Index: kresources/slox/kcal_slox.desktop
===================================================================
--- kresources/slox/kcal_slox.desktop	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ kresources/slox/kcal_slox.desktop	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -38,7 +38,7 @@
 Name[pa]=SUSE LINUX Openexchange à¨¸à¨°à¨µà¨°
 Name[pl]=Serwer SUSE LINUX Openexchange
 Name[pt]=Servidor SUSE LINUX Openexchange
-Name[pt_BR]=Servidor OpenExchange do SUSE Linux (SLOX)
+Name[pt_BR]=Servidor Openexchange do SUSE Linux (SLOX)
 Name[ru]=Ð¡ÐµÑ€Ð²ÐµÑ€ SUSE LINUX Openexchange
 Name[sl]=StreÅ¾nik SUSE LINUX Openexchange
 Name[sv]=SUSE Linux Openexchange-server
Index: kresources/slox/kabc_slox.desktop
===================================================================
--- kresources/slox/kabc_slox.desktop	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ kresources/slox/kabc_slox.desktop	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -38,7 +38,7 @@
 Name[pa]=SUSE LINUX Openexchange à¨¸à¨°à¨µà¨°
 Name[pl]=Serwer SUSE LINUX Openexchange
 Name[pt]=Servidor SUSE LINUX Openexchange
-Name[pt_BR]=Servidor OpenExchange do SUSE Linux (SLOX)
+Name[pt_BR]=Servidor Openexchange do SUSE Linux (SLOX)
 Name[ru]=Ð¡ÐµÑ€Ð²ÐµÑ€ SUSE LINUX Openexchange
 Name[sl]=StreÅ¾nik SUSE LINUX Openexchange
 Name[sv]=SUSE Linux Openexchange-server
Index: kmail/messagelistview/core/model.cpp
===================================================================
--- kmail/messagelistview/core/model.cpp	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ kmail/messagelistview/core/model.cpp	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -60,6 +60,7 @@
 #include <QScrollBar>
 
 #include <KLocale>
+#include <KCalendarSystem>
 #include <KGlobal>
 #include <KDebug>
 #include <kcursorsaver.h>
@@ -1182,34 +1183,6 @@
   }
 }
 
-static inline QString get_capitalized_long_day_name( int dayOfWeek )
-{
-  // The day name should be capitalized in the group labels
-  // This fixes some complaints from translators that have mapped
-  // their standard day names to lowercase versions for general
-  // use but still want them to be capitalized in the headers...
-  QString name = QDate::longDayName( dayOfWeek );
-  if ( name.isEmpty() )
-    return name;
-  QString copy = name;
-  copy[ 0 ] = name.at( 0 ).toUpper();
-  return copy;
-}
-
-static inline QString get_capitalized_month_name( int month )
-{
-  // The month name should be capitalized in the group labels
-  // This fixes some complaints from translators that have mapped
-  // their standard month names to lowercase versions for general
-  // use but still want them to be capitalized in the headers...
-  QString name = QDate::longMonthName( month );
-  if ( name.isEmpty() )
-    return name;
-  QString copy = name;
-  copy[ 0 ] = name.at( 0 ).toUpper();
-  return copy;
-}
-
 void Model::attachMessageToGroupHeader( MessageItem *mi )
 {
   QString groupLabel;
@@ -1265,24 +1238,12 @@
         if ( dateWeekNumber == todayWeekNumber )
         {
           // within this week
-          groupLabel = get_capitalized_long_day_name( dDate.dayOfWeek() );
+          groupLabel = KGlobal::locale()->calendar()->weekDayName( dDate );
         } else {
-          // not this week
-          // FIXME: After 4.2 think about a configurable date format.
-          //        At the moment KMime::DateFormatter doesn't support date-only formatting.
-          //        KDateTime is not better than QDate in this case.
-          //        A configurable date-only format should be probably tweaked into KMime::DateFormatter
-          //        but this can't be done with the string freeze in effect.
-          groupLabel = dDate.toString( Qt::DefaultLocaleShortDate );
+          groupLabel = KGlobal::locale()->formatDate( dDate, KLocale::ShortDate );
         }
       } else {
-        // not within this month
-        // FIXME: After 4.2 think about a configurable date format.
-        //        At the moment KMime::DateFormatter doesn't support date-only formatting.
-        //        KDateTime is not better than QDate in this case.
-        //        A configurable date-only format should be probably tweaked into KMime::DateFormatter
-        //        but this can't be done with the string freeze in effect.
-        groupLabel = dDate.toString( Qt::DefaultLocaleShortDate );
+        groupLabel = KGlobal::locale()->formatDate( dDate, KLocale::ShortDate );
       }
 
     }
@@ -1335,7 +1296,7 @@
         if ( dateWeekNumber == todayWeekNumber )
         {
           // within this week
-          groupLabel = get_capitalized_long_day_name( dDate.dayOfWeek() );
+          groupLabel = KGlobal::locale()->calendar()->weekDayName( dDate );
         } else {
           // previous weeks
           int weekDiff = todayWeekNumber - dateWeekNumber;
@@ -1364,10 +1325,12 @@
         )
         {
           // group by months, this year (so no year appended)
-          groupLabel = get_capitalized_month_name( dDate.month() );
+          groupLabel = KGlobal::locale()->calendar()->monthName( dDate );
         } else {
           // group by months
-          groupLabel = QString( "%1 %2" ).arg( get_capitalized_month_name( dDate.month() ) ).arg( dDate.year() );
+          groupLabel = QString( "%1 %2" )
+            .arg( KGlobal::locale()->calendar()->monthName( dDate ) )
+            .arg( dDate.year() );
         }
       }
     }
Index: kmail/kmcommands.cpp
===================================================================
--- kmail/kmcommands.cpp	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ kmail/kmcommands.cpp	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -2441,6 +2441,10 @@
       s = node->msgPart().name().trimmed().replace( ':', '_' );
     if ( s.isEmpty() )
       s = i18nc("filename for an unnamed attachment", "attachment.1");
+    else {  // better not use a dir-delimiter in a filename
+      s = s.replace( '/', '_' );
+      s = s.replace( '\\', '_' );
+    }
     url = KFileDialog::getSaveUrl( KUrl( "kfiledialog:///saveAttachment/" + s ),
                                    QString(),
                                    parentWidget(),
@@ -2474,6 +2478,10 @@
                  "attachment.%1",
               unnamedAtmCount );
       }
+      else {  // better not use a dir-delimiter in a filename
+        s = s.replace( '/', '_' );
+        s = s.replace( '\\', '_' );
+      }
       curUrl.setFileName( s );
     } else {
       curUrl = url;
Index: kmail/folderstorage.cpp
===================================================================
--- kmail/folderstorage.cpp	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ kmail/folderstorage.cpp	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -1173,7 +1173,7 @@
   if ( !mSearchPattern )
     return;
   QList<quint32> matchingSerNums;
-  const int end = qMin( mCurrentSearchedMsg + 100, count() );
+  const int end = qMin( mCurrentSearchedMsg + 10, count() );
   for ( int i = mCurrentSearchedMsg; i < end; ++i )
   {
     quint32 serNum = KMMsgDict::instance()->getMsgSerNum( folder(), i );
Index: doc/kleopatra/index.docbook
===================================================================
--- doc/kleopatra/index.docbook	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ doc/kleopatra/index.docbook	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -1246,11 +1246,14 @@
       </para>
 
       <para>
-	The only mandatory key in a <literal>Key Filter
-	#<replaceable>n</replaceable></literal> group is
+	The only mandatory keys in a <literal>Key Filter
+	#<replaceable>n</replaceable></literal> group are
 	<varname>Name</varname>, containing the name of the category
 	as displayed in the <link
-	linkend="configuration-appearance">config dialog</link>.
+	linkend="configuration-appearance">config dialog</link>, and
+	<varname>id</varname>, which is used as a reference for the
+	filter in other configuration sections (such as <literal>View
+	#<replaceable>n</replaceable></literal>).
       </para>
 
       <para>
@@ -1362,6 +1365,21 @@
 	      <entry>the key has been revoked.</entry>
 	    </row>
 	    <row>
+	      <entry><varname>match-context</varname></entry>
+	      <entry>
+                context<footnote>
+                  <para>
+                    Context is an enumeration with the following
+                    allowed values:
+                    <literal>appearance</literal>,
+                    <literal>filtering</literal>
+                    and <literal>any</literal>.
+                  </para>
+                </footnote>
+              </entry>
+	      <entry>the context in which this filter matches.</entry>
+	    </row>
+	    <row>
 	      <entry><varname>is-expired</varname></entry>
 	      <entry>boolean</entry>
 	      <entry>the key is expired.</entry>
@@ -1413,6 +1431,22 @@
 	      </entry>
 	    </row>
 	    <row>
+	      <entry><varname>is-qualified</varname></entry>
+	      <entry>boolean</entry>
+	      <entry>
+		the key can be used to make Qualified Signatures (as
+		defined by the German Digital Signature Law).
+	      </entry>
+	    </row>
+	    <row>
+	      <entry><varname>is-cardkey</varname></entry>
+	      <entry>boolean</entry>
+	      <entry>
+		the key material is stored on a smartcard (instead of
+		on the computer).
+	      </entry>
+	    </row>
+	    <row>
 	      <entry><varname>has-secret-key</varname></entry>
 	      <entry>boolean</entry>
 	      <entry>
Index: doc/ktimetracker/index.docbook
===================================================================
--- doc/ktimetracker/index.docbook	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ doc/ktimetracker/index.docbook	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -470,41 +470,28 @@
 
 </sect2>
 
-<sect2 id="dcop"><title>&DCOP;</title>
+<sect2 id="dcop"><title>&DBus;</title>
 
-<para>&DCOP; is the mechanism &kde; programs use to communicate with each
+<para>&DBus; is the mechanism &kde; programs use to communicate with each
 other.  A &kde; program provides a list of functions that other programs (a Bash
 script, for example) can use.</para>
 
 <example><title>Bash script that echo's &karm;'s version</title>
 <programlisting>
-	DCOPID=`dcop | grep karm`
-	if [ $DCOPID ]
-	then
-		VERS=`dcop $DCOPID KarmDCOPIface version`
-		echo "&karm; version is $VERS"
-	else
-		echo "&karm; not running"
-	fi
+qdbus org.kde.ktimetracker /KTimeTracker version 2>/dev/null || echo "ktimetracker not running"
 </programlisting>
 </example>
 
-<para>&karm;'s current &DCOP; interface is currently used mainly for automated
+<para>&karm;'s current &DBus; interface is currently used mainly for automated
 	testing, so it is very limited.  For the full interface definition, see
-	<link linkend="dcopappendix">&DCOP; Interface Appendix</link>.</para>
+	<link linkend="dcopappendix">&DBus; Interface Appendix</link>.</para>
 
-<para>To see the full &DCOP; interface of the &karm; version installed on your
+<para>To see the full &DBus; interface of the &karm; version installed on your
 	system, run the following Bash script:</para>
 
-<example><title>List &karm;'s &DCOP; interface to console</title>
+<example><title>List &karm;'s &DBus; interface to console</title>
 <programlisting>
-	DCOPID=`dcop | grep karm`
-	if [ $DCOPID ]
-	then
-		dcop $DCOPID KarmDCOPIface
-	else
-		echo "&karm; not running"
-	fi
+qdbus org.kde.ktimetracker /KTimeTracker 2>/dev/null || echo "ktimetracker not running"
 </programlisting>
 </example>
 </sect2>
@@ -642,312 +629,6 @@
 
 </sect1>
 
-<sect1 id="menus">
-<title>The &karm; menubar</title>
-<sect2>
-<title>The <guimenu>File</guimenu> menu</title>
-
-<variablelist>
-<varlistentry>
-<term>
-<menuchoice><shortcut>
-<keycombo action="simul">&Ctrl;<keycap>S</keycap></keycombo>
-</shortcut>
-<guimenu>File</guimenu>
-<guimenuitem>Save</guimenuitem>
-</menuchoice></term>
-<listitem>
-<para><action>Saves the current tasks and subtasks with their accumulated
-times</action></para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term>
-<menuchoice>
-<shortcut>
-<keycombo action="simul">&Ctrl;<keycap>P</keycap></keycombo>
-</shortcut>
-<guimenu>File</guimenu>
-<guimenuitem>Print</guimenuitem>
-</menuchoice></term>
-<listitem><para>
-<action>Prints</action> the &karm; window</para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term><menuchoice>
-<guimenu>File</guimenu>
-<guimenuitem>Start New Session</guimenuitem>
-</menuchoice></term>
-<listitem>
-<para><action>Resets </action>all session times to zero</para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term><menuchoice>
-<guimenu>File</guimenu>
-<guimenuitem>Reset All Times</guimenuitem>
-</menuchoice></term>
-<listitem>
-<para><action>Resets </action>all times to zero</para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term><menuchoice>
-<guimenu>File</guimenu>
-<guisubmenu>Import/Export</guisubmenu>
-<guimenuitem>Import Legacy Flat File...</guimenuitem>
-</menuchoice></term>
-<listitem>
-<para><action>Import </action>old style &karm; save files (&karm; 
-now uses iCalendar-style save files.)</para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term><menuchoice>
-<guimenu>File</guimenu>
-<guisubmenu>Import/Export</guisubmenu>
-<guimenuitem>Import Tasks from Planner...</guimenuitem>
-</menuchoice></term>
-<listitem>
-<para><action>Import </action>an imendio planner project (see <ulink
-url="http://planner.imendio.org">planner.imendio.org</ulink>). All tasks, subtasks and their "completed" flag will be imported from a .planner-file. You can import them as a subtask by creating a subtask, leaving it marked, and then importing. </para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term>
-<menuchoice>
-<guimenu>File</guimenu>
-<guisubmenu>Import/Export</guisubmenu>
-<guimenuitem>Export to CSV file...</guimenuitem>
-</menuchoice></term>
-<listitem>
-<para><action>Export </action>
-<guilabel>Total Session Time</guilabel>,
-<guilabel>Session Time</guilabel>, <guilabel>Time</guilabel>, and
-<guilabel>Total Time</guilabel> to a text file.</para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term><menuchoice>
-<guimenu>File</guimenu>
-<guisubmenu>Import/Export</guisubmenu>
-<guimenuitem>Export History to CSV file...</guimenuitem>
-</menuchoice></term>
-<listitem>
-<para><action>Export </action> task history to a text file.
-</para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term><menuchoice>
-<shortcut>
-<keycombo action="simul">&Ctrl;<keycap>C</keycap></keycombo>
-</shortcut>
-<guimenu>File</guimenu>
-<guimenuitem>Copy Totals to Clipboard</guimenuitem>
-</menuchoice></term>
-<listitem>
-<para><action>Copies </action> the current total time for a 
-task or all tasks to the &kde; clipboard</para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term><menuchoice>
-<shortcut>
-<keycombo action="simul">&Ctrl;&Alt;<keycap>C</keycap></keycombo>
-</shortcut>
-<guimenu>File</guimenu>
-<guimenuitem>Copy History to Clipboard</guimenuitem>
-</menuchoice></term>
-<listitem>
-<para><action>Copies </action> daily times for a 
-given period to the &kde; clipboard</para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term><menuchoice>
-<shortcut>
-<keycombo action="simul">&Ctrl;<keycap>Q</keycap></keycombo>
-</shortcut>
-<guimenu>File</guimenu>
-<guimenuitem>Quit</guimenuitem>
-</menuchoice></term>
-<listitem>
-<para><action>Closes</action> &karm;</para>
-</listitem>
-</varlistentry>
-</variablelist>
-
-</sect2>
-
-<sect2>
-<title>The <guimenu>Clock</guimenu> menu</title>
-
-<variablelist>
-<varlistentry>
-<term>
-<menuchoice>
-<shortcut><keycap>S</keycap></shortcut>
-<guimenu>Clock</guimenu>
-<guimenuitem>Start</guimenuitem>
-</menuchoice>
-</term>
-<listitem>
-<para><action>Starts</action> timing the selected task</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term>
-<menuchoice>
-<guimenu>Clock</guimenu>
-<guimenuitem>Stop</guimenuitem>
-</menuchoice>
-</term>
-<listitem>
-<para><action>Stops</action> timing the selected task</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term>
-<menuchoice>
-<shortcut><keycap>&Esc;</keycap></shortcut>
-<guimenu>Clock</guimenu>
-<guimenuitem>Stop All Timers</guimenuitem>
-</menuchoice>
-</term>
-<listitem><para><action>Stops</action> timing all tasks</para></listitem>
-</varlistentry>
-</variablelist>
-</sect2>
-
-<sect2>
-<title>The <guimenu>Task</guimenu> menu</title>
-
-<variablelist>
-<varlistentry>
-<term>
-<menuchoice>
-<shortcut>
-<keycombo action="simul">&Ctrl;<keycap>N</keycap></keycombo>
-</shortcut>
-<guimenu>Task</guimenu>
-<guimenuitem>New</guimenuitem>
-</menuchoice>
-</term>
-<listitem><para><action>Add</action> a new task</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term>
-<menuchoice>
-<shortcut>
-<keycombo action="simul">&Ctrl;&Alt;<keycap>N</keycap></keycombo>
-</shortcut>
-<guimenu>Task</guimenu>
-<guimenuitem>New Subtask</guimenuitem>
-</menuchoice>
-</term>
-<listitem>
-<para><action>Add</action> a new subtask to the selected task</para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term>
-<menuchoice>
-<shortcut>
-<keycap>Del</keycap>
-</shortcut>
-<guimenu>Task</guimenu>
-<guimenuitem>Delete</guimenuitem>
-</menuchoice>
-</term>
-<listitem>
-<para><action>Delete</action> the selected task or subtask</para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term>
-<menuchoice>
-<shortcut>
-<keycombo action="simul">&Ctrl;<keycap>E</keycap></keycombo>
-</shortcut>
-<guimenu>Task</guimenu>
-<guimenuitem>Edit</guimenuitem>
-</menuchoice>
-</term>
-<listitem>
-<para><action>Change the name or accumulated time</action> for the
-current task</para><para>There are two options for changing the time: Edit
-Absolute, in which the session and total times can be changed separately;
-and Edit Relative, in which a certain change is added to or subtracted from
-both the session and total times.</para><para>The Auto tracking option allows 
-timing to start and stop automatically when you switch to or from a particular 
-&kde; desktop.</para>
-</listitem>
-</varlistentry>
-</variablelist>
-</sect2>
-
-<sect2>
-<title>The <guimenu>Settings</guimenu> menu</title>
-<variablelist>
-
-
-<varlistentry>
-<term>
-<menuchoice>
-<guimenu>Settings</guimenu>
-<guimenuitem>Configure Shortcuts</guimenuitem>
-</menuchoice>
-</term>
-<listitem><para><action>Opens</action> a dialog to allow the user to customize
-the keyboard shortcuts</para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term>
-<menuchoice>
-<guimenu>Settings</guimenu>
-<guimenuitem>Configure &karm;</guimenuitem>
-</menuchoice>
-</term>
-<listitem><para><action>Opens</action> a dialog to allow the user to
-configure &karm;</para>
-
-<para>The dialog has three tabbed panes: <guilabel>Behavior </guilabel>, which 
-allows you to specify an alert for no activity and a warning message when you 
-delete a task set, <guilabel>Display </guilabel>, which configures the fields 
-shown in the main window and <guilabel>Storage</guilabel>,
-which configures the location of the save file, whether auto saving is
-enabled and the auto save interval.</para> </listitem>
-</varlistentry>
-
-</variablelist>
-</sect2>
-
-<sect2>
-<title>The <guimenu>Help</guimenu> menu</title>
-
-&help.menu.documentation;
-
-</sect2>
-
-</sect1>
-
 <sect1 id="tool-bar">
 <title>The Toolbar</title>
 <para>The toolbar contains icons for the following commands:</para>
@@ -1033,7 +714,7 @@
 </glossentry>
 
 <glossentry id="gloss-dcop">
-<glossterm>&DCOP;</glossterm>
+<glossterm>&DBus;</glossterm>
 <glossdef><para>The interprocess communication protocol used in &kde;.  Short
 for Desktop COmmunication Protocol.</para></glossdef>
 </glossentry>
@@ -1106,7 +787,7 @@
 
 </appendix>
 
-<appendix id="dcopappendix"><title>&DCOP; Interface</title>
+<appendix id="dcopappendix"><title>&DBus; Interface</title>
 
 <refentry id="dcop-version">
 <refmeta>
@@ -1123,7 +804,7 @@
 </refsynopsisdiv>
 <refsect1>
 <title>Description</title>
-<para><function>version()</function> is a &DCOP; call that returns &karm;'s
+<para><function>version()</function> is a &DBus; call that returns &karm;'s
 version number; for example 1.5.0.  The version number is returned as a string
 in the typical &GNU; format of major.minor.bugfix.</para>
 </refsect1>
@@ -1144,7 +825,7 @@
 </refsynopsisdiv>
 <refsect1>
 <title>Description</title>
-<para><function>quit()</function> is a &DCOP; call that provides a way that an
+<para><function>quit()</function> is a &DBus; call that provides a way that an
 external program can gracefully shutdown &karm;.
 </para>
 </refsect1>
@@ -1176,7 +857,7 @@
 </refsynopsisdiv>
 <refsect1>
 <title>Description</title>
-<para><function>hastodo(QString taskname)</function> is a &DCOP; call that
+<para><function>hastodo(QString taskname)</function> is a &DBus; call that
 	looks for a of the given name.  If found, it returns the
 	iCalendar UID that identifies that to-do.  If not found, it returns an empty
 	string.
@@ -1214,7 +895,7 @@
 
 <refsect1>
 <title>Description</title>
-<para><function>addtodo(QString todoname)</function> is a &DCOP; call that
+<para><function>addtodo(QString todoname)</function> is a &DBus; call that
 	adds a new top-level to-do to the current storage.  The UID of the new to-do
 	is returned.
 </para>
Index: doc/kmail/configure.docbook
===================================================================
--- doc/kmail/configure.docbook	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ doc/kmail/configure.docbook	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -1930,6 +1930,21 @@
 <para>Invitations use to be send as attachments to a mail. By enabling this option, you let the invitation mails to be sent in the text of the mail, which is necessary to send invitations and replies to Microsoft Outlook(tm).</para>
 </listitem>
 </varlistentry>
+<varlistentry>
+<term><guilabel>Exchange compatible invitations naming</guilabel></term>
+<listitem>
+<para>Microsoft Outlook, when used in combination with a Microsoft Exchange
+server, has a problem understanding standards-compliant groupware e-mail.
+Enable this option to send groupware invitations in a way that Microsoft
+Exchange understands. The invitation will be sent as an attachment with name <filename>ical.ics</filename>.</para>
+</listitem>
+</varlistentry>
+<varlistentry>
+<term><guilabel>Outlook compatible invitation reply comments</guilabel></term>
+<listitem>
+<para>When the user provides comments when responding to invitations, send the comment in way that Microsoft Outlook(tm) understands. If this option is not enabled, the reponse comments will not be seen in Outlook.</para>
+</listitem>
+</varlistentry>
 </variablelist>
 </sect2>
 
Index: doc/knode/more.docbook
===================================================================
--- doc/knode/more.docbook	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ doc/knode/more.docbook	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -98,10 +98,10 @@
 url="http://www.kirchwitz.de/~amk/dni/usenet-einfuehrung">http://www.kirchwitz.de/~amk/dni/usenet-einfuehrung</ulink>
 (German)</member> 
 <member>Why should I take the rules seriously? <ulink
-url="http://www.kirchwitz.de/~amk/dni/warum-regel">http://www.kirchwitz.de/~amk/dni/warum-regel</ulink>
+url="http://www.kirchwitz.de/~amk/dni/warum-regeln">http://www.kirchwitz.de/~amk/dni/warum-regeln</ulink>
 (German)</member> 
 <member>The newsreader <acronym>FAQ</acronym>: <ulink
-url="http://www.crosswinds.net/~cgarbers/faq/newsreaderFAQ.htm">http://www.crosswinds.net/~cgarbers/faq/newsreaderFAQ.htm</ulink></member> 
+url="http://www.thomas-huehn.de/usenet/newsreaderFAQ.txt">http://www.thomas-huehn.de/usenet/newsreaderFAQ.txt</ulink> (German)</member> 
 <member>The correct quoting: <ulink
 url="http://www.afaik.de/usenet/faq/zitieren">http://www.afaik.de/usenet/faq/zitieren</ulink>
 (German)</member> 
@@ -122,13 +122,13 @@
 <simplelist> 
 <member>Header entries: <ulink url="http://www.kirchwitz.de/~amk/dni/headerzeilen"> 
 http://www.kirchwitz.de/~amk/dni/headerzeilen</ulink> (German)</member> 
-<member>A very useful message-ID <acronym>FAQ</acronym>: <ulink url="http://www.qad.org/faq/faq-messageid.html"> 
-http://www.qad.org/faq/faq-messageid.html</ulink></member> 
+<member>A very useful message-ID <acronym>FAQ</acronym>: <ulink url="http://www.hanau.net/usenet/faq/messageid.php"> 
+http://www.hanau.net/usenet/faq/messageid.php (German)</ulink></member> 
 <member>A lot of links about newsreaders and related topics: <ulink
-url="http://www.leafnode.org/links">http://www.leafnode.org/links</ulink></member> 
+url="http://www.leafnode.org/links.shtml">http://www.leafnode.org/links.shtml</ulink></member> 
 <member><acronym>RFC</acronym>s, Drafts and documents for the technical
-interested: <ulink url="http://www.landfield.com/usefor/"> 
-http://www.landfield.com/usefor/</ulink></member> 
+interested: <ulink url="http://tools.ietf.org/wg/usefor/">
+http://tools.ietf.org/wg/usefor/</ulink></member> 
 </simplelist> 
 </sect1> 
 </chapter> 
Index: doc/kpilot/usage.docbook
===================================================================
--- doc/kpilot/usage.docbook	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ doc/kpilot/usage.docbook	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -8,7 +8,7 @@
 </para>
 
 <para>
-On the first start &kpilot; opens the configuration dialog which allows to you adjust its 
+On the first start &kpilot; opens the configuration dialog which allows you to adjust its 
 settings and select and configure the conduits to be used.
 Click the <guibutton>OK</guibutton> button to switch to the
 &HotSync;-log, as shown <link linkend="main-app">here</link>.
Index: doc/kalarm/index.docbook
===================================================================
--- doc/kalarm/index.docbook	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ doc/kalarm/index.docbook	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -41,8 +41,8 @@
 
 <!-- Don't change format of date and version of the documentation -->
 
-<date>2009-05-25</date>
-<releaseinfo>2.02.00</releaseinfo>
+<date>2008-09-25</date>
+<releaseinfo>2.2.7</releaseinfo>
 
 <abstract>
 <para>&kalarm; is a personal alarm message, command and email scheduler for &kde;.</para>
@@ -423,21 +423,25 @@
 <sect2>
 <title>Deleting/Reactivating an Alarm</title>
 
-<para>To delete existing alarms, do one of the following:</para>
+<para>To delete existing alarms, select one or more by clicking on
+their entries in the alarm list. Then do one of the following:</para>
 
 <itemizedlist>
 <listitem>
-<para>Select one or more alarms by clicking on their entries in the
-alarm list. Then choose <menuchoice>
+<para>Choose <menuchoice>
 <guimenu>Actions</guimenu><guimenuitem>Delete</guimenuitem>
 </menuchoice>.</para>
 </listitem>
 <listitem>
-<para><mousebutton>Right</mousebutton> click on the desired entries in
-the alarm list and choose
+<para><mousebutton>Right</mousebutton> click on the selected entries
+and choose
 <menuchoice><guimenuitem>Delete</guimenuitem></menuchoice>
 from the context menu.</para>
 </listitem>
+<listitem>
+<para>To delete them without a confirmation prompt, type
+&Shift;-<keycap>Delete</keycap>.</para>
+</listitem>
 </itemizedlist>
 
 <para>When you delete an active alarm, it is archived, provided that
@@ -2833,7 +2837,7 @@
   <replaceable>period</replaceable></option></entry>
   <entry>Cancel the alarm if it cannot be triggered within the
   specified <replaceable>period</replaceable> after the correct
-  time. The <replaceable>period</replaceable> period is specified in
+  time. The <replaceable>period</replaceable> is specified in
   the same format as described for <option>--reminder</option>.
   The default value of <replaceable>period</replaceable> is 1
   minute.</entry>
Index: kalarm/functions.h
===================================================================
--- kalarm/functions.h	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ kalarm/functions.h	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -141,21 +141,7 @@
 KDateTime           applyTimeZone(const QString& tzstring, const QDate& date, const QTime& time,
                                   bool haveTime, const KDateTime& defaultDt = KDateTime());
 bool                isWorkingTime(const KDateTime&, const KAEvent*);
-int                 localeFirstDayOfWeek();
-QString             weekDayName(int day, const KLocale*);
 
-/* Given a standard KDE day number, return the day number in the week for the user's locale.
- * Standard day number = 1 (Mon) .. 7 (Sun)
- * Locale day number in week = 0 .. 6
- */
-inline int          weekDay_to_localeDayInWeek(int weekDay)  { return (weekDay + 7 - localeFirstDayOfWeek()) % 7; }
-
-/* Given a day number in the week for the user's locale, return the standard KDE day number.
- * 'index' = 0 .. 6
- * Standard day number = 1 (Mon) .. 7 (Sun)
- */
-inline int          localeDayInWeek_to_weekDay(int index)  { return (index + localeFirstDayOfWeek() - 1) % 7 + 1; }
-
 #ifndef NDEBUG
 void                setTestModeConditions();
 void                setSimulatedSystemTime(const KDateTime&);
Index: kalarm/Changelog
===================================================================
--- kalarm/Changelog	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ kalarm/Changelog	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -1,5 +1,8 @@
 KAlarm Change Log
 
+=== Version 2.2.8 --- 19 August 2009 ===
+- Use KDE system settings to determine default working days in the week.
+
 === Version 2.2.7 (KDE 4.3.1) --- 19 August 2009 ===
 - Shift-Delete now deletes alarms without showing confirmation prompt.
 - Disable edit alarm dialogue OK button if no changes have been made.
Index: kalarm/lib/kalocale.h
===================================================================
--- kalarm/lib/kalocale.h	(.../tags/KDE/4.3.1/kdepim)	(wersja 0)
+++ kalarm/lib/kalocale.h	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -0,0 +1,54 @@
+/*
+ *  kalocale.h  -  miscellaneous locale functions
+ *  Program:  kalarm
+ *  Copyright Â© 2004-2009 by David Jarvie <djarvie@kde.org>
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License along
+ *  with this program; if not, write to the Free Software Foundation, Inc.,
+ *  51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ */
+
+#ifndef LOCALE_H
+#define LOCALE_H
+
+#include <QString>
+class KLocale;
+
+namespace KAlarm
+{
+
+/** Return the first day of the week for the user's locale.
+*   Reply = 1 (Mon) .. 7 (Sun).
+*/
+int        localeFirstDayOfWeek();
+
+/** Return the week day name (Monday = 1). */
+QString    weekDayName(int day, const KLocale*);
+
+/* Given a standard KDE day number, return the day number in the week for the user's locale.
+ * Standard day number = 1 (Mon) .. 7 (Sun)
+ * Locale day number in week = 0 .. 6
+ */
+inline int weekDay_to_localeDayInWeek(int weekDay)  { return (weekDay + 7 - localeFirstDayOfWeek()) % 7; }
+
+/* Given a day number in the week for the user's locale, return the standard KDE day number.
+ * 'index' = 0 .. 6
+ * Standard day number = 1 (Mon) .. 7 (Sun)
+ */
+inline int localeDayInWeek_to_weekDay(int index)  { return (index + localeFirstDayOfWeek() - 1) % 7 + 1; }
+
+uint defaultWorkDays();
+
+} // namespace KAlarm
+
+#endif // LOCALE_H
Index: kalarm/lib/kalocale.cpp
===================================================================
--- kalarm/lib/kalocale.cpp	(.../tags/KDE/4.3.1/kdepim)	(wersja 0)
+++ kalarm/lib/kalocale.cpp	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -0,0 +1,83 @@
+/*
+ *  kalocale.cpp  -  miscellaneous locale functions
+ *  Program:  kalarm
+ *  Copyright Â© 2003-2009 by David Jarvie <djarvie@kde.org>
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License along
+ *  with this program; if not, write to the Free Software Foundation, Inc.,
+ *  51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ */
+
+#include "kalarm.h"   //krazy:exclude=includes (kalarm.h must be first)
+#include "kalocale.h"
+
+#include <kglobal.h>
+#include <klocale.h>
+#include <kdebug.h>
+
+
+namespace KAlarm
+{
+
+/******************************************************************************
+*  Return the first day of the week for the user's locale.
+*  Reply = 1 (Mon) .. 7 (Sun).
+*/
+int localeFirstDayOfWeek()
+{
+	static int firstDay = 0;
+	if (!firstDay)
+		firstDay = KGlobal::locale()->weekStartDay();
+	return firstDay;
+}
+
+/******************************************************************************
+* Return the week day name (Monday = 1).
+*/
+QString weekDayName(int day, const KLocale* locale)
+{
+	switch (day)
+	{
+		case 1: return ki18nc("@option Name of the weekday", "Monday").toString(locale);
+		case 2: return ki18nc("@option Name of the weekday", "Tuesday").toString(locale);
+		case 3: return ki18nc("@option Name of the weekday", "Wednesday").toString(locale);
+		case 4: return ki18nc("@option Name of the weekday", "Thursday").toString(locale);
+		case 5: return ki18nc("@option Name of the weekday", "Friday").toString(locale);
+		case 6: return ki18nc("@option Name of the weekday", "Saturday").toString(locale);
+		case 7: return ki18nc("@option Name of the weekday", "Sunday").toString(locale);
+	}
+	return QString();
+}
+
+/******************************************************************************
+* Return the default work days in the week, as a bit mask.
+* They are determined by the start and end work days in system settings.
+*/
+uint defaultWorkDays()
+{
+	KLocale* locale = KGlobal::locale();
+	int end = locale->workingWeekEndDay() - 1;
+	uint days = 0;
+	for (int day = locale->workingWeekStartDay() - 1;  ; )
+	{
+		days |= 1 << day;
+		if (day == end)
+			break;
+		++day;
+		if (day >= 7)
+			day = 0;
+	}
+	return days;
+}
+
+} // namespace KAlarm
Index: kalarm/functions.cpp
===================================================================
--- kalarm/functions.cpp	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ kalarm/functions.cpp	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -1562,36 +1562,6 @@
 }
 
 /******************************************************************************
-*  Return the first day of the week for the user's locale.
-*  Reply = 1 (Mon) .. 7 (Sun).
-*/
-int localeFirstDayOfWeek()
-{
-	static int firstDay = 0;
-	if (!firstDay)
-		firstDay = KGlobal::locale()->weekStartDay();
-	return firstDay;
-}
-
-/******************************************************************************
-* Return the week day name (Monday = 1).
-*/
-QString weekDayName(int day, const KLocale* locale)
-{
-	switch (day)
-	{
-		case 1: return ki18nc("@option Name of the weekday", "Monday").toString(locale);
-		case 2: return ki18nc("@option Name of the weekday", "Tuesday").toString(locale);
-		case 3: return ki18nc("@option Name of the weekday", "Wednesday").toString(locale);
-		case 4: return ki18nc("@option Name of the weekday", "Thursday").toString(locale);
-		case 5: return ki18nc("@option Name of the weekday", "Friday").toString(locale);
-		case 6: return ki18nc("@option Name of the weekday", "Saturday").toString(locale);
-		case 7: return ki18nc("@option Name of the weekday", "Sunday").toString(locale);
-	}
-	return QString();
-}
-
-/******************************************************************************
 * Convert a date/time specification string into a local date/time or date value.
 * Parameters:
 *   timeString  = in the form [[[yyyy-]mm-]dd-]hh:mm [TZ] or yyyy-mm-dd [TZ].
Index: kalarm/kalarmconfig.kcfg
===================================================================
--- kalarm/kalarmconfig.kcfg	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ kalarm/kalarmconfig.kcfg	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -10,6 +10,7 @@
   <include>qnamespace.h</include>
   <include>kglobalsettings.h</include>
   <include>"timeperiod.h"</include>
+  <include>"kalocale.h"</include>
 
   <kcfgfile name="kalarmrc"/>
 
@@ -193,7 +194,7 @@
     <entry name="Base_WorkDays" key="WorkDays" type="UInt">
       <label context="@label">Working days</label>
       <whatsthis context="@info:whatsthis">OR'ed bits indicating which days of the week are work days, 1 = Monday ... 64 = Sunday.</whatsthis>
-      <default>31</default>
+      <default code="true">KAlarm::defaultWorkDays()</default>
       <emit signal="base_WorkTimeChanged"/>
     </entry>
     <entry name="DisabledColour" type="Color">
Index: kalarm/prefdlg.cpp
===================================================================
--- kalarm/prefdlg.cpp	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ kalarm/prefdlg.cpp	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -32,6 +32,7 @@
 #include "identities.h"
 #include "itembox.h"
 #include "kalarmapp.h"
+#include "kalocale.h"
 #include "kamail.h"
 #include "label.h"
 #include "latecancel.h"
Index: kalarm/CMakeLists.txt
===================================================================
--- kalarm/CMakeLists.txt	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ kalarm/CMakeLists.txt	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -30,6 +30,7 @@
 	lib/identities.cpp
 	lib/itembox.cpp
 	lib/label.cpp 
+	lib/kalocale.cpp
 	lib/messagebox.cpp 
 	lib/packedlayout.cpp 
 	lib/pushbutton.cpp 
Index: kalarm/recurrenceedit.cpp
===================================================================
--- kalarm/recurrenceedit.cpp	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ kalarm/recurrenceedit.cpp	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -50,6 +50,7 @@
 #include "dateedit.h"
 #include "functions.h"
 #include "kalarmapp.h"
+#include "kalocale.h"
 #include "karecurrence.h"
 #include "preferences.h"
 #include "radiobutton.h"
Index: libkdepim/addresseelineedit.cpp
===================================================================
--- libkdepim/addresseelineedit.cpp	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ libkdepim/addresseelineedit.cpp	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -800,7 +800,7 @@
 
 void AddresseeLineEdit::slotLDAPSearchData( const KPIM::LdapResultList &adrs )
 {
-  if ( s_LDAPLineEdit != this ) {
+  if ( adrs.isEmpty() || s_LDAPLineEdit != this ) {
     return;
   }
 
@@ -817,7 +817,8 @@
     setText( m_previousAddresses + m_searchString );
     // only complete again if the user didn't change the selection while
     // we were waiting; otherwise the completion box will be closed
-    if ( m_searchString.trimmed() != completionBox()->currentItem()->text().trimmed() ) {
+    QListWidgetItem *current = completionBox()->currentItem();
+    if ( !current || m_searchString.trimmed() != current->text().trimmed() ) {
       doCompletion( m_lastSearchMode );
     }
   }
Index: kpilot/conduits/popmail/popmail-conduit.desktop
===================================================================
--- kpilot/conduits/popmail/popmail-conduit.desktop	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ kpilot/conduits/popmail/popmail-conduit.desktop	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -37,7 +37,7 @@
 Comment[pa]=à¨†à¨ªà¨£à©‡ à¨¹à©ˆà¨‚à¨¡à¨¹à¨¿à¨²à¨¡ à¨¤à©‹à¨‚ à¨•à©‡à¨®à©‡à¨² à¨°à¨¾à¨¹à©€à¨‚ à¨®à©‡à¨² à¨­à©‡à¨œà©‹à¥¤
 Comment[pl]=WysyÅ‚a pocztÄ™ z palmtopa za pomocÄ… KMail.
 Comment[pt]=Enviar um e-mail a partir do seu dispositivo mÃ³vel atravÃ©s do KMail.
-Comment[pt_BR]=Envia mensagem do seu handheld atravÃ©s do Kmail.
+Comment[pt_BR]=Envia mensagem do seu handheld atravÃ©s do KMail.
 Comment[ru]=ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ð¿Ð¾Ñ‡Ñ‚Ñ‹ Ñ ÐšÐŸÐš Ñ‡ÐµÑ€ÐµÐ· KMail.
 Comment[sk]=PoÅ¡le poÅ¡tu z prenosnÃ©ho zariadenia cez KMail.
 Comment[sl]=PoÅ¡ljite poÅ¡to z vaÅ¡ega roÄnega raÄunalnika preko KMaila.
Index: kontact/plugins/knode/knodeplugin.desktop
===================================================================
--- kontact/plugins/knode/knodeplugin.desktop	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ kontact/plugins/knode/knodeplugin.desktop	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -56,7 +56,7 @@
 Comment[pa]=à¨•à©‡à¨¸à©°à¨ªà¨°à¨• à¨•à©‡à¨¨à©‹à¨¡ à¨ªà¨²à©±à¨—à¨‡à¨¨
 Comment[pl]=Wtyczka Kontact do wspÃ³Å‚pracy z KNode
 Comment[pt]='Plugin' do KNode para o Kontact
-Comment[pt_BR]=Plug-in do Knode para o Kontact
+Comment[pt_BR]=Plug-in do KNode para o Kontact
 Comment[ro]=Modul KNode pentru Kontact
 Comment[ru]=ÐÐ¾Ð²Ð¾ÑÑ‚Ð¸
 Comment[se]=Kontact, KNode-lassemoduvla
Index: kontact/plugins/kjots/kjots_plugin.desktop
===================================================================
--- kontact/plugins/kjots/kjots_plugin.desktop	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ kontact/plugins/kjots/kjots_plugin.desktop	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -42,7 +42,7 @@
 Comment[pa]=à¨•à©‡-à¨¸à©°à¨ªà¨°à¨• à¨•à©‡à¨œà©‚à¨Ÿ à¨ªà¨²à©±à¨—à¨‡à¨¨
 Comment[pl]=Wtyczka Kontact do wspÃ³Å‚pracy z Notatkami
 Comment[pt]='Plugin' do KJots para o Kontact
-Comment[pt_BR]=Plug-in do Kjots para o Kontact
+Comment[pt_BR]=Plug-in do KJots para o Kontact
 Comment[ru]=Ð‘Ð»Ð¾ÐºÐ½Ð¾Ñ‚
 Comment[sl]=Vstavek KJots za Kontact
 Comment[sv]=Kontact insticksdelprogram fÃ¶r Kjots
Index: korganizer/koeditorgeneraltodo.cpp
===================================================================
--- korganizer/koeditorgeneraltodo.cpp	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ korganizer/koeditorgeneraltodo.cpp	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -287,11 +287,12 @@
 
   KOEditorGeneral::readIncidence( todo );
 
-  QDateTime dueDT;
-
   if ( todo->hasDueDate() ) {
     enableAlarm( true );
-    dueDT = todo->dtDue().dateTime();
+    KDateTime dueDT = todo->dtDue();
+    if ( dueDT.isUtc() ) {
+      dueDT = dueDT.toLocalZone();
+    }
     mDueDateEdit->setDate( dueDT.date() );
     mDueTimeEdit->setTime( dueDT.time() );
     mDueCheck->setChecked( true );
@@ -308,9 +309,12 @@
   }
 
   if ( todo->hasStartDate() ) {
-    QDateTime start = todo->dtStart().dateTime();
-    mStartDateEdit->setDate( start.date() );
-    mStartTimeEdit->setTime( start.time() );
+    KDateTime startDT = todo->dtStart();
+    if ( startDT.isUtc() ) {
+      startDT = startDT.toLocalZone();
+    }
+    mStartDateEdit->setDate( startDT.date() );
+    mStartTimeEdit->setTime( startDT.time() );
     mStartCheck->setChecked( true );
     mStartSpec = todo->dtStart().timeSpec();
     mTimeZoneComboStart->selectTimeSpec( todo->dtStart().timeSpec() );
@@ -446,11 +450,11 @@
   if( mDueCheck->isChecked() || mStartCheck->isChecked() ) {
     mTimeButton->setEnabled( true );
   } else {
-    mTimeButton->setEnabled(false);
-    mTimeButton->setChecked(false);
+    mTimeButton->setEnabled( false );
+    mTimeButton->setChecked( false );
   }
 
-  if (enable) {
+  if ( enable ) {
     mStartTimeEdit->setEnabled( mTimeButton->isChecked() );
     mTimeZoneComboStart->setEnabled( mTimeButton->isChecked() );
   } else {
Index: korganizer/koeditorgeneralevent.cpp
===================================================================
--- korganizer/koeditorgeneralevent.cpp	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ korganizer/koeditorgeneralevent.cpp	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -430,8 +430,16 @@
   setTimeEditorsEnabled( !event->allDay() );
 
   if ( !isTemplate ) {
-    // the rest is for the events only
-    setDateTimes( event->dtStart(), event->dtEnd() );
+    // Convert UTC to local timezone, if needed (i.e. for kolab #204059)
+    KDateTime startDT = event->dtStart();
+    KDateTime endDT = event->dtEnd();
+    if ( startDT.isUtc() ) {
+      startDT = startDT.toLocalZone();
+    }
+    if ( endDT.isUtc() ) {
+      endDT = endDT.toLocalZone();
+    }
+    setDateTimes( startDT, endDT );
   } else {
     // set the start/end time from the template, only as a last resort #190545
     if ( !event->dtStart().isValid() || !event->dtEnd().isValid() ) {
Index: korganizer/koeditorgeneraljournal.cpp
===================================================================
--- korganizer/koeditorgeneraljournal.cpp	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ korganizer/koeditorgeneraljournal.cpp	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -148,9 +148,13 @@
 {
   setSummary( journal->summary() );
   if ( !tmpl ) {
-    setDate( journal->dtStart().date() );
+    KDateTime startDT = journal->dtStart();
+    if ( startDT.isUtc() ) {
+      startDT = startDT.toLocalZone();
+    }
+    setDate( startDT.date() );
     if ( !journal->allDay() ) {
-      setTime( journal->dtStart().time() );
+      setTime( startDT.time() );
     } else {
       setTime( QTime( -1, -1, -1 ) );
     }
Index: korganizer/views/todoview/kotodomodel.cpp
===================================================================
--- korganizer/views/todoview/kotodomodel.cpp	(.../tags/KDE/4.3.1/kdepim)	(wersja 1020187)
+++ korganizer/views/todoview/kotodomodel.cpp	(.../branches/KDE/4.3/kdepim)	(wersja 1020187)
@@ -630,11 +630,11 @@
   }
 
   TodoTreeNode *node = static_cast<TodoTreeNode *>( child.internalPointer() );
-  // every model index given out by us has a valid internal pointer, so
-  // that's save:
-  TodoTreeNode *parent = node->mParent;
-
-  return getModelIndex( parent );
+  if ( node->isValid() ) {
+    return getModelIndex( node->mParent );
+  } else {
+    return QModelIndex();
+  }
 }
 
 int KOTodoModel::columnCount( const QModelIndex &/*parent*/ ) const

Zmiany atrybutów dla: .
___________________________________________________________________
Dodane: svn:externals
   + 


