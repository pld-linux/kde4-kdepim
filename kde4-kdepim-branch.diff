Index: akregator/plugins/onlinesync/akregator_onlinesync_plugin.desktop
===================================================================
--- akregator/plugins/onlinesync/akregator_onlinesync_plugin.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akregator/plugins/onlinesync/akregator_onlinesync_plugin.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -24,6 +24,7 @@
 Name[pl]=Wsparcie dla czytnika kana≈Ç√≥w RSS Akregator
 Name[pt]=Suporte de Leitura de Fontes de Not√≠cias do Akregator
 Name[pt_BR]=Suporte para leitor de not√≠cias on-line do Akregator
+Name[sl]=Akregatorjeva podpora za spletne bralnike
 Name[sv]=St√∂d f√∂r Akregator kanall√§sare
 Name[tr]=Akregator √áevrimi√ßi Kaynak Okuyucu Desteƒüi
 Name[uk]=–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —á–∏—Ç–∞–Ω–Ω—è –º–µ—Ä–µ–∂–µ–≤–∏—Ö —Ä–æ–∑—Å–∏–ª–æ–∫ —É Akregator
Index: akregator/plugins/onlinesync/akregator_config_onlinesync.desktop
===================================================================
--- akregator/plugins/onlinesync/akregator_config_onlinesync.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akregator/plugins/onlinesync/akregator_config_onlinesync.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -35,6 +35,7 @@
 Name[pt]=Leitores 'Online'
 Name[pt_BR]=Leitores on-line
 Name[ro]=Cititori online
+Name[sl]=Spletni bralniki
 Name[sv]=Kanall√§sare
 Name[tr]=√áevrimi√ßi Okuyucular
 Name[uk]=–ü—Ä–æ–≥—Ä–∞–º–∏ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è —Ä–æ–∑—Å–∏–ª–æ–∫
Index: akregator/src/articleviewer.cpp
===================================================================
--- akregator/src/articleviewer.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akregator/src/articleviewer.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -457,7 +457,15 @@
 
     head += "</style></head><body>";
     m_part->view()->setContentsPos(0,0);
-    m_part->begin(m_link);
+
+    //pass link to the KHTMLPart to make relative links work
+    //add a bogus query item to distinguish from m_link
+    //fixes the Complete Story link if the url has an anchor (e.g. #reqRSS) in it
+    //See bug 177754
+
+    KUrl url(m_link);
+    url.addQueryItem("akregatorPreviewMode", "true");
+    m_part->begin(url);
     m_part->write(head);
 }
 
Index: akregator/src/selectioncontroller.cpp
===================================================================
--- akregator/src/selectioncontroller.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akregator/src/selectioncontroller.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -181,12 +181,11 @@
 
 void Akregator::SelectionController::articleHeadersAvailable()
 {
-    if(m_articleModel)
-        delete m_articleModel;
+    ArticleModel* const newModel = new ArticleModel( m_selectedSubscription );
+    m_articleLister->setArticleModel( newModel );
+    delete m_articleModel;
+    m_articleModel = newModel;
 
-    m_articleModel = new Akregator::ArticleModel( m_selectedSubscription );
-    m_articleLister->setArticleModel( m_articleModel );
-
     m_articleLister->setIsAggregation( m_selectedSubscription->isAggregation() );
 
     connect( m_articleLister->articleSelectionModel(), SIGNAL( selectionChanged( QItemSelection, QItemSelection ) ),
Index: akregator/src/articlelistview.cpp
===================================================================
--- akregator/src/articlelistview.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akregator/src/articlelistview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -144,9 +144,11 @@
 
 void ArticleListView::setArticleModel( ArticleModel* model )
 {
-    slotClear();
-    if ( !model )
+    if ( !model ) {
+        setModel( model );
         return;
+    }
+
     m_proxy = new SortColorizeProxyModel( model );
     m_proxy->setSourceModel( model );
     m_proxy->setSortRole( ArticleModel::SortRole );
@@ -164,12 +166,6 @@
     columnsProxy->setColumnEnabled( ArticleModel::AuthorColumn );
 
     setModel( columnsProxy );
-
-    if ( !m_headerSetUp )
-    {
-        loadHeaderSettings();
-        m_headerSetUp = true;
-    }
     header()->setContextMenuPolicy( Qt::CustomContextMenu );
 }
 
@@ -205,24 +201,16 @@
 
 void ArticleListView::saveHeaderSettings()
 {
-    //FIXME: HACK: Change back to saveState() when the Qt-bug is fixed
-    // is it qt-bug, really? at least saveState is working, but calling the next line causes app to hang.. -Teemu
-    //Settings::setArticlelistHeaderStates( header()->saveState().toBase64() );
-
-    QByteArray s = header()->saveState();
+    if ( model() )
+        m_headerState = header()->saveState();
     KConfigGroup conf( Settings::self()->config(), "General" );
-    conf.writeEntry( "ArticleListHeaders", s.toBase64() );
+    conf.writeEntry( "ArticleListHeaders", m_headerState.toBase64() );
 }
 
 void ArticleListView::loadHeaderSettings()
 {
-    //FIXME: HACK: change back to loadState+Settings class instead of using KConfigGroup directly..
-    //QByteArray s = QByteArray::fromBase64( Settings::feedlistHeaderStates().toAscii() ); // this fails currently, I think -Teemu
-
     KConfigGroup conf( Settings::self()->config(), "General" );
-    QByteArray s = QByteArray::fromBase64( conf.readEntry( "ArticleListHeaders" ).toAscii() );
-    if( !s.isNull() )
-        header()->restoreState( s );
+    m_headerState = QByteArray::fromBase64( conf.readEntry( "ArticleListHeaders" ).toAscii() );
 }
 
 QItemSelectionModel* ArticleListView::articleSelectionModel() const
@@ -287,8 +275,7 @@
 ArticleListView::ArticleListView( QWidget* parent )
     : QTreeView(parent),
     m_columnMode( Unspecified ),
-    m_isAggregation( false ),
-    m_headerSetUp( false )
+    m_isAggregation( false )
 {
     setSortingEnabled( true );
     setAlternatingRowColors( true );
@@ -296,7 +283,6 @@
     setUniformRowHeights( true );
     setRootIsDecorated( false );
     setAllColumnsShowFocus( true );
-
     setMinimumSize( 250, 150 );
     setWhatsThis( i18n("<h2>Article list</h2>"
         "Here you can browse articles from the currently selected feed. "
@@ -306,6 +292,7 @@
     //connect exactly once
     disconnect( header(), SIGNAL(customContextMenuRequested(QPoint)), this, SLOT(showHeaderMenu(QPoint)) );
     connect( header(), SIGNAL(customContextMenuRequested(QPoint)), this, SLOT(showHeaderMenu(QPoint)) );
+    loadHeaderSettings();
 }
 
 void ArticleListView::mousePressEvent( QMouseEvent *ev )
@@ -390,11 +377,18 @@
 }
 
 
+void ArticleListView::setModel( QAbstractItemModel* m ) {
+    QAbstractItemModel* const oldModel = model();
+    if ( oldModel )
+        m_headerState = header()->saveState();
+    QTreeView::setModel( m );
+    if ( m )
+        header()->restoreState( m_headerState );
+}
+
 void ArticleListView::slotClear()
 {
-    QAbstractItemModel* const oldModel = model();
     setModel( 0L );
-    delete oldModel;
 }
 
 void ArticleListView::slotPreviousArticle()
Index: akregator/src/subscriptionlistview.h
===================================================================
--- akregator/src/subscriptionlistview.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akregator/src/subscriptionlistview.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -28,6 +28,7 @@
 #include <QTreeView>
 #include <QMap>
 #include <QAction>
+#include <QByteArray>
 
 class KMenu;
 
@@ -83,7 +84,7 @@
     void headerMenuItemTriggered( QAction* action );
 
 private:
-    bool m_headerSetup;
+    QByteArray m_headerState;
 };
 
 }
Index: akregator/src/akregator_part.cpp
===================================================================
--- akregator/src/akregator_part.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akregator/src/akregator_part.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -103,6 +103,8 @@
     , m_dialog(0)
 
 {
+    initFonts();
+
     setPluginLoadingMode( LoadPluginsIfEnabled );
     setPluginInterfaceVersion( AKREGATOR_PLUGIN_INTERFACE_VERSION );
 
@@ -180,8 +182,6 @@
     connect(m_autosaveTimer, SIGNAL(timeout()), this, SLOT(slotSaveFeedList()));
     m_autosaveTimer->start(5*60*1000); // 5 minutes
 
-    initFonts();
-
     QString useragent = QString( "Akregator/%1; syndication" ).arg( AKREGATOR_VERSION );
 
     if( !Settings::customUserAgent().isEmpty() )
Index: akregator/src/akregator.desktop
===================================================================
--- akregator/src/akregator.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akregator/src/akregator.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -56,6 +56,7 @@
 Comment[ja]=KDE „ÅÆ„Éï„Ç£„Éº„Éâ„É™„Éº„ÉÄ„Éº
 Comment[km]=·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·û¢·û∂·ûì‚Äã·ûò·ûè·û∑·ûñ·üê·ûè·üå·ûò·û∂·ûì‚Äã·ûö·ûî·ûü·üã KDE
 Comment[ko]=ÌîºÎìú Î¶¨Îçî
+Comment[lt]=RSS kanal≈≥ skaitytuvƒó KDE darbastalio aplinkai
 Comment[lv]=KDE zi≈Üu barot≈Üu lasƒ´tƒÅjs
 Comment[nb]=En kildeleser for KDE
 Comment[nds]=En Mellenstroom-Kieker f√∂r KDE
Index: akregator/src/subscriptionlistview.cpp
===================================================================
--- akregator/src/subscriptionlistview.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akregator/src/subscriptionlistview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -55,7 +55,7 @@
             i = i.child( model->rowCount( i ) - 1, i.column() );
         return i;
     }
-    else 
+    else
         return idx.parent();
 }
 
@@ -104,7 +104,7 @@
         if ( i.row() + 1 < siblings )
             return i.sibling( i.row() + 1, i.column() );
         i = i.parent();
-    }   
+    }
 }
 
 QModelIndex nextFeedIndex( const QModelIndex& idx )
@@ -134,8 +134,9 @@
     setDragDropMode( QAbstractItemView::DragDrop );
     setDropIndicatorShown( true );
     setAcceptDrops( true );
-    m_headerSetup = false;
     connect( header(), SIGNAL( customContextMenuRequested( const QPoint & ) ), this, SLOT( showHeaderMenu( const QPoint& ) ) );
+
+    loadHeaderSettings();
 }
 
 Akregator::SubscriptionListView::~SubscriptionListView()
@@ -143,19 +144,25 @@
     saveHeaderSettings();
 }
 
-void Akregator::SubscriptionListView::setModel( QAbstractItemModel* model )
+void Akregator::SubscriptionListView::setModel( QAbstractItemModel* m )
 {
-    QTreeView::setModel( model );
-    
+    if ( model() )
+        m_headerState = header()->saveState();
+
+    QTreeView::setModel( m );
+
+    if ( m )
+        header()->restoreState( m_headerState );
+
     QStack<QModelIndex> stack;
     stack.push( rootIndex() );
     while ( !stack.isEmpty() )
     {
         const QModelIndex i = stack.pop();
-        const int childCount = model->rowCount( i );
+        const int childCount = m->rowCount( i );
         for ( int j = 0; j < childCount; ++j )
         {
-            const QModelIndex child = model->index( j, 0, i );
+            const QModelIndex child = m->index( j, 0, i );
             if ( child.isValid() )
                 stack.push( child );
         }
@@ -163,11 +170,6 @@
     }
 
     header()->setContextMenuPolicy( Qt::CustomContextMenu );
-
-    if( ! m_headerSetup ) {
-        loadHeaderSettings();
-        m_headerSetup = true;
-    }
 }
 
 void Akregator::SubscriptionListView::showHeaderMenu( const QPoint& pos )
@@ -179,7 +181,7 @@
     menu->addTitle( i18n( "Columns" ) );
     menu->setAttribute( Qt::WA_DeleteOnClose );
     connect(menu, SIGNAL( triggered( QAction* ) ), this, SLOT( headerMenuItemTriggered( QAction* ) ) );
-    
+
     for (int i = 0; i < model()->columnCount(); i++)
     {
         QString col = model()->headerData( i, Qt::Horizontal, Qt::DisplayRole ).toString();
@@ -188,7 +190,7 @@
         act->setChecked( !header()->isSectionHidden( i ) );
         act->setData( i );
     }
-    
+
     menu->popup( header()->mapToGlobal( pos ) );
 }
 
@@ -203,24 +205,17 @@
 }
 
 void Akregator::SubscriptionListView::saveHeaderSettings()
-{ 
-    QByteArray s = header()->saveState();
+{
+    if ( model() )
+        m_headerState = header()->saveState();
     KConfigGroup conf( Settings::self()->config(), "General" );
-    conf.writeEntry( "SubscriptionListHeaders", s.toBase64() );
-
-    //FIXME: HACK: Change back to Settings, when it starts to work again..
-    // Settings::setFeedlistHeaderStates( s.toBase64() );
+    conf.writeEntry( "SubscriptionListHeaders", m_headerState.toBase64() );
 }
 
 void Akregator::SubscriptionListView::loadHeaderSettings()
 {
-    // FIXME: HACK: Change back to Settings when it's working
-    //QByteArray s = QByteArray::fromBase64( Settings::feedlistHeaderStates().toAscii() );
-    
-    KConfigGroup conf( Settings::self()->config(), "General" );
-    QByteArray s = QByteArray::fromBase64( conf.readEntry( "SubscriptionListHeaders" ).toAscii() );
-    if( !s.isNull() )
-        header()->restoreState( s );
+    const KConfigGroup conf( Settings::self()->config(), "General" );
+    m_headerState = QByteArray::fromBase64( conf.readEntry( "SubscriptionListHeaders" ).toAscii() );
 }
 
 void Akregator::SubscriptionListView::slotPrevFeed()
@@ -235,7 +230,7 @@
     }
     if ( prev.isValid() )
         setCurrentIndex( prev );
-    
+
 }
 
 void Akregator::SubscriptionListView::slotNextFeed()
@@ -276,7 +271,7 @@
 
 void SubscriptionListView::slotItemBegin()
 {
-    
+
 }
 
 void SubscriptionListView::slotItemEnd()
@@ -285,22 +280,22 @@
 
 void SubscriptionListView::slotItemLeft()
 {
-    
+
 }
 
 void SubscriptionListView::slotItemRight()
 {
-    
+
 }
 
 void SubscriptionListView::slotItemUp()
 {
-    
+
 }
 
 void SubscriptionListView::slotItemDown()
 {
-    
+
 }
 
 
Index: akregator/src/articlelistview.h
===================================================================
--- akregator/src/articlelistview.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akregator/src/articlelistview.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -119,6 +119,8 @@
 
     void setIsAggregation( bool isAggregation );
 
+    /* reimp */ void setModel( QAbstractItemModel* model );
+
 protected:
     void mousePressEvent( QMouseEvent *ev );
 
@@ -162,8 +164,8 @@
     ColumnMode m_columnMode;
     bool m_isAggregation;
     QPointer<SortColorizeProxyModel> m_proxy;
-    bool m_headerSetUp;
     std::vector<boost::shared_ptr<const Filters::AbstractMatcher> > m_matchers;
+    QByteArray m_headerState;
 };
 
 } // namespace Akregator
Index: akregator/configuration/akregator_config_browser.desktop
===================================================================
--- akregator/configuration/akregator_config_browser.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akregator/configuration/akregator_config_browser.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -23,6 +23,7 @@
 Name[ja]=„Éñ„É©„Ç¶„Ç∂
 Name[km]=·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûö·ûª·ûÄ·ûö·ûÄ
 Name[ko]=ÌÉêÏÉâÍ∏∞
+Name[lt]=Nar≈°yklƒó
 Name[lv]=PƒÅrl≈´ks
 Name[nb]=Nettleser
 Name[nds]=Kieker
@@ -66,6 +67,7 @@
 Comment[pt]=Configurar a Componente de Navega√ß√£o Interna
 Comment[pt_BR]=Configurar o componente de navega√ß√£o interna
 Comment[ro]=ConfigureazƒÉ componenta internƒÉ de navigare
+Comment[sl]=Nastavite vgrajeno komponento za brskanje
 Comment[sv]=Anpassa intern webbl√§sningskomponent
 Comment[tr]=ƒ∞√ß Tarayƒ±cƒ± Bile≈üenini Yapƒ±landƒ±r
 Comment[uk]=–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤–±—É–¥–æ–≤–∞–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –ø–µ—Ä–µ–≥–ª—è–¥–∞—á–∞
Index: akregator/configuration/akregator_config_appearance.desktop
===================================================================
--- akregator/configuration/akregator_config_appearance.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akregator/configuration/akregator_config_appearance.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -93,6 +93,7 @@
 Comment[pt]=Configurar a Apar√™ncia do Leitor de Fontes
 Comment[pt_BR]=Configurar a apar√™ncia do leitor de fontes de not√≠cias
 Comment[ro]=ConfigureazƒÉ aspectul cititorului de fluxuri
+Comment[sl]=Nastavite videz bralnika virov
 Comment[sv]=Anpassa kanall√§sarens utseende
 Comment[tr]=Haber Okuyucu G√∂r√ºn√ºm√ºn√º Yapƒ±landƒ±r
 Comment[uk]=–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤–∏–≥–ª—è–¥—É –ø—Ä–æ–≥—Ä–∞–º–∏ —á–∏—Ç–∞–Ω–Ω—è —Ä–æ–∑—Å–∏–ª–æ–∫
Index: akregator/configuration/akregator_config_advanced.desktop
===================================================================
--- akregator/configuration/akregator_config_advanced.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akregator/configuration/akregator_config_advanced.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -25,6 +25,7 @@
 Name[ja]=Ë©≥Á¥∞
 Name[km]=·ûÄ·ûò·üí·ûö·û∑·ûè‚Äã·ûÅ·üí·ûñ·ûü·üã
 Name[ko]=Í≥†Í∏â
+Name[lt]=Sudƒótingesni
 Name[lv]=Papla≈°inƒÅti
 Name[nb]=Avansert
 Name[nds]=Verwiedert
Index: akregator/configuration/akregator_config_archive.desktop
===================================================================
--- akregator/configuration/akregator_config_archive.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akregator/configuration/akregator_config_archive.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -68,6 +68,7 @@
 Comment[pt_BR]=Configurar o arquivo de fontes de not√≠cias
 Comment[ro]=ConfigureazƒÉ arhiva de fluxuri
 Comment[ru]=–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—Ä—Ö–∏–≤–∞ –ª–µ–Ω—Ç
+Comment[sl]=Nastavite arhiv vira
 Comment[sv]=Anpassa kanalarkivet
 Comment[tr]=Haber Ar≈üivini Yapƒ±landƒ±r
 Comment[uk]=–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∞—Ä—Ö—ñ–≤—É —Ä–æ–∑—Å–∏–ª–æ–∫
Index: cmake/modules/FindAssuan.cmake
===================================================================
--- cmake/modules/FindAssuan.cmake	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ cmake/modules/FindAssuan.cmake	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -75,12 +75,6 @@
 
   else()
 
-    # is this needed, of just unreflected cut'n'paste?
-    # this isn't a KDE library, after all!
-    if( NOT KDEWIN_FOUND )
-      find_package( KDEWIN REQUIRED )
-    endif()
-
     set( ASSUAN_FOUND         false )
     set( ASSUAN_VANILLA_FOUND false )
     #set( ASSUAN_GLIB_FOUND    false )
Index: libkleo/libkleopatrarc.desktop
===================================================================
--- libkleo/libkleopatrarc.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ libkleo/libkleopatrarc.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -318,12 +318,14 @@
 Name[es]=Otras claves
 Name[et]=Muud v√µtmed
 Name[fr]=Autres cl√©s
+Name[fy]=Oare kaaien
 Name[ga]=Eochracha Eile
 Name[gl]=Outras Chaves
 Name[it]=Altre chiavi
 Name[ja]=„Åù„ÅÆ‰ªñ„ÅÆÈçµ
 Name[km]=·ûü·üÑ‚Äã·ûï·üí·ûü·üÅ·ûÑ‚Äã·ûë·üÄ·ûè
 Name[ko]=Îã§Î•∏ ÌÇ§
+Name[lt]=Kiti raktai
 Name[lv]=Citas atslƒìgas
 Name[nb]=Andre n√∏kler
 Name[nds]=Anner Sl√∂tels
Index: libkleo/ui/messagebox.cpp
===================================================================
--- libkleo/ui/messagebox.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ libkleo/ui/messagebox.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -2,7 +2,7 @@
     messagebox.cpp
 
     This file is part of libkleopatra, the KDE keymanagement library
-    Copyright (c) 2004 Klar‰lvdalens Datakonsult AB
+    Copyright (c) 2004 Klar√§lvdalens Datakonsult AB
 
     Libkleopatra is free software; you can redistribute it and/or
     modify it under the terms of the GNU General Public License as
@@ -60,11 +60,11 @@
 namespace {
 
 static KGuiItem KGuiItem_save() {
-    return KGuiItem( i18n("&Save to Disk..."), "filesaveas" );
+    return KGuiItem( i18n("&Save to Disk..."), "document-save-as" );
 }
 
 static KGuiItem KGuiItem_copy() {
-    return KGuiItem( i18n("&Copy to Clipboard"), "editcopy", i18n("Copy Audit Log to Clipboard") );
+    return KGuiItem( i18n("&Copy to Clipboard"), "edit-copy", i18n("Copy Audit Log to Clipboard") );
 }
 
 static KGuiItem KGuiItem_showAuditLog() {
Index: kleopatra/kleopatra_import.desktop
===================================================================
--- kleopatra/kleopatra_import.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kleopatra/kleopatra_import.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -36,6 +36,7 @@
 Comment[pt]=Gestor de Certificados e GUI Unificada de Criptografia
 Comment[pt_BR]=Gerenciador de certificados e interface gr√°fica do usu√°rio unificada
 Comment[ru]=–ú–µ–Ω–µ–¥–∂–µ—Ä —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –∏ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π.
+Comment[sl]=Upravljalnik potrdil in enoten ≈°ifrirni vmesnik
 Comment[sv]=Certifikathantering och gemensamt grafiskt anv√§ndargr√§nssnitt f√∂r kryptering
 Comment[tr]=Sertifika Y√∂neticisi ve Birle≈üik ≈ûifreleme Aray√ºz√º
 Comment[uk]=–ó–∞—Å—ñ–± –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞–º–∏ —ñ —É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –≥—Ä–∞—Ñ—ñ—á–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è
Index: kleopatra/conf/kleopatra_config_smimevalidation.desktop
===================================================================
--- kleopatra/conf/kleopatra_config_smimevalidation.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kleopatra/conf/kleopatra_config_smimevalidation.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -64,6 +64,7 @@
 Comment[pl]=Konfiguracja opcji walidacji certyfikatu S/MIME
 Comment[pt]=Configura√ß√£o das op√ß√µes de valida√ß√£o do certificado de S/MIME
 Comment[pt_BR]=Configura√ß√£o das op√ß√µes de valida√ß√£o do certificado de S/MIME
+Comment[sl]=Nastavitev mo≈ænosti preverjanja potrdil S/MIME
 Comment[sv]=Anpassning av alternativ f√∂r S/MIME-certifikatvalidering
 Comment[th]=‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á S/MIME
 Comment[tr]=S/MIME sertifika ge√ßerlilik doƒürulamasƒ± se√ßeneklerinin yapƒ±landƒ±rmasƒ±
Index: kleopatra/conf/kleopatra_config_dirserv.desktop
===================================================================
--- kleopatra/conf/kleopatra_config_dirserv.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kleopatra/conf/kleopatra_config_dirserv.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -88,6 +88,7 @@
 Comment[pl]=Konfiguracja us≈Çug katalogowych
 Comment[pt]=Configura√ß√£o dos servi√ßos de direct√≥rio
 Comment[pt_BR]=Configura√ß√£o dos servi√ßos de diret√≥rio
+Comment[sl]=Nastavitev imeni≈°kih storitev
 Comment[sv]=Inst√§llning av katalogtj√§nster
 Comment[th]=‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πÄ‡∏£‡∏Å‡∏ó‡∏≠‡∏£‡∏µ
 Comment[tr]=Dizin servisleri yapƒ±landƒ±rmasƒ±
Index: kleopatra/kleopatra_decryptverifyfolders.desktop
===================================================================
--- kleopatra/kleopatra_decryptverifyfolders.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kleopatra/kleopatra_decryptverifyfolders.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -25,6 +25,7 @@
 Name[pl]=Odszyfrowanie/weryfikacja wszystkich plik√≥w w katalogu w Kleopatrze
 Name[pt]=Descodifica√ß√£o/Verifica√ß√£o de Todos os Ficheiros da Pasta do Kleopatra
 Name[pt_BR]=Descriptografia/verifica√ß√£o do Kleopatra em todos os arquivos da pasta
+Name[sl]=De≈°ifriranje/preverjanje vseh datotek v mapi s Kleopatro
 Name[sv]=Avkoda och verifiera alla filer i katalogen med Kleopatra
 Name[tr]=Kleopatra Bu Dizindeki T√ºm Dosyalarƒ±n ≈ûifrelemesini A√ß/Doƒürula
 Name[uk]=–†–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è/–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—Å—ñ—Ö —Ñ–∞–π–ª—ñ–≤ —É —Ç–µ—Ü—ñ —É Kleopatra
@@ -57,6 +58,7 @@
 Name[pl]=Odszyfruj/weryfikuj wszystkie pliki w katalogu
 Name[pt]=Descodificar/Verificar Todos os Ficheiros na Pasta
 Name[pt_BR]=Descriptografia/verifica√ß√£o em todos os arquivos da pasta
+Name[sl]=De≈°ifriraj/preveri vse datoteke v mapi
 Name[sv]=Avkoda och verifiera alla filer i katalogen
 Name[tr]=Bu Dizindeki T√ºm Dosyalarƒ±n ≈ûifrelemesini A√ß/Doƒürula
 Name[uk]=–†–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏/–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤—Å—ñ —Ñ–∞–π–ª–∏ —É —Ç–µ—Ü—ñ
Index: kleopatra/kleopatra_decryptverifyfiles.desktop
===================================================================
--- kleopatra/kleopatra_decryptverifyfiles.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kleopatra/kleopatra_decryptverifyfiles.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -26,6 +26,7 @@
 Name[pl]=Odszyfrowanie/weryfikacja plik√≥w w Kleopatrze
 Name[pt]=Descodifica√ß√£o/Verifica√ß√£o de Ficheiros do Kleopatra
 Name[pt_BR]=Descriptografia/verifica√ß√£o de arquivos do Kleopatra
+Name[sl]=De≈°ifriranje/preverjanje datotek s Kleopatro
 Name[sv]=Avkoda och verifiera filer med Kleopatra
 Name[tr]=Kleopatra Dosyalarƒ±n ≈ûifrelemesini A√ß/Doƒürula
 Name[uk]=–†–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è/–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ–∞–π–ª—ñ–≤ —É Kleopatra
@@ -58,6 +59,7 @@
 Name[pl]=Odszyfruj/weryfikuj plik
 Name[pt]=Descodificar/Verificar o Ficheiro
 Name[pt_BR]=Descriptografia/verifica√ß√£o do arquivo
+Name[sl]=De≈°ifriraj/preveri datoteko
 Name[sv]=Avkoda och verifiera fil
 Name[tr]=Dosyalarƒ±n ≈ûifrelemesini A√ß/Doƒürula
 Name[uk]=–†–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏/–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ñ–∞–π–ª
Index: kleopatra/kgpgconf/CMakeLists.txt
===================================================================
--- kleopatra/kgpgconf/CMakeLists.txt	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kleopatra/kgpgconf/CMakeLists.txt	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1,7 +1,8 @@
 project(kgpgconf)
 
 include_directories( ${CMAKE_SOURCE_DIR}/libkleo/backends/qgpgme )
-add_definitions ( -D_ASSUAN_ONLY_GPG_ERRORS -UQT_NO_STL -DKDE_DEFAULT_DEBUG_AREA=5154 )
+add_definitions ( -D_ASSUAN_ONLY_GPG_ERRORS -DKDE_DEFAULT_DEBUG_AREA=5154 )
+remove_definitions ( -DQT_NO_STL )
 
 set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${KDE4_ENABLE_EXCEPTIONS}")
 
Index: kleopatra/uiserver/echocommand.cpp
===================================================================
--- kleopatra/uiserver/echocommand.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kleopatra/uiserver/echocommand.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -32,12 +32,6 @@
 
 #include <config-kleopatra.h>
 
-#ifdef QT_NO_STL
-#undef QT_NO_STL
-#undef QT_STL
-#define QT_STL
-#endif
-
 #include "echocommand.h"
 
 #include <utils/input.h>
Index: kleopatra/CMakeLists.txt
===================================================================
--- kleopatra/CMakeLists.txt	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kleopatra/CMakeLists.txt	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -27,7 +27,8 @@
 if (USABLE_ASSUAN_FOUND)
    include_directories(${ASSUAN_INCLUDES})
 endif(USABLE_ASSUAN_FOUND)
-add_definitions ( -DQT_STL -DQT3_SUPPORT -DQT3_SUPPORT_WARNINGS -D_ASSUAN_ONLY_GPG_ERRORS -UQT_NO_STL )
+add_definitions ( -DQT3_SUPPORT -DQT3_SUPPORT_WARNINGS -D_ASSUAN_ONLY_GPG_ERRORS )
+remove_definitions ( -DQT_NO_STL )
 
 set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${KDE4_ENABLE_EXCEPTIONS}")
 
@@ -275,6 +276,9 @@
 endif ( NOT KDE4_KCMUTILS_LIBS )
 
 target_link_libraries(kleopatra_bin ${_kleopatra_extra_libs} kleo ${QGPGME_LIBRARIES} ${KDE4_KDEUI_LIBS} ${KDE4_KMIME_LIBRARY} ${KDE4_KCMUTILS_LIBS} ${_kleopatra_uiserver_extra_libs} )
+if ( USABLE_ASSUAN_FOUND )
+  target_link_libraries(kleopatra_bin ${QT_QTNETWORK_LIBRARY}) 
+ENDIF ( USABLE_ASSUAN_FOUND )
 
 install(TARGETS kleopatra_bin ${INSTALL_TARGETS_DEFAULT_ARGS})
 
Index: kleopatra/crypto/gui/signerresolvepage.cpp
===================================================================
--- kleopatra/crypto/gui/signerresolvepage.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kleopatra/crypto/gui/signerresolvepage.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -61,6 +61,7 @@
 #include <QRadioButton>
 #include <QStackedLayout>
 #include <QVBoxLayout>
+#include <QVector>
 
 #include <cassert>
 
@@ -435,7 +436,7 @@
 void SignerResolvePage::Private::selectCertificates()
 {
     QPointer<SigningCertificateSelectionDialog> dlg = new SigningCertificateSelectionDialog( q );
-    dlg->setAllowedProtocols( QVector<Protocol>::fromStdVector(signingProtocolSelectionWidget->checkedProtocols() ) );
+    dlg->setAllowedProtocols( QVector<Protocol>::fromStdVector( signingProtocolSelectionWidget->checkedProtocols() ) );
     if ( dlg->exec() == QDialog::Accepted && dlg )
     {
         const QMap<Protocol, Key> certs = dlg->selectedCertificates();
Index: kleopatra/crypto/gui/resolverecipientspage.cpp
===================================================================
--- kleopatra/crypto/gui/resolverecipientspage.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kleopatra/crypto/gui/resolverecipientspage.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -32,12 +32,6 @@
 
 #include <config-kleopatra.h>
 
-#ifdef QT_NO_STL
-#undef QT_NO_STL
-#undef QT_STL
-#define QT_STL
-#endif
-
 #include "resolverecipientspage.h"
 #include "resolverecipientspage_p.h"
 
Index: kleopatra/crypto/gui/signerresolvepage_p.h
===================================================================
--- kleopatra/crypto/gui/signerresolvepage_p.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kleopatra/crypto/gui/signerresolvepage_p.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -39,6 +39,9 @@
 class QCheckBox;
 class QLabel;
 
+#include <vector>
+#include <map>
+
 namespace Kleo {
 namespace Crypto {
 namespace Gui {
Index: kleopatra/kleopatra_signencryptfolders.desktop
===================================================================
--- kleopatra/kleopatra_signencryptfolders.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kleopatra/kleopatra_signencryptfolders.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -26,6 +26,7 @@
 Name[pl]=Podpisywanie/szyfrowanie katalog√≥w w Kleopatrze
 Name[pt]=Assinatura/Encripta√ß√£o de Pastas do Kleopatra
 Name[pt_BR]=Assinatura/criptografia de pastas do Kleopatra
+Name[sl]=Podpisovanje/≈°ifriranje map s Kleopatro
 Name[sv]=Signera och kryptera kataloger med Kleopatra
 Name[tr]=Kleopatra Dizinleri ƒ∞mzala/≈ûifrele
 Name[uk]=–ü—ñ–¥–ø–∏—Å—É–≤–∞–Ω–Ω—è/–®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —Ç–µ–∫ —É Kleopatra
@@ -58,6 +59,7 @@
 Name[pt]=Arquivar, Assinar e Encriptar a Pasta
 Name[pt_BR]=Arquivar, assinar e criptografar a pasta
 Name[ro]=ArhiveazƒÉ, semneazƒÉ »ôi cripteazƒÉ dosarul
+Name[sl]=Arhiviraj, podpi≈°i in ≈°ifriraj mapo
 Name[sv]=Arkivera, signera och kryptera katalog
 Name[tr]=Dizini Ar≈üivle, ƒ∞mzala & ≈ûifrele
 Name[uk]=–ê—Ä—Ö—ñ–≤—É–≤–∞—Ç–∏, –ø—ñ–¥–ø–∏—Å–∞—Ç–∏ —ñ –∑–∞—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ —Ç–µ–∫—É
@@ -77,11 +79,13 @@
 Name[es]=Archivar y cifrar carpeta
 Name[et]=Kataloogi arhiveerimine ja kr√ºptimine
 Name[fr]=Archiver et chiffrer le dossier
+Name[ga]=Cuir Fillte√°n i gCartlann agus Criptigh √â
 Name[gl]=Arquivar e Cifrar Cartafol
 Name[it]=Archivia e codifica cartella
 Name[ja]=„Éï„Ç©„É´„ÉÄ„Çí„Ç¢„Éº„Ç´„Ç§„Éñ„Åó„Å¶ÊöóÂè∑Âåñ
 Name[km]=·ûî·üê·ûé·üí·ûé·ûü·û∂·ûö ·ûì·û∑·ûÑ‚Äã·û¢·üä·û∏·ûì·ûÇ·üí·ûö·û∑·ûî‚Äã·ûê·ûè
 Name[ko]=Ìè¥Îçî ÏïïÏ∂ï Î∞è ÏïîÌò∏Ìôî
+Name[lt]=Archyvuoti ir ≈°ifruoti aplankƒÖ
 Name[lv]=Arhivƒìt un ≈°ifrƒìt mapi
 Name[nb]=Arkiver og krypter mappe
 Name[nds]=Orner archiveren un versl√∂teln
Index: kleopatra/kleopatra_signencryptfiles.desktop
===================================================================
--- kleopatra/kleopatra_signencryptfiles.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kleopatra/kleopatra_signencryptfiles.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -27,6 +27,7 @@
 Name[pl]=Podpisz/zaszyfruj pliki w Kleopatrze
 Name[pt]=Assinatura/Encripta√ß√£o de Ficheiros do Kleopatra
 Name[pt_BR]=Assinatura/criptografia de arquivos do Kleopatra
+Name[sl]=Podpisovanje/≈°ifriranje datotek s Kleopatro
 Name[sv]=Signera och kryptera filer med Kleopatra
 Name[tr]=Kleopatra Dosyalarƒ± ƒ∞mzala/≈ûifrele
 Name[uk]=–ü—ñ–¥–ø–∏—Å—É–≤–∞–Ω–Ω—è/–®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ —É Kleopatra
@@ -60,6 +61,7 @@
 Name[pt]=Encriptar & Assinar o Ficheiro
 Name[pt_BR]=Criptografar e assinar arquivo
 Name[ro]=CripteazƒÉ »ôi semneazƒÉ fi»ôierul
+Name[sl]=≈†ifriraj in podpi≈°i datoteko
 Name[sv]=Kryptera och signera fil
 Name[th]=‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏•‡∏∞‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡πÅ‡∏ü‡πâ‡∏°
 Name[tr]=Dosyayƒ± ≈ûifrele & ƒ∞mzala
@@ -80,11 +82,13 @@
 Name[es]=Cifrar archivo
 Name[et]=Faili kr√ºptimine
 Name[fr]=Chiffrer le fichier
+Name[ga]=Criptigh Comhad
 Name[gl]=Cifrar Ficheiro
 Name[it]=Codifica file
 Name[ja]=„Éï„Ç°„Ç§„É´„ÇíÊöóÂè∑Âåñ
 Name[km]=·û¢·üä·û∏·ûì·ûÇ·üí·ûö·û∑·ûî‚Äã·ûØ·ûÄ·ûü·û∂·ûö
 Name[ko]=ÌååÏùº ÏïîÌò∏Ìôî
+Name[lt]=≈†ifruoti failƒÖ
 Name[lv]=≈†ifrƒìt failu
 Name[nb]=Krypter fil
 Name[nds]=Datei versl√∂teln
@@ -132,6 +136,7 @@
 Name[pt]=Assinar o Ficheiro com o OpenPGP
 Name[pt_BR]=Assinar arquivo com OpenPGP
 Name[ro]=SemneazƒÉ fi»ôierul cu OpenPGP
+Name[sl]=Podpi≈°i datoteko z OpenPGP
 Name[sv]=Signera fil med OpenPGP
 Name[tr]=Dosyayƒ± OpenPGP-ƒ∞mzala
 Name[uk]=–ü—ñ–¥–ø–∏—Å–∞—Ç–∏ —Ñ–∞–π–ª –∑ OpenPGP
@@ -166,6 +171,7 @@
 Name[pt]=Assinar o Ficheiro com o S/MIME
 Name[pt_BR]=Assinar arquivo com S/MIME
 Name[ro]=SemneazƒÉ fi»ôierul cu S/MIME
+Name[sl]=Podpi≈°i datoteko z S/MIME
 Name[sv]=Signera fil med S/MIME
 Name[tr]=Dosyayƒ± S/MIME-ƒ∞mzala
 Name[uk]=–ü—ñ–¥–ø–∏—Å–∞—Ç–∏ —Ñ–∞–π–ª –∑ S/MIME
Index: kleopatra/libkleopatraclient/tests/CMakeLists.txt
===================================================================
--- kleopatra/libkleopatraclient/tests/CMakeLists.txt	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kleopatra/libkleopatraclient/tests/CMakeLists.txt	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -9,6 +9,6 @@
 
 foreach( _kleoclient_test ${kleoclient_TESTS} )
   kde4_add_executable( "${_kleoclient_test}" TEST "${_kleoclient_test}.cpp" )
-  target_link_libraries( "${_kleoclient_test}" kleopatraclientcore ${QT_QTGUI_LIBRARY} )
+  target_link_libraries( "${_kleoclient_test}" kleopatraclientcore ${QT_QTGUI_LIBRARY} ${QT_QTCORE_LIBRARY} )
 endforeach( _kleoclient_test )
 
Index: kresources/egroupware/kcal_resourcexmlrpc.cpp
===================================================================
--- kresources/egroupware/kcal_resourcexmlrpc.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/egroupware/kcal_resourcexmlrpc.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -590,8 +590,10 @@
         calendar()->addEvent( event );
         retrievedEvents.append( event );
         changed = true;
-      } else
+      } else {
+        retrievedEvents.append( oldEvent );
         delete event;
+      }
     } else {
       if ( !localUid.isEmpty() )
         event->setUid( localUid );
@@ -700,8 +702,10 @@
         calendar()->addTodo( todo );
         retrievedTodos.append( todo );
         changed = true;
-      } else
+      } else {
+        retrievedTodos.append( oldTodo );
         delete todo;
+      }
     } else {
       idMapper().setRemoteId( todo->uid(), uid );
       calendar()->addTodo( todo );
Index: kresources/blog/blog.desktop
===================================================================
--- kresources/blog/blog.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/blog/blog.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -17,6 +17,7 @@
 Name[ja]=„Éñ„É≠„Ç∞„ÅÆÊó•Ë®ò
 Name[km]=·ûë·û∑·ûì·û∂·ûì·ûª·ûî·üí·ûî·ûú·ûè·üí·ûè·û∑‚Äã·ûì·üÖ‚Äã·ûÄ·üí·ûì·ûª·ûÑ‚Äã·ûî·üí·ûõ·ûª·ûÄ
 Name[ko]=Î∏îÎ°úÍ∑∏Ïùò Ï†ÄÎÑê
+Name[lt]=≈Ωurnalas tinklara≈°tyje
 Name[lv]=Tƒ´mekƒºa dienasgrƒÅmata
 Name[nb]=Dagbok i en blogg
 Name[nds]=Nett-Daagbook
@@ -43,6 +44,7 @@
 Comment[es]=Le permite publicar entradas de diario del calendario con entradas de bit√°cora
 Comment[et]=V√µimaldab postitada kalendri p√§eviku sissekandeid veebip√§eviku sissekannetena
 Comment[fr]=Permet de de poster des √©v√®nements du calendrier comme des entr√©es de journal
+Comment[ga]=Leis an mbreise√°n seo is f√©idir leat iontr√°lacha dialainne a chur suas ar do bhlag
 Comment[gl]=Permite publicar as entradas do diario como entradas de blogue
 Comment[it]=Consente di inserire voci di diario in un blog
 Comment[ja]=Êó•Ë®ò„ÅÆ„Ç®„É≥„Éà„É™„Çí„Éñ„É≠„Ç∞„ÅÆ„Ç®„É≥„Éà„É™„Å®„Åó„Å¶ÊäïÁ®ø„Åß„Åç„Çã„Çà„ÅÜ„Å´„Åó„Åæ„Åô
@@ -55,6 +57,7 @@
 Comment[pl]=Pozwala na wysy≈Çanie wpis√≥w dziennika jako wpis√≥w na blogach
 Comment[pt]=Permite-lhe publicar itens do di√°rio como publica√ß√µes num 'blog'
 Comment[pt_BR]=Permite-lhe postar entradas de di√°rio como entradas de blog
+Comment[sl]=Omogoƒça objavo dnevni≈°kih vnosov v koledarju kot sestavkov za blog
 Comment[sv]=G√∂r det m√∂jligt att skriva ut journalanteckningar som webbjournalinl√§gg
 Comment[tr]=Takvim g√ºnl√ºk girdilerini g√ºnl√ºk (blog) girdileri olarak g√∂ndermeyi saƒülar
 Comment[uk]=–ù–∞–¥–∞—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —Ä–æ–∑–º—ñ—â—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Å–∏ –∂—É—Ä–Ω–∞–ª—É –∫–∞–ª–µ–Ω–¥–∞—Ä—è —è–∫ –∑–∞–ø–∏—Å–∏ —É –±–ª–æ–∑—ñ.
Index: kresources/scalix/kabc/scalix.desktop
===================================================================
--- kresources/scalix/kabc/scalix.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/scalix/kabc/scalix.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -16,6 +16,7 @@
 Name[ja]=KMail ÁµåÁî± Scalix „Çµ„Éº„Éê„ÅÆ„Ç¢„Éâ„É¨„ÇπÂ∏≥
 Name[km]=·ûü·üÄ·ûú·ûó·üÖ‚Äã·û¢·û∂·ûü·ûô·ûä·üí·ûã·û∂·ûì‚Äã·ûì·üÖ‚Äã·ûõ·ûæ‚Äã·ûò·üâ·û∂·ûü·üä·û∏·ûì‚Äã·ûî·ûò·üí·ûö·ûæ Scalix ·ûè·û∂·ûò·ûö·ûô·üà KMail
 Name[ko]=KMailÏùÑ ÌÜµÌïú Scalix ÏÑúÎ≤ÑÏùò Ï£ºÏÜåÎ°ù
+Name[lt]=Adres≈≥ knygelƒó Scalix serveryje per KMail
 Name[lv]=Scalix servera adre≈°u grƒÅmata, izmantojot KMail
 Name[nb]=Adressebok p√• Scalix-tjener via KMail
 Name[nds]=Adressbook op Scalix-Server √∂ver KMail
@@ -51,6 +52,7 @@
 Comment[pl]=Zapewnia dostƒôp do wizyt√≥wek przechowywanych na serwerze Scalix przy u≈ºyciu IMAP w KMailu lub Kontakcie
 Comment[pt]=Oferece o acesso aos contactos guardados num servidor de Scalix por IMAP, atrav√©s do KMail ou do Kontact
 Comment[pt_BR]=Fornece acesso aos contatos armazenados em um servidor Scalix usando IMAP, pelo KMail ou Kontact
+Comment[sl]=Prek IMAPa v KMail ali Kontact omogoƒça dostop do stikov, shranjenih na stre≈æniku Scalix.
 Comment[sv]=Ger tillg√•ng till kontakter lagrade p√• en Scalix-server med anv√§ndning av IMAP via Kmail eller Kontact
 Comment[tr]=KMail ya da KOntact IMAP kullanarak Scalix sunucusu √ºzerindeki ki≈üilere eri≈üim saƒülar
 Comment[uk]=–ù–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è, —è–∫–∏–π –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ Scalix, –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é IMAP –∑–∞ –ø–æ—Å–µ—Ä–µ–¥–Ω–∏—Ü—Ç–≤–∞ KMail –∞–±–æ Kontact
Index: kresources/scalix/knotes/scalix.desktop
===================================================================
--- kresources/scalix/knotes/scalix.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/scalix/knotes/scalix.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -15,6 +15,7 @@
 Name[ja]=KMail ÁµåÁî± Scalix „Çµ„Éº„Éê„ÅÆ„É°„É¢
 Name[km]=·ûÖ·üÜ·ûé·û∂·üÜ‚Äã·ûì·üÖ‚Äã·ûõ·ûæ‚Äã·ûò·üâ·û∂·ûü·üä·û∏·ûì‚Äã·ûî·ûò·üí·ûö·ûæ Scalix ·ûè·û∂·ûò·ûö·ûô·üà KMail
 Name[ko]=KMailÏùÑ ÌÜµÌïú Scalix ÏÑúÎ≤ÑÏùò Î©îÎ™®
+Name[lt]=Lipn≈´s lapeliai Scalix serveryje per KMail
 Name[lv]=Scalix servera piezƒ´mes, izmantojot KMail
 Name[nb]=Notater p√•  Scalix-tjener via KMail
 Name[nds]=Notizen op Scalix-Server √∂ver KMail
Index: kresources/scalix/kcal/scalix.desktop
===================================================================
--- kresources/scalix/kcal/scalix.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/scalix/kcal/scalix.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -16,6 +16,7 @@
 Name[ja]=KMail ÁµåÁî± Scalix „Çµ„Éº„Éê„ÅÆ„Ç´„É¨„É≥„ÉÄ„Éº
 Name[km]=·ûî·üí·ûö·ûè·û∑·ûë·û∑·ûì‚Äã·ûì·üÖ‚Äã·ûõ·ûæ‚Äã·ûò·üâ·û∂·ûü·üä·û∏·ûì‚Äã·ûî·ûò·üí·ûö·ûæ Scalix ·ûè·û∂·ûò·ûö·ûô·üà KMail
 Name[ko]=KMailÏùÑ ÌÜµÌïú Scalix ÏÑúÎ≤ÑÏùò Îã¨Î†•
+Name[lt]=Kalendorius Scalix serveryje per KMail
 Name[lv]=Scalix servera kalendƒÅrs, izmantojot KMail
 Name[nb]=Kalender p√• Scalix-tjener via KMail
 Name[nds]=Kalenner op Scalix-Server √∂ver KMail
Index: kresources/slox/kabc_ox.desktop
===================================================================
--- kresources/slox/kabc_ox.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/slox/kabc_ox.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -65,6 +65,7 @@
 Comment[pl]=Zapewnia dostƒôp do wizyt√≥wek przechowywanych na serwerze Open-Xchange
 Comment[pt]=Oferece o acesso aos contactos guardados num servidor de Open-Xchange
 Comment[pt_BR]=Fornece acesso aos contatos armazenados em um servidor Open-Xchange
+Comment[sl]=Omogoƒça dostop do stikov, shranjenih na stre≈æniku Open-Xchange.
 Comment[sv]=Ger tillg√•ng till kontakter lagrade p√• en Open-Xchange-server
 Comment[tr]=Open-Xchange sunucusu √ºzerindeki ki≈üilere eri≈üim saƒülar
 Comment[uk]=–ù–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤, —è–∫—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ Open-Xchange.
Index: kresources/groupdav/kabc_groupdav.desktop
===================================================================
--- kresources/groupdav/kabc_groupdav.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/groupdav/kabc_groupdav.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -35,7 +35,7 @@
 Name[nn]=GroupDAV-tenar (som OpenGroupware)
 Name[pl]=Serwer GroupDAV (np. OpenGroupware)
 Name[pt]=Servidor GroupDAV (por exemplo OpenGroupware)
-Name[pt_BR]=Servidor GroupDav (p. ex. OpenGroupware)
+Name[pt_BR]=Servidor GroupDav (ex. OpenGroupware)
 Name[ru]=–°–µ—Ä–≤–µ—Ä GroupDAV (–Ω–∞–ø—Ä–∏–º–µ—Ä, OpenGroupware)
 Name[sk]=GroupDAV Server (napr. OpenGroupware)
 Name[sl]=Stre≈ænik GroupDAV (npr. OpenGroupware)
@@ -66,6 +66,7 @@
 Comment[pl]=Zapewnia dostƒôp do wizyt√≥wek w ksiƒÖ≈ºkach adresowych serwer√≥w GroupDAV, np. OpenGroupware
 Comment[pt]=Oferece o acesso aos contactos guardados nos livros de endere√ßos dos servidores baseados em GroupDAV, p.ex. o OpenGroupware
 Comment[pt_BR]=Fornece acesso aos contatos armazenados nos livros de endere√ßos dos servidores habilitados GroupDAV, como o OpenGroupware
+Comment[sl]=Omogoƒça dostop do stikov, shranjenih v adresarjih na stre≈ænikih, ki podpirajo GroupDAV, npr. OpenGroupware
 Comment[sv]=Ger tillg√•ng till kontakter lagrade i adressb√∂cker p√• servrar som kan hantera GroupDAV, t.ex. OpenGroupware
 Comment[tr]=GroupDAV etkinle≈ütirilmi≈ü olan sunucular √ºzerinde bulunan adres defterindeki ki≈üilere eri≈üimi saƒülar, OpenGroupware gibi
 Comment[uk]=–ù–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤, —è–∫—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É –∞–¥—Ä–µ—Å–Ω–∏—Ö –∫–Ω–∏–≥–∞—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö –∑ —É–≤—ñ–º–∫–Ω–µ–Ω–∏–º GroupDAV, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, OpenGroupware.
Index: kresources/groupdav/kcal_groupdav.desktop
===================================================================
--- kresources/groupdav/kcal_groupdav.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/groupdav/kcal_groupdav.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -35,7 +35,7 @@
 Name[nn]=GroupDAV-tenar (som OpenGroupware)
 Name[pl]=Serwer GroupDAV (np. OpenGroupware)
 Name[pt]=Servidor GroupDAV (por exemplo OpenGroupware)
-Name[pt_BR]=Servidor GroupDav (p. ex. OpenGroupware)
+Name[pt_BR]=Servidor GroupDav (ex. OpenGroupware)
 Name[ru]=–°–µ—Ä–≤–µ—Ä GroupDAV (–Ω–∞–ø—Ä–∏–º–µ—Ä, OpenGroupware)
 Name[sk]=GroupDAV Server (napr. OpenGroupware)
 Name[sl]=Stre≈ænik GroupDAV (npr. OpenGroupware)
Index: kresources/kolab/kabc/kolab.desktop
===================================================================
--- kresources/kolab/kabc/kolab.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/kolab/kabc/kolab.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -36,7 +36,7 @@
 Name[nn]=Adressebok p√• IMAP-tenar via KMail
 Name[pl]=KsiƒÖ≈ºka adresowa na serwerze IMAP za po≈õrednictwem KMail
 Name[pt]=Livro de Endere√ßos em Servidor IMAP via KMail
-Name[pt_BR]=Livro de endere√ßos em servidor IMAP via KMail
+Name[pt_BR]=Livro de endere√ßos em servidor IMAP com o KMail
 Name[ru]=–ê–¥—Ä–µ—Å–Ω–∞—è –∫–Ω–∏–≥–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ IMAP —á–µ—Ä–µ–∑ KMail
 Name[sk]=Adres√°r na IMAP-serveri pomocou KMail
 Name[sl]=Adresar na stre≈æniku IMAP preko KMaila
@@ -66,7 +66,8 @@
 Comment[nn]=Gjev tilgang til kontaktar lagra p√• ein Kolab-tenar med IMAP via KMail eller Kontakt
 Comment[pl]=Zapewnia dostƒôp do wizyt√≥wek przechowychanych na serwerze Kolab przy u≈ºyciu IMAP w KMailu lub Kontakcie
 Comment[pt]=Oferece o acesso aos contactos guardados num servidor de Kolab por IMAP, atrav√©s do KMail ou do Kontact
-Comment[pt_BR]=Fornece acesso aos contatos armazenados em um servidor Kolab usando IMAP, pelo KMail ou Kontact
+Comment[pt_BR]=Fornece acesso aos contatos armazenados em um servidor Kolab usando IMAP com o KMail ou Kontact
+Comment[sl]=Prek IMAPa v KMail ali Kontact omogoƒça dostop do stikov, shranjenih na stre≈æniku Kolab.
 Comment[sv]=Ger tillg√•ng till kontakter lagrade p√• en Kolab-server med anv√§ndning av IMAP via Kmail eller Kontact
 Comment[tr]=KMail ya da KOntact IMAP kullanarak Kolab sunucusu √ºzerindeki ki≈üilere eri≈üim saƒülar
 Comment[uk]=–ù–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤, —è–∫—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ Kolab –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é IMAP –∑–∞ –ø–æ—Å–µ—Ä–µ–¥–Ω–∏—Ü—Ç–≤–∞ KMail –∞–±–æ Kontact.
Index: kresources/kolab/knotes/resourcekolab.cpp
===================================================================
--- kresources/kolab/knotes/resourcekolab.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/kolab/knotes/resourcekolab.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -234,7 +234,6 @@
                           mUidMap[ uid ].serialNumber() );
   }
   mUidMap.remove( uid );
-  manager()->deleteNote( journal );
   mCalendar.deleteJournal( journal );
   return true;
 }
@@ -323,7 +322,10 @@
   mSilent = true;
   KCal::Journal* j = mCalendar.journal( uid );
   if( j )
+  {
+    manager()->deleteNote( j );
     deleteNote( j );
+  }
   mSilent = silent;
 }
 
Index: kresources/kolab/shared/kolabbase.cpp
===================================================================
--- kresources/kolab/shared/kolabbase.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/kolab/shared/kolabbase.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -412,7 +412,7 @@
 
 QString KolabBase::dateTimeToString( const KDateTime& time )
 {
-  return time.toString( KDateTime::ISODate ) + 'Z';
+  return time.toString( KDateTime::ISODate );
 }
 
 QString KolabBase::dateToString( const QDate& date )
@@ -422,9 +422,7 @@
 
 KDateTime KolabBase::stringToDateTime( const QString& _date )
 {
-  QString date( _date );
-  if ( date.endsWith( 'Z' ) )
-    date.truncate( date.length() - 1 );
+  const QString date( _date );
   return KDateTime::fromString( date, KDateTime::ISODate );
 }
 
Index: kresources/kolab/kcal/kolab.desktop
===================================================================
--- kresources/kolab/kcal/kolab.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/kolab/kcal/kolab.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -66,8 +66,10 @@
 Comment[nn]=Gjev tilgang til kalendrar lagra p√• ein Kolab-tenar med IMAP via KMail eller Kontakt
 Comment[pl]=Zapewnia dostƒôp do kalendarza przechowywanego na serwerze Kolab przy u≈ºyciu IMAP w KMailu lub Kontakcie
 Comment[pt]=Oferece o acesso a um calend√°rio guardado num servidor Kolab por IMAP, atrav√©s do KMail ou do Kontact
-Comment[pt_BR]=Fornece acesso a um calend√°rio armazenado em um servidor Kolab usando IMAP, pelo KMail ou Kontact
+Comment[pt_BR]=Fornece acesso a um calend√°rio armazenado em um servidor Kolab usando IMAP com o KMail ou Kontact
+Comment[sl]=Prek IMAPa v KMail ali Kontact omogoƒça dostop do koledarja, shranjenega na stre≈æniku Kolab.
 Comment[sv]=Ger tillg√•ng till en kalender lagrad p√• en Kolab-server med anv√§ndning av IMAP via Kmail eller Kontact
+Comment[tr]=KMail veya Kontact aracƒ±lƒ±ƒüƒ±yla IMAP kullanarak bir Kolab sunucusunda depolanan bir takvime eri≈üim saƒülar
 Comment[uk]=–ù–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è, —è–∫–∏–π –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ Kolab, –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é IMAP –∑–∞ –ø–æ—Å–µ—Ä–µ–¥–Ω–∏—Ü—Ç–≤–∞ KMail –∞–±–æ Kontact
 Comment[x-test]=xxProvides access to a calendar stored on a Kolab server using IMAP via KMail or Kontactxx
 Comment[zh_CN]=ÈÄöËøá KMail Êàñ Kontact ÁöÑ IMAP ÂäüËÉΩÔºåÊèê‰æõÂØπÂ≠òÂÇ®Âú® Kolab ÊúçÂä°Âô®‰∏äÁöÑÊó•ÂéÜÁöÑËÆøÈóÆÊîØÊåÅ
Index: kresources/kolab/kcal/resourcekolab.cpp
===================================================================
--- kresources/kolab/kcal/resourcekolab.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/kolab/kcal/resourcekolab.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -239,11 +239,20 @@
 {
   Q_UNUSED( syncCache );
   if (!mUidMap.isEmpty() ) {
+    emit resourceLoaded( this );
     return true;
   }
   mUidMap.clear();
 
-  return loadAllEvents() & loadAllTodos() & loadAllJournals();
+  bool result = loadAllEvents() & loadAllTodos() & loadAllJournals();
+  if ( result ) {
+    emit resourceLoaded( this );
+  } else {
+    // FIXME: anyone know if the resource correctly calls loadError()
+    // if it has one?
+  }
+
+  return result;
 }
 
 bool ResourceKolab::doLoadAll( ResourceMap& map, const char* mimetype )
Index: kresources/kolab/kcal/incidence.cpp
===================================================================
--- kresources/kolab/kcal/incidence.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/kolab/kcal/incidence.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -255,6 +255,7 @@
     QDomElement e = list.ownerDocument().createElement( "alarm" );
     list.appendChild( e );
 
+    writeString( e, "enabled", a->enabled() ? "1" : "0" );
     if ( a->hasStartOffset() ) {
       writeString( e, "start-offset", QString::number( a->startOffset().asSeconds()/60 ) );
     }
@@ -434,6 +435,8 @@
         loadAttachmentsHelper( e, a );
       } else if ( tagName == "file" ) {
         a->setAudioFile( e.text() );
+      } else if ( tagName == "enabled" ) {
+        a->setEnabled( e.text().toInt() != 0 );
       } else {
         kWarning() << "Unhandled tag" << tagName;
       }
@@ -452,6 +455,7 @@
 
       if ( tagName == "alarm" ) {
         KCal::Alarm *a = new KCal::Alarm( 0 );
+        a->setEnabled( true ); // default to enabled, unless some XML attribute says otherwise.
         QString type = e.attribute( "type" );
         if ( type == "display" ) {
           a->setType( KCal::Alarm::Display );
@@ -884,6 +888,7 @@
     alarm->setType( KCal::Alarm::Display );
   } else if ( !mAlarms.isEmpty() ) {
     foreach ( KCal::Alarm* a, mAlarms ) {
+      a->setParent( incidence );
       incidence->addAlarm( a );
     }
   }
Index: kresources/birthdays/kabc.desktop
===================================================================
--- kresources/birthdays/kabc.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/birthdays/kabc.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -74,6 +74,7 @@
 Comment[pl]=Zapewnia dostƒôp do dat urodzin wizyt√≥wek w ksiƒÖ≈ºce adresowej KDE jako zdarze≈Ñ kalendarza
 Comment[pt]=Oferece o acesso √†s datas de anivers√°rio dos contactos no livro de endere√ßos como eventos do calend√°rio
 Comment[pt_BR]=Fornece acesso √†s datas de anivers√°rio de contatos do livro de endere√ßos do KDE como eventos de calend√°rio
+Comment[sl]=Omogoƒça dostop do rojstnih dnevov stikov, shranjenih v KDE-jevem adresarju. Na voljo so kot koledarski dogodki.
 Comment[sv]=Ger tillg√•ng till f√∂delsedagsdatum f√∂r kontakter i KDE:s adressbok som kalenderh√§ndelser
 Comment[tr]=KDE Adres defterindeki ki≈üilerin doƒüumg√ºn√º g√ºnlerine takvim olaylarƒ± olarak eri≈ümeyi saƒülar
 Comment[uk]=–ù–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –¥–∞—Ç –¥–Ω—ñ–≤ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, —è–∫—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É –∞–¥—Ä–µ—Å–Ω—ñ–π –∫–Ω–∏–∑—ñ KDE —è–∫ –ø–æ–¥—ñ—ó –∫–∞–ª–µ–Ω–¥–∞—Ä—è
Index: kresources/remote/remote.desktop
===================================================================
--- kresources/remote/remote.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/remote/remote.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -71,7 +71,9 @@
 Comment[pl]=Zapewnia dostƒôp do kalendarza w zdalnym pliku przy u≈ºyciu systemu sieciowego KDE - KIO
 Comment[pt]=Oferece o acesso a um calend√°rio num ficheiro remoto, usando um KIO da plataforma de rede do KDE
 Comment[pt_BR]=Fornece acesso a um calend√°rio em um arquivo remoto usando o KIO framework da rede do KDE
+Comment[sl]=Z uporabo KDE-jevega omre≈ænega ogrodja KIO omogoƒça dostop do koledarja, ki je shranjen v oddaljeni datoteki
 Comment[sv]=Ger tillg√•ng till en kalender i en fj√§rrfil med anv√§ndning av KDE:s I/O-ramverk
+Comment[tr]=KDE'nin aƒü √ßatƒ±sƒ± KIO'yu kullanarak uzak bir dosyadaki bir takvime eri≈üimi saƒülar
 Comment[uk]=–ù–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è, —è–∫–∏–π –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–º—É —Ñ–∞–π–ª—ñ, –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∑–∞—Å–æ–±—ñ–≤ KIO KDE
 Comment[x-test]=xxProvides access to a calendar in a remote file using KDE's network framework KIOxx
 Comment[zh_CN]=ÈÄöËøá KDE ÁΩëÁªúÊ°ÜÊû∂ KIOÔºåÊèê‰æõÂØπËøúÁ®ãÊó•ÂéÜÊñá‰ª∂ÁöÑËÆøÈóÆÊîØÊåÅ
Index: kresources/akonadi/kabc/resourceakonadi.cpp
===================================================================
--- kresources/akonadi/kabc/resourceakonadi.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/akonadi/kabc/resourceakonadi.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1,7 +1,7 @@
 // -*- c-basic-offset: 2 -*-
 /*
     This file is part of libkabc.
-    Copyright (c) 2008 Kevin Krammer <kevin.krammer@gmx.at>
+    Copyright (c) 2008-2009 Kevin Krammer <kevin.krammer@gmx.at>
 
     This library is free software; you can redistribute it and/or
     modify it under the terms of the GNU Library General Public
@@ -26,6 +26,7 @@
 #include <akonadi/collectionfilterproxymodel.h>
 #include <akonadi/collectionmodel.h>
 #include <akonadi/control.h>
+#include <akonadi/entitydisplayattribute.h>
 #include <akonadi/monitor.h>
 #include <akonadi/item.h>
 #include <akonadi/itemcreatejob.h>
@@ -40,11 +41,98 @@
 #include <kconfiggroup.h>
 #include <kdebug.h>
 
+#include <QtConcurrentRun>
+#include <QFuture>
 #include <QHash>
 
 using namespace Akonadi;
 using namespace KABC;
 
+class UidToCollectionMapper
+{
+public:
+  virtual ~UidToCollectionMapper() {}
+
+  virtual Collection collectionForUid( const QString &uid ) const = 0;
+};
+
+static KJob *createSaveSequence( const UidToCollectionMapper &mapper,
+    const Item::List &addedItems, const Item::List &modifiedItems, const Item::List &deletedItems );
+
+class ThreadJobContext
+{
+  public:
+    explicit ThreadJobContext( const UidToCollectionMapper &mapper )
+      : mMapper( mapper ) {}
+
+    void clear()
+    {
+      mJobError.clear();
+      mCollections.clear();
+      mItems.clear();
+
+      mAddedItems.clear();
+      mModifiedItems.clear();
+      mDeletedItems.clear();
+    }
+
+    bool fetchCollections()
+    {
+      CollectionFetchJob *job = new CollectionFetchJob( Collection::root(), CollectionFetchJob::Recursive );
+
+      bool jobResult = job->exec();
+      if ( jobResult )
+        mCollections = job->collections();
+      else
+        mJobError = job->errorString();
+
+      delete job;
+      return jobResult;
+    }
+
+    bool fetchItems( const Collection &collection )
+    {
+      ItemFetchJob *job = new ItemFetchJob( collection );
+      job->fetchScope().fetchFullPayload();
+
+      bool jobResult = job->exec();
+      if ( jobResult )
+        mItems = job->items();
+      else
+        mJobError = job->errorString();
+
+      delete job;
+      return jobResult;
+    }
+
+    bool saveChanges()
+    {
+      KJob *job = createSaveSequence( mMapper, mAddedItems, mModifiedItems, mDeletedItems );
+
+      bool jobResult = job->exec();
+      if ( !jobResult )
+        mJobError = job->errorString();
+
+      delete job;
+      return jobResult;
+    }
+
+  public:
+    QString mJobError;
+
+    Collection::List mCollections;
+    Item::List mItems;
+
+    Item::List mAddedItems;
+    Item::List mModifiedItems;
+    Item::List mDeletedItems;
+
+  private:
+    const UidToCollectionMapper &mMapper;
+
+  private:
+};
+
 typedef QMap<Item::Id, Item> ItemMap;
 typedef QHash<QString, Item::Id> IdHash;
 
@@ -55,6 +143,10 @@
         : mCollection( collection ), mLabel( collection.name() ),
           mActive(true), mCompletionWeight(80)
     {
+      if ( mCollection.hasAttribute<EntityDisplayAttribute>() &&
+           !mCollection.attribute<EntityDisplayAttribute>()->displayName().isEmpty() )
+        mLabel = mCollection.attribute<EntityDisplayAttribute>()->displayName();
+
       readConfig( parentGroup );
     }
 
@@ -114,14 +206,23 @@
 typedef QMap<QString, QString>  UidResourceMap;
 typedef QMap<Item::Id, QString> ItemIdResourceMap;
 
-class ResourceAkonadi::Private
+class ResourceAkonadi::Private : public UidToCollectionMapper
 {
   public:
     Private( ResourceAkonadi *parent )
-      : mParent( parent ), mMonitor( 0 ), mCollectionModel( 0 ), mCollectionFilterModel( 0 )
+      : mParent( parent ), mMonitor( 0 ), mCollectionModel( 0 ), mCollectionFilterModel( 0 ),
+        mThreadJobContext( *this )
     {
     }
 
+    Collection collectionForUid( const QString &uid ) const
+    {
+      SubResource *subResource = mSubResources.value( mUidToResourceMap.value( uid ), 0 );
+      Q_ASSERT( subResource != 0 );
+
+      return subResource->mCollection;
+    }
+
  public:
     ResourceAkonadi *mParent;
 
@@ -157,6 +258,8 @@
 
     QSet<QString> mAsyncLoadCollections;
 
+    ThreadJobContext mThreadJobContext;
+
   public:
     void subResourceLoadResult( KJob *job );
 
@@ -175,6 +278,8 @@
     bool prepareSaving();
     KJob *createSaveSequence() const;
 
+    void createItemListsForSave( Item::List &added, Item::List &modified, Item::List &deleted ) const;
+
     bool reloadSubResource( SubResource *subResource, bool &changed );
 
     DistributionList *distListFromContactGroup( const KPIM::ContactGroup &contactGroup );
@@ -343,15 +448,15 @@
 
   // if we do not have any collection yet, fetch them explicitly
   if ( collections.isEmpty() ) {
-    CollectionFetchJob *colJob =
-      new CollectionFetchJob( Collection::root(), CollectionFetchJob::Recursive );
-    if ( !colJob->exec() ) {
-      emit loadingError( this, colJob->errorString() );
+    d->mThreadJobContext.clear();
+    QFuture<bool> threadResult =
+      QtConcurrent::run( &(d->mThreadJobContext), &ThreadJobContext::fetchCollections );
+    if ( !threadResult.result() ) {
+      emit loadingError( this, d->mThreadJobContext.mJobError );
       return false;
     }
 
-    // TODO: should probably add the data to the model right here
-    collections = colJob->collections();
+    collections = d->mThreadJobContext.mCollections;
   }
 
   bool result = true;
@@ -404,14 +509,15 @@
 
   // if we do not have any collection yet, fetch them explicitly
   if ( collections.isEmpty() ) {
-    CollectionFetchJob *colJob =
-      new CollectionFetchJob( Collection::root(), CollectionFetchJob::Recursive );
-    if ( !colJob->exec() ) {
-      emit loadingError( this, colJob->errorString() );
+    d->mThreadJobContext.clear();
+    QFuture<bool> threadResult =
+      QtConcurrent::run( &(d->mThreadJobContext), &ThreadJobContext::fetchCollections );
+    if ( !threadResult.result() ) {
+      emit loadingError( this, d->mThreadJobContext.mJobError );
       return false;
     }
 
-    foreach ( const Collection &collection, colJob->collections() ) {
+    foreach ( const Collection &collection, d->mThreadJobContext.mCollections ) {
       if ( !collection.contentMimeTypes().contains( QLatin1String( "text/directory" ) )
             && !collection.contentMimeTypes().contains( KPIM::ContactGroup::mimeType() ) )
         continue;
@@ -458,13 +564,17 @@
   if ( !d->prepareSaving() )
     return false;
 
-  KJob *job = d->createSaveSequence();
-  if ( job == 0 )
-    return false;
+  d->mThreadJobContext.clear();
 
-  if ( !job->exec() ) {
+  d->createItemListsForSave( d->mThreadJobContext.mAddedItems,
+                             d->mThreadJobContext.mModifiedItems,
+                             d->mThreadJobContext.mDeletedItems );
+
+  QFuture<bool> threadResult =
+    QtConcurrent::run( &(d->mThreadJobContext), &ThreadJobContext::saveChanges );
+  if ( !threadResult.result() ) {
     // TODO error handling
-    kError(5700) << "Save Sequence failed:" << job->errorString();
+    kError(5700) << "Save Sequence failed:" << d->mThreadJobContext.mJobError;
     return false;
   }
 
@@ -754,6 +864,7 @@
       mParent->mAddrMap.insert( addressee.uid(), addressee );
       mUidToResourceMap.insert( addressee.uid(), collectionUrl );
       mItemIdToResourceMap.insert( id, collectionUrl );
+      mChanges.remove( addressee.uid() );
     } else if ( item.hasPayload<KPIM::ContactGroup>() ) {
       KPIM::ContactGroup contactGroup = item.payload<KPIM::ContactGroup>();
 
@@ -1037,11 +1148,15 @@
           const QString collectionUrl = collection.url().url();
           SubResource* subResource = mSubResources.value( collectionUrl, 0 );
           if ( subResource != 0 ) {
-            if ( subResource->mLabel != collection.name() ) {
+            QString newName = collection.name();
+            if ( collection.hasAttribute<EntityDisplayAttribute>() &&
+                 !collection.attribute<EntityDisplayAttribute>()->displayName().isEmpty() )
+              newName = collection.attribute<EntityDisplayAttribute>()->displayName();
+            if ( subResource->mLabel != newName ) {
               kDebug(5700) << "Renaming subResource" << collectionUrl
                            << "from" << subResource->mLabel
-                           << "to"   << collection.name();
-              subResource->mLabel = collection.name();
+                           << "to"   << newName;
+              subResource->mLabel = newName;
               changed = true;
               emit mParent->signalSubresourceChanged( mParent, QLatin1String( "contact" ), collectionUrl );
             }
@@ -1277,12 +1392,83 @@
   return true;
 }
 
+static KJob *createSaveSequence( const UidToCollectionMapper &mapper,
+    const Item::List &addedItems, const Item::List &modifiedItems, const Item::List &deletedItems )
+{
+  TransactionSequence *sequence = new TransactionSequence();
+
+  foreach ( const Item &item, addedItems ) {
+    QString uid;
+    if ( item.hasPayload<KABC::Addressee>() ) {
+      const KABC::Addressee addressee = item.payload<KABC::Addressee>();
+      kDebug(5700) << "CreateJob for addressee" << addressee.uid()
+                   << addressee.formattedName();
+      uid = addressee.uid();
+    } else if ( item.hasPayload<KPIM::ContactGroup>() ) {
+      const KPIM::ContactGroup contactGroup = item.payload<KPIM::ContactGroup>();
+      kDebug(5700) << "CreateJob for contact group" << contactGroup.id()
+                   << contactGroup.name();
+      uid = contactGroup.id();
+    } else {
+      kWarning(5700) << "New item id=" << item.id() << "neither addressee nor contactgroup";
+      continue;
+    }
+
+    (void) new ItemCreateJob( item, mapper.collectionForUid( uid ), sequence );
+  }
+
+  foreach ( const Item &item, modifiedItems ) {
+    if ( item.hasPayload<KABC::Addressee>() ) {
+      const KABC::Addressee addressee = item.payload<KABC::Addressee>();
+      kDebug(5700) << "ModifyJob for addressee" << addressee.uid()
+                   << addressee.formattedName();
+    } else if ( item.hasPayload<KPIM::ContactGroup>() ) {
+      const KPIM::ContactGroup contactGroup = item.payload<KPIM::ContactGroup>();
+      kDebug(5700) << "ModifyJob for contact group" << contactGroup.id()
+                   << contactGroup.name();
+    } else {
+      kWarning(5700) << "Modified item id=" << item.id() << "neither addressee nor contactgroup";
+      continue;
+    }
+
+    (void) new ItemModifyJob( item, sequence );
+  }
+
+  foreach ( const Item &item, deletedItems ) {
+    if ( item.hasPayload<KABC::Addressee>() ) {
+      const KABC::Addressee addressee = item.payload<KABC::Addressee>();
+      kDebug(5700) << "DeleteJob for addressee" << addressee.uid()
+                   << addressee.formattedName();
+    } else if ( item.hasPayload<KPIM::ContactGroup>() ) {
+      const KPIM::ContactGroup contactGroup = item.payload<KPIM::ContactGroup>();
+      kDebug(5700) << "DeleteJob for contact group" << contactGroup.id()
+                   << contactGroup.name();
+    } else {
+      kWarning(5700) << "Deleted item id=" << item.id() << "neither addressee nor contactgroup";
+      continue;
+    }
+
+    (void) new ItemDeleteJob( item, sequence );
+  }
+
+  return sequence;
+}
+
 KJob *ResourceAkonadi::Private::createSaveSequence() const
 {
+  Item::List addedItems;
+  Item::List modifiedItems;
+  Item::List deletedItems;
+
+  createItemListsForSave( addedItems, modifiedItems, deletedItems );
+
+  return ::createSaveSequence( *this, addedItems, modifiedItems, deletedItems );
+}
+
+void ResourceAkonadi::Private::createItemListsForSave( Item::List &added, Item::List &modified, Item::List &deleted ) const
+{
   kDebug(5700) << mChanges.count() << "changes";
 
-  TransactionSequence *sequence = new TransactionSequence();
-
   ChangeMap::const_iterator changeIt    = mChanges.constBegin();
   ChangeMap::const_iterator changeEndIt = mChanges.constEnd();
   for ( ; changeIt != changeEndIt; ++changeIt ) {
@@ -1306,9 +1492,7 @@
           item.setMimeType( QLatin1String( "text/directory" ) );
           item.setPayload<KABC::Addressee>( addressee );
 
-          (void) new ItemCreateJob( item, subResource->mCollection, sequence );
-          kDebug(5700) << "CreateJob for addressee" << addressee.uid()
-                      << addressee.formattedName();
+          added << item;
         } else {
           DistributionList *list = mParent->mDistListMap.value( uid );
           if ( list != 0 ) {
@@ -1317,9 +1501,7 @@
             item.setMimeType( KPIM::ContactGroup::mimeType() );
             item.setPayload<KPIM::ContactGroup>( contactGroup );
 
-            (void) new ItemCreateJob( item, subResource->mCollection, sequence );
-            kDebug(5700) << "CreateJob for contact group" << contactGroup.id()
-                         << contactGroup.name();
+            added << item;
           }
         }
         break;
@@ -1336,9 +1518,7 @@
 
           item.setPayload<KABC::Addressee>( addressee );
 
-          (void) new ItemModifyJob( item, sequence );
-          kDebug(5700) << "ModifyJob for addressee" << addressee.uid()
-                       << addressee.formattedName();
+          modified << item;
         } else if ( item.hasPayload<KPIM::ContactGroup>() ) {
           DistributionList *list = mParent->mDistListMap.value( uid );
           if ( list != 0 ) {
@@ -1346,9 +1526,7 @@
 
             item.setPayload<KPIM::ContactGroup>( contactGroup );
 
-            (void) new ItemModifyJob( item, sequence );
-            kDebug(5700) << "ModifyJob for addressee" << addressee.uid()
-                         << addressee.formattedName();
+            modified << item;
           }
         }
         break;
@@ -1359,41 +1537,27 @@
         Q_ASSERT( itemIt != mItems.constEnd() );
 
         item = itemIt.value();
-        if ( item.hasPayload<KABC::Addressee>() ) {
-          addressee = item.payload<KABC::Addressee>();
-
-          kDebug(5700) << "DeleteJob for addressee" << uid
-                      << addressee.formattedName();
-        } else if ( item.hasPayload<KPIM::ContactGroup>() ) {
-          KPIM::ContactGroup contactGroup = item.payload<KPIM::ContactGroup>();
-
-          kDebug(5700) << "DeleteJob for contact group" << uid
-                       << contactGroup.name();
-        }
-
-        (void) new ItemDeleteJob( item, sequence );
+        deleted << item;
         break;
     }
   }
-
-  return sequence;
 }
 
 bool ResourceAkonadi::Private::reloadSubResource( SubResource *subResource, bool &changed )
 {
   changed = false;
-  ItemFetchJob *job = new ItemFetchJob( subResource->mCollection );
-  job->fetchScope().fetchFullPayload();
-
-  if ( !job->exec() ) {
-    emit mParent->loadingError( mParent, job->errorString() );
+  mThreadJobContext.clear();
+  QFuture<bool> threadResult =
+    QtConcurrent::run( &mThreadJobContext, &ThreadJobContext::fetchItems, subResource->mCollection );
+  if ( !threadResult.result() ) {
+    emit mParent->loadingError( mParent, mThreadJobContext.mJobError );
     return false;
   }
 
+  Item::List items = mThreadJobContext.mItems;
+
   const QString collectionUrl = subResource->mCollection.url().url();
 
-  Item::List items = job->items();
-
   kDebug(5700) << "Reload for sub resource " << collectionUrl
                << "produced" << items.count() << "items";
 
Index: kresources/akonadi/kabc/akonadi.desktop
===================================================================
--- kresources/akonadi/kabc/akonadi.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/akonadi/kabc/akonadi.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -8,6 +8,7 @@
 Name[es]=Libreta de direcciones Akonadi
 Name[et]=Akonadi aadressiraamatud
 Name[fr]=Carnet d'adresses Akonadi
+Name[ga]=Leabhair Sheolta√≠ Akonadi
 Name[gl]=Caderno de Enderezos do Akonadi
 Name[it]=Rubrica indirizzi di Akonadi
 Name[ja]=Akonadi „Ç¢„Éâ„É¨„ÇπÂ∏≥
@@ -50,6 +51,7 @@
 Comment[pl]=Zapewnia dostƒôp do wizyt√≥wek przechowywanych w katalogach ksiƒÖ≈ºki adresowej Akonadi
 Comment[pt]=Oferece o acesso aos contactos guardados nas pastas do livro de endere√ßos do Akonadi
 Comment[pt_BR]=Fornece acesso aos contatos armazenados nas pastas do livro de endere√ßos do Akonadi
+Comment[sl]=Omogoƒça dostop do stikov, shranjenih v Akonadijevih mapah z adresarji
 Comment[sv]=Ger tillg√•ng till kontakter lagrade i Akonadi adressbokskataloger
 Comment[tr]=Akonadi adres defteri dizinlerindeki ki≈üilere eri≈üimi saƒülar
 Comment[uk]=–ù–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤, —è–∫—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É —Ç–µ–∫–∞—Ö –∞–¥—Ä–µ—Å–Ω–æ—ó –∫–Ω–∏–≥–∏ Akonadi
Index: kresources/akonadi/kcal/resourceakonadi.cpp
===================================================================
--- kresources/akonadi/kcal/resourceakonadi.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/akonadi/kcal/resourceakonadi.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1,6 +1,6 @@
 /*
     This file is part of libkcal.
-    Copyright (c) 2008 Kevin Krammer <kevin.krammer@gmx.at>
+    Copyright (c) 2008-2009 Kevin Krammer <kevin.krammer@gmx.at>
 
     This library is free software; you can redistribute it and/or
     modify it under the terms of the GNU Library General Public
@@ -34,6 +34,7 @@
 #include <akonadi/collectionfilterproxymodel.h>
 #include <akonadi/collectionmodel.h>
 #include <akonadi/control.h>
+#include <akonadi/entitydisplayattribute.h>
 #include <akonadi/monitor.h>
 #include <akonadi/item.h>
 #include <akonadi/itemcreatejob.h>
@@ -42,23 +43,22 @@
 #include <akonadi/itemfetchscope.h>
 #include <akonadi/itemmodifyjob.h>
 #include <akonadi/transactionsequence.h>
+#include <akonadi/kcal/assignmentvisitor.h>
 #include <akonadi/kcal/kcalmimetypevisitor.h>
 
 #include <kconfiggroup.h>
 #include <kdebug.h>
 #include <kmimetype.h>
 
+#include <QtConcurrentRun>
+#include <QFuture>
 #include <QHash>
-#include <QTimer>
 
 #include <boost/shared_ptr.hpp>
 
 using namespace Akonadi;
 using namespace KCal;
 
-using namespace Akonadi;
-using namespace KCal;
-
 typedef boost::shared_ptr<Incidence> IncidencePtr;
 
 typedef QMap<Item::Id, Item> ItemMap;
@@ -83,6 +83,91 @@
   return false;
 }
 
+class UidToCollectionMapper
+{
+public:
+  virtual ~UidToCollectionMapper() {}
+
+  virtual Collection collectionForUid( const QString &uid ) const = 0;
+};
+
+static KJob *createSaveSequence( const UidToCollectionMapper &mapper,
+    const Item::List &addedItems, const Item::List &modifiedItems, const Item::List &deletedItems );
+
+class ThreadJobContext
+{
+  public:
+    explicit ThreadJobContext( const UidToCollectionMapper &mapper )
+      : mMapper( mapper ) {}
+
+    void clear()
+    {
+      mJobError.clear();
+      mCollections.clear();
+      mItems.clear();
+
+      mAddedItems.clear();
+      mModifiedItems.clear();
+      mDeletedItems.clear();
+    }
+
+    bool fetchCollections()
+    {
+      CollectionFetchJob *job = new CollectionFetchJob( Collection::root(), CollectionFetchJob::Recursive );
+
+      bool jobResult = job->exec();
+      if ( jobResult )
+        mCollections = job->collections();
+      else
+        mJobError = job->errorString();
+
+      delete job;
+      return jobResult;
+    }
+
+    bool fetchItems( const Collection &collection )
+    {
+      ItemFetchJob *job = new ItemFetchJob( collection );
+      job->fetchScope().fetchFullPayload();
+
+      bool jobResult = job->exec();
+      if ( jobResult )
+        mItems = job->items();
+      else
+        mJobError = job->errorString();
+
+      delete job;
+      return jobResult;
+    }
+
+    bool saveChanges()
+    {
+      KJob *job = createSaveSequence( mMapper, mAddedItems, mModifiedItems, mDeletedItems );
+
+      bool jobResult = job->exec();
+      if ( !jobResult )
+        mJobError = job->errorString();
+
+      delete job;
+      return jobResult;
+    }
+
+  public:
+    QString mJobError;
+
+    Collection::List mCollections;
+    Item::List mItems;
+
+    Item::List mAddedItems;
+    Item::List mModifiedItems;
+    Item::List mDeletedItems;
+
+  private:
+    const UidToCollectionMapper &mMapper;
+
+  private:
+};
+
 class SubResource
 {
   public:
@@ -90,6 +175,10 @@
         : mCollection( collection ), mLabel( collection.name() ),
           mActive(true)
     {
+      if ( mCollection.hasAttribute<EntityDisplayAttribute>() &&
+           !mCollection.attribute<EntityDisplayAttribute>()->displayName().isEmpty() )
+        mLabel = mCollection.attribute<EntityDisplayAttribute>()->displayName();
+
       readConfig( parentGroup );
     }
 
@@ -137,15 +226,26 @@
 typedef QMap<QString, QString>  UidResourceMap;
 typedef QMap<Item::Id, QString> ItemIdResourceMap;
 
-class ResourceAkonadi::Private : public KCal::Calendar::CalendarObserver
+enum ChangeType
 {
+  Added,
+  Changed,
+  Removed
+};
+
+typedef QMap<QString, ChangeType> ChangeMap;
+
+class ResourceAkonadi::Private : public KCal::Calendar::CalendarObserver,
+                                 public UidToCollectionMapper
+{
   public:
     Private( ResourceAkonadi *parent )
       : mParent( parent ), mMonitor( 0 ), mCalendar( QLatin1String( "UTC" ) ),
         mLock( true ), mInternalCalendarModification( false ),
         mMimeVisitor( new KCalMimeTypeVisitor() ),
         mCollectionModel( 0 ), mCollectionFilterModel( 0 ),
-        mAgentModel( 0 ), mAgentFilterModel( 0 )
+        mAgentModel( 0 ), mAgentFilterModel( 0 ),
+        mThreadJobContext( *this )
     {
       mCalendar.registerObserver( this );
     }
@@ -155,6 +255,14 @@
       delete mMimeVisitor;
     }
 
+    Collection collectionForUid( const QString &uid ) const
+    {
+      SubResource *subResource = mSubResources.value( mUidToResourceMap.value( uid ), 0 );
+      Q_ASSERT( subResource != 0 );
+
+      return subResource->mCollection;
+    }
+
   public:
     ResourceAkonadi *mParent;
 
@@ -173,8 +281,6 @@
 
     bool mInternalCalendarModification;
 
-    QTimer mAutoSaveOnDeleteTimer;
-
     KCalMimeTypeVisitor *mMimeVisitor;
 
     CollectionModel *mCollectionModel;
@@ -188,19 +294,15 @@
 
     QHash<Akonadi::Job*, QString> mJobToResourceMap;
 
-    enum ChangeType
-    {
-      Added,
-      Changed,
-      Removed
-    };
-
-    typedef QMap<QString, ChangeType> ChangeMap;
     ChangeMap mChanges;
 
     AgentInstanceModel *mAgentModel;
     AgentFilterProxyModel *mAgentFilterModel;
 
+    ThreadJobContext mThreadJobContext;
+
+    AssignmentVisitor mIncidenceAssigner;
+
   public:
     void subResourceLoadResult( KJob *job );
 
@@ -215,12 +317,13 @@
     void addCollectionsRecursively( const QModelIndex &parent, int start, int end );
     bool removeCollectionsRecursively( const QModelIndex &parent, int start, int end );
 
-    void delayedAutoSaveOnDelete();
-
     Collection findDefaultCollection() const;
     bool prepareSaving();
-    KJob *createSaveSequence();
 
+    void createItemListsForSave( Item::List &added, Item::List &modified, Item::List &deleted );
+
+    void processChange( ChangeMap::const_iterator changeIt, Item::List &added, Item::List &modified, Item::List &deleted );
+
     // from the CalendarObserver interface
     virtual void calendarIncidenceAdded( Incidence *incidence );
     virtual void calendarIncidenceChanged( Incidence *incidence );
@@ -657,9 +760,12 @@
   }
 
   // clear local caches
-  d->mInternalCalendarModification = true;
-  d->mCalendar.close();
-  d->mInternalCalendarModification = false;
+  if ( !d->mCalendar.incidences().isEmpty() ) {
+    d->mInternalCalendarModification = true;
+    d->mCalendar.close();
+    d->mInternalCalendarModification = false;
+    emit resourceChanged( this );
+  }
 
   d->mItems.clear();
   d->mIdMapping.clear();
@@ -670,15 +776,15 @@
 
   // if we do not have any collection yet, fetch them explicitly
   if ( collections.isEmpty() ) {
-    CollectionFetchJob *colJob =
-      new CollectionFetchJob( Collection::root(), CollectionFetchJob::Recursive );
-    if ( !colJob->exec() ) {
-      loadError( colJob->errorString() );
+    d->mThreadJobContext.clear();
+    QFuture<bool> threadResult =
+      QtConcurrent::run( &(d->mThreadJobContext), &ThreadJobContext::fetchCollections );
+    if ( !threadResult.result() ) {
+      loadError( d->mThreadJobContext.mJobError );
       return false;
     }
 
-    // TODO: should probably add the data to the model right here
-    collections = colJob->collections();
+    collections = d->mThreadJobContext.mCollections;
   }
 
   bool result = true;
@@ -718,15 +824,23 @@
   if ( !d->prepareSaving() )
     return false;
 
-  KJob *job = d->createSaveSequence();
-  if ( job == 0 )
-    return false;
+  d->mThreadJobContext.clear();
 
-  connect( job, SIGNAL( result( KJob* ) ), this, SLOT( saveResult( KJob* ) ) );
+  d->createItemListsForSave( d->mThreadJobContext.mAddedItems,
+                             d->mThreadJobContext.mModifiedItems,
+                             d->mThreadJobContext.mDeletedItems );
 
-  if ( !job->exec() )
+  QFuture<bool> threadResult =
+    QtConcurrent::run( &(d->mThreadJobContext), &ThreadJobContext::saveChanges );
+  if ( !threadResult.result() ) {
+    // TODO error handling
+    kError(5800) << "Save Sequence failed:" << d->mThreadJobContext.mJobError;
+    saveError( d->mThreadJobContext.mJobError );
     return false;
+  }
 
+  emit resourceSaved( this );
+
   d->mChanges.clear();
 
   return true;
@@ -737,65 +851,57 @@
   kDebug(5800) << "syncCache=" << syncCache
                << ", incidence" << incidence->uid();
 
-  UidResourceMap::const_iterator findIt = d->mUidToResourceMap.constFind( incidence->uid() );
-  while ( findIt == d->mUidToResourceMap.constEnd() ) {
-    if ( !d->mStoreCollection.isValid() ||
-          d->mSubResources.value( d->mStoreCollection.url().url(), 0 ) == 0 ) {
-
-      // if there is only one subresource take it instead of asking
-      // since this is the most likely choice of the user anyway
-      if ( d->mSubResourceIds.count() == 1 ) {
-        d->mStoreCollection = Collection::fromUrl( *d->mSubResourceIds.begin() );
-      } else {
-        Collection defaultCollection = d->findDefaultCollection();
-        if ( defaultCollection.isValid() ) {
-          setStoreCollection( defaultCollection );
-        }
-        else {
-          ResourceAkonadiConfigDialog dialog( this );
-          if ( dialog.exec() != QDialog::Accepted )
-            return false;
-        }
-      }
-    } else
-      d->mUidToResourceMap.insert( incidence->uid(), d->mStoreCollection.url().url() );
-
-    findIt = d->mUidToResourceMap.constFind( incidence->uid() );
+  ChangeMap::const_iterator changeIt = d->mChanges.constFind( incidence->uid() );
+  if ( changeIt == d->mChanges.constEnd() ) {
+    kWarning(5800) << "There is no change for incidence uid=" << incidence->uid()
+                   << "summary=" << incidence->summary();
+    return true;
   }
 
-  KJob *job = 0;
+  if ( changeIt.value() == Added ) {
+    UidResourceMap::const_iterator findIt = d->mUidToResourceMap.constFind( incidence->uid() );
+    while ( findIt == d->mUidToResourceMap.constEnd() ) {
+      if ( !d->mStoreCollection.isValid() ||
+            d->mSubResources.value( d->mStoreCollection.url().url(), 0 ) == 0 ) {
 
-  ItemMap::const_iterator itemIt = d->mItems.constEnd();
+        // if there is only one subresource take it instead of asking
+        // since this is the most likely choice of the user anyway
+        if ( d->mSubResourceIds.count() == 1 ) {
+          d->mStoreCollection = Collection::fromUrl( *d->mSubResourceIds.begin() );
+        } else {
+          Collection defaultCollection = d->findDefaultCollection();
+          if ( defaultCollection.isValid() ) {
+            setStoreCollection( defaultCollection );
+          }
+          else {
+            ResourceAkonadiConfigDialog dialog( this );
+            if ( dialog.exec() != QDialog::Accepted )
+              return false;
+          }
+        }
+      } else
+        d->mUidToResourceMap.insert( incidence->uid(), d->mStoreCollection.url().url() );
 
-  IdHash::const_iterator idIt = d->mIdMapping.constFind( incidence->uid() );
-  if ( idIt != d->mIdMapping.constEnd() ) {
-    itemIt = d->mItems.constFind( idIt.value() );
+      findIt = d->mUidToResourceMap.constFind( incidence->uid() );
+    }
   }
 
-  if ( itemIt == d->mItems.constEnd() ) {
-    kDebug(5800) << "No item yet, using ItemCreateJob";
+  d->mThreadJobContext.clear();
 
-    Item item( d->mMimeVisitor->mimeType( incidence ) );
-    item.setPayload<IncidencePtr>( IncidencePtr( incidence->clone() ) );
+  d->processChange( changeIt, d->mThreadJobContext.mAddedItems,
+                    d->mThreadJobContext.mModifiedItems, d->mThreadJobContext.mDeletedItems );
 
-    job = new ItemCreateJob( item, d->mStoreCollection, this );
-  } else {
-    kDebug(5800) << "Item already exists, using ItemModifyJob";
-    Item item = itemIt.value();
-    item.setPayload<IncidencePtr>( IncidencePtr( incidence->clone() ) );
-
-    ItemModifyJob *modifyJob = new ItemModifyJob( item, this );
-    // HACK listen to the result and update revision accordingly
-    modifyJob->disableRevisionCheck();
-
-    job = modifyJob;
+  QFuture<bool> threadResult =
+    QtConcurrent::run( &(d->mThreadJobContext), &ThreadJobContext::saveChanges );
+  if ( !threadResult.result() ) {
+    // TODO error handling
+    kError(5800) << "Save Sequence failed:" << d->mThreadJobContext.mJobError;
+    saveError( d->mThreadJobContext.mJobError );
+    return false;
   }
 
-  connect( job, SIGNAL( result( KJob* ) ), this, SLOT( saveResult( KJob* ) ) );
+  emit resourceSaved( this );
 
-  if ( !job->exec() )
-    return false;
-
   d->mChanges.remove( incidence->uid() );
 
   return true;
@@ -891,9 +997,6 @@
 {
   // TODO: might be better to do this already in the resource factory
   Akonadi::Control::start();
-
-  connect( &d->mAutoSaveOnDeleteTimer, SIGNAL( timeout() ),
-           this, SLOT( delayedAutoSaveOnDelete() ) );
 }
 
 void ResourceAkonadi::Private::subResourceLoadResult( KJob *job )
@@ -926,7 +1029,15 @@
 
       Incidence *cachedIncidence = mCalendar.incidence( incidencePtr->uid() );
       if ( cachedIncidence != 0 ) {
-        *cachedIncidence = *(incidencePtr.get());
+        if ( !mIncidenceAssigner.assign( cachedIncidence, incidencePtr.get() ) ) {
+          kWarning(5800) << "Incidence uid=" << cachedIncidence->uid()
+                         << ", " << cachedIncidence->summary()
+                         << "changed type. Replacing it.";
+
+          mCalendar.deleteIncidence( cachedIncidence );
+          delete cachedIncidence;
+          mCalendar.addIncidence( incidencePtr.get()->clone() );
+        }
       } else {
         Incidence *incidence = incidencePtr->clone();
         if ( !mCalendar.addIncidence( incidence ) ) {
@@ -1035,10 +1146,16 @@
   bool internalModification = mInternalCalendarModification;
   mInternalCalendarModification = true;
 
-//   mCalendar.deleteIncidence( cachedIncidence );
-//   mCalendar.addIncidence( incidence.get()->clone() );
-  *cachedIncidence = *(incidence.get());
+  if ( !mIncidenceAssigner.assign( cachedIncidence, incidence.get() ) ) {
+    kWarning(5800) << "Incidence uid=" << cachedIncidence->uid()
+                   << ", " << cachedIncidence->summary()
+                   << "changed type. Replacing it.";
 
+    mCalendar.deleteIncidence( cachedIncidence );
+    delete cachedIncidence;
+    mCalendar.addIncidence( incidence.get()->clone() );
+  }
+
   mInternalCalendarModification = internalModification;
 
   mChanges.remove( incidence->uid() );
@@ -1138,11 +1255,15 @@
           const QString collectionUrl = collection.url().url();
           SubResource* subResource = mSubResources.value( collectionUrl, 0 );
           if ( subResource != 0 ) {
-            if ( subResource->mLabel != collection.name() ) {
+            QString newName = collection.name();
+            if ( collection.hasAttribute<EntityDisplayAttribute>() &&
+                 !collection.attribute<EntityDisplayAttribute>()->displayName().isEmpty() )
+              newName = collection.attribute<EntityDisplayAttribute>()->displayName();
+            if ( subResource->mLabel != newName ) {
               kDebug(5800) << "Renaming subResource" << collectionUrl
                            << "from" << subResource->mLabel
-                           << "to"   << collection.name();
-              subResource->mLabel = collection.name();
+                           << "to"   << newName;
+              subResource->mLabel = newName;
               changed = true;
               // TODO probably need to add this to ResourceCalendar as well
               //emit mParent->signalSubresourceChanged( mParent, QLatin1String( "calendar" ), collectionUrl );
@@ -1266,13 +1387,6 @@
   return changed;
 }
 
-void ResourceAkonadi::Private::delayedAutoSaveOnDelete()
-{
-  kDebug(5800);
-
-  mParent->doSave( false );
-}
-
 Collection ResourceAkonadi::Private::findDefaultCollection() const
 {
   if ( mConfig.isValid() ) {
@@ -1331,82 +1445,123 @@
   return true;
 }
 
-KJob *ResourceAkonadi::Private::createSaveSequence()
+static KJob *createSaveSequence( const UidToCollectionMapper &mapper,
+    const Item::List &addedItems, const Item::List &modifiedItems, const Item::List &deletedItems )
 {
-  kDebug(5800);
-  mAutoSaveOnDeleteTimer.stop();
-
   TransactionSequence *sequence = new TransactionSequence();
 
+  foreach ( const Item &item, addedItems ) {
+    QString uid;
+    if ( item.hasPayload<IncidencePtr>() ) {
+      const IncidencePtr incidence = item.payload<IncidencePtr>();
+      kDebug(5800) << "CreateJob for incidence" << incidence->uid()
+                   << incidence->summary();
+      uid = incidence->uid();
+    } else {
+      kWarning(5800) << "New item id=" << item.id() << "not an incidence";
+      continue;
+    }
+
+    (void) new ItemCreateJob( item, mapper.collectionForUid( uid ), sequence );
+  }
+
+  foreach ( const Item &item, modifiedItems ) {
+    if ( item.hasPayload<IncidencePtr>() ) {
+      const IncidencePtr incidence = item.payload<IncidencePtr>();
+      kDebug(5800) << "ModifyJob for incidence" << incidence->uid()
+                   << incidence->summary();
+    } else {
+      kWarning(5800) << "Modified item id=" << item.id() << "not an incidence";
+      continue;
+    }
+
+    ItemModifyJob *job = new ItemModifyJob( item, sequence );
+    // HACK we need to listen the result and update the revision number accordingly
+    // not as easy as it sounds though, since we would also need to revert if the
+    // transaction sequence fails
+    job->disableRevisionCheck();
+  }
+
+  foreach ( const Item &item, deletedItems ) {
+    if ( item.hasPayload<IncidencePtr>() ) {
+      const IncidencePtr incidence = item.payload<IncidencePtr>();
+      kDebug(5800) << "DeleteJob for incidence" << incidence->uid()
+                   << incidence->summary();
+    } else {
+      kWarning(5800) << "Deleted item id=" << item.id() << "not an incidence";
+      continue;
+    }
+
+    (void) new ItemDeleteJob( item, sequence );
+  }
+
+  return sequence;
+}
+
+void ResourceAkonadi::Private::createItemListsForSave( Item::List &added, Item::List &modified, Item::List &deleted )
+{
+  kDebug(5800) << mChanges.count() << "changes";
+
   ChangeMap::const_iterator changeIt    = mChanges.constBegin();
   ChangeMap::const_iterator changeEndIt = mChanges.constEnd();
   for ( ; changeIt != changeEndIt; ++changeIt ) {
-    const QString uid = changeIt.key();
+    processChange( changeIt, added, modified, deleted );
+  }
+}
 
-    kDebug() << mIdMapping;
-    kDebug() << uid;
-    IdHash::const_iterator idIt = mIdMapping.constFind( uid );
+void ResourceAkonadi::Private::processChange( ChangeMap::const_iterator changeIt, Item::List &added, Item::List &modified, Item::List &deleted )
+{
+  const QString uid = changeIt.key();
 
-    ItemMap::const_iterator itemIt;
+  kDebug() << mIdMapping;
+  kDebug() << uid;
+  IdHash::const_iterator idIt = mIdMapping.constFind( uid );
 
-    Item item;
-    SubResource *subResource = 0;
-    Incidence *incidence = 0;
+  ItemMap::const_iterator itemIt;
 
-    switch ( changeIt.value() ) {
-      case Added:
-        subResource = mSubResources.value( mUidToResourceMap.value( uid ), 0 );
-        Q_ASSERT( subResource != 0 );
+  Item item;
+  SubResource *subResource = 0;
+  Incidence *incidence = 0;
 
-        incidence = mCalendar.incidence( uid );
-        Q_ASSERT( incidence != 0 );
+  switch ( changeIt.value() ) {
+    case Added:
+      subResource = mSubResources.value( mUidToResourceMap.value( uid ), 0 );
+      Q_ASSERT( subResource != 0 );
 
-        item.setMimeType( mMimeVisitor->mimeType( incidence ) );
-        item.setPayload<IncidencePtr>( IncidencePtr( incidence->clone() ) );
+      incidence = mCalendar.incidence( uid );
+      Q_ASSERT( incidence != 0 );
 
-        (void) new ItemCreateJob( item, subResource->mCollection, sequence );
-        kDebug(5800) << "CreateJob for incidence" << incidence->uid()
-                     << incidence->summary();
-        break;
+      item.setMimeType( mMimeVisitor->mimeType( incidence ) );
+      item.setPayload<IncidencePtr>( IncidencePtr( incidence->clone() ) );
 
-      case Changed:
-      {
-        Q_ASSERT( idIt != mIdMapping.constEnd() );
-        itemIt = mItems.constFind( idIt.value() );
-        Q_ASSERT( itemIt != mItems.constEnd() );
+      added << item;
+      break;
 
-        incidence = mCalendar.incidence( uid );
-        Q_ASSERT( incidence != 0 );
+    case Changed:
+    {
+      Q_ASSERT( idIt != mIdMapping.constEnd() );
+      itemIt = mItems.constFind( idIt.value() );
+      Q_ASSERT( itemIt != mItems.constEnd() );
 
-        item = itemIt.value();
-        item.setPayload<IncidencePtr>( IncidencePtr( incidence->clone() ) );
+      incidence = mCalendar.incidence( uid );
+      Q_ASSERT( incidence != 0 );
 
-        ItemModifyJob *job = new ItemModifyJob( item, sequence );
-        // HACK we need to listen the result and update the revision number accordingly
-        // not as easy as it sounds though, since we would also need to revert if the
-        // transaction sequence fails
-        job->disableRevisionCheck();
-        kDebug(5800) << "ModifyJob for incidence" << incidence->uid()
-                     << incidence->summary();
-        break;
-      }
+      item = itemIt.value();
+      item.setPayload<IncidencePtr>( IncidencePtr( incidence->clone() ) );
 
-      case Removed:
-        Q_ASSERT( idIt != mIdMapping.constEnd() );
-        itemIt = mItems.constFind( idIt.value() );
-        Q_ASSERT( itemIt != mItems.constEnd() );
+      modified << item;
+      break;
+    }
 
-        item = itemIt.value();
+    case Removed:
+      Q_ASSERT( idIt != mIdMapping.constEnd() );
+      itemIt = mItems.constFind( idIt.value() );
+      Q_ASSERT( itemIt != mItems.constEnd() );
 
-        (void) new ItemDeleteJob( item, sequence );
-        kDebug(5800) << "DeleteJob for incidence" << uid
-                     << ( item.hasPayload<IncidencePtr>() ?
-                          item.payload<IncidencePtr>()->summary() : QString() );
-        break;
-    }
+      item = itemIt.value();
+      deleted << item;
+      break;
   }
-
-  return sequence;
 }
 
 void ResourceAkonadi::Private::calendarIncidenceAdded( Incidence *incidence )
@@ -1449,8 +1604,6 @@
     mUidToResourceMap.remove( incidence->uid() );
 
     mChanges[ incidence->uid() ] = Removed;
-
-    mAutoSaveOnDeleteTimer.start( 5000 ); // FIXME: configurable if needed at all
   } else
     mChanges.remove( incidence->uid() );
 }
@@ -1459,18 +1612,18 @@
 {
   changed = false;
 
-  ItemFetchJob *job = new ItemFetchJob( subResource->mCollection );
-  job->fetchScope().fetchFullPayload();
-
-  if ( !job->exec() ) {
-    mParent->loadError( job->errorString() );
+  mThreadJobContext.clear();
+  QFuture<bool> threadResult =
+    QtConcurrent::run( &mThreadJobContext, &ThreadJobContext::fetchItems, subResource->mCollection );
+  if ( !threadResult.result() ) {
+    mParent->loadError( mThreadJobContext.mJobError );
     return false;
   }
 
+  Item::List items = mThreadJobContext.mItems;
+
   const QString collectionUrl = subResource->mCollection.url().url();
 
-  Item::List items = job->items();
-
   kDebug(5800) << "Reload for sub resource " << collectionUrl
                << "produced" << items.count() << "items";
 
@@ -1488,7 +1641,15 @@
 
       Incidence *incidence = mCalendar.incidence( incidencePtr->uid() );
       if ( incidence != 0 ) {
-        *incidence = *(incidencePtr.get());
+        if ( !mIncidenceAssigner.assign( incidence, incidencePtr.get() ) ) {
+          kWarning(5800) << "Incidence uid=" << incidence->uid()
+                         << ", " << incidence->summary()
+                         << "changed type. Replacing it.";
+
+          mCalendar.deleteIncidence( incidence );
+          delete incidence;
+          mCalendar.addIncidence( incidencePtr.get()->clone() );
+        }
       } else {
         mCalendar.addIncidence( incidencePtr->clone() );
       }
Index: kresources/akonadi/kcal/resourceakonadi.h
===================================================================
--- kresources/akonadi/kcal/resourceakonadi.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/akonadi/kcal/resourceakonadi.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -172,8 +172,6 @@
     Q_PRIVATE_SLOT( d, void collectionRowsInserted( const QModelIndex&, int, int ) )
     Q_PRIVATE_SLOT( d, void collectionRowsRemoved( const QModelIndex&, int, int ) )
     Q_PRIVATE_SLOT( d, void collectionDataChanged( const QModelIndex&, const QModelIndex& ) )
-
-    Q_PRIVATE_SLOT( d, void delayedAutoSaveOnDelete() )
     //@endcond
 };
 
Index: kresources/akonadi/kcal/akonadi.desktop
===================================================================
--- kresources/akonadi/kcal/akonadi.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/akonadi/kcal/akonadi.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -24,6 +24,7 @@
 Comment[pl]=Zapewnia dostƒôp do kalendarzy przechowywanych w katalogach kalendarzy Akonadi
 Comment[pt]=Oferece o acesso aos calend√°rios guardados nas pastas de calend√°rios do Akonadi
 Comment[pt_BR]=Fornece acesso aos calend√°rios armazenados nas pastas de calend√°rios do Akonadi
+Comment[sl]=Omogoƒça dostop do koledarjev, shranjenih v Akonadijevih mapah s koledarji
 Comment[sv]=Ger tillg√•ng till kalendrar lagrade i Akonadi-kalenderkataloger
 Comment[tr]=Akonadi takvim dizinlerindeki takvimlere eri≈üim saƒülar
 Comment[uk]=–ù–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—ñ–≤, —è–∫—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É —Ç–µ–∫–∞—Ö –∫–∞–ª–µ–Ω–¥–∞—Ä—ñ–≤ Akonadi
Index: kresources/groupware/kabc_groupware.desktop
===================================================================
--- kresources/groupware/kabc_groupware.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kresources/groupware/kabc_groupware.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -67,6 +67,7 @@
 Comment[pl]=Zapewnia dostƒôp do wizyt√≥wek przechowywanych na serwerach pracy grupowej.
 Comment[pt]=Oferece o acesso aos contactos guardados num servidor de Groupware.
 Comment[pt_BR]=Fornece acesso aos contatos armazenados em um servidor de Groupware.
+Comment[sl]=Omogoƒça dostop do stikov, shranjenih na stre≈æniku Groupware.
 Comment[sv]=Ger tillg√•ng till kontakter lagrade p√• en grupprogramserver.
 Comment[tr]=Groupware sunucusu √ºzerindeki ki≈üilere eri≈üim saƒülar.
 Comment[uk]=–ù–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤, —è–∫—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ Groupware.
Index: kmail/editorwatcher.h
===================================================================
--- kmail/editorwatcher.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/editorwatcher.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -39,7 +39,17 @@
 {
   Q_OBJECT
   public:
-    EditorWatcher( const KUrl &url, const QString &mimeType, bool openWith, QObject *parent = 0 );
+
+    /**
+     * Constructs an EditorWatcher.
+     * @param parent the parent object of this EditorWatcher, which will take care of deleting
+     *               this EditorWatcher if the parent is deleted.
+     * @param parentWidget the parent widget of this EditorWatcher, which will be used as the parent
+     *                     widget for message dialogs.
+     */
+    EditorWatcher( const KUrl &url, const QString &mimeType, bool openWith,
+                   QObject *parent, QWidget *parentWidget );
+
     bool start();
     bool fileChanged() const { return mFileModified; }
   signals:
@@ -55,6 +65,7 @@
     QString mMimeType;
     bool mOpenWith;
     KProcess *mEditor;
+    QWidget *mParentWidget;
 
     int mInotifyFd;
     int mInotifyWatch;
Index: kmail/messagelistview/core/sortorder.cpp
===================================================================
--- kmail/messagelistview/core/sortorder.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/messagelistview/core/sortorder.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -140,7 +140,7 @@
   OptionList groupSortings = enumerateGroupSortingOptions( aggregation->grouping() );
   OptionList groupSortDirections = enumerateGroupSortDirectionOptions( aggregation->grouping(),
                                                                        mGroupSorting );
-  SortOrder defaultSortOrder = defaultForAggregation( aggregation );
+  SortOrder defaultSortOrder = defaultForAggregation( aggregation, SortOrder() );
   bool messageSortingOk = optionListHasOption( messageSortings,
                                                mMessageSorting, defaultSortOrder.messageSorting() );
   bool messageSortDirectionOk = optionListHasOption( messageSortDirections, mMessageSortDirection,
@@ -155,37 +155,65 @@
          groupSortingOk && groupSortDirectionOk;
 }
 
-SortOrder SortOrder::defaultForAggregation( const Aggregation *aggregation )
+SortOrder SortOrder::defaultForAggregation( const Aggregation *aggregation,
+                                            const SortOrder &oldSortOrder )
 {
+  SortOrder newSortOrder;
+
+  //
+  // First check if we can adopt the message sorting and the message sort direction from
+  // the old sort order. This is mostly true, except, for example, when the old message sorting
+  // was "by most recent in subtree", and the aggregation doesn't use threading.
+  //
+  OptionList messageSortings = enumerateMessageSortingOptions( aggregation->threading() );
+  bool messageSortingOk = optionListHasOption( messageSortings,
+                                               oldSortOrder.messageSorting(),
+                                               SortOrder().messageSorting() );
+  bool messageSortDirectionOk = false;
+  if ( messageSortingOk ) {
+    OptionList messageSortDirections = enumerateMessageSortDirectionOptions(
+                                              oldSortOrder.messageSorting() );
+    messageSortDirectionOk = optionListHasOption( messageSortDirections, oldSortOrder.messageSortDirection(),
+                                                  SortOrder().messageSortDirection() );
+  }
+
+  //
+  // Ok, if we can partly adopt the old sort order, set the values now.
+  //
+  if ( messageSortingOk )
+    newSortOrder.setMessageSorting( oldSortOrder.messageSorting() );
+  else
+    newSortOrder.setMessageSorting( SortMessagesByDateTime );
+  if ( messageSortDirectionOk )
+    newSortOrder.setMessageSortDirection( oldSortOrder.messageSortDirection() );
+  else
+    newSortOrder.setMessageSortDirection( Descending );
+
+  //
+  // Now set the group sorting and group sort direction, depending on the aggregation.
+  //
   Aggregation::Grouping grouping = aggregation->grouping();
   if ( grouping == Aggregation::GroupByDate ||
        grouping == Aggregation::GroupByDateRange ) {
-    SortOrder order;
-    order.setGroupSortDirection( Descending );
-    order.setGroupSorting( SortGroupsByDateTime );
-    order.setMessageSortDirection( Descending );
-    order.setMessageSorting( SortMessagesByDateTime );
-    return order;
+    newSortOrder.setGroupSortDirection( Descending );
+    newSortOrder.setGroupSorting( SortGroupsByDateTime );
+
   }
   else if ( grouping == Aggregation::GroupByReceiver || grouping == Aggregation::GroupBySender ||
             grouping == Aggregation::GroupBySenderOrReceiver ) {
-    SortOrder order;
-    order.setGroupSortDirection( Descending );
-    order.setMessageSortDirection( Descending );
-    order.setMessageSorting( SortMessagesByDateTime );
+    newSortOrder.setGroupSortDirection( Descending );
     switch ( grouping ) {
       case Aggregation::GroupByReceiver:
-        order.setGroupSorting( SortGroupsByReceiver ); break;
+        newSortOrder.setGroupSorting( SortGroupsByReceiver ); break;
       case Aggregation::GroupBySender:
-        order.setGroupSorting( SortGroupsBySender ); break;
+        newSortOrder.setGroupSorting( SortGroupsBySender ); break;
       case Aggregation::GroupBySenderOrReceiver:
-        order.setGroupSorting( SortGroupsBySenderOrReceiver ); break;
+        newSortOrder.setGroupSorting( SortGroupsBySenderOrReceiver ); break;
       default: break;
     }
-    return order;
   }
-  else
-    return SortOrder();
+
+  return newSortOrder;
 }
 
 bool SortOrder::readConfigHelper( KConfigGroup &conf, const QString &id )
Index: kmail/messagelistview/core/widgetbase.cpp
===================================================================
--- kmail/messagelistview/core/widgetbase.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/messagelistview/core/widgetbase.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -254,7 +254,7 @@
 {
   if ( storageModel && mAggregation && !mSortOrder.validForAggregation( mAggregation ) ) {
     kDebug() << "Could not restore sort order for folder" << storageModel->id();
-    mSortOrder = SortOrder::defaultForAggregation( mAggregation );
+    mSortOrder = SortOrder::defaultForAggregation( mAggregation, mSortOrder );
 
     // Change the global sort order if the sort order didn't fit the global aggregation.
     // Otherwise, if it is a per-folder aggregation, make the sort order per-folder too.
Index: kmail/messagelistview/core/sortorder.h
===================================================================
--- kmail/messagelistview/core/sortorder.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/messagelistview/core/sortorder.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -187,8 +187,12 @@
 
     /**
      * Returns the default sort order for the given aggregation.
+     * @param oldSortOrder the previously used sort order. If possible, the new sort order
+     *                     will be based on that old sort order, i.e. the message sorting and
+     *                     message sort direction is adopted.
      */
-    static SortOrder defaultForAggregation( const Aggregation *aggregation );
+    static SortOrder defaultForAggregation( const Aggregation *aggregation,
+                                            const SortOrder &oldSortOrder );
 
     /**
     * Returns true if the ms parameter specifies a valid MessageSorting option.
Index: kmail/application_octetstream.desktop
===================================================================
--- kmail/application_octetstream.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/application_octetstream.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -12,7 +12,7 @@
 Name[fy]=Applikaasje octetstream
 Name[gl]=Aplicaci√≥n Octetstream
 Name[hu]=Alkalmaz√°s-adatfolyam
-Name[ja]=„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ „Ç™„ÇØ„ÉÜ„ÉÉ„Éà „Çπ„Éà„É™„Éº„É†
+Name[ja]=„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥/„Ç™„ÇØ„ÉÜ„ÉÉ„Éà„Çπ„Éà„É™„Éº„É†
 Name[ka]=·É†·Éï·Éê·Éì·Éò·Éú·Éî·Éë·Éò·Éê·Éú·Éò ·Éû·É†·Éù·Éí·É†·Éê·Éõ·Éê
 Name[kk]=“ö–æ–ª–¥–∞–Ω–±–∞–Ω—ã“£ –±–∏–Ω–∞—Ä–ª—ã –∞“ì—ã–º—ã
 Name[km]=Octetstream ·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏
@@ -52,7 +52,7 @@
 Comment[hu]=Form√°z√≥modul application/octet-stream t√≠pus√∫ adatfolyamokhoz
 Comment[is]=Sni√∞m√°tst√≥l fyrir application/octet-stream
 Comment[it]=Un'estensione per la formattazione di application/octet-stream nei messaggi di posta
-Comment[ja]=application/octet-stream „ÅÆ Bodypart „Éï„Ç©„Éº„Éû„ÉÉ„Çø„Éó„É©„Ç∞„Ç§„É≥
+Comment[ja]=application/octet-stream Áî®„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏Êú¨‰Ωì„Éï„Ç©„Éº„Éû„ÉÉ„Çø
 Comment[ka]=·Éú·Éê·É¨·Éò·Éö·Éò·Éë·É†·Éò·Éï·Éò ·Éì·Éê·Éõ·É§·Éù·É†·Éõ·Éê·É¢·Éî·Éë·Éî·Éö·Éò ·Éõ·Éù·Éì·É£·Éö·Éò ·Éû·É†·Éù·Éí·É†·Éê·Éõ·Éò·É°·Éó·Éï·Éò·É°/octet-stream
 Comment[kk]=Application/octet-–∞“ì—ã–º—ã “Ø—à—ñ–Ω –ø—ñ—à—ñ–º–¥–µ–≥—ñ—à –º–æ–¥—É–ª—ñ
 Comment[km]=·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûá·üÜ·ûì·ûΩ·ûô‚Äã·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûí·üí·ûú·ûæ‚Äã·ûë·üí·ûö·ûÑ·üã·ûë·üí·ûö·û∂·ûô‚Äã·ûï·üí·ûì·üÇ·ûÄ‚Äã·ûè·ûΩ ·ûü·ûò·üí·ûö·û∂·ûî·üã‚Äã·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏/octet-stream
Index: kmail/folderselectiontreewidget.cpp
===================================================================
--- kmail/folderselectiontreewidget.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/folderselectiontreewidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -27,6 +27,7 @@
 #include "kmfoldermgr.h"
 #include "util.h"
 
+#include <kaction.h>
 #include <kmenu.h>
 #include <kiconloader.h>
 #include <kconfiggroup.h>
@@ -80,6 +81,13 @@
   setContextMenuPolicy( Qt::CustomContextMenu );
   connect( this, SIGNAL( customContextMenuRequested( const QPoint & ) ),
            this, SLOT( slotContextMenuRequested( const QPoint & ) ) );
+  connect( this, SIGNAL( itemSelectionChanged() ),
+           this, SLOT( slotItemSelectionChanged() ) );
+
+  mCreateFolderAction = new KAction( KIcon( "folder-new" ),
+                                     i18n("&New Subfolder..."), this );
+  connect( mCreateFolderAction, SIGNAL( triggered() ),
+           this, SLOT( addChildFolder() ) );
 }
 
 void FolderSelectionTreeWidget::recursiveReload( FolderViewItem *fti, FolderSelectionTreeWidgetItem *parent )
@@ -101,6 +109,7 @@
                                                : new FolderSelectionTreeWidgetItem( this, fti );
 
   item->setText( mNameColumnIndex, fti->labelText() );
+  item->setIcon( 0, fti->icon( 0 ) );
   // Build the path (ParentItemPath/CurrentItemName)
   QString path;
   if( parent )
@@ -108,12 +117,9 @@
   path += fti->labelText();
 
   item->setText( mPathColumnIndex, path );
-  QPixmap pix = fti->normalIcon();
-  item->setIcon( mNameColumnIndex, pix.isNull() ? SmallIcon( "folder" ) : QIcon( pix ) );
 
-  // Make items without folders and readonly items unselectable
-  // if we're told so
-  if ( mLastMustBeReadWrite && ( !fti->folder() || fti->folder()->isReadOnly() ) ) {
+  // Make readonly items unselectable, if we're told so
+  if ( mLastMustBeReadWrite && ( fti->folder() && fti->folder()->isReadOnly() ) ) {
     item->setFlags( item->flags() & ~Qt::ItemIsSelectable );
   } else {
     item->setFolder( fti->folder() );
@@ -204,16 +210,13 @@
 
 void FolderSelectionTreeWidget::addChildFolder()
 {
-  const KMFolder *fld = folder();
-  if ( fld ) {
-    reconnectSignalSlotPair( kmkernel->folderMgr(), SIGNAL( folderAdded(KMFolder*) ),
-             this, SLOT( slotFolderAdded(KMFolder*) ) );
-    reconnectSignalSlotPair( kmkernel->imapFolderMgr(), SIGNAL( folderAdded(KMFolder*) ),
-             this, SLOT( slotFolderAdded(KMFolder*) ) );
-    reconnectSignalSlotPair( kmkernel->dimapFolderMgr(), SIGNAL( folderAdded(KMFolder*) ),
-             this, SLOT( slotFolderAdded(KMFolder*) ) );
-    mFolderTree->addChildFolder( (KMFolder *) fld, parentWidget() );
-  }
+  reconnectSignalSlotPair( kmkernel->folderMgr(), SIGNAL( folderAdded(KMFolder*) ),
+           this, SLOT( slotFolderAdded(KMFolder*) ) );
+  reconnectSignalSlotPair( kmkernel->imapFolderMgr(), SIGNAL( folderAdded(KMFolder*) ),
+           this, SLOT( slotFolderAdded(KMFolder*) ) );
+  reconnectSignalSlotPair( kmkernel->dimapFolderMgr(), SIGNAL( folderAdded(KMFolder*) ),
+           this, SLOT( slotFolderAdded(KMFolder*) ) );
+  mFolderTree->addChildFolder( folder(), parentWidget() );
 }
 
 void FolderSelectionTreeWidget::slotContextMenuRequested( const QPoint &p )
@@ -225,16 +228,10 @@
   setCurrentItem( lvi );
   lvi->setSelected( true );
 
-  const KMFolder * folder = static_cast<FolderSelectionTreeWidgetItem *>( lvi )->folder();
-  if ( !folder || folder->noContent() || folder->noChildren() )
-    return;
+  KMenu *folderMenu = new KMenu;
+  folderMenu->addTitle( static_cast<FolderSelectionTreeWidgetItem *>( lvi )->labelText() );
+  folderMenu->addAction( mCreateFolderAction );
 
-  KMenu *folderMenu = new KMenu;
-  folderMenu->addTitle( folder->label() );
-  folderMenu->addSeparator();
-  folderMenu->addAction( KIcon("folder-new"),
-                         i18n("&New Subfolder..."), this,
-                         SLOT(addChildFolder()) );
   kmkernel->setContextMenuShown( true );
   folderMenu->exec ( viewport()->mapToGlobal( p ), 0);
   kmkernel->setContextMenuShown( false );
@@ -254,6 +251,31 @@
              this, SLOT( slotFolderAdded(KMFolder*) ) );
 }
 
+void FolderSelectionTreeWidget::slotItemSelectionChanged()
+{
+  bool allowOk = true;
+  bool allowCreate = true;
+
+  const QList<QTreeWidgetItem *> selItems = selectedItems();
+  if ( selItems.isEmpty() )				// no selection
+    allowOk = allowCreate = false;
+  else
+  {
+    const KMFolder *fld = static_cast<FolderSelectionTreeWidgetItem *>( selectedItems().first() )->folder();
+    if ( !fld )						// "Local Folders" root
+      allowOk = !mLastMustBeReadWrite;
+    else						// any other folder
+    {
+      allowCreate = !fld->noChildren() && !fld->isReadOnly();
+      if ( mLastMustBeReadWrite )
+          allowOk = !fld->noContent() && !fld->isReadOnly();
+    }
+  }
+
+  mCreateFolderAction->setEnabled( allowCreate );
+  emit actionsAllowed( allowOk, allowCreate );
+}
+
 void FolderSelectionTreeWidget::applyFilter( const QString& filter )
 {
   // We would like to set items that do not match the filter to disabled,
Index: kmail/urlhandlermanager.cpp
===================================================================
--- kmail/urlhandlermanager.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/urlhandlermanager.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -468,7 +468,9 @@
     if ( !url.hasRef() )
       return false;
     QString displayName, libName, keyId;
-    if ( !foundSMIMEData( url.path() + '#' + url.ref(), displayName, libName, keyId ) )
+    if ( !foundSMIMEData( url.path() + '#' +
+                          QUrl::fromPercentEncoding( url.ref().toLatin1() ),
+                          displayName, libName, keyId ) )
       return false;
     QStringList lst;
     lst << "-query" << keyId;
@@ -481,7 +483,9 @@
 
   QString SMimeURLHandler::statusBarMessage( const KUrl & url, KMReaderWin * ) const {
     QString displayName, libName, keyId;
-    if ( !foundSMIMEData( url.path() + '#' + url.ref(), displayName, libName, keyId ) )
+    if ( !foundSMIMEData( url.path() + '#' +
+                          QUrl::fromPercentEncoding( url.ref().toLatin1() ),
+                          displayName, libName, keyId ) )
       return QString();
     return i18n("Show certificate 0x%1", keyId );
   }
Index: kmail/Messages.sh
===================================================================
--- kmail/Messages.sh	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/Messages.sh	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1,4 +1,6 @@
 #! /bin/sh
 $PREPARETIPS > tips.cpp
+$EXTRACTRC `find . -name '*.ui' -or -name '*.rc' -or -name '*.kcfg'` >> rc.cpp || exit 11
 $XGETTEXT -ktranslate `find -name '*.cpp' -o -name '*.h'` -o $podir/kmail.pot
 rm -f tips.cpp
+rm -f rc.cpp
Index: kmail/folderselectiondialog.cpp
===================================================================
--- kmail/folderselectiondialog.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/folderselectiondialog.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -71,8 +71,8 @@
   mTreeView->setFocus();
   connect( mTreeView, SIGNAL( itemDoubleClicked( QTreeWidgetItem*, int ) ),
            this, SLOT( slotSelect() ) );
-  connect( mTreeView, SIGNAL( itemSelectionChanged() ),
-           this, SLOT( slotUpdateBtnStatus() ) );
+  connect( mTreeView, SIGNAL( actionsAllowed( bool, bool ) ),
+           this, SLOT( slotUpdateBtnStatus( bool, bool ) ) );
   connect(this, SIGNAL( user1Clicked() ), mTreeView, SLOT( addChildFolder() ) );
   readConfig();
   mTreeView->resizeColumnToContents(0);
@@ -106,10 +106,10 @@
   accept();
 }
 
-void FolderSelectionDialog::slotUpdateBtnStatus()
+void FolderSelectionDialog::slotUpdateBtnStatus( bool allowOk, bool allowCreate )
 {
-  enableButton( User1, folder() &&
-                ( !folder()->noContent() && !folder()->noChildren() ) );
+  enableButton( Ok, allowOk );
+  enableButton( User1, allowCreate );
 }
 
 void FolderSelectionDialog::setFlags( bool mustBeReadWrite, bool showOutbox,
Index: kmail/kmreadermainwin.cpp
===================================================================
--- kmail/kmreadermainwin.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/kmreadermainwin.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -297,7 +297,7 @@
   //----- Message Menu
   mForwardActionMenu  = new KActionMenu(KIcon("mail-forward"), i18nc("Message->","&Forward"), this);
   actionCollection()->addAction("message_forward", mForwardActionMenu );
-  connect( mForwardActionMenu, SIGNAL( activated() ), this,
+  connect( mForwardActionMenu, SIGNAL(triggered(bool)), this,
            SLOT( slotForwardMsg() ) );
 
   mForwardAttachedAction  = new KAction(KIcon("mail-forward"), i18nc("Message->Forward->","As &Attachment..."), this);
Index: kmail/editorwatcher.cpp
===================================================================
--- kmail/editorwatcher.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/editorwatcher.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -42,12 +42,14 @@
 
 using namespace KMail;
 
-EditorWatcher::EditorWatcher(const KUrl & url, const QString &mimeType, bool openWith, QObject * parent) :
+EditorWatcher::EditorWatcher( const KUrl & url, const QString &mimeType, bool openWith,
+                              QObject * parent, QWidget *parentWidget ) :
     QObject( parent ),
     mUrl( url ),
     mMimeType( mimeType ),
     mOpenWith( openWith ),
     mEditor( 0 ),
+    mParentWidget( parentWidget ),
     mHaveInotify( false ),
     mFileOpen( false ),
     mEditorRunning( false ),
@@ -151,8 +153,10 @@
   // nobody can edit that fast, we seem to be unable to detect
   // when the editor will be closed
   if ( mEditTime.elapsed() <= 3000 ) {
-    KMessageBox::error( 0, i18n("KMail is unable to detect when the chosen editor is closed. "
-         "To avoid data loss, editing the attachment will be aborted."), i18n("Unable to edit attachment") );
+    KMessageBox::error( mParentWidget,
+                        i18n( "KMail is unable to detect when the choosen editor is closed. "
+                              "To avoid data loss, editing the attachment will be aborted." ),
+                        i18n( "Unable to edit attachment" ) );
   }
 
   emit editDone( this );
Index: kmail/kmail_config_composer.desktop
===================================================================
--- kmail/kmail_config_composer.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/kmail_config_composer.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -90,6 +90,7 @@
 Comment[pt]=Configura√ß√£o do Compositor de Mensagens
 Comment[pt_BR]=Configura√ß√µes do compositor de mensagens
 Comment[ro]=ConfigurƒÉri compunere mesaj
+Comment[sl]=Nastavitve sestavljalnika sporoƒçil
 Comment[sv]=Inst√§llningar av brevf√∂nster
 Comment[tr]=ƒ∞leti Olu≈üturucu Ayarlarƒ±
 Comment[uk]=–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑–∞—Å–æ–±—É —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
Index: kmail/searchwindow.cpp
===================================================================
--- kmail/searchwindow.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/searchwindow.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -322,7 +322,7 @@
   connect(mReplyListAction, SIGNAL(triggered(bool) ), SLOT(slotReplyListToMsg()));
   mForwardActionMenu  = new KActionMenu(KIcon("mail-forward"), i18nc("Message->","&Forward"), this);
   actionCollection()->addAction("search_message_forward", mForwardActionMenu );
-  connect( mForwardActionMenu, SIGNAL(activated()), this,
+  connect( mForwardActionMenu, SIGNAL(triggered(bool)), this,
            SLOT(slotForwardMsg()) );
   mForwardAction  = new KAction(KIcon("mail-forward")
     , i18nc("@action:inmenu Forward message inline.", "&Inline..."), this);
Index: kmail/networkaccount.cpp
===================================================================
--- kmail/networkaccount.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/networkaccount.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -205,16 +205,16 @@
 
       //If the password should be written to the wallet, do that
       if ( !mStorePasswdInConfig ) {
-        Wallet *wallet = kmkernel->wallet();
 
         //If the password is dirty, try to store it in the wallet
         if ( mPasswdDirty ) {
+          Wallet *wallet = kmkernel->wallet();
           if ( wallet && wallet->writePassword( "account-" + QString::number(mId), passwd() ) == 0 )
             passwdStored = true;
         }
 
         //If the password isn't dirty, it is already stored in the wallet.
-        else if ( wallet )
+        else
           passwdStored = true;
 
         //If the password is stored in the wallet, it isn't dirty or stored in the config
Index: kmail/kmreaderwin.cpp
===================================================================
--- kmail/kmreaderwin.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/kmreaderwin.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -550,7 +550,7 @@
   ac->addAction("view_headers", headerMenu );
   headerMenu->setToolTip( i18n("Choose display style of message headers") );
 
-  connect( headerMenu, SIGNAL(activated()),
+  connect( headerMenu, SIGNAL(triggered(bool)),
            this, SLOT(slotCycleHeaderStyles()) );
 
   QActionGroup *group = new QActionGroup( this );
@@ -600,7 +600,7 @@
   KActionMenu *attachmentMenu  = new KActionMenu(i18nc("View->", "&Attachments"), this);
   ac->addAction("view_attachments", attachmentMenu );
   attachmentMenu->setToolTip( i18n("Choose display style of attachments") );
-  connect( attachmentMenu, SIGNAL(activated()),
+  connect( attachmentMenu, SIGNAL(triggered(bool)),
            this, SLOT(slotCycleAttachmentStrategy()) );
 
   group = new QActionGroup( this );
@@ -2146,7 +2146,9 @@
 //-----------------------------------------------------------------------------
 void KMReaderWin::slotCopySelectedText()
 {
-  QApplication::clipboard()->setText( mViewer->selectedText() );
+  QString selection = mViewer->selectedText();
+  selection.replace( QChar::Nbsp, ' ' );
+  QApplication::clipboard()->setText( selection );
 }
 
 
@@ -2823,7 +2825,10 @@
       typeBlacklisted = node->msgPart().subtypeStr() == "pgp-encrypted"
                      || node->msgPart().subtypeStr() == "pgp-signature"
                      || node->msgPart().subtypeStr() == "pkcs7-mime"
-                     || node->msgPart().subtypeStr() == "pkcs7-signature";
+                     || node->msgPart().subtypeStr() == "pkcs7-signature"
+                     || node->msgPart().subtypeStr() == "x-pkcs7-signature"
+                     || ( node->msgPart().subtypeStr() == "octet-stream" &&
+                          node->msgPart().fileName() == "msg.asc" );
     }
     typeBlacklisted = typeBlacklisted || node == mRootNode;
     if ( !label.isEmpty() && !icon.isEmpty() && !typeBlacklisted ) {
Index: kmail/messageactions.cpp
===================================================================
--- kmail/messageactions.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/messageactions.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -43,41 +43,41 @@
 {
   mReplyActionMenu = new KActionMenu( KIcon("mail-reply-sender"), i18nc("Message->","&Reply"), this );
   mActionCollection->addAction( "message_reply_menu", mReplyActionMenu );
-  connect( mReplyActionMenu, SIGNAL(activated()),
+  connect( mReplyActionMenu, SIGNAL(triggered(bool)),
            this, SLOT(slotReplyToMsg()) );
 
   mReplyAction = new KAction( KIcon("mail-reply-sender"), i18n("&Reply..."), this );
   mActionCollection->addAction( "reply", mReplyAction );
   mReplyAction->setShortcut(Qt::Key_R);
-  connect( mReplyAction, SIGNAL(activated()),
+  connect( mReplyAction, SIGNAL(triggered(bool)),
            this, SLOT(slotReplyToMsg()) );
   mReplyActionMenu->addAction( mReplyAction );
 
   mReplyAuthorAction = new KAction( KIcon("mail-reply-sender"), i18n("Reply to A&uthor..."), this );
   mActionCollection->addAction( "reply_author", mReplyAuthorAction );
   mReplyAuthorAction->setShortcut(Qt::SHIFT+Qt::Key_A);
-  connect( mReplyAuthorAction, SIGNAL(activated()),
+  connect( mReplyAuthorAction, SIGNAL(triggered(bool)),
            this, SLOT(slotReplyAuthorToMsg()) );
   mReplyActionMenu->addAction( mReplyAuthorAction );
 
   mReplyAllAction = new KAction( KIcon("mail-reply-all"), i18n("Reply to &All..."), this );
   mActionCollection->addAction( "reply_all", mReplyAllAction );
   mReplyAllAction->setShortcut( Qt::Key_A );
-  connect( mReplyAllAction, SIGNAL(activated()),
+  connect( mReplyAllAction, SIGNAL(triggered(bool)),
            this, SLOT(slotReplyAllToMsg()) );
   mReplyActionMenu->addAction( mReplyAllAction );
 
   mReplyListAction = new KAction( KIcon("mail-reply-list"), i18n("Reply to Mailing-&List..."), this );
   mActionCollection->addAction( "reply_list", mReplyListAction );
   mReplyListAction->setShortcut( Qt::Key_L );
-  connect( mReplyListAction, SIGNAL(activated()),
+  connect( mReplyListAction, SIGNAL(triggered(bool)),
            this, SLOT(slotReplyListToMsg()) );
   mReplyActionMenu->addAction( mReplyListAction );
 
   mNoQuoteReplyAction = new KAction( i18n("Reply Without &Quote..."), this );
   mActionCollection->addAction( "noquotereply", mNoQuoteReplyAction );
   mNoQuoteReplyAction->setShortcut( Qt::SHIFT+Qt::Key_R );
-  connect( mNoQuoteReplyAction, SIGNAL(activated()),
+  connect( mNoQuoteReplyAction, SIGNAL(triggered(bool)),
            this, SLOT(slotNoQuoteReplyToMsg()) );
 
 
@@ -86,7 +86,7 @@
   mCreateTodoAction->setToolTip( i18n( "Allows you to create a calendar to-do or reminder from this message" ) );
   mCreateTodoAction->setWhatsThis( i18n( "This option starts the KOrganizer to-do editor with initial values taken from the currently selected message. Then you can edit the to-do to your liking before saving it to your calendar." ) );
   mActionCollection->addAction( "create_todo", mCreateTodoAction );
-  connect( mCreateTodoAction, SIGNAL(activated()),
+  connect( mCreateTodoAction, SIGNAL(triggered(bool)),
            this, SLOT(slotCreateTodo()) );
 
 
@@ -97,21 +97,21 @@
 
   action = new KAction( KIcon("mail-mark-read"), i18n("Mark Message as &Read"), this );
   action->setToolTip( i18n("Mark selected messages as read") );
-  connect( action, SIGNAL(activated()),
+  connect( action, SIGNAL(triggered(bool)),
            this, SLOT(slotSetMsgStatusRead()) );
   mActionCollection->addAction( "status_read", action );
   mStatusMenu->addAction( action );
 
   action = new KAction( KIcon("mail-mark-unread-new"), i18n("Mark Message as &New"), this );
   action->setToolTip( i18n("Mark selected messages as new") );
-  connect( action, SIGNAL(activated()),
+  connect( action, SIGNAL(triggered(bool)),
            this, SLOT(slotSetMsgStatusNew()) );
   mActionCollection->addAction( "status_new", action );
   mStatusMenu->addAction( action );
 
   action = new KAction( KIcon("mail-mark-unread"), i18n("Mark Message as &Unread"), this );
   action->setToolTip( i18n("Mark selected messages as unread") );
-  connect( action, SIGNAL(activated()),
+  connect( action, SIGNAL(triggered(bool)),
            this, SLOT(slotSetMsgStatusUnread()) );
   mActionCollection->addAction( "status_unread", action );
   action->setShortcut( Qt::CTRL+Qt::Key_U );
@@ -121,7 +121,7 @@
 
   mToggleFlagAction = new KToggleAction( KIcon("mail-mark-important"),
                                          i18n("Mark Message as &Important"), this );
-  connect( mToggleFlagAction, SIGNAL(activated()),
+  connect( mToggleFlagAction, SIGNAL(triggered(bool)),
            this, SLOT(slotSetMsgStatusFlag()) );
   mToggleFlagAction->setCheckedState( KGuiItem(i18n("Remove &Important Message Mark")) );
   mActionCollection->addAction( "status_flag", mToggleFlagAction );
@@ -129,7 +129,7 @@
 
   mToggleToActAction = new KToggleAction( KIcon("mail-mark-task"),
                                           i18n("Mark Message as &Action Item"), this );
-  connect( mToggleToActAction, SIGNAL(activated()),
+  connect( mToggleToActAction, SIGNAL(triggered(bool)),
            this, SLOT(slotSetMsgStatusToAct()) );
   mToggleToActAction->setCheckedState( KGuiItem(i18n("Remove &Action Item Message Mark")) );
   mActionCollection->addAction( "status_toact", mToggleToActAction );
@@ -137,7 +137,7 @@
 
   mEditAction = new KAction( KIcon("accessories-text-editor"), i18n("&Edit Message"), this );
   mActionCollection->addAction( "edit", mEditAction );
-  connect( mEditAction, SIGNAL(activated()),
+  connect( mEditAction, SIGNAL(triggered(bool)),
            this, SLOT(editCurrentMessage()) );
   mEditAction->setShortcut( Qt::Key_T );
 
Index: kmail/folderselectiondialog.h
===================================================================
--- kmail/folderselectiondialog.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/folderselectiondialog.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -101,7 +101,7 @@
    * Called when selection in the tree view changes in order
    * to update the enabled/disabled state of the dialog buttons.
    */
-  void slotUpdateBtnStatus();
+  void slotUpdateBtnStatus( bool allowOk, bool allowCreate );
 
 protected:
   /**
Index: kmail/managesievescriptsdialog.cpp
===================================================================
--- kmail/managesievescriptsdialog.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/managesievescriptsdialog.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -111,6 +111,12 @@
   while ( accountIt != am->end() ) {
     KMAccount *a = *accountIt;
     ++accountIt;
+
+    // Don't show POP3 accounts in the sieve list
+    if ( a->type() != KAccount::Imap &&
+         a->type() != KAccount::DImap )
+      continue;
+
     last = new Q3CheckListItem( mListView, last, a->name(), Q3CheckListItem::Controller );
     last->setPixmap( 0, SmallIcon( "network-server" ) );
     if ( ImapAccountBase * iab = dynamic_cast<ImapAccountBase*>( a ) ) {
Index: kmail/redirectdialog.cpp
===================================================================
--- kmail/redirectdialog.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/redirectdialog.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -83,7 +83,7 @@
   mEditTo->setFocus();
 
   setButtonGuiItem( User1, KGuiItem( i18n("&Send Now"), "mail-send" ) );
-  setButtonGuiItem( User2, KGuiItem( i18n("Send &Later"), "queue" ) );
+  setButtonGuiItem( User2, KGuiItem( i18n("Send &Later"), "mail-queue" ) );
   connect(this,SIGNAL(user1Clicked()),this, SLOT(slotUser1()));
   connect(this,SIGNAL(user2Clicked()),this, SLOT(slotUser2()));
 }
Index: kmail/kmcommands.cpp
===================================================================
--- kmail/kmcommands.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/kmcommands.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -2285,25 +2285,16 @@
     msg->initHeader(mIdentity);
     msg->setCharset("utf-8");
     msg->setTo( KMMessage::decodeMailtoUrl( mUrl.path() ) );
-    QString query=mUrl.query();
-    while (!query.isEmpty()) {
-      QString queryPart;
-      int secondQuery = query.indexOf('?',1);
-      if (secondQuery != -1)
-        queryPart = query.left(secondQuery);
-      else
-        queryPart = query;
-      query = query.mid(queryPart.length());
 
-      if (queryPart.left(9) == "?subject=")
-        msg->setSubject( KUrl::fromPercentEncoding(queryPart.mid(9).toLatin1()) );
-      else if (queryPart.left(6) == "?body=")
-        // It is correct to convert to toLatin1() as URL should not contain
-        // anything except ascii.
-        msg->setBody( KUrl::fromPercentEncoding(queryPart.mid(6).toLatin1()).toLatin1() );
-      else if (queryPart.left(4) == "?cc=")
-        msg->setCc( KUrl::fromPercentEncoding(queryPart.mid(4).toLatin1()) );
-    }
+    QString body = mUrl.queryItem( "body" );
+    QString subject = mUrl.queryItem( "subject" );
+    QString cc = mUrl.queryItem( "cc" );
+    if ( !subject.isEmpty() )
+      msg->setSubject( subject );
+    if ( !body.isEmpty() )
+      msg->setBodyFromUnicode( body );
+    if ( !cc.isEmpty() )
+      msg->setCc( cc );
 
     KMail::Composer * win = KMail::makeComposer( msg, mIdentity );
     win->setCharset("", true);
@@ -2329,8 +2320,10 @@
           mUrl.pathOrUrl() ), QString(), KGuiItem(i18n("Execute")), KStandardGuiItem::cancel() ) != KMessageBox::Yes)
         return Canceled;
     }
-    if ( !KMail::Util::handleUrlOnMac( mUrl.pathOrUrl() ) )
-      (void) new KRun( mUrl, mMainWidget );
+    if ( !KMail::Util::handleUrlOnMac( mUrl.pathOrUrl() ) ) {
+      KRun *runner = new KRun( mUrl, mMainWidget ); // will delete itself
+      runner->setRunExecutables( false );
+    }
   }
   else
     return Failed;
@@ -3375,7 +3368,8 @@
   KMail::EditorWatcher *watcher =
       new KMail::EditorWatcher( KUrl( mTempFile.fileName() ),
                                 part.typeStr() + '/' + part.subtypeStr(),
-                                false, this );
+                                false, this, parentWidget() );
+
   connect( watcher, SIGNAL(editDone(KMail::EditorWatcher*)), SLOT(editDone(KMail::EditorWatcher*)) );
   if ( !watcher->start() )
     return Failed;
Index: kmail/kmmsgbase.cpp
===================================================================
--- kmail/kmmsgbase.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/kmmsgbase.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -655,7 +655,7 @@
 
   QByteArray result = cset + "''";
   for ( l = latin.data(); *l; ++l ) {
-    bool needsQuoting = ( *l & 0x80 );
+    bool needsQuoting = ( *l & 0x80 ) || ( *l == '%' );
     if( !needsQuoting ) {
       int len = especials.length();
       for ( int i = 0; i < len; i++ )
Index: kmail/kmmainwidget.cpp
===================================================================
--- kmail/kmmainwidget.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/kmmainwidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -366,7 +366,7 @@
   // For some reason, this is necessary here so that the copy action still
   // works after changing the folder layout.
   if ( mMsgView )
-    disconnect( mMsgView->copyAction(), SIGNAL( activated() ),
+    disconnect( mMsgView->copyAction(), SIGNAL(triggered(bool) ),
                 mMsgView, SLOT( slotCopySelectedText() ) );
 
   // If long folder list is enabled, the splitters are:
@@ -548,7 +548,7 @@
 
   // Make the copy action work, see disconnect comment above
   if ( mMsgView )
-    connect( mMsgView->copyAction(), SIGNAL( activated() ),
+    connect( mMsgView->copyAction(), SIGNAL( triggered(bool) ),
              mMsgView, SLOT( slotCopySelectedText() ) );
 }
 
@@ -848,7 +848,7 @@
 
 
     if ( mFavoritesCheckMailAction )
-      connect( mFavoritesCheckMailAction, SIGNAL( activated() ),
+      connect( mFavoritesCheckMailAction, SIGNAL(triggered(bool)),
                mFavoriteFolderView, SLOT( checkMail() ) );
 
      // FIXME: These signals should be emitted by the manager, probably
@@ -3585,14 +3585,14 @@
   actionCollection()->addAction( "favorite_check_mail", mFavoritesCheckMailAction );
   mFavoritesCheckMailAction->setShortcut( QKeySequence( Qt::CTRL+Qt::SHIFT+Qt::Key_L ) );
   if ( mFavoriteFolderView ) {
-    connect( mFavoritesCheckMailAction, SIGNAL(activated()),
+    connect( mFavoritesCheckMailAction, SIGNAL(triggered(bool)),
              mFavoriteFolderView, SLOT(checkMail()) );
   }
 
   KActionMenu *actActionMenu = new KActionMenu(KIcon("mail-receive"), i18n("Check Ma&il"), this);
   actionCollection()->addAction("check_mail_in", actActionMenu );
   actActionMenu->setDelayed(true); //needed for checking "all accounts"
-  connect(actActionMenu, SIGNAL(activated()), this, SLOT(slotCheckMail()));
+  connect(actActionMenu, SIGNAL(triggered(bool)), this, SLOT(slotCheckMail()));
   mActMenu = actActionMenu->menu();
   connect(mActMenu, SIGNAL(triggered(QAction*)),
           SLOT(slotCheckOneAccount(QAction*)));
@@ -3866,7 +3866,7 @@
 
   mForwardActionMenu = new KActionMenu(KIcon("mail-forward"), i18nc("Message->","&Forward"), this);
   actionCollection()->addAction("message_forward", mForwardActionMenu );
-  connect( mForwardActionMenu, SIGNAL(activated()), this,
+  connect( mForwardActionMenu, SIGNAL(triggered(bool)), this,
            SLOT(slotForwardMsg()) );
 
   mForwardAttachedAction = new KAction(KIcon("mail-forward"), i18nc("Message->Forward->","As &Attachment..."), this);
@@ -3895,7 +3895,7 @@
   //----- Create filter actions
   mFilterMenu = new KActionMenu(KIcon("view-filter"), i18n("&Create Filter"), this);
   actionCollection()->addAction("create_filter", mFilterMenu );
-  connect( mFilterMenu, SIGNAL(activated()), this,
+  connect( mFilterMenu, SIGNAL(triggered(bool)), this,
            SLOT(slotFilter()) );
   mSubjectFilterAction = new KAction(i18n("Filter on &Subject..."), this);
   actionCollection()->addAction("subject_filter", mSubjectFilterAction );
@@ -3966,7 +3966,7 @@
   actionCollection()->addAction("thread_watched", mWatchThreadAction );
   connect(mWatchThreadAction, SIGNAL(triggered(bool) ), SLOT(slotSetThreadStatusWatched()));
 
-  mIgnoreThreadAction = new KToggleAction(KIcon("process-stop"), i18n("&Ignore Thread"), this);
+  mIgnoreThreadAction = new KToggleAction(KIcon("mail-thread-ignored"), i18n("&Ignore Thread"), this);
   actionCollection()->addAction("thread_ignored", mIgnoreThreadAction );
   connect(mIgnoreThreadAction, SIGNAL(triggered(bool) ), SLOT(slotSetThreadStatusIgnored()));
 
Index: kmail/kmcomposewin.cpp
===================================================================
--- kmail/kmcomposewin.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/kmcomposewin.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1046,9 +1046,9 @@
   actActionNowMenu->setDelayed( true );
   actActionLaterMenu->setDelayed( true );
 
-  connect( actActionNowMenu, SIGNAL(activated()), this,
+  connect( actActionNowMenu, SIGNAL(triggered(bool)), this,
            SLOT(slotSendNow()) );
-  connect( actActionLaterMenu, SIGNAL(activated()), this,
+  connect( actActionLaterMenu, SIGNAL(triggered(bool)), this,
            SLOT(slotSendLater()) );
 
   mActNowMenu = actActionNowMenu->menu();
@@ -2992,12 +2992,13 @@
   atmTempFile->write( msgPart->bodyDecodedBinary() );
   atmTempFile->flush();
 
+  KMail::EditorWatcher *watcher =
+          new KMail::EditorWatcher( KUrl( atmTempFile->fileName() ),
+                                    contentTypeStr, openWith,
+                                    this, this );
+  connect( watcher, SIGNAL( editDone(KMail::EditorWatcher*) ),
+           SLOT( slotEditDone(KMail::EditorWatcher*) ) );
 
-  KMail::EditorWatcher *watcher =
-      new KMail::EditorWatcher( KUrl( atmTempFile->fileName() ),
-                                contentTypeStr, openWith, this );
-  connect( watcher, SIGNAL(editDone(KMail::EditorWatcher*)),
-           SLOT(slotEditDone(KMail::EditorWatcher*)) );
   if ( watcher->start() ) {
     mEditorMap.insert( watcher, msgPart );
     mEditorTempFiles.insert( watcher, atmTempFile );
Index: kmail/kmail_view.desktop
===================================================================
--- kmail/kmail_view.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/kmail_view.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -7,6 +7,7 @@
 Name[el]=Œ†œÅŒøŒ≤ŒøŒªŒÆ KMail
 Name[es]=Vista KMail
 Name[et]=KMaili vaade
+Name[ga]=Amharc KMail
 Name[gl]=Vista KMail 
 Name[it]=Vista KMail
 Name[ja]=KMail „Éì„É•„Éº
@@ -21,6 +22,7 @@
 Name[pl]=Widok KMail
 Name[pt]=Janela do KMail
 Name[pt_BR]=Exibi√ß√£o do KMail
+Name[sl]=KMailov prikaz
 Name[sv]=Kmail-vy
 Name[tr]=KMail g√∂r√ºn√ºm√º
 Name[uk]=–ü–µ—Ä–µ–≥–ª—è–¥ KMail
Index: kmail/folderselectiontreewidget.h
===================================================================
--- kmail/folderselectiontreewidget.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/folderselectiontreewidget.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -27,6 +27,7 @@
 #include <libkdepim/foldertreewidget.h>
 
 class KMFolder;
+class KAction;
 
 namespace KMail {
 
@@ -47,14 +48,6 @@
 class FolderSelectionTreeWidget : public KPIM::FolderTreeWidget
 {
   Q_OBJECT
-private:
-  int mNameColumnIndex;                 ///< The index of the folder name column
-  int mPathColumnIndex;                 ///< The index of the path column
-  KMail::MainFolderView* mFolderTree; ///< The MainFolderView to fetch the data from
-  QString mFilter;                      ///< The current folder path filter string
-  bool mLastMustBeReadWrite;            ///< Internal state for reload()
-  bool mLastShowOutbox;                 ///< Internal state for reload()
-  bool mLastShowImapFolders;            ///< Internal state for reload()
 
 public:
   /**
@@ -142,6 +135,11 @@
    */
   void slotFolderAdded( KMFolder *addedFolder );
 
+  /**
+   * Called when the selection changes.
+   * See documentation for QTreeWidget::itemSelectionChanged()
+   */
+  void slotItemSelectionChanged();
 
 protected:
   /**
@@ -155,6 +153,27 @@
    */
   void recursiveReload( FolderViewItem *fti, FolderSelectionTreeWidgetItem *parent );
 
+signals:
+  /**
+   * Emitted when the tree widget selection changes, to inform the parent dialogue
+   * of the actions that are allowed for the selected folder.
+   *
+   * @param allowOk if true, the OK action (accepting the selected folder) is allowed.
+   * @param allowCreate if true, the "New Subfolder" action is allowed.
+   */
+  void actionsAllowed( bool allowOk, bool allowCreate );
+
+private:
+  int mNameColumnIndex;                 ///< The index of the folder name column
+  int mPathColumnIndex;                 ///< The index of the path column
+  KMail::MainFolderView* mFolderTree;   ///< The MainFolderView to fetch the data from
+  QString mFilter;                      ///< The current folder path filter string
+
+  bool mLastMustBeReadWrite;            ///< Internal state for reload()
+  bool mLastShowOutbox;                 ///< Internal state for reload()
+  bool mLastShowImapFolders;            ///< Internal state for reload()
+
+  KAction *mCreateFolderAction;         ///< "New Subfolder" action for popup menu
 };
 
 } // namespace KMail
Index: kmail/kmmsgpartdlg.cpp
===================================================================
--- kmail/kmmsgpartdlg.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/kmmsgpartdlg.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -90,7 +90,7 @@
                                << QString::fromLatin1("application/octet-stream")
                                << QString::fromLatin1("application/x-gunzip")
                                << QString::fromLatin1("application/zip") );
-  connect( mMimeType, SIGNAL(textChanged(const QString&)),
+  connect( mMimeType, SIGNAL(editTextChanged(const QString&)),
            this, SLOT(slotMimeTypeChanged(const QString&)) );
   glay->addWidget( mMimeType, 0, 1 );
 
@@ -335,7 +335,7 @@
   if ( !mt.isNull() )
     mIcon->setPixmap( KIconLoader::global()->loadMimeTypeIcon( mt->iconName(),
                       KIconLoader::Desktop ) );
-  else 
+  else
     mIcon->setPixmap( DesktopIcon("unknown") );
 }
 
Index: kmail/objecttreeparser.cpp
===================================================================
--- kmail/objecttreeparser.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmail/objecttreeparser.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -440,17 +440,19 @@
     if ( doCheck && cryptProto ) {
       GpgME::VerificationResult result;
       if ( data ) { // detached
-        if ( Kleo::VerifyDetachedJob * const job = cryptProto->verifyDetachedJob() ) {
+        const std::auto_ptr<Kleo::VerifyDetachedJob> job( cryptProto->verifyDetachedJob() );
+        if ( job.get() ) {
           KleoJobExecutor executor;
-          result = executor.exec( job, signaturetext, cleartext );
+          result = executor.exec( job.get(), signaturetext, cleartext );
           messagePart.auditLog = executor.auditLogAsHtml();
         } else {
           cryptPlugError = CANT_VERIFY_SIGNATURES;
         }
       } else { // opaque
-        if ( Kleo::VerifyOpaqueJob * const job = cryptProto->verifyOpaqueJob() ) {
+        const std::auto_ptr<Kleo::VerifyOpaqueJob> job( cryptProto->verifyOpaqueJob() );
+        if ( job.get() ) {
           KleoJobExecutor executor;
-          result = executor.exec( job, signaturetext, cleartext );
+          result = executor.exec( job.get(), signaturetext, cleartext );
           messagePart.auditLog = executor.auditLogAsHtml();
         } else {
           cryptPlugError = CANT_VERIFY_SIGNATURES;
@@ -479,7 +481,7 @@
         messagePart.isGoodSignature = true;
 
       // get key for this signature
-      Kleo::KeyListJob *job = cryptProto->keyListJob();
+      const std::auto_ptr<Kleo::KeyListJob> job( cryptProto->keyListJob() );
       std::vector<GpgME::Key> keys;
       if ( signature.fingerprint() ) // if the fingerprint is empty, the keylisting would return all available keys
         GpgME::KeyListResult keyListRes = job->exec( QStringList( QString::fromLatin1( signature.fingerprint() ) ),
@@ -689,14 +691,14 @@
     if ( mReader )
       emit mReader->noDrag(); // in case pineentry pops up, don't let kmheaders start a drag afterwards
 
-    Kleo::DecryptVerifyJob* job = cryptProto->decryptVerifyJob();
-    if ( !job ) {
+    const std::auto_ptr<Kleo::DecryptVerifyJob> job( cryptProto->decryptVerifyJob() );
+    if ( !job.get() ) {
       cryptPlugError = CANT_DECRYPT;
       cryptProto = 0;
     } else {
       QByteArray plainText;
       KleoJobExecutor executor;
-      const std::pair<GpgME::DecryptionResult,GpgME::VerificationResult> res = executor.exec( job, ciphertext, plainText );
+      const std::pair<GpgME::DecryptionResult,GpgME::VerificationResult> res = executor.exec( job.get(), ciphertext, plainText );
       const GpgME::DecryptionResult decryptResult = res.first;
       const GpgME::VerificationResult verifyResult = res.second;
       signatureFound = verifyResult.signatures().size() > 0;
@@ -1157,15 +1159,22 @@
       return true;
     }
 
-    // FIXME(marc) check here that the protocol parameter matches the
-    // mimetype of "signature" (not required by the RFC, but practised
-    // by all implementaions of security multiparts
+    QString protocolContentType = node->contentTypeParameter( "protocol" ).toLower();
+    const QString signatureContentType =
+        QString( "%1/%2" ).arg( QString( signature->typeString() ).toLower() )
+                          .arg( QString( signature->subTypeString() ).toLower() );
+    if ( protocolContentType.isEmpty() ) {
+      kWarning() << "Message doesn't set the protocol for the multipart/signed content-type, "
+                    "using content-type of the signature:" << signatureContentType;
+      protocolContentType = signatureContentType;
+    }
 
-    const QString contentType = node->contentTypeParameter( "protocol" ).toLower();
     const Kleo::CryptoBackend::Protocol *protocol = 0;
-    if ( contentType == "application/pkcs7-signature" || contentType == "application/x-pkcs7-signature" )
+    if ( protocolContentType == "application/pkcs7-signature" ||
+         protocolContentType == "application/x-pkcs7-signature" )
       protocol = Kleo::CryptoBackendFactory::instance()->smime();
-    else if ( contentType == "application/pgp-signature" || contentType == "application/x-pgp-signature" )
+    else if ( protocolContentType == "application/pgp-signature" ||
+              protocolContentType == "application/x-pgp-signature" )
       protocol = Kleo::CryptoBackendFactory::instance()->openpgp();
 
     if ( !protocol ) {
@@ -1455,9 +1464,9 @@
 
       const QByteArray certData = node->msgPart().bodyDecodedBinary();
 
-      Kleo::ImportJob *import = smimeCrypto->importJob();
+      const std::auto_ptr<Kleo::ImportJob> import( smimeCrypto->importJob() );
       KleoJobExecutor executor;
-      const GpgME::ImportResult res = executor.exec( import, certData );
+      const GpgME::ImportResult res = executor.exec( import.get(), certData );
       if ( res.error() ) {
         htmlWriter()->queue( i18n( "Sorry, certificate could not be imported.<br />"
                                    "Reason: %1", QString::fromLocal8Bit( res.error().asString() ) ) );
@@ -1676,8 +1685,8 @@
   GlobalSettings::setChiasmusDecryptionKey( selectorDlg.key() );
   assert( !GlobalSettings::chiasmusDecryptionKey().isEmpty() );
 
-  Kleo::SpecialJob * job = chiasmus->specialJob( "x-decrypt", QMap<QString,QVariant>() );
-  if ( !job ) {
+  const std::auto_ptr<Kleo::SpecialJob> job( chiasmus->specialJob( "x-decrypt", QMap<QString,QVariant>() ) );
+  if ( !job.get() ) {
     errorText = i18n( "Chiasmus backend does not offer the "
                       "\"x-decrypt\" function. Please report this bug." );
     return false;
@@ -2199,11 +2208,12 @@
                       cryptProto->name(),
                       QString::fromLatin1( block.keyId ) );
         QString keyWithWithoutURL
-            = isSMIME
+            // FIXME: Kleopatra misses a -query option, so disable this for now.
+            = /*isSMIME
             ? QString("%1%2</a>")
                 .arg( startKeyHREF,
                       cannotCheckSignature ? i18n("[Details]") : ("0x" + block.keyId) )
-            : "0x" + QString::fromUtf8( block.keyId );
+            : */"0x" + QString::fromUtf8( block.keyId );
 
 
         // temporary hack: always show key infos!
Index: knode/knode_config_privacy.desktop
===================================================================
--- knode/knode_config_privacy.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ knode/knode_config_privacy.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -49,7 +49,7 @@
 Name[nn]=Signering/stadfesting
 Name[pl]=Podpisywanie/Weryfikacja podpis√≥w
 Name[pt]=Assinar/Verificar
-Name[pt_BR]=Assinando/verificando
+Name[pt_BR]=Assinatura/verifica√ß√£o
 Name[ro]=Semnare/verificare
 Name[ru]=–ü–æ–¥–ø–∏—Å—å –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞
 Name[sk]=Podpis/overenie
Index: knode/kncomposer.cpp
===================================================================
--- knode/kncomposer.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ knode/kncomposer.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -576,7 +576,7 @@
   v_iew->t_o->setFont(fnt);
   v_iew->g_roups->setFont(fnt);
   v_iew->f_up2->setFont(fnt);
-  v_iew->e_dit->setFont(fnt);
+  v_iew->e_dit->setFontForWholeText(fnt);
 
   slotUpdateStatusBar();
 }
Index: knode/kncollectionviewitem.cpp
===================================================================
--- knode/kncollectionviewitem.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ knode/kncollectionviewitem.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -60,13 +60,13 @@
     // local folders
     switch ( type() ) {
       case KFolderTreeItem::Outbox:
-        setPixmap( 0, SmallIcon("folder-outbox") );
+        setPixmap( 0, SmallIcon("mail-folder-outbox") );
         break;
       case KFolderTreeItem::Drafts:
         setPixmap( 0, SmallIcon("document-properties") );
         break;
       case KFolderTreeItem::SentMail:
-        setPixmap( 0, SmallIcon("folder-sent-mail") );
+        setPixmap( 0, SmallIcon("mail-folder-sent") );
         break;
       default:
         setPixmap( 0, SmallIcon("folder") );
Index: knode/knmainwidget.cpp
===================================================================
--- knode/knmainwidget.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ knode/knmainwidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -428,7 +428,7 @@
 {
   kDebug(5003) << url;
   QString host = url.host();
-  unsigned short int port = url.port();
+  short int port = url.port();
   KNNntpAccount *acc=0;
 
   if (url.url().left(7) == "news://") {
@@ -436,7 +436,7 @@
     // lets see if we already have an account for this host...
     KNAccountManager::List list = a_ccManager->accounts();
     for ( KNAccountManager::List::Iterator it = list.begin(); it != list.end(); ++it ) {
-      if ( (*it)->server().toLower() == host.toLower() && ( port==0 || (*it)->port() == port ) ) {
+      if ( (*it)->server().toLower() == host.toLower() && ( port==-1 || (*it)->port() == port ) ) {
         acc = *it;
         break;
       }
@@ -447,7 +447,7 @@
       acc->setName(host);
       acc->setServer(host);
 
-      if(port!=0)
+      if(port!=-1)
         acc->setPort(port);
 
       if(url.hasUser() && url.hasPass()) {
Index: knode/knsearchdialog.cpp
===================================================================
--- knode/knsearchdialog.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ knode/knsearchdialog.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -36,7 +36,7 @@
 
   setWindowIcon( KIcon("knode") );
   setButtonsOrientation( Qt::Vertical );
-  setButtonGuiItem( User1, KGuiItem( i18n("&Search"), "mail_find" ) );
+  setButtonGuiItem( User1, KGuiItem( i18n("&Search"), "edit-find" ) );
   setButtonGuiItem( User2, KGuiItem( i18n("C&lear"), "edit-clear" ) );
 
   connect( this, SIGNAL(closeClicked()), SLOT(slotClose()) );
Index: kalarm/templatedlg.cpp
===================================================================
--- kalarm/templatedlg.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/templatedlg.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1,7 +1,7 @@
 /*
  *  templatedlg.cpp  -  dialog to create, edit and delete alarm templates
  *  Program:  kalarm
- *  Copyright ¬© 2004-2008 by David Jarvie <djarvie@kde.org>
+ *  Copyright ¬© 2004-2009 by David Jarvie <djarvie@kde.org>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -73,7 +73,6 @@
 	layout->setMargin(0);
 	topLayout->addLayout(layout);
 	mListFilterModel = new TemplateListFilterModel(EventListModel::templates());
-	mListFilterModel->setTypeFilter(false);
 	mListView = new TemplateListView(topWidget);
 	mListView->setModel(mListFilterModel);
 	mListView->sortByColumn(TemplateListFilterModel::TemplateNameColumn, Qt::AscendingOrder);
Index: kalarm/kalarm.h
===================================================================
--- kalarm/kalarm.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/kalarm.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -23,7 +23,7 @@
 
 #undef QT3_SUPPORT
 
-#define KALARM_VERSION "2.1.4"
+#define KALARM_VERSION "2.1.5"
 #define KALARM_NAME "KAlarm"
 #define KALARM_DBUS_SERVICE  "org.kde.kalarm"  // D-Bus service name of KAlarm application
 
Index: kalarm/mainwindow.cpp
===================================================================
--- kalarm/mainwindow.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/mainwindow.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1184,12 +1184,6 @@
 		                   getMailHeader("Subject", content),
 				   body, sernum);
 	}
-	else if (!(files = KUrl::List::fromMimeData(data)).isEmpty())
-	{
-		kDebug() << "URL";
-		action = KAEvent::FILE;
-		alarmText.setText(files[0].prettyUrl());
-	}
 #ifdef KMAIL_SUPPORTED
 	else if (KPIM::MailList::canDecode(data))
 	{
@@ -1219,6 +1213,12 @@
 		}
 		return;
 	}
+	else if (!(files = KUrl::List::fromMimeData(data)).isEmpty())
+	{
+		kDebug() << "URL";
+		action = KAEvent::FILE;
+		alarmText.setText(files[0].prettyUrl());
+	}
 	else if (data->hasText())
 	{
 		QString text = data->text();
Index: kalarm/templatelistfiltermodel.cpp
===================================================================
--- kalarm/templatelistfiltermodel.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/templatelistfiltermodel.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1,7 +1,7 @@
 /*
  *  templatelistfiltermodel.cpp  -  proxy model class for lists of alarm templates
  *  Program:  kalarm
- *  Copyright ¬© 2007 by David Jarvie <software@astrojar.org.uk>
+ *  Copyright ¬© 2007,2009 by David Jarvie <djarvie@kde.org>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -30,11 +30,11 @@
 // TemplateListFilterModel provides sorting and filtering for the alarm list model.
 
 
-void TemplateListFilterModel::setTypeFilter(bool excludeCommandAlarms)
+void TemplateListFilterModel::setTypeFilter(EventListModel::Type type)
 {
-	if (excludeCommandAlarms != mCmdFilter)
+	if (type != mFilter)
 	{
-		mCmdFilter = excludeCommandAlarms;
+		mFilter = type;
 		filterChanged();
 	}
 }
@@ -44,9 +44,9 @@
 	QModelIndex sourceIndex = sourceModel()->index(sourceRow, 0);
 	if (sourceModel()->data(sourceIndex, EventListModel::StatusRole).toInt() != KCalEvent::TEMPLATE)
 		return false;
-	if (!mCmdFilter)
+	if (mFilter == EventListModel::ALL)
 		return true;
-	return sourceModel()->data(sourceIndex, EventListModel::ValueRole).toInt() != KAEvent::COMMAND;
+	return sourceModel()->data(sourceIndex, EventListModel::ValueRole).toInt() & mFilter;
 }
 
 bool TemplateListFilterModel::filterAcceptsColumn(int sourceCol, const QModelIndex&) const
Index: kalarm/eventlistmodel.cpp
===================================================================
--- kalarm/eventlistmodel.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/eventlistmodel.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1,7 +1,7 @@
 /*
  *  eventlistmodel.cpp  -  model class for lists of alarms or templates
  *  Program:  kalarm
- *  Copyright ¬© 2007,2008 by David Jarvie <djarvie@kde.org>
+ *  Copyright ¬© 2007-2009 by David Jarvie <djarvie@kde.org>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -89,7 +89,7 @@
 	// We need to store the list so that when deletions occur, the deleted alarm's
 	// position in the list can be determined.
 	mEvents = AlarmCalendar::resources()->events(mStatus);
-for(int x=0; x<mEvents.count(); ++x)kDebug(0)<<"Event"<<(void*)mEvents[x];
+//for(int x=0; x<mEvents.count(); ++x)kDebug(0)<<"Event"<<(void*)mEvents[x];
 	if (!mTextIcon)
 	{
 		mTextIcon    = new QPixmap(SmallIcon("dialog-information"));
@@ -484,6 +484,17 @@
 }
 
 /******************************************************************************
+* Static method called when a resource status has changed.
+*/
+void EventListModel::resourceStatusChanged(AlarmResource* resource, AlarmResources::Change change)
+{
+	if (mAlarmInstance)
+		mAlarmInstance->slotResourceStatusChanged(resource, change);
+	if (mTemplateInstance)
+		mTemplateInstance->slotResourceStatusChanged(resource, change);
+}
+
+/******************************************************************************
 * Called when a resource status has changed.
 */
 void EventListModel::slotResourceStatusChanged(AlarmResource* resource, AlarmResources::Change change)
Index: kalarm/Changelog
===================================================================
--- kalarm/Changelog	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/Changelog	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1,6 +1,11 @@
 KAlarm Change Log
 
-=== Version 2.1.4 --- 18 January 2009 ===
+=== Version 2.1.5 --- 7 February 2009 ===
+- Disable inapplicable alarm types in alarm edit dialogue Load Template list.
+- Prevent multiple identical error messages being displayed for the same alarm.
+- Fix possible crash on alarm refresh, or removal or disabling of a resource.
+
+=== Version 2.1.4 (KDE 4.2) --- 18 January 2009 ===
 - Prevent corrupt alarms if deferral reinstates from archived alarm instead of
   from the displaying calendar.
 - Ignore events in calendar without usable alarms (which prevents them getting
Index: kalarm/kalarmapp.cpp
===================================================================
--- kalarm/kalarmapp.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/kalarmapp.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1,7 +1,7 @@
 /*
  *  kalarmapp.cpp  -  the KAlarm application object
  *  Program:  kalarm
- *  Copyright ¬© 2001-2008 by David Jarvie <djarvie@kde.org>
+ *  Copyright ¬© 2001-2009 by David Jarvie <djarvie@kde.org>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -1038,6 +1038,9 @@
 				return false;
 			if (!MainWindow::count())
 			{
+				// We have to have at least one main window to act
+				// as parent to the system tray icon (even if the
+				// window is hidden).
 				creating = true;    // prevent main window constructor from creating an additional tray icon
 				parent = MainWindow::create();
 				creating = false;
@@ -1656,9 +1659,7 @@
 				}
 				// Display the message even though it failed
 			}
-			if (!event.enabled())
-				delete win;        // event is disabled - close its window
-			else if (!win
+			if (!win
 			     ||  (!win->hasDefer() && !alarm.repeatAtLogin())
 			     ||  replaceReminder)
 			{
Index: kalarm/lib/colourbutton.cpp
===================================================================
--- kalarm/lib/colourbutton.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/lib/colourbutton.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -18,12 +18,13 @@
  *  51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
  */
 
+#include "kalarm.h"
+#include "colourbutton.moc"
+
 #include <QMouseEvent>
 #include <QKeyEvent>
 
-#include "colourbutton.h"
 
-
 ColourButton::ColourButton(QWidget* parent)
 	: KColorButton(parent),
 	  mReadOnly(false)
Index: kalarm/lib/stackedwidgets.h
===================================================================
--- kalarm/lib/stackedwidgets.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/lib/stackedwidgets.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -102,7 +102,7 @@
 class StackedScrollWidget : public StackedWidgetT<QScrollArea>
 {
 	public:
-		StackedScrollWidget(StackedScrollGroup* group, QWidget* parent = 0);
+		explicit StackedScrollWidget(StackedScrollGroup* group, QWidget* parent = 0);
 		QWidget* widget() const  { return viewport()->findChild<QWidget*>(); }
 };
 
Index: kalarm/eventlistmodel.h
===================================================================
--- kalarm/eventlistmodel.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/eventlistmodel.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1,7 +1,7 @@
 /*
  *  eventlistmodel.h  -  model class for lists of alarms or templates
  *  Program:  kalarm
- *  Copyright ¬© 2007,2008 by David Jarvie <djarvie@kde.org>
+ *  Copyright ¬© 2007-2009 by David Jarvie <djarvie@kde.org>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -42,6 +42,13 @@
 {
 		Q_OBJECT
 	public:
+		enum Type
+		{
+			DISPLAY = 0x01,
+			COMMAND = 0x02,
+			EMAIL   = 0x04,
+			ALL     = DISPLAY | COMMAND | EMAIL
+		};
 		enum {   // data columns
 			TimeColumn, TimeToColumn, RepeatColumn, ColourColumn, TypeColumn, TextColumn,
 			TemplateNameColumn,
@@ -76,6 +83,7 @@
 		void                  removeEvent(const QString& eventId)   { removeEvent(findEvent(eventId)); }
 		void                  removeResource(AlarmResource*);
 		static KAEvent*       event(const QModelIndex&);
+		static void           resourceStatusChanged(AlarmResource*, AlarmResources::Change);
 
 	public slots:
 		void                  reload();
Index: kalarm/templatelistfiltermodel.h
===================================================================
--- kalarm/templatelistfiltermodel.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/templatelistfiltermodel.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1,7 +1,7 @@
 /*
  *  templatelistfiltermodel.h  -  proxy model class for lists of alarm templates
  *  Program:  kalarm
- *  Copyright ¬© 2007 by David Jarvie <software@astrojar.org.uk>
+ *  Copyright ¬© 2007,2009 by David Jarvie <djarvie@kde.org>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -35,8 +35,8 @@
 		};
 
 		explicit TemplateListFilterModel(EventListModel* baseModel, QObject* parent = 0)
-		               : EventListFilterModel(baseModel, parent) {}
-		void setTypeFilter(bool excludeCommandAlarms);
+		               : EventListFilterModel(baseModel, parent), mFilter(EventListModel::ALL) {}
+		void setTypeFilter(EventListModel::Type);
 		virtual QModelIndex mapFromSource(const QModelIndex& sourceIndex) const;
 		virtual QModelIndex mapToSource(const QModelIndex& proxyIndex) const;
 
@@ -45,7 +45,7 @@
 		virtual bool filterAcceptsColumn(int sourceCol, const QModelIndex& sourceParent) const;
 
 	private:
-		bool mCmdFilter;
+		EventListModel::Type mFilter;
 };
 
 #endif // TEMPLATELISTFILTERMODEL_H
Index: kalarm/alarmcalendar.cpp
===================================================================
--- kalarm/alarmcalendar.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/alarmcalendar.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -495,16 +495,22 @@
 	switch (change)
 	{
 		case AlarmResources::Enabled:
-			if (!resource->isActive())
-				removeKAEvents(resource);
+			if (resource->isActive())
+				return;
+			kDebug() << "Enabled (inactive)";
 			break;
 		case AlarmResources::Invalidated:
+			kDebug() << "Invalidated";
+			break;
 		case AlarmResources::Deleted:
-			removeKAEvents(resource);
+			kDebug() << "Deleted";
 			break;
 		default:
-			break;
+			return;
 	}
+	// Ensure the data model is notified before deleting the KAEvent instances
+	EventListModel::resourceStatusChanged(resource, change);
+	removeKAEvents(resource);
 }
 
 /******************************************************************************
Index: kalarm/resources/localdir.desktop
===================================================================
--- kalarm/resources/localdir.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/resources/localdir.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -19,6 +19,7 @@
 Name[kk]=–ñ–µ—Ä–≥—ñ–ª—ñ–∫—Ç—ñ –∫–∞—Ç–∞–ª–æ–≥—Ç–∞“ì—ã –µ—Å–∫–µ—Ä—Ç—É–ª–µ—Ä
 Name[km]=·ûá·ûº·ûì‚Äã·ûä·üÜ·ûé·ûπ·ûÑ‚Äã·ûÄ·üí·ûì·ûª·ûÑ‚Äã·ûê·ûè‚Äã·ûò·ûº·ûõ·ûä·üí·ûã·û∂·ûì
 Name[ko]=Î°úÏª¨ ÎîîÎ†âÌÑ∞Î¶¨Ïóê Ï†ÄÏû•Ìïú ÏïåÎûå
+Name[lt]=Priminimai vietiniame aplanke
 Name[lv]=AtgƒÅdinƒÅjumi lokƒÅlƒÅ mapƒì
 Name[nb]=Varslinger i lokal katalog
 Name[nds]=Alarms binnen lokaal Orner
@@ -58,7 +59,9 @@
 Comment[pl]=Zapewnia dostƒôp do kalendarza alarm√≥w przechowywanego w lokalnym katalogu, w kt√≥rym ka≈ºdy element kalendarza jest zapisany w osobnym pliku
 Comment[pt]=Oferece o acesso a um calend√°rio de alarmes guardado numa pasta local; cada item do calend√°rio √© guardado num ficheiro em separado
 Comment[pt_BR]=Fornece acesso a um calend√°rio de alarmes armazenado em um √∫nico arquivo local, onde cada item do calend√°rio √© armazenado em um arquivo separado
+Comment[sl]=Omogoƒça dostop do koledarja z alarmi, ki so shranjeni v krajevni mapi, kjer je vsak alarm shranjen v loƒçeni datoteki
 Comment[sv]=Ger tillg√•ng till en alarmkalender lagrad i en lokal katalog, d√§r varje kalenderobjekt √§r lagrat i en separat fil
+Comment[tr]=Her takvim √∂ƒüesinin ayrƒ± bir dosyada depolandƒ±ƒüƒ± yerel bir dizinde depolanmƒ±≈ü bir alarm takvimine eri≈üim saƒülar
 Comment[uk]=–ù–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –Ω–∞–≥–∞–¥—É–≤–∞–Ω—å, —è–∫–∏–π –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É –ª–æ–∫–∞–ª—å–Ω–æ–º—É –∫–∞—Ç–∞–ª–æ–∑—ñ, –¥–µ –∫–æ–∂–µ–Ω –∑–∞–ø–∏—Å –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É –æ–∫—Ä–µ–º–æ–º—É —Ñ–∞–π–ª—ñ
 Comment[x-test]=xxProvides access to an alarm calendar stored in a local directory, in which each calendar item is stored in a separate filexx
 Comment[zh_CN]=Êèê‰æõÂØπÂ≠òÂÇ®Âú®‰∏Ä‰∏™Êú¨Âú∞ÁõÆÂΩï‰∏≠ÁöÑÊèêÈÜíÊó•ÂéÜÁöÑËÆøÈóÆÊîØÊåÅÔºåÊØè‰∏™Êó•ÂéÜÈ°πÁõÆÈÉΩÂ≠òÂÇ®Âú®ÂêÑËá™Áã¨Á´ãÁöÑÊñá‰ª∂ÂÜÖ
Index: kalarm/resources/local.desktop
===================================================================
--- kalarm/resources/local.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/resources/local.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -58,7 +58,9 @@
 Comment[pl]=Zapewnia dostƒôp do kalendarza alarm√≥w przechowywanego w pojedy≈Ñczym pliku lokalnym
 Comment[pt]=Oferece o acesso a um calend√°rio de alarmes guardado num √∫nico ficheiro local
 Comment[pt_BR]=Fornece acesso a um calend√°rio de alarmes armazenado em um √∫nico arquivo local
+Comment[sl]=Omogoƒça dostop do koledarja z alarmi, ki je shranjen v eni krajevni datoteki
 Comment[sv]=Ger tillg√•ng till en alarmkalender lagrad i en enda lokal fil
+Comment[tr]=Tek bir yerel dosyada depolanmƒ±≈ü bir alarm takvimine eri≈üim saƒülar
 Comment[uk]=–ù–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –Ω–∞–≥–∞–¥—É–≤–∞–Ω—å, —è–∫–∏–π –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É –æ–∫—Ä–µ–º–æ–º—É –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Ñ–∞–π–ª—ñ
 Comment[x-test]=xxProvides access to an alarm calendar stored in a single local filexx
 Comment[zh_CN]=Êèê‰æõÂØπÂ≠òÂÇ®Âú®Âçï‰∏™Êú¨Âú∞Êñá‰ª∂‰∏≠ÁöÑÊèêÈÜíÊó•ÂéÜÁöÑËÆøÈóÆÊîØÊåÅ
Index: kalarm/resources/remote.desktop
===================================================================
--- kalarm/resources/remote.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/resources/remote.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -59,7 +59,9 @@
 Comment[pl]=Zapewnia dostƒôp do kalendarza alarm√≥w w pliku zdalnymp przy pomocy systemu sieciowego KDE - KIO
 Comment[pt]=Oferece o acesso a um calend√°rio de alarmes num ficheiro remoto, usando um KIO da plataforma de rede do KDE
 Comment[pt_BR]=Fornece acesso a um calend√°rio de alarmes em um arquivo remoto usando o KIO framework da rede do KDE
+Comment[sl]=Z uporabo KDE-jevega omre≈ænega ogrodja KIO omogoƒça dostop do koledarja z alarmi, ki je shranjen v oddaljeni datoteki
 Comment[sv]=Ger tillg√•ng till en alarmkalender i en fj√§rrfil med anv√§ndning av KDE:s I/O-ramverk
+Comment[tr]=KDE'nin aƒü √ßatƒ±sƒ± KIO'yu kullanarak uzak bir dosyadaki bir alarm takvimine eri≈üim saƒülar
 Comment[uk]=–ù–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –Ω–∞–≥–∞–¥—É–≤–∞–Ω—å, —è–∫–∏–π –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–º—É —Ñ–∞–π–ª—ñ, –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –º–µ—Ä–µ–∂–µ–≤–∏—Ö –∑–∞—Å–æ–±—ñ–≤ KIO KDE
 Comment[x-test]=xxProvides access to an alarm calendar in a remote file using KDE's network framework KIOxx
 Comment[zh_CN]=ÈÄöËøá KDE ÁΩëÁªúÊ°ÜÊû∂ KIOÔºåÊèê‰æõÂØπÂ≠òÂÇ®Âú®‰∏Ä‰∏™ËøúÁ®ãÊñá‰ª∂‰∏≠ÁöÑÊèêÈÜíÊó•ÂéÜÁöÑËÆøÈóÆÊîØÊåÅ
Index: kalarm/resources/alarmresources.cpp
===================================================================
--- kalarm/resources/alarmresources.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/resources/alarmresources.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1,7 +1,7 @@
 /*
  *  alarmresources.cpp  -  alarm calendar resources
  *  Program:  kalarm
- *  Copyright ¬© 2006-2008 by David Jarvie <djarvie@kde.org>
+ *  Copyright ¬© 2006-2009 by David Jarvie <djarvie@kde.org>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -45,13 +45,14 @@
 
 AlarmResources* AlarmResources::create(const KDateTime::Spec& timeSpec, bool activeOnly, bool passiveClient)
 {
-	if (mInstance)
-		return 0;
-	AlarmResources* cal = new AlarmResources(timeSpec, activeOnly, passiveClient);
-	if (!mConstructionError.isEmpty())
-		delete cal;
-	else
-		mInstance = cal;
+	if (!mInstance)
+	{
+		AlarmResources* cal = new AlarmResources(timeSpec, activeOnly, passiveClient);
+		if (!mConstructionError.isEmpty())
+			delete cal;
+		else
+			mInstance = cal;
+	}
 	return mInstance;
 }
 
Index: kalarm/resources/alarmresources.h
===================================================================
--- kalarm/resources/alarmresources.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/resources/alarmresources.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1,7 +1,7 @@
 /*
  *  alarmresources.h  -  alarm calendar resources
  *  Program:  kalarm
- *  Copyright ¬© 2006-2008 by David Jarvie <djarvie@kde.org>
+ *  Copyright ¬© 2006-2009 by David Jarvie <djarvie@kde.org>
  *  Based on calendarresources.h in libkcal,
  *  Copyright (c) 2003 Cornelius Schumacher <schumacher@kde.org>
  *  Copyright (C) 2003-2004 Reinhold Kainhofer <reinhold@kainhofer.com>
@@ -56,8 +56,11 @@
 		};
 
 		/** Create the alarm calendar resources instance.
-		 *  @return The alarm calendar resources instance, or 0 if either a reserved
-		 *          file name was used or it has already been created.
+		 *  If the alarm calendar resources instance has already been created,
+		 *  the existing instance is returned regardless of parameters passed.
+		 *  @return The alarm calendar resources instance, or 0 if a reserved
+		 *          file name was used (in which case, use creationError() to
+		 *          fetch the error message).
 		 */
 		static AlarmResources* create(const KDateTime::Spec& timeSpec, bool activeOnly = false, bool passiveClient = false);
 		static QString creationError()   { return mConstructionError; }
Index: kalarm/messagewin.cpp
===================================================================
--- kalarm/messagewin.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/messagewin.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -228,9 +228,20 @@
 void MessageWin::showError(const KAEvent& event, const DateTime& alarmDateTime,
                            const QStringList& errmsgs, const QString& dontShowAgain)
 {
-	if (dontShowAgain.isEmpty()
-	||  !KAlarm::dontShowErrors(event.id(), dontShowAgain))
-		(new MessageWin(&event, alarmDateTime, errmsgs, dontShowAgain))->show();
+	if (!dontShowAgain.isEmpty()
+	&&  KAlarm::dontShowErrors(event.id(), dontShowAgain))
+		return;
+
+	// Don't pile up duplicate error messages for the same alarm
+	for (int i = 0, end = mWindowList.count();  i < end;  ++i)
+	{
+		MessageWin* w = mWindowList[i];
+		if (w->mErrorWindow  &&  w->mEventID == event.id()
+		&&  w->mErrorMsgs == errmsgs  &&  w->mDontShowAgain == dontShowAgain)
+			return;
+	}
+
+	(new MessageWin(&event, alarmDateTime, errmsgs, dontShowAgain))->show();
 }
 
 /******************************************************************************
Index: kalarm/templatepickdlg.cpp
===================================================================
--- kalarm/templatepickdlg.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/templatepickdlg.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1,7 +1,7 @@
 /*
  *  templatepickdlg.cpp  -  dialog to choose an alarm template
  *  Program:  kalarm
- *  Copyright ¬© 2004,2006-2008 by David Jarvie <djarvie@kde.org>
+ *  Copyright ¬© 2004,2006-2009 by David Jarvie <djarvie@kde.org>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -36,7 +36,7 @@
 static const char TMPL_PICK_DIALOG_NAME[] = "TemplatePickDialog";
 
 
-TemplatePickDlg::TemplatePickDlg(QWidget* parent)
+TemplatePickDlg::TemplatePickDlg(EventListModel::Type type, QWidget* parent)
 	: KDialog(parent)
 {
 	QWidget* topWidget = new QWidget(this);
@@ -49,9 +49,10 @@
 	topLayout->setSpacing(spacingHint());
 
 	// Display the list of templates, but exclude command alarms if in kiosk mode.
-	bool includeCmdAlarms = ShellProcess::authorised();
+	if (!ShellProcess::authorised())
+		type = static_cast<EventListModel::Type>(type & ~EventListModel::COMMAND);
 	mListFilterModel = new TemplateListFilterModel(EventListModel::templates());
-	mListFilterModel->setTypeFilter(!includeCmdAlarms);
+	mListFilterModel->setTypeFilter(type);
 	mListView = new TemplateListView(topWidget);
 	mListView->setModel(mListFilterModel);
 	mListView->sortByColumn(TemplateListFilterModel::TemplateNameColumn, Qt::AscendingOrder);
Index: kalarm/editdlg.cpp
===================================================================
--- kalarm/editdlg.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/editdlg.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -785,7 +785,7 @@
 	if (height() > s.height())
 	{
 		// Resize to slightly greater than the minimum height.
-		// This is for some unkown reason necessary, since
+		// This is for some unknown reason necessary, since
 		// sometimes resizing to the minimum height fails.
 		resize(s.width(), s.height() + 2);
 	}
@@ -1016,7 +1016,17 @@
 */
 void EditAlarmDlg::slotHelp()
 {
-	TemplatePickDlg dlg(this);
+	EventListModel::Type type;
+	switch (mAlarmType)
+	{
+		case KAEvent::FILE:
+		case KAEvent::MESSAGE:  type = EventListModel::DISPLAY;  break;
+		case KAEvent::COMMAND:  type = EventListModel::COMMAND;  break;
+		case KAEvent::EMAIL:    type = EventListModel::EMAIL;  break;
+		default:
+			return;
+	}
+	TemplatePickDlg dlg(type, this);
 	if (dlg.exec() == QDialog::Accepted)
 		initValues(dlg.selectedTemplate());
 }
Index: kalarm/kalarm-2.1.5-general.pl
===================================================================
--- kalarm/kalarm-2.1.5-general.pl	(.../tags/KDE/4.2.0/kdepim)	(wersja 0)
+++ kalarm/kalarm-2.1.5-general.pl	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -0,0 +1,13 @@
+#!/usr/bin/perl -w
+# Convert pre-2.1.5 General section settings.
+
+use strict;
+
+while (<>)
+{
+	if (/^CmdXTerm=konsole/) {
+		s/ -T / -p tabtitle=/;
+		print "[General]\n";
+		print $_;
+	}
+}
Index: kalarm/kalarm.upd
===================================================================
--- kalarm/kalarm.upd	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/kalarm.upd	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -62,3 +62,10 @@
 Group=General
 Options=overwrite
 Script=kalarm-2.0.2-general.pl
+
+# Convert KDE3 konsole -T command parameter
+Id=2.1.5
+File=kalarmrc
+Group=General
+Options=overwrite
+Script=kalarm-2.1.5-general.pl
Index: kalarm/main.cpp
===================================================================
--- kalarm/main.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/main.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1,7 +1,7 @@
 /*
  *  main.cpp
  *  Program:  kalarm
- *  Copyright ¬© 2001-2008 by David Jarvie <djarvie@kde.org>
+ *  Copyright ¬© 2001-2009 by David Jarvie <djarvie@kde.org>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -37,7 +37,7 @@
 	KAboutData aboutData(PROGRAM_NAME, 0, ki18n("KAlarm"), KALARM_VERSION,
 		ki18n("Personal alarm message, command and email scheduler for KDE"),
 		KAboutData::License_GPL,
-		ki18n("Copyright 2001-2008, David Jarvie"), KLocalizedString(), "http://www.astrojar.org.uk/kalarm");
+		ki18n("Copyright 2001-2009, David Jarvie"), KLocalizedString(), "http://www.astrojar.org.uk/kalarm");
 	aboutData.addAuthor(ki18n("David Jarvie"), KLocalizedString(), "djarvie@kde.org");
 	aboutData.setOrganizationDomain("kde.org");
 
Index: kalarm/CMakeLists.txt
===================================================================
--- kalarm/CMakeLists.txt	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/CMakeLists.txt	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -125,6 +125,6 @@
 install( FILES kalarmui.rc DESTINATION ${DATA_INSTALL_DIR}/kalarm )
 install( FILES org.kde.kalarm.kalarm.xml DESTINATION ${KDE4_DBUS_INTERFACES_DIR} )
 install( FILES kalarm.upd DESTINATION ${KCONF_UPDATE_INSTALL_DIR})
-install( PROGRAMS kalarm-version.pl kalarm-1.2.1-general.pl kalarm-1.9.5-defaults.pl kalarm-2.0.2-general.pl DESTINATION ${KCONF_UPDATE_INSTALL_DIR})
+install( PROGRAMS kalarm-version.pl kalarm-1.2.1-general.pl kalarm-1.9.5-defaults.pl kalarm-2.0.2-general.pl kalarm-2.1.5-general.pl DESTINATION ${KCONF_UPDATE_INSTALL_DIR})
 
 kde4_install_icons( ${ICON_INSTALL_DIR} )
Index: kalarm/templatepickdlg.h
===================================================================
--- kalarm/templatepickdlg.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/templatepickdlg.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -20,6 +20,7 @@
 #ifndef TEMPLATEPICKDLG_H
 #define TEMPLATEPICKDLG_H
 
+#include "eventlistmodel.h"
 #include <kdialog.h>
 
 class QResizeEvent;
@@ -32,7 +33,7 @@
 {
 		Q_OBJECT
 	public:
-		explicit TemplatePickDlg(QWidget* parent = 0);
+		explicit TemplatePickDlg(EventListModel::Type, QWidget* parent = 0);
 		const KAEvent* selectedTemplate() const;
 	protected:
 		virtual void   resizeEvent(QResizeEvent*);
Index: kalarm/kalarm.autostart.desktop
===================================================================
--- kalarm/kalarm.autostart.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kalarm/kalarm.autostart.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -32,6 +32,7 @@
 Comment[ja]=„É≠„Ç∞„Ç§„É≥ÊôÇ„Å´ KAlarm „ÇíËá™ÂãïËµ∑Âãï
 Comment[km]=·ûÖ·û∂·ûî·üã·ûï·üí·ûä·ûæ·ûò KAlarm ·ûä·üÑ·ûô‚Äã·ûü·üí·ûú·üê·ûô·ûî·üí·ûö·ûú·ûè·üí·ûè·û∑‚Äã·ûì·üÖ·ûñ·üÅ·ûõ‚Äã·ûÖ·ûº·ûõ
 Comment[ko]=Î°úÍ∑∏Ïù∏Ìï† Îïå KAlarm ÏãúÏûëÌïòÍ∏∞
+Comment[lt]=KAlarm paleidimas automati≈°kai prisiregistravimo metu
 Comment[lv]=KAlarm automƒÅtiska palai≈°ana pieslƒìdzoties
 Comment[nb]=KAlarm autostart ved innlogging
 Comment[nds]=KAlarm bi't Anmellen automaatsch starten
Index: korn/KOrn.desktop
===================================================================
--- korn/KOrn.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korn/KOrn.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1,6 +1,7 @@
 [Desktop Entry]
 GenericName=Mail Alert
 GenericName[af]=Pos inkennis stel
+GenericName[ar]=SMS
 GenericName[bg]=–ê–ª–∞—Ä–º–∞ –∑–∞ –µ-–ø–æ—â–∞
 GenericName[ca]=Alerta per al correu
 GenericName[cs]=Upozornƒõn√≠ na po≈°tu
Index: kaddressbook/xxport/gmx_xxport.desktop
===================================================================
--- kaddressbook/xxport/gmx_xxport.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kaddressbook/xxport/gmx_xxport.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -61,6 +61,7 @@
 Comment[pl]=Wtyczka do importu i eksportu kontakt√≥w w formacie ksiƒÖ≈ºki adresowej GMX
 Comment[pt]=Um 'plugin' para importar e exportar os contactos no formato vCard
 Comment[pt_BR]=Plug-in para importar e exportar contatos no formato de livro de endere√ßos do GMX
+Comment[sl]=Vstavek za uvoz in izvoz stikov v obliki adresarja GMX
 Comment[sv]=Insticksprogram f√∂r import och export av kontakter med GMX-adressboksformat
 Comment[tr]=GMX'in adres defteri bi√ßimini i√ßeriye ve dƒ±≈üarƒ±ya aktarma eklentisi
 Comment[uk]=–í—Ç—É–ª–æ–∫ –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É —Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç—É –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤ —É —Ñ–æ—Ä–º–∞—Ç—ñ –∞–¥—Ä–µ—Å–Ω–∏—Ö –∫–Ω–∏–≥ GMX
Index: kaddressbook/xxport/vcard_xxport.desktop
===================================================================
--- kaddressbook/xxport/vcard_xxport.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kaddressbook/xxport/vcard_xxport.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -16,7 +16,7 @@
 Name[fi]=KAB vCard liit√§nn√§inen
 Name[fr]=Module d'import¬†/ export vCard pour KAB
 Name[fy]=KAB vCard XXPort-plugin
-Name[ga]=Breise√°n Iomp√≥rt√°la/Easp√≥rt√°la vCard le haghaidh KAB
+Name[ga]=Breise√°n Iomp√≥rt√°la/Easp√≥rt√°la v-Ch√°rta√≠ le haghaidh KAB
 Name[gl]=Engadido XXPort de vCard para KAB
 Name[he]=◊™◊ï◊°◊£ ◊ô◊ô◊ë◊ï◊ê/◊ô◊ô◊¶◊ï◊ê ◊¢◊ë◊ï◊® vCard ◊©◊ú KAB
 Name[hu]=KAB vCard XXPort b≈ëv√≠t≈ëmodul
@@ -66,7 +66,7 @@
 Comment[fi]=Liit√§nn√§inen vCard-muodossa olevien kontaktien tuontiin ja vientiin
 Comment[fr]=Module d'import¬†/ export de contacts au format vCard
 Comment[fy]=Comment=Plugin foar it ymportearjen fan kontaktpersoanen yn vCard-formaat
-Comment[ga]=Breise√°n a iomp√≥rt√°lann agus easp√≥rt√°lann teagmh√°lacha i bhform√°id vCard
+Comment[ga]=Breise√°n a iomp√≥rt√°lann agus easp√≥rt√°lann teagmh√°lacha i bhform√°id v-Ch√°rta
 Comment[gl]=Engadido para importar e exportar contactos no formato vCard
 Comment[hu]=B≈ëv√≠t≈ëmodul vCard n√©vjegyek import√°l√°s√°hoz/export√°l√°s√°hoz
 Comment[is]=√çforrit til a√∞ flytja inn e√∞a √∫t tengili√∞i √≠ vCard sni√∞i
Index: kaddressbook/editors/kaddressbookimprotocol.desktop
===================================================================
--- kaddressbook/editors/kaddressbookimprotocol.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kaddressbook/editors/kaddressbookimprotocol.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -41,6 +41,7 @@
 Name[pl]=Protok√≥≈Ç komunikacji internetowej KAddressbook
 Name[pt]=Protocolo de Mensagens Instant√¢neas do KAdressbook
 Name[pt_BR]=Protocolo de mensagens instant√¢neas do KAddressbook
+Name[ro]=Protocol de mesagerie instantanee Carte de adrese
 Name[ru]=–ü—Ä–æ—Ç–æ–∫–æ–ª –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –∞–¥—Ä–µ—Å–Ω–æ–π –∫–Ω–∏–≥–∏ KDE
 Name[se]=≈†leaƒëgadieƒë√°husprotokolla KDE-ƒçujuhusgirjji v√°r√°s
 Name[sk]=Protokol pre KDE Adres√°r Instant Messaging
Index: kaddressbook/kabcore.cpp
===================================================================
--- kaddressbook/kabcore.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kaddressbook/kabcore.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1382,7 +1382,7 @@
   connect(mActionCategories, SIGNAL(triggered(bool) ), SLOT( setCategories() ));
   mActionCategories->setWhatsThis( i18n( "Set the categories for all selected contacts." ) );
 
-  QAction *clearLocation = coll->addAction( "clear_search" );
+  KAction *clearLocation = coll->addAction( "clear_search" );
   clearLocation->setIcon( KIcon(QApplication::isRightToLeft() ? "edit-clear-locationbar-rtl" : "edit-clear-locationbar-ltr") );
   clearLocation->setText( i18n( "Clear Search Bar" ) );
   connect(clearLocation, SIGNAL(triggered(bool) ), SLOT( slotClearSearchBar() ));
Index: kaddressbook/addresseeeditorwidget.cpp
===================================================================
--- kaddressbook/addresseeeditorwidget.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kaddressbook/addresseeeditorwidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -210,7 +210,7 @@
 
   mIMWidget = new IMEditWidget( page, mAddressee, tab1.mInetLayout );
   connect( mIMWidget, SIGNAL( modified() ), SLOT( emitModified() ) );
-  tab1.layout->addWidget( mIMWidget, 7, 4, 3, 2 );
+  tab1.layout->addWidget( mIMWidget );
 
   // Categories
   connect( tab1.mCategoryButton, SIGNAL( clicked() ), SLOT( selectCategories() ) );
Index: kaddressbook/kcmconfigs/kcmkabldapconfig.cpp
===================================================================
--- kaddressbook/kcmconfigs/kcmkabldapconfig.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kaddressbook/kcmconfigs/kcmkabldapconfig.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -41,6 +41,7 @@
 KCMKabLdapConfig::KCMKabLdapConfig( QWidget *parent, const QVariantList & )
   : KCModule( KCMKabLdapConfigFactory::componentData(), parent )
 {
+  KGlobal::locale()->insertCatalog( "libkldap" );
   QVBoxLayout *layout = new QVBoxLayout( this );
   mConfigWidget = new LDAPOptionsWidget( this );
   layout->addWidget( mConfigWidget );
Index: kaddressbook/kabcdistlistupdater/kabcdistlistupdater.desktop
===================================================================
--- kaddressbook/kabcdistlistupdater/kabcdistlistupdater.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kaddressbook/kabcdistlistupdater/kabcdistlistupdater.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -28,6 +28,7 @@
 Comment[pl]=Narzƒôdzie uaktualniania starych list dystrybucyjnych.
 Comment[pt]=Uma ferramenta de actualiza√ß√£o das listas de distribui√ß√£o antigas para as novas.
 Comment[pt_BR]=Ferramenta de atualiza√ß√£o de listas de distribui√ß√£o antigas para novas.
+Comment[sl]=Orodje za pretvarjanje starih seznamov za razpo≈°iljanje v novo obliko.
 Comment[sv]=Verktyg f√∂r att uppdatera gamla f√∂rdelningslistor till nya.
 Comment[tr]=Eski daƒüƒ±tƒ±m listelerini yeni hale g√ºncellemek i√ßin bir ara√ß.
 Comment[uk]=–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ä–∏—Ö —Å–ø–∏—Å–∫—ñ–≤ —Ä–æ–∑–ø–æ–≤—Å—é–¥–∂–µ–Ω–Ω—è
Index: kaddressbook/features/distributionlistng.desktop
===================================================================
--- kaddressbook/features/distributionlistng.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kaddressbook/features/distributionlistng.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -21,6 +21,7 @@
 Name[pl]=Nowa wtyczka KAB do obs≈Çugi list wysy≈Çkowych
 Name[pt]='Plugin' de Lista de Distribui√ß√£o do KAB da Pr√≥xima Gera√ß√£o
 Name[pt_BR]=Plug-in da pr√≥xima gera√ß√£o de listas de distribui√ß√£o do KAB
+Name[sl]=Novi vstavek za adresarjev seznam za razpo≈°iljanje
 Name[sv]=Adressbokens n√§sta generation insticksprogram f√∂r distributionslistor
 Name[tr]=KAB Daƒüƒ±tƒ±m Listesi Sonraki Ku≈üak Eklentisi
 Name[uk]=–ù–æ–≤—ñ—Ç–Ω—ñ–π –≤—Ç—É–ª–æ–∫ —Å–ø–∏—Å–∫—É —Ä–æ–∑–ø–æ–≤—Å—é–¥–∂–µ–Ω–Ω—è KAB
Index: libkholidays/holidays/CMakeLists.txt
===================================================================
--- libkholidays/holidays/CMakeLists.txt	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ libkholidays/holidays/CMakeLists.txt	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -10,9 +10,9 @@
          holiday_br
          holiday_ca
          holiday_catalan
+         holiday_ch
          holiday_cl
          holiday_co
-         holiday_ch
          holiday_cz
          holiday_de
          holiday_dk
@@ -25,8 +25,9 @@
          holiday_gr
          holiday_gt
          holiday_hu
+         holiday_ie
+         holiday_il
          holiday_is
-         holiday_il
          holiday_it
          holiday_jm
          holiday_jp
@@ -43,13 +44,12 @@
          holiday_ru
          holiday_se
          holiday_si
+         holiday_sk
+         holiday_Suedtirol
          holiday_th
          holiday_ua
          holiday_us
          holiday_uy
-         holiday_ie
-         holiday_Suedtirol
          holiday_za
          DESTINATION ${DATA_INSTALL_DIR}/libkholidays)
 
-
Index: libkholidays/holidays/holiday_dk
===================================================================
--- libkholidays/holidays/holiday_dk	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ libkholidays/holidays/holiday_dk	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -4,6 +4,7 @@
 :
 : Helligdage
 "Hellig tre Konger" on 6.1
+"Kyndelmisse" on 2.2
 weekend "Fastelavn" weekend on easter minus 49 days
 weekend "Palme s√∏ndag" weekend on easter minus 7 days
 weekend "Sk√¶rtorsdag" weekend on easter minus 3 days
@@ -30,13 +31,15 @@
 :
 : Nationale m√¶rkedage
 "Kampen ved Myslunde 1864" on 2.2
-"Stormen p√• K√∏benhavn 1659" on second tuesday in february
-"Slaget p√• reden 1801" on 2.4
+"Stormen p√• K√∏benhavn 1659" on 11.2
+"Slaget p√• Reden 1801" on 2.4
 "Danmarks Bes√¶ttelse 1940" on 9.4
 "Slaget ved Dybb√∏l 1864" on 18.4
 "Danmarks befrielse 1945" on 5.5
 "Kampen ved Helgoland 1864" on 9.5
-"Valdemarsdag/Genforeningsdag" on 15.6
+"Europadagen" on 9.5
+"Valdemarsdag/Genforeningsdagen 1920" on 15.6
+"Slaget i K√∏ge Bugt" on 1.6
 "Slaget ved Fredericia 1849" on 6.7
 "Slaget ved Isted 1850" on 25.7
 "Stormen p√• Frederiksstad 1850" on 4.10
@@ -44,16 +47,18 @@
 :
 : Royale f√∏dselsdage
 "Kronprinsesse Mary" on 5.2
+"Prinsesse Marie" on 6.2
 "Dronning Margrete II" on 16.4
+"Prinsesse Isabella" on 21.4
 "Prinsesse Benedikte" on 29.4
 "Kronprins Frederik" on 26.5
 "Prins Joachim" on 7.6
 "Prins Henrik" on 11.6
-"Prinsesse Alexandra" on 30.6
 "Prins Felix" on 22.7
 "Prins Nikolai" on 28.8
+"Prins Christian" on 15.10
 :
 : Andet
-small blue "Sommertid" on last sunday in march
-small blue "Vintertid" on last sunday in october
+small blue "Sommertid begynder" on last sunday in march
+small blue "Sommertid ender" on last sunday in october
 "Mors dag" on second sunday in may
Index: plugins/kmail/bodypartformatter/text_calendar.desktop
===================================================================
--- plugins/kmail/bodypartformatter/text_calendar.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ plugins/kmail/bodypartformatter/text_calendar.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -12,7 +12,7 @@
 Name[fy]=Applikaasje octetstream
 Name[gl]=Aplicaci√≥n Octetstream
 Name[hu]=Alkalmaz√°s-adatfolyam
-Name[ja]=„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ „Ç™„ÇØ„ÉÜ„ÉÉ„Éà „Çπ„Éà„É™„Éº„É†
+Name[ja]=„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥/„Ç™„ÇØ„ÉÜ„ÉÉ„Éà„Çπ„Éà„É™„Éº„É†
 Name[ka]=·É†·Éï·Éê·Éì·Éò·Éú·Éî·Éë·Éò·Éê·Éú·Éò ·Éû·É†·Éù·Éí·É†·Éê·Éõ·Éê
 Name[kk]=“ö–æ–ª–¥–∞–Ω–±–∞–Ω—ã“£ –±–∏–Ω–∞—Ä–ª—ã –∞“ì—ã–º—ã
 Name[km]=Octetstream ·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏
@@ -52,7 +52,7 @@
 Comment[hu]=Form√°z√≥modul text/calendar adatfolyamok kezel√©s√©hez
 Comment[is]=Sni√∞m√°tst√≥l fyrir text/calendar
 Comment[it]=Un'estensione per la formattazione di text/calendar nei messaggi di posta 
-Comment[ja]=text/calendar Áî®„ÅÆ Bodypart „Éï„Ç©„Éº„Éû„ÉÉ„Çø „Éó„É©„Ç∞„Ç§„É≥
+Comment[ja]=text/calendar Áî®„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏Êú¨‰Ωì„Éï„Ç©„Éº„Éû„ÉÉ„Çø
 Comment[ka]=·Éô·Éù·Éõ·Éû·Éù·Éú·Éî·Éú·É¢·É£·É†·Éò ·Éì·Éê·Éõ·É§·Éù·É†·Éõ·Éê·É¢·Éî·Éë·Éî·Éö·Éò ·Éõ·Éù·Éì·É£·Éö·Éò text/calendar
 Comment[kk]=Text/calendar –±”©–ª—ñ–º—ñ–Ω –ø—ñ—à—ñ–º–¥–µ—É –º–æ–¥—É–ª—ñ
 Comment[km]=·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûá·üÜ·ûì·ûΩ·ûô‚Äã·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûí·üí·ûú·ûæ‚Äã·ûë·üí·ûö·ûÑ·üã·ûë·üí·ûö·û∂·ûô‚Äã·ûï·üí·ûì·üÇ·ûÄ‚Äã·ûè·ûΩ ·ûü·ûò·üí·ûö·û∂·ûî·üã‚Äã·û¢·ûè·üí·ûê·ûî·ûë/·ûî·üí·ûö·ûè·û∑·ûë·û∑·ûì
Index: plugins/kmail/bodypartformatter/text_vcard.desktop
===================================================================
--- plugins/kmail/bodypartformatter/text_vcard.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ plugins/kmail/bodypartformatter/text_vcard.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -12,7 +12,7 @@
 Name[fy]=Applikaasje octetstream
 Name[gl]=Aplicaci√≥n Octetstream
 Name[hu]=Alkalmaz√°s-adatfolyam
-Name[ja]=„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ „Ç™„ÇØ„ÉÜ„ÉÉ„Éà „Çπ„Éà„É™„Éº„É†
+Name[ja]=„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥/„Ç™„ÇØ„ÉÜ„ÉÉ„Éà„Çπ„Éà„É™„Éº„É†
 Name[ka]=·É†·Éï·Éê·Éì·Éò·Éú·Éî·Éë·Éò·Éê·Éú·Éò ·Éû·É†·Éù·Éí·É†·Éê·Éõ·Éê
 Name[kk]=“ö–æ–ª–¥–∞–Ω–±–∞–Ω—ã“£ –±–∏–Ω–∞—Ä–ª—ã –∞“ì—ã–º—ã
 Name[km]=Octetstream ·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏
@@ -53,7 +53,7 @@
 Comment[hu]=Form√°z√≥modul text/vcard adatfolyamok kezel√©s√©hez
 Comment[is]=Sni√∞m√°tst√≥l fyrir text/vcard
 Comment[it]=Un'estensione per la formattazione di text/vcard nei messaggi di posta
-Comment[ja]=text/vcard Áî®„ÅÆ Bodypart „Éï„Ç©„Éº„Éû„ÉÉ„Çø „Éó„É©„Ç∞„Ç§„É≥
+Comment[ja]=text/vcard Áî®„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏Êú¨‰Ωì„Éï„Ç©„Éº„Éû„ÉÉ„Çø
 Comment[ka]=·Éô·Éù·Éõ·Éû·Éù·Éú·Éî·Éú·É¢·É£·É†·Éò ·Éì·Éê·Éõ·É§·Éù·É†·Éõ·Éê·É¢·Éî·Éë·Éî·Éö·Éò ·Éõ·Éù·Éì·É£·Éö·Éò text/vcard
 Comment[kk]=Text/vcard –±”©–ª—ñ–º—ñ–Ω –ø—ñ—à—ñ–º–¥–µ—É –º–æ–¥—É–ª—ñ
 Comment[km]=·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûá·üÜ·ûì·ûΩ·ûô‚Äã·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûí·üí·ûú·ûæ‚Äã·ûë·üí·ûö·ûÑ·üã·ûë·üí·ûö·û∂·ûô‚Äã·ûï·üí·ûì·üÇ·ûÄ‚Äã·ûè·ûΩ ·ûü·ûò·üí·ûö·û∂·ûî·üã‚Äã·û¢·ûè·üí·ûê·ûî·ûë/vcard
Index: plugins/kmail/bodypartformatter/text_xdiff.desktop
===================================================================
--- plugins/kmail/bodypartformatter/text_xdiff.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ plugins/kmail/bodypartformatter/text_xdiff.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -12,7 +12,7 @@
 Name[fy]=Applikaasje octetstream
 Name[gl]=Aplicaci√≥n Octetstream
 Name[hu]=Alkalmaz√°s-adatfolyam
-Name[ja]=„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ „Ç™„ÇØ„ÉÜ„ÉÉ„Éà „Çπ„Éà„É™„Éº„É†
+Name[ja]=„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥/„Ç™„ÇØ„ÉÜ„ÉÉ„Éà„Çπ„Éà„É™„Éº„É†
 Name[ka]=·É†·Éï·Éê·Éì·Éò·Éú·Éî·Éë·Éò·Éê·Éú·Éò ·Éû·É†·Éù·Éí·É†·Éê·Éõ·Éê
 Name[kk]=“ö–æ–ª–¥–∞–Ω–±–∞–Ω—ã“£ –±–∏–Ω–∞—Ä–ª—ã –∞“ì—ã–º—ã
 Name[km]=Octetstream ·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏
@@ -46,10 +46,11 @@
 Comment[fr]=Module de mise en forme du corps du message pour text/x-patch
 Comment[gl]=Un engadido para formatar o corpo do texto/x-patch
 Comment[it]=Un'estensione per la formattazione di text/x-patch nei messaggi di posta
-Comment[ja]=text/x-patch Áî®„ÅÆ bodypart „Éï„Ç©„Éº„Éû„ÉÉ„Çø„Éó„É©„Ç∞„Ç§„É≥
+Comment[ja]=text/x-patch Áî®„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏Êú¨‰Ωì„Éï„Ç©„Éº„Éû„ÉÉ„Çø
 Comment[kk]=Text/x-diff –±”©–ª—ñ–º—ñ–Ω –ø—ñ—à—ñ–º–¥–µ—É –º–æ–¥—É–ª—ñ
 Comment[km]=·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûá·üÜ·ûì·ûΩ·ûô‚Äã·ûß·ûî·ûÄ·ûö·ûé·üç·ûí·üí·ûú·ûæ·ûë·üí·ûö·ûÑ·üã·ûë·üí·ûö·û∂·ûô‚Äã·ûï·üí·ûì·üÇ·ûÄ·ûè·ûΩ‚Äã·ûü·ûò·üí·ûö·û∂·ûî·üã text/x-patch
 Comment[ko]=text/x-patch ÌòïÏãù Íæ∏ÎØ∏Í∏∞ ÌîåÎü¨Í∑∏Ïù∏
+Comment[lt]=text/x-patch formatavimo priedas
 Comment[lv]=Satura daƒºas formƒì≈°anas spraudnis text/x-patch datu tipam
 Comment[nb]=Et programtillegg for text/x-patch for br√∏dtekst-formatering
 Comment[nds]=En H√∂√∂ftdeel-Formateermoduul f√∂r text/x-patch
Index: ktimetracker/ktimetrackerpart.desktop
===================================================================
--- ktimetracker/ktimetrackerpart.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ ktimetracker/ktimetrackerpart.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -14,6 +14,7 @@
 Name[ja]=KTimeTracker „Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
 Name[km]=·ûü·ûò·û∂·ûü·ûó·û∂·ûÇ‚Äã·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏·ûè·û∂·ûò·ûä·û∂·ûì‚Äã·ûö·ûî·ûü·üã KTime
 Name[ko]=KTimeTracker Íµ¨ÏÑ± ÏöîÏÜå
+Name[lt]=KTimeTracker komponentas
 Name[lv]=KTimeTracker komponente
 Name[nb]=KTimeTracker-komponent
 Name[nds]=Tietlogbook-Komponent
Index: ktimetracker/ktimetrackerpart.h
===================================================================
--- ktimetracker/ktimetrackerpart.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ ktimetracker/ktimetrackerpart.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -53,7 +53,6 @@
 public:
     ktimetrackerpart(QWidget *parentWidget, QObject *parent, const QVariantList&);
 
-    void taskViewCustomContextMenuRequested( const QPoint& );
     TimetrackerWidget* MainWidget() { return mMainWidget; };
 
     virtual ~ktimetrackerpart();
@@ -64,6 +63,7 @@
     virtual bool openFile();
 
 public Q_SLOTS:
+   void taskViewCustomContextMenuRequested( const QPoint& );
    void setStatusBar(const QString & qs);
 };
 
Index: ktimetracker/timetrackerwidget.cpp
===================================================================
--- ktimetracker/timetrackerwidget.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ ktimetracker/timetrackerwidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -161,7 +161,7 @@
 int TimetrackerWidget::focusSearchBar()
 {
   kDebug(5970) << "Entering function";
-  d->mSearchWidget->setFocus();
+  if ( d->mSearchWidget->isVisible() ) d->mSearchWidget->setFocus();
   return 0;
 }
 
Index: ktimetracker/kcmconfigs/ktimetrackerconfig.desktop
===================================================================
--- ktimetracker/kcmconfigs/ktimetrackerconfig.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ ktimetracker/kcmconfigs/ktimetrackerconfig.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -33,6 +33,7 @@
 Comment[ja]=KTimeTracker „ÅÆË®≠ÂÆö
 Comment[km]=·ûÄ·üÜ·ûé·ûè·üã‚Äã·ûö·ûÖ·ûì·û∂·ûü·ûò·üí·ûñ·üê·ûì·üí·ûí ktimetracker
 Comment[ko]=KTimeTracker ÏÑ§Ï†ï
+Comment[lt]=Konfig≈´ruoti ktimetracker
 Comment[lv]=Konfigurƒìt ktimetracker
 Comment[nb]=Oppsett for ktimettracker
 Comment[nds]=Tietlogbook instellen
Index: kjots/Kjots.desktop
===================================================================
--- kjots/Kjots.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kjots/Kjots.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -14,11 +14,13 @@
 GenericName[es]=Apuntador de notas
 GenericName[et]=M√§rkmete rakendus
 GenericName[fr]=Prise de note
+GenericName[ga]=Eagarth√≥ir N√≥ta√≠
 GenericName[gl]=Caderno de Notas
 GenericName[it]=Blocco appunti
 GenericName[ja]=„É°„É¢Â∏≥
 GenericName[km]=·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûë·ûë·ûΩ·ûõ‚Äã·ûÖ·üÜ·ûé·û∂·üÜ
 GenericName[ko]=Î©îÎ™®Ïû•
+GenericName[lt]=Pastab≈≥ gavƒójas
 GenericName[lv]=Piezƒ´mju bloci≈Ü≈°
 GenericName[nb]=Notisblokk
 GenericName[nds]=Notizenprogramm
@@ -30,6 +32,7 @@
 GenericName[pt_BR]=Tomador de notas
 GenericName[ro]=Carne»õel de note
 GenericName[ru]=–ó–∞–ø–∏—Å–Ω–∞—è –∫–Ω–∏–∂–∫–∞
+GenericName[sl]=Bele≈ænica
 GenericName[sv]=Anteckningsblock
 GenericName[tr]=Not Alƒ±cƒ±
 GenericName[uk]=–ó–∞–ø–∏—Å–Ω–∞ –∫–Ω–∏–∂–∫–∞
Index: libkdepim/kprefsdialog.cpp
===================================================================
--- libkdepim/kprefsdialog.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ libkdepim/kprefsdialog.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -399,7 +399,7 @@
   if ( !mItem->value().date().isValid() ) {
     mItem->setValue( QDateTime::currentDateTime() );
   }
-  mDateEdit->setDate( mItem->value().date() );
+  mDateEdit->setDate( mItem->value().date().isValid() ? mItem->value().date() : QDate::currentDate()  );
 }
 
 void KPrefsWidDate::writeConfig()
Index: libkdepim/kmeditor.cpp
===================================================================
--- libkdepim/kmeditor.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ libkdepim/kmeditor.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -95,6 +95,10 @@
     // Each pair is the index of the start- and end position of the signature.
     QList< QPair<int,int> > signaturePositions( const KPIMIdentities::Signature &sig ) const;
 
+    // This fixes the string returned by QTextEdit::toPlainText(), by removing non-ASCII
+    // chars like QChar::LineSeparator, non-breaking spaces or embedded image markers.
+    void fixupTextEditString( QString &text ) const;
+
     void startExternalEditor();
     void slotEditorFinished( int, QProcess::ExitStatus exitStatus );
 
@@ -122,6 +126,19 @@
 
 using namespace KPIM;
 
+void KMeditorPrivate::fixupTextEditString( QString &text ) const
+{
+  // Remove line separators. Normal \n chars are still there, so no linebreaks get lost here
+  text.remove( QChar::LineSeparator );
+
+  // Get rid of embedded images, see QTextImageFormat documentation:
+  // "Inline images are represented by an object replacement character (0xFFFC in Unicode) "
+  text.remove( 0xFFFC );
+
+  // In plaintext mode, each space is non-breaking.
+  text.replace( QChar::Nbsp, QChar( ' ' ) );
+}
+
 QList< QPair<int,int> > KMeditorPrivate::signaturePositions( const KPIMIdentities::Signature &sig ) const
 {
   QList< QPair<int,int> > signaturePositions;
@@ -972,12 +989,7 @@
     block = block.next();
   }
 
-  // Get rid of embedded linebreaks, caused by the <br> tag. We add our own,
-  // plain-text ascii linebreaks above.
-  // Additionally, when using plain text mode, the text doesn't contain the
-  // line separator character, so we can't even rely on that.
-  temp.remove( QChar::LineSeparator );
-
+  d->fixupTextEditString( temp );
   return temp;
 }
 
Index: libkdepim/categoryhierarchyreader.cpp
===================================================================
--- libkdepim/categoryhierarchyreader.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ libkdepim/categoryhierarchyreader.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -52,7 +52,15 @@
 {
   clear();
   QStringList::Iterator it;
-  categories.sort();
+
+  // case insensitive sort
+  QMap<QString, QString> map;
+  foreach ( QString str, categories ) {
+    map.insert( str.toLower(), str );
+  }
+
+  categories = map.values();
+
   QStringList last_path;
   for ( it = categories.begin(); it != categories.end(); ++it ) {
     QStringList _path = path( *it );
Index: libkdepim/completionordereditor.cpp
===================================================================
--- libkdepim/completionordereditor.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ libkdepim/completionordereditor.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -104,11 +104,11 @@
 
 void LDAPCompletionItem::save( CompletionOrderEditor* )
 {
-  KConfig _config( "kabldaprc" );
-  KConfigGroup config(&_config, "LDAP" );
-  config.writeEntry( QString( "SelectedCompletionWeight%1" ).arg( mLdapClient->clientNumber() ),
-                     mWeight );
-  config.sync();
+  KConfig *config = LdapSearch::config();
+  KConfigGroup group( config, "LDAP" );
+  group.writeEntry( QString( "SelectedCompletionWeight%1" ).arg( mLdapClient->clientNumber() ),
+                    mWeight );
+  group.sync();
 }
 
 // A simple item saved into kpimcompletionorder (no subresources, just name/identifier/weight)
Index: console/kabcclient/doc/examples/letters/home_address.desktop
===================================================================
--- console/kabcclient/doc/examples/letters/home_address.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ console/kabcclient/doc/examples/letters/home_address.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -17,6 +17,7 @@
 Name[ja]=„Éó„É©„Ç§„Éô„Éº„Éà„ÅÆÊâãÁ¥ô„ÅÆÂÆõÂÖà
 Name[km]=·û¢·û∂·ûü·ûô·ûä·üí·ûã·û∂·ûì‚Äã·ûü·üÜ·ûî·ûª·ûè·üí·ûö‚Äã·ûï·üí·ûë·üá/·ûØ·ûÄ·ûá·ûì
 Name[ko]=Ïßë/Í∞úÏù∏ Ïö∞Ìé∏ Ï£ºÏÜå
+Name[lt]=L
 Name[lv]=Vƒìstules privƒÅtƒÅ/mƒÅjas adrese
 Name[nb]=Brevadresse hjemme/privat
 Name[nds]=Postadress (privaat)
Index: kpilot/conduits/keyringconduit/kpilot-conduit-keyring.desktop
===================================================================
--- kpilot/conduits/keyringconduit/kpilot-conduit-keyring.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/keyringconduit/kpilot-conduit-keyring.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -13,6 +13,7 @@
 Comment[it]=Questo condotto sincronizza il portachiavi del tuo palmare con un database archiviato sul PC.
 Comment[ja]=„Åì„ÅÆ„Ç≥„É≥„Ç∏„ÉÉ„Éà„ÅØ„Éè„É≥„Éâ„Éò„É´„Éâ„ÅÆ„Ç≠„Éº„É™„É≥„Ç∞„Éá„Éº„Çø„Éô„Éº„Çπ„Çí PC „ÅÆ„Éá„Éº„Çø„Éô„Éº„Çπ„Å®ÂêåÊúü„Åï„Åõ„Åæ„Åô„ÄÇ
 Comment[km]=conduit syncs ·ûì·üÅ·üá‚Äã·ûò·ûº·ûõ·ûä·üí·ûã·û∂·ûì‚Äã·ûë·û∑·ûì·üí·ûì·ûì·üê·ûô keyring ·ûö·ûî·ûü·üã‚Äã·ûß·ûî·ûÄ·ûö·ûé·üç‚Äã·ûô·ûΩ·ûö·ûä·üÉ‚Äã·ûá·û∂‚Äã·ûò·ûΩ·ûô‚Äã·ûò·ûº·ûõ·ûä·üí·ûã·û∂·ûì‚Äã·ûë·û∑·ûì·üí·ûì·ûì·üê·ûô‚Äã·ûä·üÇ·ûõ‚Äã·ûî·û∂·ûì‚Äã·ûï·üí·ûë·ûª·ûÄ‚Äã·ûì·üÖ‚Äã·ûÄ·üí·ûì·ûª·ûÑ‚Äã·ûÄ·ûª·üÜ·ûñ·üí·ûô·ûº·ûë·üê·ûö¬†·üî
+Comment[lt]=≈†is kanalas sinchronizuoja delninuko rakt≈≥ rato duomen≈≥ bazƒô su duomen≈≥ baze, esanƒçia pc.
 Comment[lv]=≈†ƒ´ ƒ∑ƒìde sinhronizƒì j≈´su rokas datora un datora atslƒìgu sai≈°ƒ∑i.
 Comment[nb]=Denne kanalen synkroniserer h√•nddatorens n√∏kkelring-database med en database lagret p√• maskinen.
 Comment[nds]=Disse Kanaal synkroniseert dat Sl√∂telbund op den Handreekner mit een op den Reekner.
@@ -41,6 +42,7 @@
 Name[gl]=Chaveiro
 Name[it]=Portachiavi
 Name[ja]=Èçµ„É™„É≥„Ç∞
+Name[lt]=Rakt≈≥ ratas
 Name[lv]=Atslƒìgu sai≈°ƒ∑is
 Name[nb]=N√∏kkelring
 Name[nds]=Sl√∂telbund
Index: kpilot/conduits/malconduit/mal_conduit.desktop
===================================================================
--- kpilot/conduits/malconduit/mal_conduit.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/malconduit/mal_conduit.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -53,6 +53,7 @@
 Comment[es]=Sincroniza AvantGo (o, en general, el contenido de un servidor MAL) con la agenda electr√≥nica. Esto le permite ver p√°ginas web en el dispositivo sin estar conectado, como la cartelera de cine, la parrilla de televisi√≥n, o cualquier otra p√°gina web.
 Comment[et]=See kanal s√ºnkroniseerib AvantGo (v√µi √ºldisemalt MAL serveri sisu) pihuarvutiga. See v√µimaldab vaadata veebilehek√ºlgi pihuseadmelt ilma v√µrgu√ºhendusega, n√§iteks uurida kino- v√µi telekava v√µi mis tahes muud huvipakkuvat veebilehek√ºlge.
 Comment[fr]=Synchronise AvantGo (ou plus g√©n√©ralement tout serveur MAL) avec votre p√©riph√©rique. Ceci vous permet de consulter des pages Web hors ligne sur votre Palm, comme des programmes TV, Cin√©ma ou n'importe quelle page Web.
+Comment[ga]=Sioncr√≥naigh AvantGo (n√≥, n√≠os ginear√°lta, an t-√°bhar ar fhreastala√≠ MAL) leis an r√≠omhaire boise. Ceada√≠onn s√© seo duit leathanaigh Ghr√©as√°in a l√©amh as l√≠ne ar do r√≠omhaire boise, mar shampla sceideal teilif√≠se n√≥ scann√°in, n√≥ leathanach ar bith eile.
 Comment[gl]=Sincronizar AvantGo (ou xeralmente o contido dun servidor MAL) co dispositivo m√≥bil. Isto permi¬≠te ver p√°xinas web f√≥ra de li√±a, como o horario da TV ou do cine, ou calquera outra p√°xina. 
 Comment[it]=Sincronizza AvantGo (o il contenuto di un generico server MAL) con il palmare. In questo modo potrai visualizzare le pagine web fuori linea sul palmare, come per esempio la programmazione di un cinema o una TV o qualsiasi altra pagina web.
 Comment[ja]=AvantGo („Åæ„Åü„ÅØ‰∏ÄËà¨„Å´ MAL „Çµ„Éº„Éê„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ) „Å®„Éè„É≥„Éâ„Éò„É´„Éâ„ÇíÂêåÊúü„Åï„Åõ„Åæ„Åô„ÄÇ„Åì„Çå„Å´„Çà„Çä„ÄÅ„Éè„É≥„Éâ„Éò„É´„Éâ„ÅßÊò†Áîª„ÇÑ„ÉÜ„É¨„ÉìÁï™ÁµÑË°®„ÄÅ„Åù„ÅÆ‰ªñ„ÅÆ„Ç¶„Çß„Éñ„Éö„Éº„Ç∏„Çí„Ç™„Éï„É©„Ç§„É≥„ÅßÈñ≤Ë¶ß„Åß„Åç„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åô„ÄÇ
@@ -65,6 +66,7 @@
 Comment[pl]=Synchronizuje AvantGo (lub og√≥lnie zawarto≈õƒá serwera MAL) z palmtopem. Pozwala to przeglƒÖdaƒá, bez po≈ÇƒÖczenia z sieciƒÖ, strony WWW na palmtopie, np. repertuar kin lub program telewizyjny, lub dowolnƒÖ stronƒô WWW.
 Comment[pt]=Sincroniza o AvantGo (ou, genericamente, o conte√∫do de um servidor de MAL) para o dispositivo m√≥vel. Isto permite-lhe ver as p√°ginas Web no dispositivo m√≥vel sem estar ligado, como o seu hor√°rio de cinema ou TV ou ainda qualquer outra p√°gina Web.
 Comment[pt_BR]=Sincroniza o AvantGo (ou geralmente o conte√∫do de um servidor MAL) com o handheld. Isto permite que voc√™ visualize p√°ginas web off-line no handheld, por exemplo, a programa√ß√£o do cinema ou TV, ou qualquer outra p√°gina.
+Comment[sl]=Uskladi AvantGo (oziroma v splo≈°nem vsebino stre≈ænika MAL) na roƒçnem raƒçunalniku. S tem si lahko na njem ogledujete spletne strani brez povezave, kot so razpored kino predstav ali pa TV spored ali pa katerokoli drugo spletno stran.
 Comment[sv]=Synkronisera AvantGo (eller mer allm√§nt inneh√•llet p√• en MAL-server) med handdatorn. Det l√•ter dig titta p√• webbsidor i nerkopplat l√§ge p√• handdatorn, som bio eller tv-program, eller vilken annan webbsida som helst.
 Comment[tr]=AvantGo i√ßeriƒüini (ya da genel olarak MAL sunucularƒ± i√ßeriƒüini) el bilgisayarƒ± ile e≈üzamanlar. Bu, TV ya da sinema programƒ± ve diƒüer  web sayfalarƒ±nƒ± el bilgisayarƒ±nƒ±zda √ßevirim dƒ±≈üƒ± olarak g√∂r√ºnt√ºlemenizi saƒülar.
 Comment[uk]=–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è AvantGo (–∞–±–æ –≤–º—ñ—Å—Ç —Å–µ—Ä–≤–µ—Ä—ñ–≤ MAL) –Ω–∞ –∫–∏—à–µ–Ω—å–∫–æ–≤–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π . –¶—è –¥—ñ—è –Ω–∞–¥–∞—î –∑–º–æ–≥—É –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω–∫–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—Ä–æ–≥—Ä–∞–º—É –∫—ñ–Ω–æ—Ç–µ–∞—Ç—Ä–∞ –∞–±–æ —Ç–µ–ª–µ–±–∞—á–µ–Ω–Ω—è, –Ω–∞ –∫–∏—à–µ–Ω—å–∫–æ–≤–æ–º—É –ø—Ä–∏—Å—Ç—Ä–æ—ó –±–µ–∑ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º.
Index: kpilot/conduits/akonadibase/akonadidataproxy.cc
===================================================================
--- kpilot/conduits/akonadibase/akonadidataproxy.cc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/akonadibase/akonadidataproxy.cc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -45,13 +45,14 @@
 {
 public:
 	Private( const IDMapping& mapping )
-		: fCollectionId( -1 ), fMapping( mapping )
+		: fCollectionId( -1 ), fMapping( mapping ), fNextTempId( -1 )
 	{
 	}
-	
+
 	Akonadi::Entity::Id fCollectionId;
 	// Make it const as the proxy should not make changes to it.
 	const IDMapping fMapping;
+	qint64 fNextTempId;
 };
 
 AkonadiDataProxy::AkonadiDataProxy( const IDMapping& mapping )
@@ -63,7 +64,7 @@
 AkonadiDataProxy::~AkonadiDataProxy()
 {
 	FUNCTIONSETUP;
-	
+
 	delete d;
 }
 
@@ -75,14 +76,14 @@
 	DEBUGKPILOT << "We don't support creation of akonadi datastores yet. Not doing anything.";
 	// TODO: figure out how to tell our user via their Palm sync log that
 	// they need to configure akonadi.
-	
+
 	return false;
 }
 
 bool AkonadiDataProxy::isOpen() const
 {
 	FUNCTIONSETUP;
-	
+
 	if( Akonadi::ServerManager::isRunning() )
 	{
 		Akonadi::CollectionFetchJob *job = new Akonadi::CollectionFetchJob
@@ -102,7 +103,7 @@
 		WARNINGKPILOT << "Error: Akonadi is not running.";
 		return false;
 	}
-	
+
 	return true;
 }
 
@@ -114,7 +115,7 @@
 	Akonadi::ItemFetchJob* job
 		= new Akonadi::ItemFetchJob( Akonadi::Collection( d->fCollectionId ) );
 	job->fetchScope().fetchFullPayload();
-	
+
 	if ( job->exec() ) {
 		Akonadi::Item::List items = job->items();
 		foreach( const Akonadi::Item &item, items )
@@ -136,6 +137,7 @@
 				// Well the record with id mPcId doesn't seem to be in the akonadi
 				// resource any more so it is deleted.
 				AkonadiRecord* ar = createDeletedAkonadiRecord( mPcId );
+				ar->setDummy();
 				Q_ASSERT( ar->isDeleted() );
 				Q_ASSERT( ar->isModified() );
 				Q_ASSERT( ar->id() == mPcId );
@@ -170,20 +172,17 @@
 
 /* Protected methods */
 
-static qint64 newId = -1;
-
 QString AkonadiDataProxy::generateUniqueId()
 {
 	FUNCTIONSETUP;
-	
-	newId--;
-	return QString::number( newId );
+
+	return QString::number( d->fNextTempId-- );
 }
 
 bool AkonadiDataProxy::commitCreate( Record *rec )
 {
 	FUNCTIONSETUP;
-	
+
 	AkonadiRecord* aRec = static_cast<AkonadiRecord*>( rec );
 	Akonadi::ItemCreateJob* job = new Akonadi::ItemCreateJob( aRec->item()
 		, Akonadi::Collection( d->fCollectionId ) );
@@ -205,7 +204,7 @@
 bool AkonadiDataProxy::commitUpdate( Record *rec )
 {
 	FUNCTIONSETUP;
-	
+
 	AkonadiRecord* aRec = static_cast<AkonadiRecord*>( rec );
 	Akonadi::ItemModifyJob* job = new Akonadi::ItemModifyJob( aRec->item() );
 
Index: kpilot/conduits/akonadibase/akonadirecord.cc
===================================================================
--- kpilot/conduits/akonadibase/akonadirecord.cc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/akonadibase/akonadirecord.cc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -47,8 +47,13 @@
 	d->fItem = item;
 	d->fLastSyncDateTime = lastSync.toUTC(); // Item times are saved in UTC time.
 	d->fDeleted = false;
+	d->fDummy = false;
 }
 
+/**
+ * This ctor is _only_ used for dummy records which are temporarily used to delete
+ * data.
+ */
 AkonadiRecord::AkonadiRecord( const QString& id ) : d( new AkonadiRecordPrivate )
 {
 	d->fTempId = id;
@@ -122,6 +127,11 @@
 	d->fItem = item;
 	// Make sure that we return the right id after updating the itemobject.
 	setId( QString::number( item.id() ) );
+	/**
+	 * Assuming we're being passed a valid item to use, make sure fDummy
+	 * is not still false after this.
+	 */
+	setDummy( false );
 }
 
 void AkonadiRecord::synced()
@@ -130,9 +140,17 @@
 	// Nothing to do here.
 }
 
+void AkonadiRecord::setDummy(bool dummy)
+{
+	FUNCTIONSETUPL(5);
+	DEBUGKPILOT << "dummy: " << dummy;
+	d->fDummy = dummy;
+}
+
 bool AkonadiRecord::isValid() const
 {
 	FUNCTIONSETUPL(5);
 	bool valid = ! d->fDummy;
+	DEBUGKPILOT << "valid: " << valid;
 	return valid;
 }
Index: kpilot/conduits/akonadibase/akonadirecord.h
===================================================================
--- kpilot/conduits/akonadibase/akonadirecord.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/akonadibase/akonadirecord.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -103,6 +103,12 @@
 	 */
 	/* virtual */ bool isValid() const;
 
+	/**
+	  * Explicit set of whether this is a dummy (intended only for delete)
+	  * record.
+	  */
+	void setDummy( bool dummy = true );
+
 private:
 	QSharedDataPointer<AkonadiRecordPrivate> d;
 };
Index: kpilot/conduits/todo/todoakonadirecord.cc
===================================================================
--- kpilot/conduits/todo/todoakonadirecord.cc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/todo/todoakonadirecord.cc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -36,6 +36,8 @@
 TodoAkonadiRecord::TodoAkonadiRecord( const Akonadi::Item& i, const QDateTime& dt )
 	: AkonadiRecord( i, dt )
 {
+	FUNCTIONSETUPL(5);
+	DEBUGKPILOT << toString();
 }
 
 TodoAkonadiRecord::TodoAkonadiRecord( const QString& id ) : AkonadiRecord( id )
@@ -104,5 +106,13 @@
 
 QString TodoAkonadiRecord::toString() const
 {
-	return QString();
+	boost::shared_ptr<KCal::Todo> todo
+		= boost::dynamic_pointer_cast<KCal::Todo, KCal::Incidence>(
+		item().payload<IncidencePtr>() );
+
+	QString desc =
+		QString("TodoAkonadiRecord. Summary: [%1]")
+		.arg(todo->summary());
+
+	return desc;
 }
Index: kpilot/conduits/todo/todoconduit.cc
===================================================================
--- kpilot/conduits/todo/todoconduit.cc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/todo/todoconduit.cc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -62,12 +62,62 @@
 	KPILOT_DELETE( d );
 }
 
+static int mapHHPriorityToPC( int hhPriority )
+{
+	FUNCTIONSETUPL(5);
+	
+	int pcPriority;
+
+	if( 1 <= hhPriority && hhPriority <= 5 )
+	{
+		pcPriority =  2 * hhPriority - 1;
+	}
+	else
+	{
+		// hhPriority out of range so set pcPriority to undefined value
+		WARNINGKPILOT << "HH Priority (" << hhPriority << ") not in range 1..5";
+		pcPriority = 0;
+	}
+
+	DEBUGKPILOT << "hhPriority=" << hhPriority << ", pcPriority=" << pcPriority;
+
+	return pcPriority;
+}
+
+static int mapPCPriorityToHH( int pcPriority )
+{
+	FUNCTIONSETUPL(5);
+	
+	int hhPriority;
+	
+	if( 1 <= pcPriority && pcPriority <= 9 )
+	{
+		hhPriority = (pcPriority + 1) / 2;
+	}
+	else if( pcPriority == 0 )
+        {
+		// force unspecified pc priority to lowest hh priority
+		hhPriority = 5;
+        }
+	else
+	{
+		// pcPriority out of range, so set hh priority to lowest valid valud
+		WARNINGKPILOT << "pcPriority (" << pcPriority << ") not in range 0..9";
+		hhPriority = 5;
+	}
+	
+	DEBUGKPILOT << "pcPriority=" << pcPriority << "hhPriority=" << hhPriority;
+	
+	return hhPriority;
+}
+
 void TodoConduit::loadSettings()
 {
 	FUNCTIONSETUP;
 	
 	TodoSettings::self()->readConfig();
 	d->fCollectionId = TodoSettings::akonadiCollection();
+	d->fPrevCollectionId = TodoSettings::prevAkonadiCollection();
 }
 
 bool TodoConduit::initDataProxies()
@@ -108,7 +158,7 @@
 	fHHDataProxy->loadAllRecords();
 	fBackupDataProxy = new TodoHHDataProxy( fLocalDatabase );
 	fBackupDataProxy->loadAllRecords();
-	fPCDataProxy->loadAllRecords();
+	//fPCDataProxy->loadAllRecords();
 	
 	return true;
 }
@@ -147,7 +197,7 @@
 	// due date is set.
 	else if( pcTodo->hasDueDate() != !hhTodo.getIndefinite() )
 	{
-		DEBUGKPILOT << "On has and other does not have due date. PC[" 
+		DEBUGKPILOT << "One has and other does not have due date. PC[" 
 			<< pcTodo->hasDueDate() << "], HH[" << !hhTodo.getIndefinite() << ']';
 		dueDateEqual = false;
 	}
@@ -157,8 +207,9 @@
 		dueDateEqual = true;
 	}
 	
-	
-	// TODO: Do some mapping for the priority.
+	// Priorities are equal if the pc priority maps correctly to the hh priority
+	bool priorityEqual = mapPCPriorityToHH( pcTodo->priority() ) == hhTodo.getPriority();
+
 	// TODO: Do some mapping for the completed percentage.
 	
 	DEBUGKPILOT << "descriptionEqual: " << descriptionEqual;
@@ -166,12 +217,14 @@
 	DEBUGKPILOT << "categoriesEqual: " << categoriesEqual;
 	DEBUGKPILOT << "dueDateEqual: " << dueDateEqual;
 	DEBUGKPILOT << "completeEqual: " << completeEqual;
+	DEBUGKPILOT << "priorityEqual: " << priorityEqual;
 	
 	return descriptionEqual
 		&& noteEqual
 		&& categoriesEqual
 		&& dueDateEqual
-		&& completeEqual;
+		&& completeEqual
+		&& priorityEqual;
 }
 
 Record* TodoConduit::createPCRecord( const HHRecord *hhRec )
@@ -221,9 +274,10 @@
 		hhTo.setIndefinite( 1 );
 	}
 
-	// TODO: Map priority of KCal::Todo to PilotTodoEntry
-	// hhTo.setPriority( todo->priority() );
+	// Map priority from PC to HH
+	hhTo.setPriority( mapPCPriorityToHH( pcFrom->priority() ) );
 
+	// Set Completed
 	hhTo.setComplete( pcFrom->isCompleted() );
 
 	// what we call summary pilot calls description.
@@ -251,7 +305,7 @@
 	
 	pcTo->setSecrecy( hhFrom.isSecret() ? KCal::Todo::SecrecyPrivate : KCal::Todo::SecrecyPublic );
 
-	if ( hhFrom.getIndefinite() )
+	if( hhFrom.getIndefinite() )
 	{
 		pcTo->setHasDueDate( false );
 	}
@@ -261,9 +315,10 @@
 		pcTo->setHasDueDate( true );
 	}
 
-	// PRIORITY //
-	// TODO: e->setPriority(de->getPriority());
-	
+	// Map priority from HH to PC
+	pcTo->setPriority( mapHHPriorityToPC( hhFrom.getPriority() ) );
+
+	// Properly set the completion state
 	if( hhFrom.getComplete() && !pcTo->hasCompletedDate() )
 	{
 		pcTo->setCompleted( KDateTime::currentLocalDateTime() );
Index: kpilot/conduits/todo/kpilot-conduit-todo.desktop
===================================================================
--- kpilot/conduits/todo/kpilot-conduit-todo.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/todo/kpilot-conduit-todo.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -20,6 +20,7 @@
 Comment[pl]=Ten ≈ÇƒÖcznik synchronizuje zadania z palmtopa z zadaniami Akonadi.
 Comment[pt]=Esta conduta sincroniza a base de dados de itens por-fazer com uma Colec√ß√£o de Itens Por-Fazer do Akonadi.
 Comment[pt_BR]=Esta conduta sincroniza a base de dados das pend√™ncias com uma cole√ß√£o de pend√™ncias do Akonadi.
+Comment[sl]=Ta veznik usklajuje opravila na roƒçnem raƒçunalniku z Akonadijevo zbirko opravil.
 Comment[sv]=Den h√§r kanalen synkroniserar handdatorns uppgiftsdatabas med en Akonadi uppgiftssamling.
 Comment[tr]=Bu kanal el bilgisayarƒ±nƒ±zdaki yapƒ±lacak √∂geleri ile bilgisayarƒ±nƒ±zdaki Akonadi Yapƒ±lacak √ñgeleri Koleksiyonunu e≈üzamanlar.
 Comment[uk]=–¶–µ–π –∞–∫–≤–µ–¥—É–∫ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î –±–∞–∑—É –¥–∞–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å –∫–∏—à–µ–Ω—å–∫–æ–≤–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é –∑—ñ –∑–±—ñ—Ä–∫–æ—é –∑–∞–≤–¥–∞–Ω—å Akonadi.
Index: kpilot/conduits/todo/todofactory.cc
===================================================================
--- kpilot/conduits/todo/todofactory.cc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/todo/todofactory.cc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1,6 +1,6 @@
 /* KPilot
 **
-** Copyright (C) 2008 by Dan Pilone <pilone@slac.com>
+** Copyright (C) 2008 - 2009 by Bertjan Broeksema <b.broeksema@home.nl>
 **
 ** This file defines the factory for the abbrowser-conduit plugin.
 */
Index: kpilot/conduits/todo/todohhrecord.cc
===================================================================
--- kpilot/conduits/todo/todohhrecord.cc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/todo/todohhrecord.cc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -30,9 +30,12 @@
 
 #include "options.h"
 
-TodoHHRecord::TodoHHRecord( PilotRecord *record, const QString &category ) 
+TodoHHRecord::TodoHHRecord( PilotRecord *record, const QString &category )
 	: HHRecord( record, category )
 {
+	FUNCTIONSETUPL(5);
+	DEBUGKPILOT << "id: [" << id() << "], description: [" << toString() << "]";
+
 }
 
 bool TodoHHRecord::equal( const HHRecord* other ) const
@@ -80,3 +83,9 @@
 	
 	return PilotTodoEntry( fRecord );
 }
+
+QString TodoHHRecord::toString() const
+{
+	PilotTodoEntry tde = todoEntry();
+	return tde.getDescription();
+}
Index: kpilot/conduits/todo/todohhrecord.h
===================================================================
--- kpilot/conduits/todo/todohhrecord.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/todo/todohhrecord.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -45,6 +45,12 @@
 	void setTodoEntry( const PilotTodoEntry& entry, bool keepPrevCategory = true );
 	
 	PilotTodoEntry todoEntry() const;
+
+	/**
+	 * Returns a string presentation of this record.
+	 */
+	/* virtual */ QString toString() const;
+
 };
 
 #endif
Index: kpilot/conduits/calendar/calendarakonadirecord.cc
===================================================================
--- kpilot/conduits/calendar/calendarakonadirecord.cc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/calendar/calendarakonadirecord.cc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -141,14 +141,28 @@
 			(
 				item().payload<IncidencePtr>()
 			);
-	bool check = (!event->summary().isEmpty() &&
-		      event->dtStart().dateTime().isValid() &&
-		      event->dtEnd().dateTime().isValid());
+	unsigned int validChecks = 0;
+	bool myCheck = (!event->summary().isEmpty() &&
+			event->dtStart().dateTime().isValid() &&
+			event->dtEnd().dateTime().isValid());
 	DEBUGKPILOT << toString();
-	DEBUGKPILOT << "my checks: " << check;
+	DEBUGKPILOT << "my checks: " << myCheck;
+	if ( myCheck ) ++validChecks;
+
 	bool parentCheck = AkonadiRecord::isValid();
-	DEBUGKPILOT << "parent check: " << parentCheck;
-	DEBUGKPILOT << "returning: " << (check && parentCheck);
+	DEBUGKPILOT << "parent check: " << parentCheck << ", myCheck: " << myCheck;
+	if ( parentCheck ) ++validChecks;
 
-	return (check && parentCheck);
+	/*
+	 * For some inexplicable reason, myCheck == true, and parentCheck == true,
+	 * but (myCheck && parentCheck) == false earlier. We know that at this point
+	 * we should have 2 things that are true, so use an int to get around
+	 * this weirdness for the time being. At this point, something like this is
+	 * preferable to data loss, which we do hit if isValid() returns false when
+	 * it should be true.
+	 */
+	// TODO: Figure out how (true && true) can be false =:/
+	DEBUGKPILOT << "returning: " << ( validChecks == 2 );
+
+	return ( validChecks == 2 );
 }
Index: kpilot/conduits/calendar/calendarconduit.cc
===================================================================
--- kpilot/conduits/calendar/calendarconduit.cc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/calendar/calendarconduit.cc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -156,7 +156,16 @@
 	TEST( pcEvent->dtStart().dateTime().toLocalTime(), hhEntry.dtStart(), "dtStart" )
 	if( !hhEntry.doesFloat() && !hhEntry.isMultiDay() )
 	{
-		TEST( pcEvent->dtEnd().dateTime().toLocalTime(), hhEntry.dtEnd(), "dtEnd" )
+		// Handle midnight palm bug (http://bugs.kde.org/show_bug.cgi?id=183631)
+		QTime time = pcEvent->dtEnd().dateTime().toLocalTime().time();
+		if ( pcEvent->recurs() && time.hour() == 0 && time.minute() == 0 )
+		{
+			QDateTime pcDt = pcEvent->dtEnd().dateTime().toLocalTime();
+			pcDt.setDate(pcDt.date().addDays(-1));
+			TEST( pcDt, hhEntry.dtEnd(), "dtEnd" )
+		}
+		else
+			TEST( pcEvent->dtEnd().dateTime().toLocalTime(), hhEntry.dtEnd(), "dtEnd" )
 	}
 	
 	TEST( pcEvent->isAlarmEnabled(), hhEntry.isAlarmEnabled(), "HasAlarm" )
@@ -198,6 +207,9 @@
 			{
 				QDateTime hhDt = hhEntry.dtEnd();
 				QDateTime pcDt = pcEvent->dtEnd().dateTime().toLocalTime();
+				if (hhDt.time().hour() == 0 && hhDt.time().minute() == 0)
+					pcDt.setDate(pcDt.date().addDays(-1));
+
 				TEST( hhDt, pcDt, "DtEventEnd" );
 			}
 		}
@@ -609,20 +621,55 @@
 		
 	case KCal::Recurrence::rMonthlyPos:
 		// Palm: Day=0(sun)-6(sat); week=0-4, 4=last week; pos=week*7+day
-		// libkcal: day=bit0(mon)-bit6(sun); week=-5to-1(from end) and 1-5 (from beginning)
+		// libkcal: day=1(mon)-7(sun); week=-5to-1(from end) and 1-5 (from beginning)
 		// PC->Palm: pos=week*7+day
 		//  week: if w=-1 -> week=4, else week=w-1
-		//  day: day=(daybit+1)%7  (rotate because of the different offset)
+		//  day: palmday=kcalday %7 (adjust for Sunday being different between palm and libkcal)
 		de->setRepeatType( repeatMonthlyByDay );
 		if (r->monthPositions().count()>0)
 		{
 			// Only take the first monthly position, as the palm allows only one
 			KCal::RecurrenceRule::WDayPos mp = r->monthPositions().first();
 			int week = mp.pos();
-			int day = ( mp.day() + 1 ) % 7; // rotate because of different offset
+			int day = mp.day() % 7;
 			// turn to 0-based and include starting from end of month
-			// TODO: We don't handle counting from the end of the month yet!
-			if( week == -1 ) week = 4; else week--;
+			if( week > 0 )
+			{
+				week--;
+			}
+			else if( week == -1 )
+			{
+				// Handle last week of the month occurrence
+				week = 4;
+			}
+			else if( week < 0 )
+			{
+				// TODO: Handle counting from the end of the month better.  The following
+				// code implements the following mapping, which works for when the recurrent
+				// day occurs 4 times in the month; when the day occurs 5 times in a month, the
+				// recurrence appears 1 week early.
+				// kcal=-2 (second from last) => palm 2 (week 3)
+				// kcal=-3 (third from last) => palm 1 (week 2)
+				// kcal=-4 (fourth from last) => palm 0 (week 1)
+				// kcal=-5 (fifth from last) => palm 0 (week 1)
+				DEBUGKPILOT << "Recurring event from end of month, week (from PC) =" << week;
+				if( week > -5)
+				{
+					week += 4;
+				}
+				else
+				{
+					week = 0;
+				}
+			}
+			else
+			{
+				// if none of the cases above are executed week==0.  I'm not sure what this would 
+				// mean but for now let's leave it alone, meaning that the occurrence on the palm 
+				// will be during the first week of the month.
+				DEBUGKPILOT << "Week (from PC) is 0.  Leaving it alone.";
+			}
+
 			de->setRepeatDay( static_cast<DayOfMonthType>( 7 * week + day ) );
 		}
 		break;
Index: kpilot/conduits/calendar/kpilot-conduit-calendar.desktop
===================================================================
--- kpilot/conduits/calendar/kpilot-conduit-calendar.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/calendar/kpilot-conduit-calendar.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -21,6 +21,7 @@
 Comment[pl]=Ten ≈ÇƒÖcznik synchronizuje kalendarz palmtopa z kalendarzem Akonadi.
 Comment[pt]=Esta conduta sincroniza a base de dados do calend√°rio com uma Colec√ß√£o de Calend√°rio do Akonadi.
 Comment[pt_BR]=Esta conduta sincroniza a base de dados do calend√°rio com uma cole√ß√£o de calend√°rio do Akonadi.
+Comment[sl]=Ta veznik usklajuje koledar na roƒçnem raƒçunalniku z Akonadijevo zbirko koledarjev.
 Comment[sv]=Den h√§r kanalen synkroniserar handdatorns kalenderdatabas med en Akonadi kalendersamling.
 Comment[tr]=Bu kanal el bilgisayarƒ±nƒ±zdaki takvim ile bilgisayarƒ±nƒ±zdakini e≈üzamanlar.
 Comment[uk]=–¶–µ–π –∞–∫–≤–µ–¥—É–∫ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î –±–∞–∑—É –¥–∞–Ω–∏—Ö –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∫–∏—à–µ–Ω—å–∫–æ–≤–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é –∑—ñ –∑–±—ñ—Ä–∫–æ—é –∫–∞–ª–µ–Ω–¥–∞—Ä—è Akonadi.
Index: kpilot/conduits/calendar/calendarhhrecord.cc
===================================================================
--- kpilot/conduits/calendar/calendarhhrecord.cc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/calendar/calendarhhrecord.cc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -30,9 +30,12 @@
 
 #include "options.h"
 
-CalendarHHRecord::CalendarHHRecord( PilotRecord *record, const QString &category ) 
+CalendarHHRecord::CalendarHHRecord( PilotRecord *record, const QString &category )
 	: HHRecord( record, category )
 {
+	FUNCTIONSETUPL(5);
+	DEBUGKPILOT << "id: [" << id() << "], description: [" << toString() << "]";
+
 }
 
 PilotDateEntry CalendarHHRecord::dateEntry() const
Index: kpilot/conduits/base/hhdataproxy.cc
===================================================================
--- kpilot/conduits/base/hhdataproxy.cc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/base/hhdataproxy.cc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -38,7 +38,7 @@
 #include "hhrecord.h"
 
 HHDataProxy::HHDataProxy( PilotDatabase *db ) : fDatabase( db )
-	, fLastUsedUniqueId( 0L ), fAppInfo( 0L )
+	, fLastUsedUniqueId( 0L ), fAppInfo( 0L ), fNextTempId( -1 )
 {
 }
 
@@ -182,21 +182,12 @@
 	}
 }
 
+
 QString HHDataProxy::generateUniqueId()
 {
-	recordid_t id = 0;
+	FUNCTIONSETUP;
 
-	QList<QString> ids = fRecords.keys();
-
-	for( int i = 0; i < fRecords.size(); ++i )
-	{
-		if( ids.at( i ).toULong() > id )
-		{
-			id = ids.at( i ).toULong();
-		}
-	}
-
-	return QString::number( id + 1 );
+	return QString::number( fNextTempId-- );
 }
 
 
Index: kpilot/conduits/base/hhdataproxy.h
===================================================================
--- kpilot/conduits/base/hhdataproxy.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/base/hhdataproxy.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -154,5 +154,6 @@
 	QList<recordid_t> fResettedRecords;
 	PilotAppInfoBase *fAppInfo;
 	QMap<uint, QString> fAddedCategories;
+	qint64 fNextTempId;
 };
 #endif
Index: kpilot/conduits/base/hhrecord.cc
===================================================================
--- kpilot/conduits/base/hhrecord.cc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/base/hhrecord.cc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -45,7 +45,7 @@
 PilotRecord* HHRecord::pilotRecord() const
 {
 	FUNCTIONSETUP;
-	
+
 	return fRecord;
 }
 
@@ -69,24 +69,40 @@
 
 const QString HHRecord::id() const
 {
-	return QString::number( fRecord->id() );
+	if( fTempId.isEmpty() )
+	{
+		return QString::number( fRecord->id() );
+	}
+	else
+	{
+		return fTempId;
+	}
 }
 
 void HHRecord::setId( const QString &id )
 {
 	FUNCTIONSETUP;
-	
-	bool converted;
-	recordid_t rid = id.toULong( &converted );
-	
-	if( !converted )
+
+	// ids < 0 are temporary ids
+	if( id.toLongLong() < 0 )
 	{
-		DEBUGKPILOT <<"Could not convert " << id << " to ulong. Id not set!";
-		return;
+		fTempId = id;
 	}
 	else
 	{
-		fRecord->setID( rid );
+		bool converted;
+		recordid_t rid = id.toULong( &converted );
+
+		if( !converted )
+		{
+			DEBUGKPILOT <<"Could not convert " << id << " to ulong. Id not set!";
+			return;
+		}
+		else
+		{
+			fTempId.clear();
+			fRecord->setID( rid );
+		}
 	}
 }
 
Index: kpilot/conduits/base/hhrecord.h
===================================================================
--- kpilot/conduits/base/hhrecord.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/base/hhrecord.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -37,7 +37,8 @@
 protected:
 	PilotRecord *fRecord;
 	QString fCategory;
-	
+	QString fTempId;
+
 public:
 	HHRecord( PilotRecord *record, const QString &category );
 
Index: kpilot/conduits/base/recordconduit.cc
===================================================================
--- kpilot/conduits/base/recordconduit.cc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/base/recordconduit.cc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -865,18 +865,28 @@
 	}
 	else if( hhRecord )
 	{
-		// Case: 6.5.2 or 6.5.8
-		// Warning id is a temporary id. Only after commit we know what id is
-		// assigned to the record. So on commit the proxy should get the mapping
-		// so that it can change the mapping.
-		DEBUGKPILOT << "Case 6.5.2 and 6.5.8";
-		pcRecord = createPCRecord( hhRecord );
-		QString id = fPCDataProxy->create( pcRecord );
-		fMapping.map( hhRecord->id(), id );
-		copyCategory( hhRecord, pcRecord );
+		if( !hhRecord->isDeleted() )
+		{
+			// Case: 6.5.2 or 6.5.8
+			// Warning id is a temporary id. Only after commit we know what id is
+			// assigned to the record. So on commit the proxy should get the mapping
+			// so that it can change the mapping.
+
+			DEBUGKPILOT << "Case 6.5.2 and 6.5.8";
+			pcRecord = createPCRecord( hhRecord );
+			QString id = fPCDataProxy->create( pcRecord );
+			fMapping.map( hhRecord->id(), id );
+			copyCategory( hhRecord, pcRecord );
 		
-		pcRecord->synced();
-		hhRecord->synced();
+			pcRecord->synced();
+			hhRecord->synced();
+		}
+		else
+		{
+			// Case: 6.5.18
+			DEBUGKPILOT << "Case 6.5.18";
+			fHHDataProxy->remove( hhRecord->id() );
+                }
 	}
 	else if( pcRecord )
 	{
@@ -927,12 +937,30 @@
 		}
 		else
 		{
-			// Keep pcRecord. The hhRecord is changed so undo that changes.
-			copy( pcRecord, hhRecord );
-			fHHDataProxy->update( hhRecord->id(), hhRecord );
-			// Both records are in sync so they are no longer modified.
-			hhRecord->synced();
-			pcRecord->synced();
+			if( !hhRecord->isDeleted() )
+			{
+				// Keep pcRecord. The hhRecord is changed so undo that change.
+				copy( pcRecord, hhRecord );
+				fHHDataProxy->update( hhRecord->id(), hhRecord );
+				// Both records are in sync so they are no longer modified.
+				hhRecord->synced();
+				pcRecord->synced();
+			}
+			else
+			{
+				// hhRecord is deleted
+				// Break the current mapping between hh record and pc record
+				fMapping.removeHHId( hhRecord->id() );
+
+				// now remove the hh record
+				fHHDataProxy->remove( hhRecord->id() );
+
+				// create a new hhRecord and adjust mappings, etc.
+				HHRecord *hhRec = createHHRecord( pcRecord );
+				fHHDataProxy->create( hhRec );
+				fMapping.map( hhRec->id(), pcRecord->id() );
+				copyCategory( pcRecord, hhRec );
+			}
 		}
 	}
 	else
@@ -954,12 +982,30 @@
 		}
 		else
 		{
-			// Keep hhRecord. The pcRecord is changed so undo that changes.
-			copy( hhRecord, pcRecord );
-			fPCDataProxy->update( pcRecord->id(), pcRecord );
-			// Both records are in sync so they are no longer modified.
-			hhRecord->synced();
-			pcRecord->synced();
+			if( !pcRecord->isDeleted() )
+			{
+				// Keep hhRecord. The pcRecord is changed so undo that change.
+				copy( hhRecord, pcRecord );
+				fPCDataProxy->update( pcRecord->id(), pcRecord );
+				// Both records are in sync so they are no longer modified.
+				hhRecord->synced();
+				pcRecord->synced();
+			}
+			else
+			{
+				// pcRecord is deleted
+				// Break the current mapping between hh record and (dummy) pc record
+				fMapping.removeHHId( hhRecord->id() );
+
+				// now remove the dummy pc record
+				fPCDataProxy->remove( pcRecord->id() );
+
+				// create a new pcRecord and adjust mappings, etc.
+				Record *pcRec = createPCRecord( hhRecord );
+				fPCDataProxy->create( pcRec );
+				fMapping.map( hhRecord->id(), pcRec->id() );
+				copyCategory( hhRecord, pcRec );
+			}
 		}
 	}
 }
Index: kpilot/conduits/base/idmappingxmlsource.cc
===================================================================
--- kpilot/conduits/base/idmappingxmlsource.cc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/base/idmappingxmlsource.cc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -268,7 +268,7 @@
 	}
 	
 	QFile file( d->fPath );
-	if( file.open( QIODevice::ReadWrite ) )
+	if( file.open( QIODevice::WriteOnly | QIODevice::Truncate) )
 	{
 		QTextStream out( &file );
 		doc.save( out, 4 );
Index: kpilot/conduits/base/dataproxy.cc
===================================================================
--- kpilot/conduits/base/dataproxy.cc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/base/dataproxy.cc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -38,46 +38,46 @@
 DataProxy::~DataProxy()
 {
 	FUNCTIONSETUP;
-	
+
 	qDeleteAll( fRecords );
 }
 
 QString DataProxy::create( Record *record )
 {
 	FUNCTIONSETUP;
-	
+
 	// Temporary id.
 	QString uniqueId = generateUniqueId();
-	
+
 	// Make sure that the new record has the right id and add the record.
 	record->setId( uniqueId );
-	
-	DEBUGKPILOT << "Record created with id: [" << uniqueId << "]";
-	
+
+	DEBUGKPILOT << "Record created with id: [" << uniqueId << "], description: [" << record->toString() << "]";
+
 	fRecords.insert( uniqueId, record );
-	
+
 	// Update rollback/volatility information.
 	fCreated.insert( uniqueId, false );
 	fCounter.created();
-	
+
 	return uniqueId;
 }
 
 void DataProxy::remove( const QString &id )
 {
 	FUNCTIONSETUP;
-	
+
 	Record *rec = fRecords.value( id );
 	if( rec == 0L )
 	{
 		// No record
 		return;
 	}
-	
-	DEBUGKPILOT << "Removing record id: [" << id << "]";
+
+	DEBUGKPILOT << "Removing record id: [" << id << "], description: [" << rec->toString() << "]";
 	// Remove record.
 	fRecords.remove( id );
-	
+
 	// Update rollback/volatility information.
 	fDeletedRecords.insert( rec->id(), rec );
 	fDeleted.insert( rec->id(), false );
@@ -87,7 +87,7 @@
 void DataProxy::update( const QString &id, Record *newRecord )
 {
 	FUNCTIONSETUP;
-	
+
 	Record *oldRecord = fRecords.value( id );
 	if( oldRecord == 0L )
 	{
@@ -100,7 +100,7 @@
 	// Make sure that the new record has the right id and update the old record.
 	newRecord->setId( id );
 	fRecords.insert( id, newRecord );
-	
+
 	// Update rollback/volatility information.
 	fOldRecords.insert( id, oldRecord );
 	fCounter.updated();
@@ -114,21 +114,21 @@
 const CUDCounter* DataProxy::counter() const
 {
 	FUNCTIONSETUP;
-	
+
 	return &fCounter;
 }
 
 void DataProxy::setEndcount()
 {
 	FUNCTIONSETUP;
-	
+
 	fCounter.setEndCount( fRecords.size() );
 }
 
 void DataProxy::setIterateMode( const Mode m )
 {
 	FUNCTIONSETUP;
-	
+
 	fMode = m;
 }
 
@@ -151,7 +151,7 @@
 bool DataProxy::hasNext() const
 {
 	FUNCTIONSETUP;
-	
+
 	if( fMode == All )
 	{
 		return fIterator.hasNext();
@@ -198,15 +198,15 @@
 bool DataProxy::commit()
 {
 	FUNCTIONSETUP;
-	
+
 	// Commit created records.
 	QStringListIterator it( fCreated.keys() );
-	
+
 	DEBUGKPILOT << "Committing: [" << fCreated.size() << "] records.";
-	
+
 	// Reset the map
 	fCreated.clear();
-	
+
 	while( it.hasNext() )
 	{
 		QString id = it.next();
@@ -222,9 +222,10 @@
 				// Commit failed.
 				return false;
 			}
-			
+
 			// Commit succeeded.
-			
+
+			DEBUGKPILOT << "Record with tempId " << id << " committed with permId " << rec->id();
 			// Put the record with the new id in.
 			if( rec->id() != id )
 			{
@@ -233,7 +234,7 @@
 				
 				fRecords.remove( id );
 				fRecords.insert( rec->id(), rec );
-			
+
 				fChangedIds.insert( id, rec->id() );
 			}
 			else
@@ -249,17 +250,17 @@
 	
 	// Commit updated records.
 	DEBUGKPILOT << "Updating: [" << fOldRecords.size() << "] records.";
-	
+
 	QListIterator<Record*> i( fOldRecords.values() );
 	while( i.hasNext() )
 	{
 		// i.next() contains the old values.
 		Record *oldRec = i.next();
 		QString id = oldRec->id();
-		
+
 		// Look up the new values
 		Record *rec = find( id );
-		
+
 		if( rec && !fCreated.value( id ) )
 		{
 			if( !commitUpdate( rec ) )
@@ -267,11 +268,11 @@
 				// Commit failed.
 				return false;
 			}
-			
+
 			// Commit succeeded.
-			
+
 			QString newId = rec->id();
-			
+
 			if( newId != id )
 			{
 				oldRec->setId( newId );
@@ -284,7 +285,7 @@
 	
 	// Commit deleted records
 	DEBUGKPILOT << "Deleting: [" << fDeletedRecords.size() << "] records.";
-	
+
 	i = QListIterator<Record*>( fDeletedRecords.values() );
 	while( i.hasNext() )
 	{
@@ -300,13 +301,13 @@
 				// Commit failed.
 				return false;
 			}
-			
+
 			// Commit succeeded.
-			
+
 			fDeleted.insert( oldRec->id(), true );
 		}
 	}
-	
+
 	// Give implementing classes the change to do things if necessary.
 	return _commit();
 }
@@ -314,28 +315,28 @@
 bool DataProxy::rollback()
 {
 	FUNCTIONSETUP;
-	
+
 	// Delete committed new records.
 	QStringListIterator it( fCreated.keys() );
-	
+
 	while( it.hasNext() )
 	{
 		QString id = it.next();
-		
+
 		// Only undo creates that are committed.
 		Record *rec = find( id );
 		if( rec && fCreated.value( id ) )
 		{
 			DEBUGKPILOT << "Deleting created record: [" << rec->id() << "].";
-			
+
 			commitDelete( rec );
 			fCreated.insert( rec->id(), false );
 		}
 	}
-	
+
 	// Reset the map
 	fCreated.clear();
-	
+
 	// Undo changes to updated records.
 	QListIterator<Record*> i( fOldRecords.values() );
 	while( i.hasNext() )
@@ -344,47 +345,47 @@
 		if( fUpdated.value( oldRec->id() ) )
 		{
 			DEBUGKPILOT << "Restoring changed record: [" << oldRec->id() << "].";
-			
+
 			QString oldId = oldRec->id();
 			commitUpdate( oldRec );
-			
+
 			// Id might have changed
 			if( oldRec->id() != oldId )
 			{
 				fUpdated.remove( oldId );
-				
+
 				fChangedIds.insert( oldId, oldRec->id() );
 			}
-			
+
 			fUpdated.insert( oldRec->id(), false );
 		}
 	}
-	
+
 	// Restore deleted records.
 	i = QListIterator<Record*>( fDeletedRecords.values() );
 	while( i.hasNext() )
 	{
 		Record *oldRec = i.next();
-		
+
 		if( fDeleted.value( oldRec->id() ) )
 		{
 			DEBUGKPILOT << "Restoring deleted record: [" << oldRec->id() << "].";
-		
+
 			QString oldId = oldRec->id();
 			commitCreate( oldRec );
-			
+
 			// Id might have changed
 			if( oldRec->id() != oldId )
 			{
 				fDeleted.remove( oldId );
-				
+
 				fChangedIds.insert( oldId, oldRec->id() );
 			}
-			
+
 			fDeleted.insert( oldRec->id(), false );
 		}
 	}
-	
+
 	// Give implementing classes the change to rollback things if necessary.
 	return _rollback();
 }
Index: kpilot/conduits/base/tests/rchotsynchhtest.cc
===================================================================
--- kpilot/conduits/base/tests/rchotsynchhtest.cc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/base/tests/rchotsynchhtest.cc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -229,9 +229,10 @@
 	U = cudPC->countUpdated();
 	D = cudPC->countDeleted();
 	
-	QCOMPARE( C, 2 ); // 6.5.{2, 8}
-	QCOMPARE( U, 4 ); // 6.5.{3, 9, 11, 16}
-	QCOMPARE( D, 5 ); // 6.5.{4, 10, 12, 15, 16}
+	QCOMPARE( C, 3 ); // 6.5.{2, 8, 11}
+	QCOMPARE( U, 3 ); // 6.5.{3, 9, 16}
+	QCOMPARE( D, 6 ); // 6.5.{4, 10, 11, 12, 15, 16}
+
 }
 
 void RCHotSyncHHTest::testCase_6_5_1()
Index: kpilot/conduits/base/tests/rcfullsynchhtest.cc
===================================================================
--- kpilot/conduits/base/tests/rcfullsynchhtest.cc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/base/tests/rcfullsynchhtest.cc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -196,9 +196,10 @@
 	U = cudPC->countUpdated();
 	D = cudPC->countDeleted();
 	
-	QCOMPARE( C, 3 ); // 6.5.{2, 8, 13}
-	QCOMPARE( U, 6 ); // 6.5.{3, 9, 11, 16, 19, 20}
-	QCOMPARE( D, 5 ); // 6.5.{4, 10, 12, 15, 16}
+	QCOMPARE( C, 4 ); // 6.5.{2, 8, 11, 13}
+	QCOMPARE( U, 5 ); // 6.5.{3, 9, 16, 19, 20}
+	QCOMPARE( D, 6 ); // 6.5.{4, 10, 11, 12, 15, 16}
+
 }
 
 void RCFullSyncHHTest::testCase_6_5_1()
Index: kpilot/conduits/base/design/Use_Case_-_Conduit_Syncing.odt
===================================================================
Nie mo≈ºna wy≈õwietliƒá: plik binarny.
svn:mime-type = application/octet-stream
Index: kpilot/conduits/contacts/kpilot-conduit-contacts.desktop
===================================================================
--- kpilot/conduits/contacts/kpilot-conduit-contacts.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/conduits/contacts/kpilot-conduit-contacts.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -21,6 +21,7 @@
 Comment[pl]=Ten ≈ÇƒÖcznik synchronizuje ksiƒÖ≈ºkƒô adresowƒÖ palmtopa z ksiƒÖ≈ºkƒÖ adresowƒÖ Akonadi.
 Comment[pt]=Esta conduta sincroniza a base de dados do livro de endere√ßos do dispositivo com uma Colec√ß√£o do Akonadi.
 Comment[pt_BR]=Esta conduta sincroniza o livro de endere√ßos do handheld com uma cole√ß√£o do Akonadi.
+Comment[sl]=Ta veznik usklajuje adresar na roƒçnem raƒçunalniku z Akonadijevo zbirko adresarjev.
 Comment[sv]=Den h√§r kanalen synkroniserar handdatorns adressboksdatabas med en Akonadi samling.
 Comment[tr]=Bu kanal, el bilgisayarƒ±nƒ±zdaki adres defteri veritabanƒ± ile bilgisayarƒ±nƒ±zdaki Akonadi koleksiyonunu e≈üzamanlar.
 Comment[uk]=–¶–µ–π –∞–∫–≤–µ–¥—É–∫ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î –±–∞–∑—É –¥–∞–Ω–∏—Ö –∞–¥—Ä–µ—Å–Ω–æ—ó –∫–Ω–∏–≥–∏ –∫–∏—à–µ–Ω—å–∫–æ–≤–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é –∑—ñ –∑–±—ñ—Ä–∫–æ—é Akonadi.
Index: kpilot/kpilot/kpilotdaemon.desktop
===================================================================
--- kpilot/kpilot/kpilotdaemon.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/kpilot/kpilotdaemon.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -2,6 +2,7 @@
 [Desktop Entry]
 Name=KPilotDaemon
 Name[af]=Kpilotdaemon
+Name[ar]=KPilot
 Name[da]=KPilotD√¶mon
 Name[de]=KPilot-Dienst
 Name[el]=ŒîŒ±ŒØŒºŒøŒΩŒ±œÇ KPilot
Index: kpilot/kpilot/hotSync.cc
===================================================================
--- kpilot/kpilot/hotSync.cc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/kpilot/hotSync.cc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -517,7 +517,9 @@
 {
 	if (e->type() == (QEvent::Type)Thread::TerminateOK)
 	{
-		fBackupThread->deleteLater();
+		// delete the thread when it's finished
+		// TODO: figure out why calling deleteLater directly doesn't work
+		QTimer::singleShot(0,fBackupThread,SLOT(deleteLater()));
 		fBackupThread = 0L;
 		// This was a successful termination.
 		addSyncLogEntry( i18n("... OK.\n"), false );
@@ -526,7 +528,9 @@
 	}
 	if (e->type() == (QEvent::Type)Thread::TerminateFailure)
 	{
-		fBackupThread->deleteLater();
+		// delete the thread when it's finished
+		// TODO: figure out why calling deleteLater directly doesn't work
+		QTimer::singleShot(0,fBackupThread,SLOT(deleteLater()));
 		fBackupThread = 0L;
 		// Unsuccessful termination.
 		addSyncLogEntry( i18n("Backup failed.") );
Index: kpilot/lib/options.h
===================================================================
--- kpilot/lib/options.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/lib/options.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -45,7 +45,7 @@
 // Other headers
 #include <iostream>
 
-#define KPILOT_VERSION	"5.2.0 (KDE 4.2.0)"
+#define KPILOT_VERSION	"5.2.1 (KDE 4.2.1)"
 
 extern KDE_EXPORT int debug_level;
 
Index: kpilot/lib/pilotRecord.cc
===================================================================
--- kpilot/lib/pilotRecord.cc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/lib/pilotRecord.cc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -46,7 +46,10 @@
 
 /* virtual */ QString PilotRecordBase::textRepresentation() const
 {
-	return CSL1("[ %1,%2,%3 ]") . arg(attributes(),category(),id());
+	return CSL1("[ %1,%2,%3 ]")
+		.arg( attributes() )
+		.arg( category() )
+		.arg( id() );
 }
 
 /* virtual */ QString PilotRecord::textRepresentation() const
Index: kpilot/Documentation/base-conduit-template/kpilot-conduit-contacts.desktop
===================================================================
--- kpilot/Documentation/base-conduit-template/kpilot-conduit-contacts.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kpilot/Documentation/base-conduit-template/kpilot-conduit-contacts.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -13,6 +13,7 @@
 Comment[it]=Questo condotto sincronizza il portachiavi del tuo palmare con un database archiviato sul PC.
 Comment[ja]=„Åì„ÅÆ„Ç≥„É≥„Ç∏„ÉÉ„Éà„ÅØ„Éè„É≥„Éâ„Éò„É´„Éâ„ÅÆ„Ç≠„Éº„É™„É≥„Ç∞„Éá„Éº„Çø„Éô„Éº„Çπ„Çí PC „ÅÆ„Éá„Éº„Çø„Éô„Éº„Çπ„Å®ÂêåÊúü„Åï„Åõ„Åæ„Åô„ÄÇ
 Comment[km]=conduit syncs ·ûì·üÅ·üá‚Äã·ûò·ûº·ûõ·ûä·üí·ûã·û∂·ûì‚Äã·ûë·û∑·ûì·üí·ûì·ûì·üê·ûô keyring ·ûö·ûî·ûü·üã‚Äã·ûß·ûî·ûÄ·ûö·ûé·üç‚Äã·ûô·ûΩ·ûö·ûä·üÉ‚Äã·ûá·û∂‚Äã·ûò·ûΩ·ûô‚Äã·ûò·ûº·ûõ·ûä·üí·ûã·û∂·ûì‚Äã·ûë·û∑·ûì·üí·ûì·ûì·üê·ûô‚Äã·ûä·üÇ·ûõ‚Äã·ûî·û∂·ûì‚Äã·ûï·üí·ûë·ûª·ûÄ‚Äã·ûì·üÖ‚Äã·ûÄ·üí·ûì·ûª·ûÑ‚Äã·ûÄ·ûª·üÜ·ûñ·üí·ûô·ûº·ûë·üê·ûö¬†·üî
+Comment[lt]=≈†is kanalas sinchronizuoja delninuko rakt≈≥ rato duomen≈≥ bazƒô su duomen≈≥ baze, esanƒçia pc.
 Comment[lv]=≈†ƒ´ ƒ∑ƒìde sinhronizƒì j≈´su rokas datora un datora atslƒìgu sai≈°ƒ∑i.
 Comment[nb]=Denne kanalen synkroniserer h√•nddatorens n√∏kkelring-database med en database lagret p√• maskinen.
 Comment[nds]=Disse Kanaal synkroniseert dat Sl√∂telbund op den Handreekner mit een op den Reekner.
Index: knotes/knoteslegacy.cpp
===================================================================
--- knotes/knoteslegacy.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ knotes/knoteslegacy.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -80,7 +80,6 @@
     double version = grp.readEntry( "version", 1.0 );
     
     if ( version < 3.0 ) {
-      delete test;
       
       // create the new note
       Journal *journal = new Journal();
@@ -109,11 +108,8 @@
                         ( state & NET::KeepAbove ) ? true : false );
 #endif
       grp.deleteEntry( "state" );
-      delete test;
-    }  else {
-      delete test;
     }
-    
+    delete test;
   }
   
   return converted;
Index: knotes/knoteedit.h
===================================================================
--- knotes/knoteedit.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ knotes/knoteedit.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -91,7 +91,8 @@
     
   private slots:
     void slotCurrentCharFormatChanged( const QTextCharFormat & );
-    
+    void slotCutEnabled( bool );
+
   private:
     void autoIndent();
     
Index: knotes/knotesapp.cpp
===================================================================
--- knotes/knotesapp.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ knotes/knotesapp.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -589,8 +589,12 @@
 void KNotesApp::killNote( KCal::Journal *journal )
 {
   // this kills the KNote object
-  delete m_notes.take( journal->uid() );
-  updateNoteActions();
+  KNote *note = m_notes.take( journal->uid() );
+  if ( note )
+  {
+    delete note;
+    updateNoteActions();
+  }
 }
 
 void KNotesApp::acceptConnection()
Index: knotes/knotes_manager.desktop
===================================================================
--- knotes/knotes_manager.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ knotes/knotes_manager.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -2,6 +2,7 @@
 [Desktop Entry]
 Name=Notes
 Name[af]=Notas
+Name[ar]=ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™
 Name[be]=–ó–∞–º–µ—Ç–∫—ñ
 Name[br]=Notenno√π
 Name[cs]=Pozn√°mky
Index: knotes/knoteedit.cpp
===================================================================
--- knotes/knoteedit.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ knotes/knoteedit.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -68,7 +68,7 @@
            redo, SLOT( setEnabled( bool ) ) );
   
   connect( this, SIGNAL( copyAvailable( bool ) ),
-           m_cut, SLOT( setEnabled( bool ) ) );
+           this, SLOT( slotCutEnabled( bool ) ) );
   connect( this, SIGNAL( copyAvailable( bool ) ),
            m_copy, SLOT( setEnabled( bool ) ) );
   
@@ -205,8 +205,13 @@
 {
 }
 
-void KNoteEdit::setText( const QString &text )
+void KNoteEdit::slotCutEnabled( bool b )
 {
+    m_cut->setEnabled( b && !isReadOnly() );
+}
+
+void KNoteEdit::setText( const QString& text )
+{
   if ( acceptRichText() && Qt::mightBeRichText( text ) ) {
     setHtml( text );
   } else {
Index: kmobiletools/kmobiletools/engines/at_engine/at_engine.desktop
===================================================================
--- kmobiletools/kmobiletools/engines/at_engine/at_engine.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmobiletools/kmobiletools/engines/at_engine/at_engine.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -26,6 +26,7 @@
 Name[pt]=Motor AT
 Name[pt_BR]=Mecanismo AT
 Name[ro]=Motor AT
+Name[sl]=Pogon AT
 Name[sv]=AT-gr√§nssnitt
 Name[tr]=AT Motoru
 Name[uk]=–†—É—à—ñ–π AT
@@ -56,6 +57,7 @@
 Comment[pl]=Modu≈Ç KMobileTools u≈ºywajƒÖcy standardowego zestawu polece≈Ñ AT
 Comment[pt]=Um motor do KMobileTools baseado no conjunto de comandos-padr√£o AT
 Comment[pt_BR]=Mecanismo do KMobileTools baseado no conjunto de comandos-padr√£o AT
+Comment[sl]=Pogon KMobileTools, ki temelji na standardnem naboru ukazov GSM AT
 Comment[sv]=Kmobiletools-gr√§nssnitt baserat p√• standardiserade GSM AT-kommadon
 Comment[tr]=KMobileTools Motoru tabanlƒ± standart GSM AT Komut Seti
 Comment[uk]=–†—É—à—ñ–π KMobileTools –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –Ω–∞–±–æ—Ä—É –∫–æ–º–∞–Ω–¥ GSM AT
@@ -86,6 +88,7 @@
 Description[pl]=Domy≈õlny modu≈Ç KMobileTools, napisany przez cz≈Çonk√≥w zespo≈Çu KMobileTools.\nDobry wyb√≥r dla prawie wszystkich telefon√≥w, ale w przypadku niekt√≥rych modeli brakuje bardziej zaawansowanych funkcji.\nNajlepszy wyb√≥r dla telefon√≥w Motoroli, dzia≈Ça te≈º dobrze z produktami Sony Ericsson i Siemensa.
 Description[pt]=O motor predefinido do KMobileTools, desenvolvido internamente pela equipa do KMobileTools.\nUma boa escolha para praticamente todos os telem√≥veis mas, em alguns modelos ,podem faltar algumas funcionalidades avan√ßadas.\nSendo a melhor escolha para os telem√≥veis da Motorola, tamb√©m funciona bem com os da Sony Ericsson e Siemens.
 Description[pt_BR]=Mecanismo padr√£o do KMobileTools, totalmente desenvolvido pela equipe do KMobileTools.\nUma boa escolha para praticamente todos os celulares mas, em alguns modelos podem faltar algumas funcionalidades avan√ßadas.\n√â a melhor escolha para os celulares da Motorola, tamb√©m funciona com os da Sony Ericsson e Siemens.
+Description[sl]=Privzeti pogon za KMobileTools, ki ga je razvila ekipa KMobileTools.\nTo je dobra izbira za skoraj vse mobilne telefone, a na nekaterih manjka podpora za napredne zmo≈ænosti.\nNajbolj≈°a izbira za mobile telefone Motorola, dobro deluje tudi s Sony Ericsson in Siemens.
 Description[sv]=Kmobiletools standardgr√§nssnitt, utvecklat internt av Kmobiletools-gruppen.\nEtt bra val f√∂r n√§stan alla mobiltelefoner, men f√∂r vissa modeller saknar det avancerade funktioner.\nB√§sta valet f√∂r Motorola-telefoner, fungerar bra med Sony Ericsson och Siemens.
 Description[tr]=KMobileTools takƒ±mƒ± tarafƒ±ndan geli≈ütirilen KMobileTools √∂ntanƒ±mlƒ± motoru.\nT√ºm cep telefonlarƒ± i√ßin iyi bir se√ßimdir ancak bazƒ± modellerin geli≈ümi≈ü √∂zelliklerinde yetersiz kalabilir.\nMotorola telefonlar i√ßin en iyi se√ßimdir, Sony Ericsson ve Siemens telefonlar ile de iyi √ßalƒ±≈üƒ±r.
 Description[uk]=–¢–∏–ø–æ–≤–∏–π —Ä—É—à—ñ–π KMobileTools, —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–∏–π –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ –∑ —Ä–æ–∑—Ä–æ–±–∫–∏ KMobileTools.\n–ß—É–¥–æ–≤–∏–π –≤–∏–±—ñ—Ä –º–∞–π–∂–µ –¥–ª—è –≤—Å—ñ—Ö –º–æ–±—ñ–ª—å–Ω–∏—Ö —Ç–µ–ª–µ—Ñ–æ–Ω—ñ–≤, –∞–ª–µ –¥–ª—è –¥–µ—è–∫–∏—Ö –º–æ–¥–µ–ª–µ–π —É –Ω—å–æ–º—É –≤—ñ–¥—Å—É—Ç–Ω—ñ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ.\n–ù–∞–π–∫—Ä–∞—â–∏–π –≤–∏–±—ñ—Ä –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω—ñ–≤ Motorola Phones, —Ç–∞–∫–æ–∂ –¥–æ–±—Ä–µ –ø—Ä–∞—Ü—é—î –∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º–∏ Sony Ericsson —ñ Siemens.
Index: kmobiletools/kmobiletools/engines/fake_engine/fake_engine.desktop
===================================================================
--- kmobiletools/kmobiletools/engines/fake_engine/fake_engine.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmobiletools/kmobiletools/engines/fake_engine/fake_engine.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -25,6 +25,7 @@
 Name[pt]=Motor falso
 Name[pt_BR]=Mecanismo falso
 Name[ro]=Motor fals
+Name[sl]=La≈æni pogon
 Name[sv]=Falskt gr√§nssnitt
 Name[tr]=Yalancƒ± motor
 Name[uk]=–§—ñ–∫—Ç–∏–≤–Ω–∏–π —Ä—É—à—ñ–π
@@ -55,6 +56,7 @@
 Comment[pl]=Pusty modu≈Ç KMobileTools...
 Comment[pt]=Um motor falso do KMobileTools...
 Comment[pt_BR]=Um mecanismo falso do KMobileTools...
+Comment[sl]=La≈æni pogon za KMobileTools ...
 Comment[sv]=Ett falskt gr√§nssnitt f√∂r Kmobiletools...
 Comment[tr]=Bir KMobileTools yalancƒ± motoru...
 Comment[uk]=–†—É—à—ñ–π-–æ–±–º–∞–Ω–∫–∞ –¥–ª—è KMobileTools...
@@ -84,6 +86,7 @@
 Description[pl]=Modu≈Ç KMobileTools wykorzystywany jako przyk≈Çad przy zmianach API.
 Description[pt]=Um motor falso do KMobileTools que √© usado como prova do conceito de redefini√ß√£o do desenho da API.
 Description[pt_BR]=Um mecanismo falso do KMobileTools que √© usado como prova do conceito de redefini√ß√£o da API.
+Description[sl]=La≈æni pogon za KMobileTools, ki slu≈æi kot dokaz koncepta za na novo naƒçrtovan programski vmesnik.
 Description[sv]=Ett falskt gr√§nssnitt f√∂r Kmobiletools anv√§nt som bevis av konceptet f√∂r omkonstruktionen av programmeringsgr√§nssnittet.
 Description[tr]=Api'yi yeniden tasarlama ve g√º√ßlendirme amacƒ±yla kullanƒ±lan KMobileTools yalancƒ± motoru.
 Description[uk]=–§—ñ–∫—Ç–∏–≤–Ω–∏–π —Ä—É—à—ñ–π KMobileTools, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —è–∫ –º–æ–¥–µ–ª—å –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π –∑–º—ñ–Ω–∏ –¥–∏–∑–∞–π–Ω—É api.
Index: kmobiletools/kmobiletools/engines/gammu_engine/gammu_engine.desktop
===================================================================
--- kmobiletools/kmobiletools/engines/gammu_engine/gammu_engine.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmobiletools/kmobiletools/engines/gammu_engine/gammu_engine.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -56,6 +56,7 @@
 Comment[pl]=Modu≈Ç KMobileTools wykorzystujƒÖcy Gammu
 Comment[pt]=Um Motor do KMobileTools baseado no Gammu
 Comment[pt_BR]=Mecanismo do KMobileTools baseado no Gammu
+Comment[sl]=Pogon za KMobileTools, temeljeƒç na Gammu
 Comment[sv]=Gr√§nssnitt f√∂r Kmobiletools baserat p√• Gammu
 Comment[tr]=KMobileTools Motoru tabanlƒ± Gammu
 Comment[uk]=–†—É—à—ñ–π KMobileTools, –∑–∞—Å–Ω–æ–≤–∞–Ω–∏–π –Ω–∞ Gammu
@@ -86,6 +87,7 @@
 Description[pl]=Modu≈Ç KMobileTools u≈ºywajƒÖcy Gammu. Dzia≈Ça ze wszystkimi telefonami obs≈ÇugujƒÖcymi polecenia AT. IstniejƒÖ specjalne sterowniki dla telefon√≥w Alcatela, Nokii, Sony Ericsson i wykorzystujƒÖcych Symbiana.
 Description[pt]=Um motor do KMobileTools que usa o Gammu como infra-estrutura. √â compat√≠vel com todos os comandos baseados em AT. Controladores especiais para os telefones da Alcatel, Nokia, Symbian e Sony Ericsson.
 Description[pt_BR]=Um mecanismo do KMobileTools que usa o Gammu como backend. √â compat√≠vel com todos os telefones baseados em AT. Controladores especiais para os telefones da Alcatel, Nokia, Symbian e Sony Ericsson.
+Description[sl]=Pogon za KMobileTools, ki v ozadju uporablja Gammu. Je zdru≈æljiv s telefoni temeljeƒçimi na AT. Na voljo so posebni gonilniki za telefone Alcatel, Nokia, Symbian in Sony Ericsson.
 Description[sv]=Ett Kmobiletools-gr√§nssnitt som anv√§nder Gammu som gr√§nssnitt. Fungerar med alla AT-baserade telefoner. S√§rskilda drivrutiner f√∂r  telefoner fr√•n Alcatel, Nokia, Symbian och Sony Ericsson.
 Description[tr]=Gammu arka ucunu kullanan bir KMobileTools motoru. AT-tabanlƒ± telefonlar ile uyumludur. Alcatel, Nokia, Symbian ve Sony Ericsson telefonlar i√ßin √∂zel s√ºr√ºc√ºler.
 Description[uk]=–†—É—à—ñ–π KMobileTools, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Gammu —É —è–∫–æ—Å—Ç—ñ —Å–µ—Ä–≤–µ—Ä–∞. –°—É–º—ñ—Å–Ω–∏–π –∑ –≤—Å—ñ–º–∞ –∑–∞—Å–Ω–æ–≤–∞–Ω–∏–º–∏ –Ω–∞ –ª–æ–≥—ñ—Ü—ñ AT —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º–∏. –û–∫—Ä–µ–º—ñ –¥—Ä–∞–π–≤–µ—Ä–∏ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω—ñ–≤ Alcatel, Nokia, Symbian —ñ Sony Ericsson.
Index: kmobiletools/kmobiletools/libkmobiletools/akonadi/akonadi_serializer_sms.desktop
===================================================================
--- kmobiletools/kmobiletools/libkmobiletools/akonadi/akonadi_serializer_sms.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kmobiletools/kmobiletools/libkmobiletools/akonadi/akonadi_serializer_sms.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -10,7 +10,7 @@
 Name[ga]=Srath√≥ir SMS
 Name[gl]=Serializador de SMS
 Name[it]=Serializzatore di SMS
-Name[ja]=SMS „Ç∑„É™„Ç¢„É©„Ç§„Ç∂
+Name[ja]=SMS Áî®„Ç∑„É™„Ç¢„É©„Ç§„Ç∂
 Name[km]=·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûî·üÑ·üá·ûñ·ûª·ûò·üí·ûñ SMS
 Name[lv]=SMS serializƒìtƒÅjs
 Name[nb]=SMS serialiserer
Index: kontact/plugins/planner/planner.cpp
===================================================================
--- kontact/plugins/planner/planner.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kontact/plugins/planner/planner.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -237,7 +237,7 @@
       i18np( "No appointments pending within the next day",
              "No appointments pending within the next %1 days", mCustomDays ), this );
     noEvents->setAlignment( Qt::AlignHCenter | Qt::AlignVCenter );
-    mLayout->addWidget( noEvents );
+    mLayout->addWidget( noEvents, 0, 0 );
     mLabels.append( noEvents );
   }
 
@@ -342,6 +342,7 @@
       if( !mUnderline ){
         urlLabel->setUnderline( false );
       }
+      urlLabel->setWordWrap( true );
       urlLabel->setMaximumWidth( urlLabel->minimumSizeHint().width() );
       mPlannerGrid->addWidget( urlLabel, counter, 3 );
       mLabels.append( urlLabel );
@@ -361,6 +362,7 @@
       urlLabel2->setUrl( todo->uid() );
       urlLabel2->installEventFilter( this );
       urlLabel2->setAlignment( Qt::AlignLeft | Qt::AlignTop );
+      urlLabel->setWordWrap( true );
       if( stateText == i18nc( "to-do is overdue", "overdue" ) ){
         urlLabel2->setText( "<font color = red >" + string + "</font>" );
       }
@@ -375,6 +377,12 @@
       connect( urlLabel2, SIGNAL(rightClickedUrl(const QString&)),
                this, SLOT(todoPopupMenu(const QString&)) );
 
+      QString tipText( KCal::IncidenceFormatter::toolTipStr(
+                         todo, true, KPIM::KPimPrefs::timeSpec() ) );
+      if ( !tipText.isEmpty() ) {
+        urlLabel2->setToolTip( tipText );
+      }
+
       mPlannerGrid->setColumnMinimumWidth( 6, 15 );
 
       label = new QLabel( stateText, this );
@@ -435,8 +443,8 @@
 
 //   for ( ; it != events_orig.end(); ++it ) {
 //     ev = ( *it )->clone();
-  Q_FOREACH( KCal::Event *ev, mCalendar->events( date ) ){
-    if ( ev->recursOn( date, KDateTime::LocalZone ) ) {
+  Q_FOREACH ( KCal::Event *ev, mCalendar->events( date, mCalendar->timeSpec() ) ) {
+    if ( ev->recursOn( date, mCalendar->timeSpec() ) ) {
       kdt = ev->dtStart();
       kdt.setDate( date );
       ev->setDtStart( kdt );
@@ -460,7 +468,7 @@
 
     QDate currentDate = QDate::currentDate();
     QString datestr;
-    QDate sD = QDate( date.year(), date.month(), date.day() );
+    QDate sD = date;
     QLabel *label;
 
     ++counter;
@@ -504,10 +512,12 @@
 
       // Print the date span for multiday, allDay events, for the
       // first day of the event only.
+      KDateTime::Spec spec = KPIM::KPimPrefs::timeSpec();
       if ( ev->isMultiDay() && ev->allDay() && dayof == 1 && span > 1 ) {
-        datestr = KGlobal::locale()->formatDate( ev->dtStart().date() );
-        datestr += " -\n " +
-                    KGlobal::locale()->formatDate( sD.addDays( span-1 ) );
+        KDateTime ksD( sD.addDays( span - 1 ), spec );
+        datestr = ev->dtStartDateStr( false, spec ) +
+                  " -\n " +
+                  KGlobal::locale()->formatDate( ksD.date(), KLocale::LongDate );
         label = new QLabel( datestr, this );
         label->setAlignment( Qt::AlignLeft | Qt::AlignTop );
         mPlannerGrid->addWidget( label, counter, 3 );
@@ -516,8 +526,8 @@
 
       // Fill Event Time Range Field (only for non-allDay Events)
       if ( !ev->allDay() ){
-        QTime sST = ev->dtStart().time();
-        QTime sET = ev->dtEnd().time();
+        QTime sST = ev->dtStart().toTimeSpec( spec ).time();
+        QTime sET = ev->dtEnd().toTimeSpec( spec ).time();
         if ( ev->isMultiDay() ){
           if ( ev->dtStart().date() < date ){
             sST = QTime( 0, 0 );
@@ -549,6 +559,7 @@
       urlLabel->setUrl( ev->uid() );
       urlLabel->installEventFilter( this );
       urlLabel->setAlignment( Qt::AlignLeft | Qt::AlignTop | Qt::WordBreak );
+      urlLabel->setWordWrap( true );
       if( !mUnderline ){
         urlLabel->setUnderline( false );
       }
@@ -737,6 +748,7 @@
       urlLabel->setUrl( entry.addressee.uid() );
       urlLabel->setText( entry.addressee.realName() );
       urlLabel->setTextFormat( Qt::RichText );
+      urlLabel->setWordWrap( true );
       if( !mUnderline ){
           urlLabel->setUnderline( false );
         }
Index: kontact/plugins/weather/summarywidget.cpp
===================================================================
--- kontact/plugins/weather/summarywidget.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kontact/plugins/weather/summarywidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -85,6 +85,7 @@
     QLabel *label = new QLabel(
       i18n( "No weather D-Bus service available;\nyou need KWeather to use this plugin." ), this );
     mLayout->addWidget( label, Qt::AlignHCenter | Qt::AlignVCenter );
+    mLayout->addWidget( label, 0, 0 );
   }
 }
 
@@ -125,6 +126,7 @@
       QPixmap::fromImage( img.scaled( 32, 32, Qt::IgnoreAspectRatio, Qt::SmoothTransformation ) ) );
     urlLabel->setMaximumSize( urlLabel->sizeHint() );
     urlLabel->setAlignment( Qt::AlignTop );
+    urlLabel->setWordWrap( true );
     layout->addWidget( urlLabel, 0, 0, 2, 1 );
     mLabels.append( urlLabel );
     connect ( urlLabel, SIGNAL(leftClickedUrl(const QString&)),
@@ -150,7 +152,7 @@
                          .arg( i18n( "Rel. Humidity" ) )
                          .arg( (*it).relativeHumidity() );
 
-    label->setToolTip( labelText.replace( " ", "&nbsp;" ) );
+    label->setToolTip( labelText.replace( ' ', "&nbsp;" ) );
 
     label = new QLabel( cover, this );
     label->setAlignment( Qt::AlignLeft );
Index: kontact/plugins/specialdates/sdsummarywidget.cpp
===================================================================
--- kontact/plugins/specialdates/sdsummarywidget.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kontact/plugins/specialdates/sdsummarywidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -442,9 +442,9 @@
       QDate sD = QDate( year, (*addrIt).date.month(), (*addrIt).date.day() );
 
       if ( (*addrIt).daysTo == 0 ) {
-        datestr = i18n( "Today" );
+        datestr = i18nc( "the special day is today", "Today" );
       } else if ( (*addrIt).daysTo == 1 ) {
-        datestr = i18n( "Tomorrow" );
+        datestr = i18nc( "the special day is tomorrow", "Tomorrow" );
       } else {
         datestr = KGlobal::locale()->formatDate( sD, KLocale::FancyLongDate );
       }
@@ -507,6 +507,7 @@
         urlLabel->setUrl( (*addrIt).addressee.uid() );
         urlLabel->setText( (*addrIt).addressee.realName() );
         urlLabel->setTextFormat( Qt::RichText );
+        urlLabel->setWordWrap( true );
         mLayout->addWidget( urlLabel, counter, 4 );
         mLabels.append( urlLabel );
 
@@ -547,7 +548,7 @@
                "No special dates pending within the next %1 days",
                mDaysAhead ), this );
     label->setAlignment( Qt::AlignHCenter | Qt::AlignVCenter );
-    mLayout->addWidget( label, 0, 2 );
+    mLayout->addWidget( label, 0, 0 );
     mLabels.append( label );
   }
 
Index: kontact/plugins/knotes/summarywidget.cpp
===================================================================
--- kontact/plugins/knotes/summarywidget.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kontact/plugins/knotes/summarywidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -123,11 +123,11 @@
   } else {
       QLabel *noNotes = new QLabel( i18n( "No Notes Available" ), this );
       noNotes->setAlignment( Qt::AlignHCenter | Qt::AlignVCenter );
-      mLayout->addWidget( noNotes, 0, 1 );
+      mLayout->addWidget( noNotes, 0, 0 );
       mLabels.append( noNotes );
   }
 
-  Q_FOREACH( label, mLabels ) {
+  Q_FOREACH( label, mLabels ) { //krazy:exclude=foreach as label is a pointer
     label->show();
   }
 }
Index: kontact/plugins/kjots/kjots_plugin.desktop
===================================================================
--- kontact/plugins/kjots/kjots_plugin.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kontact/plugins/kjots/kjots_plugin.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -31,6 +31,7 @@
 Comment[ja]=Kontact KJots „Éó„É©„Ç∞„Ç§„É≥
 Comment[km]=·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûá·üÜ·ûì·ûΩ·ûô‚Äã·ûë·üÜ·ûì·û∂·ûÄ·üã·ûë·üÜ·ûì·ûÑ KJots
 Comment[ko]=Kontact KJots ÌîåÎü¨Í∑∏Ïù∏
+Comment[lt]=Kontact KJots priedas
 Comment[lv]=Kontact KJots spraudnis
 Comment[nb]=Kontact programtillegg for KJots
 Comment[nds]=KJots-Moduul f√∂r Kontact
Index: kontact/plugins/korganizer/apptsummarywidget.cpp
===================================================================
--- kontact/plugins/korganizer/apptsummarywidget.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kontact/plugins/korganizer/apptsummarywidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -59,8 +59,10 @@
   mLayout->setRowStretch( 6, 1 );
 
   mCalendar = KOrg::StdCalendar::self();
-  mCalendar->load();
 
+  //If the kpart isn't created yet, it's created now, and mCalendar is loaded
+  mPlugin->part();
+
   connect( mCalendar, SIGNAL(calendarChanged()), this, SLOT(updateView()) );
   connect( mPlugin->core(), SIGNAL(dayChanged(const QDate&)), this, SLOT(updateView()) );
 
@@ -107,7 +109,7 @@
   QPixmap pm = loader.loadIcon( "view-calendar-day", KIconLoader::Small );
 
   SummaryEventInfo::setShowSpecialEvents( mShowBirthdaysFromCal,
-                                                 mShowAnniversariesFromCal );
+                                          mShowAnniversariesFromCal );
   QDate currentDate = QDate::currentDate();
   QDate dt;
   for ( dt = currentDate;
@@ -153,6 +155,7 @@
       urlLabel->setUrl( event->summaryUrl );
       urlLabel->installEventFilter( this );
       urlLabel->setTextFormat( Qt::RichText );
+      urlLabel->setWordWrap( true );
       mLayout->addWidget( urlLabel, counter, 3 );
       mLabels.append( urlLabel );
 
@@ -160,7 +163,7 @@
                this, SLOT(viewEvent(const QString&)) );
       connect( urlLabel, SIGNAL(rightClickedUrl(const QString&)),
                this, SLOT(popupMenu(const QString&)) );
-      if ( event->summaryTooltip.isEmpty() ) {
+      if ( !event->summaryTooltip.isEmpty() ) {
         urlLabel->setToolTip( event->summaryTooltip );
       }
 
@@ -184,9 +187,8 @@
       i18np( "No upcoming events starting within the next day",
              "No upcoming events starting within the next %1 days",
              mDaysAhead ), this );
-    noEvents->setObjectName( "nothing to see" );
     noEvents->setAlignment( Qt::AlignHCenter | Qt::AlignVCenter );
-    mLayout->addWidget( noEvents, 0, 2 );
+    mLayout->addWidget( noEvents, 0, 0 );
     mLabels.append( noEvents );
   }
 
Index: kontact/plugins/korganizer/todosummarywidget.cpp
===================================================================
--- kontact/plugins/korganizer/todosummarywidget.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kontact/plugins/korganizer/todosummarywidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -2,7 +2,7 @@
   This file is part of Kontact.
 
   Copyright (c) 2003 Tobias Koenig <tokoe@kde.org>
-  Copyright (c) 2005-2006,2008 Allen Winter <winter@kde.org>
+  Copyright (c) 2005-2006,2008-2009 Allen Winter <winter@kde.org>
 
   This program is free software; you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
@@ -74,7 +74,9 @@
   mLayout->setRowStretch( 6, 1 );
 
   mCalendar = KOrg::StdCalendar::self();
-  mCalendar->load();
+  
+  //If the kpart isn't created yet, it's created now, and mCalendar is loaded
+  mPlugin->part();
 
   connect( mCalendar, SIGNAL(calendarChanged()), SLOT(updateView()) );
   connect( mPlugin->core(), SIGNAL(dayChanged(const QDate&)), SLOT(updateView()) );
@@ -254,6 +256,7 @@
       urlLabel->setUrl( todo->uid() );
       urlLabel->installEventFilter( this );
       urlLabel->setTextFormat( Qt::RichText );
+      urlLabel->setWordWrap( true );
       mLayout->addWidget( urlLabel, counter, 4 );
       mLabels.append( urlLabel );
 
@@ -262,7 +265,8 @@
       connect( urlLabel, SIGNAL(rightClickedUrl(const QString&)),
                this, SLOT(popupMenu(const QString&)) );
 
-      QString tipText( KCal::IncidenceFormatter::toolTipString( todo, true ) );
+      QString tipText( KCal::IncidenceFormatter::toolTipStr(
+                         todo, true, KPIM::KPimPrefs::timeSpec() ) );
       if ( !tipText.isEmpty() ) {
         urlLabel->setToolTip( tipText );
       }
@@ -284,11 +288,11 @@
              "No pending to-dos due within the next %1 days",
              mDaysToGo ), this );
     noTodos->setAlignment( Qt::AlignHCenter | Qt::AlignVCenter );
-    mLayout->addWidget( noTodos, 0, 2 );
+    mLayout->addWidget( noTodos, 0, 0 );
     mLabels.append( noTodos );
   }
 
-  Q_FOREACH( label, mLabels ) {
+  Q_FOREACH( label, mLabels ) { //krazy:exclude=foreach as label is a pointer
     label->show();
   }
 }
Index: kontact/plugins/kmail/summarywidget.cpp
===================================================================
--- kontact/plugins/kmail/summarywidget.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kontact/plugins/kmail/summarywidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -64,7 +64,6 @@
   mLayout = new QGridLayout();
   mainLayout->addItem( mLayout );
   mLayout->setSpacing( 3 );
-  mLayout->setColumnStretch( 2, 1 );
   mLayout->setRowStretch( 6, 1 );
 
   slotUnreadCountChanged();
@@ -167,6 +166,7 @@
         KUrlLabel *urlLabel = new KUrlLabel( *it, folderPath, this );
         urlLabel->installEventFilter( this );
         urlLabel->setAlignment( Qt::AlignLeft );
+        urlLabel->setWordWrap( true );
         mLayout->addWidget( urlLabel, counter, 1 );
         mLabels.append( urlLabel );
 
@@ -198,7 +198,7 @@
   if ( counter == 0 ) {
     label = new QLabel( i18n( "No unread messages in your monitored folders" ), this );
     label->setAlignment( Qt::AlignHCenter | Qt::AlignVCenter );
-    mLayout->addWidget( label, 0, 2 );
+    mLayout->addWidget( label, 0, 0 );
     mLabels.append( label );
   }
 
Index: kontact/plugins/summary/summaryview_part.cpp
===================================================================
--- kontact/plugins/summary/summaryview_part.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kontact/plugins/summary/summaryview_part.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -206,6 +206,10 @@
 
   QHBoxLayout *layout = new QHBoxLayout( mFrame );
 
+  int margin = 20; // margin width: insert margins so there is space to dnd a
+                   // summary when either column is empty. looks nicer too.
+
+  layout->insertSpacing( 0, margin );
   mLeftColumn = new QVBoxLayout();
   layout->addLayout( mLeftColumn );
   mLeftColumn->setSpacing( KDialog::spacingHint() );
@@ -213,6 +217,7 @@
   mRightColumn = new QVBoxLayout();
   layout->addLayout( mRightColumn );
   mRightColumn->setSpacing( KDialog::spacingHint() );
+  layout->insertSpacing( -1, margin );
 
   QStringList::Iterator strIt;
   for ( strIt = mLeftColumnSummaries.begin(); strIt != mLeftColumnSummaries.end(); ++strIt ) {
@@ -383,11 +388,11 @@
 
 void SummaryViewPart::slotAdjustPalette()
 {
-    mMainWidget->setStyleSheet( 
+    mMainWidget->setStyleSheet(
       "#mMainWidget { "
       " background: palette(base);"
       " background-image: url(:/summaryview/kontact_bg.png);"
-      " background-position: bottom right;" 
+      " background-position: bottom right;"
       " background-repeat: no-repeat; }" );
 }
 
@@ -444,7 +449,7 @@
   sa->setWidgetResizable( true );
 
   mMainWidget = new QFrame;
-  mMainWidget->setObjectName("mMainWidget");
+  mMainWidget->setObjectName( "mMainWidget" );
   sa->setWidget( mMainWidget );
   mMainWidget->setFocusPolicy( Qt::StrongFocus );
   setWidget( sa );
Index: kontact/plugins/newsticker/summarywidget.cpp
===================================================================
--- kontact/plugins/newsticker/summarywidget.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kontact/plugins/newsticker/summarywidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -258,6 +258,7 @@
     KUrlLabel *urlLabel = new KUrlLabel( hbox );
     urlLabel->setUrl( (*it).url );
     urlLabel->setPixmap( (*it).logo );
+    urlLabel->setWordWrap( true );
     urlLabel->setMaximumSize( urlLabel->minimumSizeHint() );
     mLabels.append( urlLabel );
 
Index: kontact/src/mainwindow.cpp
===================================================================
--- kontact/src/mainwindow.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ kontact/src/mainwindow.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -165,6 +165,9 @@
   mSidePane->setMinimumWidth( mSidePane->sizeHint().width() );
 
   factory()->plugActionList( this, QString( "navigator_actionlist" ), mActionPlugins );
+
+  restoreWindowSize( KConfigGroup( KGlobal::config(), "MainWindow" ) );
+  setAutoSaveSettings();
 }
 
 void MainWindow::initGUI()
@@ -183,9 +186,6 @@
 
   createGUI( 0 );
 
-  resize( 700, 520 ); // initial size to prevent a scrollbar in sidepane
-  setAutoSaveSettings();
-
   KToolBar *navigatorToolBar = findToolBar( "navigatorToolBar" );
   Q_ASSERT( navigatorToolBar );
   if ( layoutDirection() == Qt::LeftToRight ) {
@@ -1151,7 +1151,7 @@
   QString wizard_icon_path = iconloader->iconPath( "tools-wizard", KIconLoader::Desktop );
 
   QString info = ki18n( "<h2 style='text-align:center; margin-top: 0px;'>Welcome to Kontact %1</h2>"
-      "<p>%2</p>"
+      "<p align=\"center\">%2</p>"
       "<table align=\"center\">"
       "<tr><td><a href=\"%3\"><img width=\"%4\" height=\"%5\" src=\"%6\" /></a></td>"
       "<td><a href=\"%7\">%8</a><br /><span id=\"subtext\"><nobr>%9</nobr></span></td></tr>"
Index: akonadi/tray/akonaditray.desktop
===================================================================
--- akonadi/tray/akonaditray.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/tray/akonaditray.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -9,6 +9,7 @@
 Name[nl]=Akonadi-vak
 Name[pa]=‡®Ö‡®ï‡©å‡®Ç‡®°‡©Ä-‡®ü‡®∞‡©á
 Name[ru]=–°–∏—Å—Ç–µ–º–Ω—ã–π –ª–æ—Ç–æ–∫ –¥–ª—è Akonadi
+Name[sl]=Akonadi v sistemski vrstici
 Name[sv]=Akonadi-bricka
 Name[x-test]=xxAkonaditrayxx
 Name[zh_CN]=Akonadi ÊâòÁõò
@@ -37,6 +38,7 @@
 GenericName[pt_BR]=Utilit√°rio de notifica√ß√£o do Akonadi
 GenericName[ro]=Utilitar Akonadi pentru tavƒÉ
 GenericName[ru]=–£—Ç–∏–ª–∏—Ç–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ª–æ—Ç–∫–∞ –¥–ª—è Akonadi
+GenericName[sl]=Akonadijevo orodje v sistemski vrstici
 GenericName[sv]=Akonadi-brickverktyg
 GenericName[tr]=Akonadi Sistem √áekmecesi Aracƒ±
 GenericName[uk]=–£—Ç–∏–ª—ñ—Ç–∞ –ª–æ—Ç–∫–∞ Akonadi
Index: akonadi/agents/nepomuk_email_feeder/nepomukemailfeeder.desktop
===================================================================
--- akonadi/agents/nepomuk_email_feeder/nepomukemailfeeder.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/agents/nepomuk_email_feeder/nepomukemailfeeder.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -7,11 +7,13 @@
 Name[es]=Proveedor de correos electr√≥nicos de Nepomuk
 Name[et]=Nepomuki e-kirjade s√∂√∂tur
 Name[fr]=Connecteur Nepomuk pour les courriels
+Name[ga]=Fothaire R√≠omhphoist Nepomuk
 Name[gl]=Fornecedor de Correo de Nepomuk
 Name[it]=Fornitore di indirizzi di posta per Nepomuk
 Name[ja]=Nepomuk „É°„Éº„É´„Éï„Ç£„Éº„ÉÄ„Éº
 Name[km]=·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûò·ûè·û∑·ûñ·üê·ûè·üå·ûò·û∂·ûì‚Äã·û¢·üä·û∏·ûò·üÇ·ûõ Nepomuk
 Name[ko]=Nepomuk Ï†ÑÏûê Ïö∞Ìé∏ Í≥µÍ∏âÏûê
+Name[lt]=Nepomuk lai≈°k≈≥ ≈°altinis
 Name[lv]=Nepomuk e-pasta barotƒÅjs
 Name[nb]=E-postsender til Nepomuk
 Name[nds]=Nepomuk-Nettpostingaav
@@ -21,6 +23,7 @@
 Name[pl]=Obs≈Çuga e-maili dla Nepomuka
 Name[pt]=Alimenta√ß√£o de E-Mail do Nepomuk
 Name[pt_BR]=Alimentador de e-mail do Nepomuk
+Name[sl]=Podajalnik epo≈°te za Nepomuk
 Name[sv]=E-postinmatning till Nepomuk
 Name[tr]=Nepomuk E-posta Besleyici
 Name[uk]=–ü–µ—Ä–µ–¥–∞–≤–∞—á –ø–æ—à—Ç–∏ Nepomuk
@@ -39,6 +42,7 @@
 Comment[ja]=Nepomuk „Å´„É°„Éº„É´„ÇíÊèê‰æõ„Åô„Çã„Ç®„ÇØ„Çπ„ÉÜ„É≥„Ç∑„Éß„É≥
 Comment[km]=·ûï·üí·ûì·üÇ·ûÄ‚Äã·ûî·ûì·üí·ûê·üÇ·ûò‚Äã·ûä·üÇ·ûõ·ûè·üí·ûö·ûº·ûú‚Äã·ûî·ûâ·üí·ûá·ûº·ûì‚Äã·û¢·üä·û∏·ûò·üÇ·ûõ‚Äã·ûë·üÖ·ûÄ·û∂·ûì·üã Nepomuk
 Comment[ko]=NepomukÏóê Ï†ÑÏûê Ïö∞Ìé∏ÏùÑ Ï∂îÍ∞ÄÌïòÎäî Í≥µÍ∏âÏûê
+Comment[lt]=Priedas el. lai≈°k≈≥ perdavimui ƒØ Nepomuk
 Comment[lv]=Papla≈°inƒÅjums, kas ies≈´ta e-pastus Nepomuk
 Comment[nb]=Utvidelse som sender e-poster inn til Nepomuk
 Comment[nds]=Verwiedern, mit de sik Nettpost na Nepomuk √∂verdregen lett
@@ -47,6 +51,7 @@
 Comment[pl]=Rozszerzenie do wysy≈Çania e-maili do Nepomuka
 Comment[pt]=Extens√£o para enviar mensagens de e-mail para o Nepomuk
 Comment[pt_BR]=Extens√£o para enviar e-mails para o Nepomuk
+Comment[sl]=Raz≈°iritev, ki posreduje e-po≈°to v Nepomuk
 Comment[sv]=Ut√∂kning f√∂r att skicka e-postadresser till Nepomuk
 Comment[tr]=E-postalarƒ± Nepomuk i√ßerisine ta≈üƒ±mak i√ßin bir eklenti
 Comment[uk]=–î–æ–¥–∞—Ç–æ–∫ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∏—Ö –ª–∏—Å—Ç—ñ–≤ –¥–æ Nepomuk
Index: akonadi/agents/mailthreader/mailthreaderagent.desktop
===================================================================
--- akonadi/agents/mailthreader/mailthreaderagent.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/agents/mailthreader/mailthreaderagent.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -7,11 +7,13 @@
 Name[es]=Agente de hilos de correo
 Name[et]=Kirjal√µimede agent
 Name[fr]=Agent de regroupement de messages
+Name[ga]=Gn√≠omhaire Sn√°ithithe R√≠omhphoist
 Name[gl]=Axente de F√≠¬≠os de Correo
 Name[it]=Agente raggruppamento messaggi di posta
 Name[ja]=„É°„Éº„É´„Çí„Çπ„É¨„ÉÉ„ÉâÂåñ„Åô„Çã„Ç®„Éº„Ç∏„Çß„É≥„Éà
 Name[km]=·ûó·üí·ûì·û∂·ûÄ·üã·ûÑ·û∂·ûö‚Äã·ûÅ·üí·ûü·üÇ·ûü·üí·ûö·û°·û∂·ûô‚Äã·ûü·üÜ·ûî·ûª·ûè·üí·ûö
 Name[ko]=Î©îÏùº Î¨∂Í∏∞ ÎßàÎ≤ïÏÇ¨
+Name[lt]=Lai≈°k≈≥ i≈°dƒóstymo gija agentas
 Name[lv]=Pasta pavedienu aƒ£ents
 Name[nb]=Agent for e-posttr√•ding
 Name[nds]=Kl√∂√∂nsnackh√∂lper
@@ -22,6 +24,7 @@
 Name[pt]=Agente de Tarefas de Correio
 Name[pt_BR]=Agente de tarefas de correio
 Name[ro]=Agent de grupare a mesajelor
+Name[sl]=Posrednik za nizanje po≈°te
 Name[sv]=E-posttr√•dningsmodul
 Name[tr]=E-posta Dizme Aracƒ±
 Name[uk]=–ê–≥–µ–Ω—Ç —Ä–æ–∑–≥–∞–ª—É–∂–µ–Ω–Ω—è –ø–æ—à—Ç–∏
@@ -36,11 +39,13 @@
 Comment[es]=Ordenar por hilos una colecci√≥n de mensajes
 Comment[et]=Kirjakogust kirjal√µimede loomiseks
 Comment[fr]=Des messages regroup√©s par fil de discussion
+Comment[ga]=Gn√≠omhaire a shn√°ith√≠onn r√≠omhphost i mbaili√∫ch√°n
 Comment[gl]=Ligar o correo por f√≠¬≠os nunha colecci√≥n
 Comment[it]=Raggruppa per conversazione i messaggi di posta in una collezione
 Comment[ja]=„É°„Éº„É´„Çí„Çπ„É¨„ÉÉ„ÉâÂåñ„Åó„Åæ„Åô
 Comment[km]=·ûä·û∂·ûÄ·üã‚Äã·ûü·üÜ·ûî·ûª·ûè·üí·ûö‚Äã·ûá·û∂‚Äã·ûÅ·üí·ûü·üÇ·ûü·üí·ûö·û°·û∂·ûô‚Äã·ûì·üÖ‚Äã·ûÄ·üí·ûì·ûª·ûÑ‚Äã·ûü·ûò·üí·ûö·û∂·üÜ·ûÑ
 Comment[ko]=Î™®ÏùåÏßëÏùò Î©îÏùº Î¨∂Í∏∞
+Comment[lt]=I≈°dƒóstyti lai≈°kus kolekcijoje gija
 Comment[lv]=Pavedienos ielƒÅdƒì pastu kolekcijƒÅ
 Comment[nb]=Lag e-posttr√•der i en samling
 Comment[nds]=Kl√∂√∂nsnacks binnen en Nettpostsammeln
@@ -51,6 +56,7 @@
 Comment[pt]=Agendar mensagens de e-mail numa colec√ß√£o
 Comment[pt_BR]=Agendar as mensagens de uma cole√ß√£o
 Comment[ro]=GrupeazƒÉ mesajele √Æntr-o colec»õie
+Comment[sl]=Niza po≈°to v zbirko
 Comment[sv]=Tr√•da e-post fr√•n en samling
 Comment[tr]=E-postalarƒ± bir koleksiyon i√ßerisine diz
 Comment[uk]=–†–æ–∑–≥–∞–ª—É–∂—É—î –ø–æ—à—Ç–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑—ñ –∑–±—ñ—Ä–∫–∏
Index: akonadi/agents/nepomuk_contact_feeder/nepomukcontactfeeder.desktop
===================================================================
--- akonadi/agents/nepomuk_contact_feeder/nepomukcontactfeeder.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/agents/nepomuk_contact_feeder/nepomukcontactfeeder.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -7,11 +7,13 @@
 Name[es]=Proveedor de contactos de Nepomuk
 Name[et]=Nepomuki kontaktide s√∂√∂tur
 Name[fr]=Connecteur Nepomuk pour les contacts
+Name[ga]=Fothaire Teagmh√°lacha Nepomuk
 Name[gl]=Fornecedor de Contactos do Nepomuk
 Name[it]=Fornitore di contatti Nepomuk per Akonadi
 Name[ja]=Nepomuk ÈÄ£Áµ°ÂÖà„Éï„Ç£„Éº„ÉÄ„Éº
 Name[km]=·ûò·ûè·û∑·ûñ·üê·ûè·üå·ûò·û∂·ûì‚Äã·ûë·üÜ·ûì·û∂·ûÄ·üã·ûë·üÜ·ûì·ûÑ Nepomuk
 Name[ko]=Nepomuk Ïó∞ÎùΩÏ≤ò Í≥µÍ∏âÏûê
+Name[lt]=Nepomuk kontakt≈≥ ≈°altinis
 Name[lv]=Nepomuk kontaktu barotƒÅjs
 Name[nb]=Kontaktsender til Nepomuk
 Name[nds]=Nepomuk-Kontaktingaav
@@ -21,6 +23,7 @@
 Name[pl]=Obs≈Çuga wizyt√≥wek dla Nepomuka
 Name[pt]=Alimenta√ß√£o de Contactos para o Nepomuk
 Name[pt_BR]=Alimentador de contatos para o Nepomuk
+Name[sl]=Podajalnik stikov za Nepomuk
 Name[sv]=Kontaktinmatning till Nepomuk
 Name[tr]=Nepomuk Ki≈üi Besleyici
 Name[uk]=–ü–µ—Ä–µ–¥–∞–≤–∞—á –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤ Nepomuk
@@ -39,6 +42,7 @@
 Comment[ja]=Nepomuk „Å´ÈÄ£Áµ°ÂÖà„ÇíÊèê‰æõ„Åô„Çã„Ç®„ÇØ„Çπ„ÉÜ„É≥„Ç∑„Éß„É≥
 Comment[km]=·ûï·üí·ûì·üÇ·ûÄ‚Äã·ûî·ûì·üí·ûê·üÇ·ûò‚Äã·ûä·üÇ·ûõ·ûè·üí·ûö·ûº·ûú‚Äã·ûî·ûâ·üí·ûá·ûº·ûì‚Äã·ûë·üÜ·ûì·û∂·ûÄ·üã·ûë·üÜ·ûì·ûÑ‚Äã·ûë·üÖ Nepomuk
 Comment[ko]=NepomukÏóê Ïó∞ÎùΩÏ≤òÎ•º Ï∂îÍ∞ÄÌïòÎäî ÌôïÏû• Í∏∞Îä•
+Comment[lt]=Praplƒótimas skirtas kontakt≈≥ persiuntimui ƒØ Nepomuk
 Comment[lv]=Papla≈°inƒÅjums, kas ies≈´ta kontaktu datus Nepomuk
 Comment[nb]=Utvidelse som sender kontakter inn til Nepomuk
 Comment[nds]=Verwiedern, mit de sik Kontakten na Nepomuk √∂verdregen laat
@@ -47,6 +51,7 @@
 Comment[pl]=Rozszerzenie do wysy≈Çania wizyt√≥wek do Nepomuka
 Comment[pt]=Extens√£o para enviar contactos para o Nepomuk
 Comment[pt_BR]=Extens√£o para enviar contatos para o Nepomuk
+Comment[sl]=Raz≈°iritev, ki posreduje stike v Nepomuk
 Comment[sv]=Ut√∂kning f√∂r att skicka kontakter till Nepomuk
 Comment[tr]=Ki≈üileri Nepomuk i√ßerisine ta≈üƒ±mak i√ßin bir eklenti
 Comment[uk]=–î–æ–¥–∞—Ç–æ–∫ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤ –¥–æ Nepomuk
Index: akonadi/agents/strigifeeder/strigifeeder.desktop
===================================================================
--- akonadi/agents/strigifeeder/strigifeeder.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/agents/strigifeeder/strigifeeder.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -7,11 +7,13 @@
 Name[es]=Proveedor de datos de Strigi
 Name[et]=Strigi s√∂√∂tur
 Name[fr]=Connecteur Strigi
+Name[ga]=Fothaire Strigi
 Name[gl]=Fornecedor de Strigi
 Name[it]=Fornitore per Strigi
 Name[ja]=Strigi „Éï„Ç£„Éº„ÉÄ„Éº
 Name[km]=·ûò·ûè·û∑·ûñ·üê·ûè·üå·ûò·û∂·ûì Strigi
 Name[ko]=Strigi Í≥µÍ∏âÏûê
+Name[lt]=Strigi ≈°altinis
 Name[lv]=Strigi barotƒÅjs
 Name[nb]=Sender til Strigi
 Name[nds]=Strigi-Ingaav
@@ -22,6 +24,7 @@
 Name[pt]=Alimenta√ß√£o do Strigi
 Name[pt_BR]=Alimentador do Strigi
 Name[ro]=Alimentator Strigi
+Name[sl]=Podajalnik za strigi
 Name[sv]=Inmatning till Strigi
 Name[tr]=Strigi Besleyici
 Name[uk]=–ü–µ—Ä–µ–¥–∞–≤–∞—á Strigi
@@ -41,6 +44,7 @@
 Comment[ja]=Strigi „Éô„Éº„Çπ„ÅÆÂÖ®ÊñáÊ§úÁ¥¢
 Comment[km]=·ûÄ·û∂·ûö‚Äã·ûü·üí·ûú·üÇ·ûÑ·ûö·ûÄ‚Äã·û¢·ûè·üí·ûê·ûî·ûë‚Äã·ûñ·üÅ·ûâ·ûõ·üÅ·ûâ‚Äã·ûä·üÇ·ûõ‚Äã·ûò·û∂·ûì‚Äã·ûò·ûº·ûõ·ûä·üí·ûã·û∂·ûì‚Äã·ûõ·ûæ Strigi
 Comment[ko]=Strigi Í∏∞Î∞ò Ï†ÑÎ¨∏ Í≤ÄÏÉâ
+Comment[lt]=Viso teksto paie≈°ka, paremta Strigi
 Comment[lv]=Strigi bƒÅzƒìta pilna teksta meklƒì≈°ana
 Comment[nb]=Strigi-basert fullteksts√∏k
 Comment[nds]=Heeltexts√∂√∂k mit Strigi
@@ -51,6 +55,7 @@
 Comment[pt]=Um motor de busca por texto completo baseado no Strigi
 Comment[pt_BR]=Pesquisa por texto completo baseada no Strigi
 Comment[ro]=CƒÉutare integralƒÉ de text bazatƒÉ pe Strigi
+Comment[sl]=Iskanje po vsem besedilu, ki temelji na Strigi
 Comment[sv]=Fulltexts√∂kning baserad p√• Strigi
 Comment[tr]=Strigi-tabanlƒ± tam metin aramasƒ±
 Comment[uk]=–ü–æ–≤–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–∏–π –ø–æ—à—É–∫ –Ω–∞ –æ—Å–Ω–æ–≤—ñ Strigi
Index: akonadi/plugins/akonadi_serializer_addressee.desktop
===================================================================
--- akonadi/plugins/akonadi_serializer_addressee.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/plugins/akonadi_serializer_addressee.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -10,8 +10,9 @@
 Name[ga]=Srath√≥ir Seolaithe
 Name[gl]=Serializador de Destinatarios
 Name[it]=Serializzatore degli indirizzi
-Name[ja]=Âèó‰ø°ËÄÖ„Ç∑„É™„Ç¢„É©„Ç§„Ç∂
+Name[ja]=Âèó‰ø°ËÄÖÁî®„Ç∑„É™„Ç¢„É©„Ç§„Ç∂
 Name[km]=·ûò·üâ·û∂·ûü·üä·û∏·ûì‚Äã·ûî·üÑ·üá·ûñ·ûª·ûò·üí·ûñ‚Äã·û¢·üí·ûì·ûÄ‚Äã·ûë·ûë·ûΩ·ûõ·ûü·üÜ·ûî·ûª·ûè·üí·ûö
+Name[lt]=Adresat≈≥ serializatorius
 Name[lv]=Adre≈°u serializƒìtƒÅjs
 Name[nb]=Adressat-serialiserer
 Name[nds]=Adressaten-Reegmoduul
@@ -43,6 +44,7 @@
 Comment[it]=Un'estensione di Akonadi per la serializzazione degli indirizzi
 Comment[ja]=Âèó‰ø°ËÄÖ„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÅÆ„Åü„ÇÅ„ÅÆ Akonadi „Ç∑„É™„Ç¢„É©„Ç§„Ç∂„Éó„É©„Ç∞„Ç§„É≥
 Comment[km]=·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûá·üÜ·ûì·ûΩ·ûô‚Äã·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûî·üÑ·üá·ûñ·ûª·ûò·üí·ûñ Akonadi ·ûü·ûò·üí·ûö·û∂·ûî·üã‚Äã·ûú·ûè·üí·ûê·ûª‚Äã·û¢·üí·ûì·ûÄ‚Äã·ûë·ûë·ûΩ·ûõ‚Äã·ûü·üÜ·ûî·ûª·ûè·üí·ûö
+Comment[lt]=Akonadi adresat≈≥ objekt≈≥ serializatoriaus priedas
 Comment[lv]=Akonadi adre≈°u serializƒì≈°anas spraudnis
 Comment[nb]=Et Akonadi programtillegg for serialisering av adressat-objekter
 Comment[nds]=Akonadi-Inreegmoduul f√∂r Adressaten
Index: akonadi/plugins/akonadi_serializer_bookmark.desktop
===================================================================
--- akonadi/plugins/akonadi_serializer_bookmark.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/plugins/akonadi_serializer_bookmark.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -10,8 +10,9 @@
 Name[ga]=Srath√≥ir leabharmharcanna
 Name[gl]=Serializador de marcadores
 Name[it]=Serializzatore dei segnalibri
-Name[ja]=„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ„Ç∑„É™„Ç¢„É©„Ç§„Ç∂
+Name[ja]=„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØÁî®„Ç∑„É™„Ç¢„É©„Ç§„Ç∂
 Name[km]=·ûò·üâ·û∂·ûü·üä·û∏·ûì‚Äã·ûî·üÑ·üá·ûñ·ûª·ûò·üí·ûñ‚Äã·ûÖ·üÜ·ûé·û∂·üÜ
+Name[lt]=≈Ωymeli≈≥ serializatorius
 Name[lv]=GrƒÅmatzƒ´mju serializƒìtƒÅjs
 Name[nb]=Bokmerke-serialisering
 Name[nds]=Leesteken-Reegmoduul
@@ -42,6 +43,7 @@
 Comment[it]=Un'estensione di Akonadi per la serializzazione dei segnalibri
 Comment[ja]=„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÅÆ„Åü„ÇÅ„ÅÆ Akonadi „Ç∑„É™„Ç¢„É©„Ç§„Ç∂„Éó„É©„Ç∞„Ç§„É≥
 Comment[km]=·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûá·üÜ·ûì·ûΩ·ûô‚Äã·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûî·üÑ·üá·ûñ·ûª·ûò·üí·ûñ Akonadi ·ûü·ûò·üí·ûö·û∂·ûî·üã‚Äã·ûú·ûè·üí·ûê·ûª‚Äã·ûÖ·üÜ·ûé·û∂·üÜ
+Comment[lt]=Akonadi serializatoriaus priedas ≈æymeli≈≥ objektams
 Comment[lv]=Akonadi grƒÅmatzƒ´mju serializƒì≈°anas spraudnis
 Comment[nb]=Et Akonadi programtillegg for serialisering av  bokmerke-objekter
 Comment[nds]=Akonadi-Inreegmoduul f√∂r Leestekens
Index: akonadi/plugins/akonadi_serializer_contactgroup.desktop
===================================================================
--- akonadi/plugins/akonadi_serializer_contactgroup.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/plugins/akonadi_serializer_contactgroup.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -7,9 +7,12 @@
 Name[es]=Serializador de grupos de contactos
 Name[et]=Kontaktir√ºhma jadasti
 Name[fr]=S√©rialiseur de groupes de contacts
+Name[ga]=Srath√≥ir Gr√∫pa Teagmh√°lacha
 Name[gl]=Serializador de Grupo de Contacto
 Name[it]=Serializzatore gruppi di contatti
+Name[ja]=ÈÄ£Áµ°ÂÖà„Ç∞„É´„Éº„ÉóÁî®„Ç∑„É™„Ç¢„É©„Ç§„Ç∂
 Name[km]=·û¢·üí·ûì·ûÄ‚Äã·ûä·û∂·ûÄ·üã‚Äã·ûõ·üÅ·ûÅ‚Äã·ûü·üÄ·ûö·üÄ·ûõ‚Äã·ûÄ·üí·ûö·ûª·ûò‚Äã·ûë·üÜ·ûì·û∂·ûÄ·üã·ûë·üÜ·ûì·ûÑ
+Name[lt]=Kontakt≈≥ grupi≈≥ serializatorius
 Name[lv]=Kontaktu grupu serializƒìtƒÅjs
 Name[nb]=Gruppeserialisering for kontakter
 Name[nds]=Kontaktkoppel-Reegmoduul
@@ -34,9 +37,12 @@
 Comment[es]=Un complemento serializador de Akonadi para objetos de grupos de contacto
 Comment[et]=Akonadi kontaktir√ºhma objektide jadastamisplugin
 Comment[fr]=Un module externe Akonadi pour la s√©rialisation des groupes de contacts
+Comment[ga]=Breise√°n srath√≥ra Akonadi le haghaidh gr√∫pa√≠ teagmh√°lacha
 Comment[gl]=Engadido de serializaci√≥n de Akonadi para obxectos de grupo de contacto
 Comment[it]=Un'estensione di Akonadi per la serializzazione dei gruppi di contatti
+Comment[ja]=ÈÄ£Áµ°ÂÖà„Ç∞„É´„Éº„Éó„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÅÆ„Åü„ÇÅ„ÅÆ Akonadi „Ç∑„É™„Ç¢„É©„Ç§„Ç∂„Éó„É©„Ç∞„Ç§„É≥
 Comment[km]=·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏·ûá·üÜ·ûì·ûΩ·ûô‚Äã·û¢·üí·ûì·ûÄ‚Äã·ûä·û∂·ûÄ·üã·ûõ·üÅ·ûÅ·ûü·üÄ·ûö·üÄ·ûõ Akonadi ·ûü·ûò·üí·ûö·û∂·ûî·üã‚Äã·ûú·ûè·üí·ûê·ûª‚Äã·ûÄ·üí·ûö·ûª·ûò‚Äã·ûë·üÜ·ûì·û∂·ûÄ·üã·ûë·üÜ·ûì·ûÑ
+Comment[lt]=Akonadi serializatoriaus priedas kontakt≈≥ grupi≈≥ objektams
 Comment[lv]=Akonadi kontaktu grupu  serializƒì≈°anas spraudnis
 Comment[nb]=Et Akonadi programtillegg for serialisering av kontaktgruppe-objekter
 Comment[nds]=Akonadi-Inreegmoduul f√∂r Kontaktkoppeln
Index: akonadi/plugins/akonadi_serializer_kcal.desktop
===================================================================
--- akonadi/plugins/akonadi_serializer_kcal.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/plugins/akonadi_serializer_kcal.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -10,7 +10,7 @@
 Name[ga]=Srath√≥ir Imeachta√≠
 Name[gl]=Serializador de Incidencias
 Name[it]=Serializzatore occorrenze
-Name[ja]=„Ç§„Éô„É≥„Éà„Ç∑„É™„Ç¢„É©„Ç§„Ç∂
+Name[ja]=„Ç§„Éô„É≥„ÉàÁî®„Ç∑„É™„Ç¢„É©„Ç§„Ç∂
 Name[km]=·ûò·üâ·û∂·ûü·üä·û∏·ûì·ûî·üÑ·üá·ûñ·ûª·ûò·üí·ûñ‚Äã·ûß·ûî·üí·ûî·ûè·üí·ûè·û∑·û†·üÅ·ûè·ûª
 Name[lv]=Notikumu serializƒìtƒÅjs
 Name[nb]=Forekomst-serialisering
Index: akonadi/plugins/akonadi_serializer_mail.desktop
===================================================================
--- akonadi/plugins/akonadi_serializer_mail.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/plugins/akonadi_serializer_mail.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -10,7 +10,7 @@
 Name[ga]=Srath√≥ir R√≠omhphoist
 Name[gl]=Serializador de Correo
 Name[it]=Serializzatore posta elettronica
-Name[ja]=„É°„Éº„É´„Ç∑„É™„Ç¢„É©„Ç§„Ç∂
+Name[ja]=„É°„Éº„É´Áî®„Ç∑„É™„Ç¢„É©„Ç§„Ç∂
 Name[km]=·ûò·üâ·û∂·ûü·üä·û∏·ûì‚Äã·ûî·üÑ·üá·ûñ·ûª·ûò·üí·ûñ‚Äã·ûü·üÜ·ûî·ûª·ûè·üí·ûö
 Name[lv]=Pasta serializƒìtƒÅjs
 Name[nb]=E-post-serialisering
Index: akonadi/kabc/kcontactmanager/kcontactmanager.desktop
===================================================================
--- akonadi/kabc/kcontactmanager/kcontactmanager.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/kabc/kcontactmanager/kcontactmanager.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -23,6 +23,7 @@
 GenericName[ja]=ÈÄ£Áµ°ÂÖà„Éû„Éç„Éº„Ç∏„É£
 GenericName[km]=·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûÇ·üí·ûö·ûî·üã·ûÇ·üí·ûö·ûÑ‚Äã·ûë·üÜ·ûì·û∂·ûÄ·üã·ûë·üÜ·ûì·ûÑ
 GenericName[ko]=Ïó∞ÎùΩÏ≤ò Í¥ÄÎ¶¨Ïûê
+GenericName[lt]=Kontakt≈≥ tvarkytuvƒó
 GenericName[lv]=Kontaktu pƒÅrvaldnieks
 GenericName[nb]=Kontaktbehandler
 GenericName[nds]=Kontaktenpleger
Index: akonadi/clients/akonadiconsole/akonadiconsole.desktop
===================================================================
--- akonadi/clients/akonadiconsole/akonadiconsole.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/clients/akonadiconsole/akonadiconsole.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -13,6 +13,7 @@
 Name[ja]=Akonadi „Ç≥„É≥„ÇΩ„Éº„É´
 Name[km]=·ûÄ·ûª·ûÑ·ûü·ûº·ûõ‚Äã·ûö·ûî·ûü·üã Akonadi
 Name[ko]=Akonadi ÏΩòÏÜî
+Name[lt]=Akonadi konsolƒó
 Name[lv]=Anokadi konsole
 Name[nb]=Akonadi-konsoll
 Name[nds]=Akonadi-Konsool
@@ -24,6 +25,7 @@
 Name[pt_BR]=Console do Akonadi
 Name[ro]=ConsolƒÉ Akonadi
 Name[ru]=–ö–æ–Ω—Å–æ–ª—å Akonadi
+Name[sl]=Konzola za Akonadi
 Name[sv]=Akonadi-terminal
 Name[tr]=Akonadi U√ßbirimi
 Name[uk]=–¢–µ—Ä–º—ñ–Ω–∞–ª Akonadi
@@ -48,6 +50,7 @@
 Comment[ja]=Akonadi „ÅÆÁÆ°ÁêÜ„Å®„Éá„Éê„ÉÉ„Ç∞„ÅÆ„Åü„ÇÅ„ÅÆ„Ç≥„É≥„ÇΩ„Éº„É´
 Comment[km]=·ûÄ·û∂·ûö‚Äã·ûÇ·üí·ûö·ûî·üã·ûÇ·üí·ûö·ûÑ Akonadi ·ûì·û∑·ûÑ‚Äã·ûÄ·ûª·ûÑ·ûü·ûº·ûõ‚Äã·ûî·üÜ·ûî·û∂·ûè·üã‚Äã·ûÄ·üÜ·û†·ûª·ûü
 Comment[ko]=Akonadi Í¥ÄÎ¶¨ Î∞è ÎîîÎ≤ÑÍπÖ ÏΩòÏÜî
+Comment[lt]=Akonadi tvarkymo ir i≈°riktavimo konsolƒó
 Comment[lv]=Akonadi pƒÅrvaldƒ´bas un atkƒº≈´do≈°anas konsole
 Comment[nb]=Konsoll for Akonadi administrasjon og feils√∏king
 Comment[nds]=Akonadi sien Pleeg- un Fehlers√∂√∂k-Konsool
@@ -59,6 +62,7 @@
 Comment[pt_BR]=Console de gerenciamento e depura√ß√£o do Akonadi
 Comment[ro]=ConsolƒÉ de administrare »ôi depanare Akonadi
 Comment[ru]=–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Akonadi –∏ –∫–æ–Ω—Å–æ–ª—å –æ—Ç–ª–∞–¥–∫–∏
+Comment[sl]=Akonadijeva konzola za upravljanje in razhro≈°ƒçevanje
 Comment[sv]=Akonadi hanterings- och fels√∂kningsterminal
 Comment[tr]=Akonadi Y√∂netim ve Hata Ayƒ±klama U√ßbirimi
 Comment[uk]=–¢–µ—Ä–º—ñ–Ω–∞–ª –∫–µ—Ä—É–≤–∞–Ω–Ω—è —ñ –∑–Ω–µ–≤–∞–¥–∂–µ–Ω–Ω—è Akonadi
Index: akonadi/kcal/assignmentvisitor.cpp
===================================================================
--- akonadi/kcal/assignmentvisitor.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 0)
+++ akonadi/kcal/assignmentvisitor.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -0,0 +1,123 @@
+/*
+    Copyright (c) 2009 Kevin Krammer <kevin.krammer@gmx.at>
+
+    This library is free software; you can redistribute it and/or modify it
+    under the terms of the GNU Library General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or (at your
+    option) any later version.
+
+    This library is distributed in the hope that it will be useful, but WITHOUT
+    ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+    FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Library General Public
+    License for more details.
+
+    You should have received a copy of the GNU Library General Public License
+    along with this library; see the file COPYING.LIB.  If not, write to the
+    Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
+    02110-1301, USA.
+*/
+
+#include "assignmentvisitor.h"
+
+#include <kcal/event.h>
+#include <kcal/freebusy.h>
+#include <kcal/journal.h>
+#include <kcal/todo.h>
+
+#include <kdebug.h>
+
+using namespace KCal;
+
+class AssignmentVisitor::Private
+{
+  public:
+    Private() : mSource( 0 ) {}
+
+  public:
+    const IncidenceBase *mSource;
+};
+
+AssignmentVisitor::AssignmentVisitor() : d( new Private() )
+{
+}
+
+AssignmentVisitor::~AssignmentVisitor()
+{
+  delete d;
+}
+
+bool AssignmentVisitor::assign( IncidenceBase *target, const IncidenceBase *source )
+{
+  Q_ASSERT( target != 0 );
+  Q_ASSERT( source != 0 );
+
+  d->mSource = source;
+
+  bool result = target->accept( *this );
+
+  d->mSource = 0;
+
+  return result;
+}
+
+bool AssignmentVisitor::visit( Event *event )
+{
+  Q_ASSERT( event != 0 );
+
+  const Event *source = dynamic_cast<const Event*>( d->mSource );
+  if ( source == 0 ) {
+    kError(5800) << "Type mismatch: source is" << d->mSource->type()
+                 << "target is" << event->type();
+    return false;
+  }
+
+  *event = *source;
+  return true;
+}
+
+bool AssignmentVisitor::visit( Todo *todo )
+{
+  Q_ASSERT( todo != 0 );
+
+  const Todo *source = dynamic_cast<const Todo*>( d->mSource );
+  if ( source == 0 ) {
+    kError(5800) << "Type mismatch: source is" << d->mSource->type()
+                 << "target is" << todo->type();
+    return false;
+  }
+
+  *todo = *source;
+  return true;
+}
+
+bool AssignmentVisitor::visit( Journal *journal )
+{
+  Q_ASSERT( journal != 0 );
+
+  const Journal *source = dynamic_cast<const Journal*>( d->mSource );
+  if ( source == 0 ) {
+    kError(5800) << "Type mismatch: source is" << d->mSource->type()
+                 << "target is" << journal->type();
+    return false;
+  }
+
+  *journal = *source;
+  return true;
+}
+
+bool AssignmentVisitor::visit( FreeBusy *freebusy )
+{
+  Q_ASSERT( freebusy != 0 );
+
+  const FreeBusy *source = dynamic_cast<const FreeBusy*>( d->mSource );
+  if ( source == 0 ) {
+    kError(5800) << "Type mismatch: source is" << d->mSource->type()
+                 << "target is" << freebusy->type();
+    return false;
+  }
+
+  *freebusy = *source;
+  return true;
+}
+
+// kate: space-indent on; indent-width 2; replace-tabs on;
Index: akonadi/kcal/CMakeLists.txt
===================================================================
--- akonadi/kcal/CMakeLists.txt	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/kcal/CMakeLists.txt	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -10,6 +10,7 @@
 ########### next target ###############
 
 set( kcalakonadi_LIB_SRC
+     assignmentvisitor.cpp
      kcalmimetypevisitor.cpp
      kcalmodel.cpp
      kcalitembrowser.cpp
Index: akonadi/kcal/assignmentvisitor.h
===================================================================
--- akonadi/kcal/assignmentvisitor.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 0)
+++ akonadi/kcal/assignmentvisitor.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -0,0 +1,117 @@
+/*
+    Copyright (c) 2009 Kevin Krammer <kevin.krammer@gmx.at>
+
+    This library is free software; you can redistribute it and/or modify it
+    under the terms of the GNU Library General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or (at your
+    option) any later version.
+
+    This library is distributed in the hope that it will be useful, but WITHOUT
+    ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+    FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Library General Public
+    License for more details.
+
+    You should have received a copy of the GNU Library General Public License
+    along with this library; see the file COPYING.LIB.  If not, write to the
+    Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
+    02110-1301, USA.
+*/
+
+#ifndef KCAL_ASSIGNMENTVISITOR_H
+#define KCAL_ASSIGNMENTVISITOR_H
+
+#include "akonadi-kcal_export.h"
+
+#include <kcal/incidencebase.h>
+
+namespace KCal {
+
+/**
+  Helper for type correct assignment of incidence pointers.
+
+  Usage example:
+  @code
+  KCal::Incidence *currentIncidence; // assume this is set somewhere else
+  KCal::Incidence *updatedIncidence; // assume this is set somewhere else
+
+  ::AssignmentVisitor visitor;
+
+  // assign
+  if ( !visitor.assign(currentIncidence, updatedIncidence) ) {
+    // not of same type
+  }
+  @endcode
+
+  @author Kevin Krammer \<kevin.krammer@gmx.at\>
+
+  @since 4.3
+ */
+class AKONADI_KCAL_EXPORT AssignmentVisitor : public IncidenceBase::Visitor
+{
+  public:
+    /**
+      Creates a visitor instance.
+     */
+    AssignmentVisitor();
+
+    /**
+      Destroys the instance
+     */
+    virtual ~AssignmentVisitor();
+
+    /**
+      Assigns the @p source to the @p target
+
+      Basically the sub type equivalent of
+      @code
+      *target = *source
+      @endcode
+
+      @param target the instance to assign to
+      @param source the instance to assign from
+
+      @return @c false if the two objects are of different type
+     */
+    bool assign( IncidenceBase *target, const IncidenceBase *source );
+
+    /**
+      Tries to assign to the given @p event
+
+      @return @c false if the source passed to assign() is of a different type
+     */
+    virtual bool visit( Event *event );
+
+    /**
+      Tries to assign to the given @p todo
+
+      @return @c false if the source passed to assign() is of a different type
+     */
+    virtual bool visit( Todo *todo );
+
+    /**
+      Tries to assign to the given @p journal
+
+      @return @c false if the source passed to assign() is of a different type
+     */
+    virtual bool visit( Journal *journal );
+
+    /**
+      Tries to assign to the given @p freebusy^
+
+      @return @c false if the source passed to assign() is of a different type
+     */
+    virtual bool visit( FreeBusy *freebusy );
+
+  private:
+    //@cond PRIVATE
+    class Private;
+    Private *const d;
+    //@endcond
+
+    Q_DISABLE_COPY( AssignmentVisitor )
+};
+
+}
+
+#endif
+// kate: space-indent on; indent-width 2; replace-tabs on;
Index: akonadi/kcm/kcm_akonadi_server.desktop
===================================================================
--- akonadi/kcm/kcm_akonadi_server.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/kcm/kcm_akonadi_server.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -20,11 +20,13 @@
 Name[es]=Configuraci√≥n del servidor Akonadi
 Name[et]=Akonadi serveri seadistused
 Name[fr]=Configuration du serveur Akonadi
+Name[ga]=Cumra√≠ocht Fhreastala√≠ Akonadi
 Name[gl]=Configuraci√≥n do Servidor Akonadi 
 Name[it]=Configurazione del server Akonadi
 Name[ja]=Akonadi „Çµ„Éº„Éê„ÅÆË®≠ÂÆö
 Name[km]=·ûÄ·û∂·ûö‚Äã·ûÄ·üÜ·ûé·ûè·üã‚Äã·ûö·ûÖ·ûì·û∂·ûü·ûò·üí·ûñ·üê·ûì·üí·ûí‚Äã·ûò·üâ·û∂·ûü·üä·û∏·ûì·ûî·ûò·üí·ûö·ûæ Akonadi
 Name[ko]=Akonadi ÏÑúÎ≤Ñ ÏÑ§Ï†ï
+Name[lt]=Akonadi serverio konfig≈´ravimas
 Name[lv]=Akonadi servera konfigurƒÅcija
 Name[nb]=Akonadi tjeneroppsett
 Name[nds]=Akonadi-Serverinstellen
@@ -35,6 +37,7 @@
 Name[pt]=Configura√ß√£o do Servidor de Akonadi
 Name[pt_BR]=Configura√ß√£o do servidor do Akonadi
 Name[ro]=Configurare server Akonadi
+Name[sl]=Nastavitev stre≈ænika Akonadi
 Name[sv]=Akonadi-serverinst√§llning
 Name[tr]=Akonadi Sunucu Yapƒ±landƒ±rmasƒ±
 Name[uk]=–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä–∞ Akonadi
Index: akonadi/kcm/kcm_akonadi_resources.desktop
===================================================================
--- akonadi/kcm/kcm_akonadi_resources.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/kcm/kcm_akonadi_resources.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -26,6 +26,7 @@
 Name[ja]=Akonadi „É™„ÇΩ„Éº„Çπ„ÅÆË®≠ÂÆö
 Name[km]=·ûÄ·û∂·ûö‚Äã·ûÄ·üÜ·ûé·ûè·üã‚Äã·ûö·ûÖ·ûì·û∂·ûü·ûò·üí·ûñ·üê·ûì·üí·ûí‚Äã·ûí·ûì·ûí·û∂·ûì Akonadi
 Name[ko]=Akonadi ÏûêÏõê ÏÑ§Ï†ï
+Name[lt]=Akonadi resurs≈≥ konfig≈´ravimas
 Name[lv]=Akonadi resursu konfigurƒÅcija
 Name[nb]=Akonadi ressursoppsett
 Name[nds]=Akonadi-Ressourceninstellen
@@ -36,6 +37,7 @@
 Name[pt]=Configura√ß√£o dos Recursos do Akonadi
 Name[pt_BR]=Configura√ß√£o dos recursos do Akonadi
 Name[ro]=Configurare resurse Akonadi
+Name[sl]=Nastavitev virov za Akonadi
 Name[sv]=Akonadi-resursinst√§llning
 Name[tr]=Akonadi Kaynak Yapƒ±landƒ±rmasƒ±
 Name[uk]=–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ Akonadi
Index: akonadi/kcm/kcm_akonadi.desktop
===================================================================
--- akonadi/kcm/kcm_akonadi.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/kcm/kcm_akonadi.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -22,11 +22,13 @@
 Name[es]=Configuraci√≥n de Akonadi
 Name[et]=Akonadi seadistused
 Name[fr]=Configuration d'Akonadi
+Name[ga]=Cumra√≠ocht Akonadi
 Name[gl]=Configuraci√≥n do Akonadi 
 Name[it]=Configurazione di Akonadi
 Name[ja]=Akonadi „ÅÆË®≠ÂÆö
 Name[km]=·ûÄ·û∂·ûö‚Äã·ûÄ·üÜ·ûé·ûè·üã‚Äã·ûö·ûÖ·ûì·û∂·ûü·ûò·üí·ûñ·üê·ûì·üí·ûí‚Äã·ûò·üâ·û∂·ûü·üä·û∏·ûì·ûî·ûò·üí·ûö·ûæ Akonadi
 Name[ko]=Akonadi ÏÑ§Ï†ï
+Name[lt]=Akonadi konfig≈´ravimas
 Name[lv]=Akonadi konfigurƒÅcija
 Name[nb]=Akonadi-oppsett
 Name[nds]=Akonadi-Instellen
@@ -37,6 +39,7 @@
 Name[pt]=Configura√ß√£o do Akonadi
 Name[pt_BR]=Configura√ß√£o do Akonadi
 Name[ro]=Configurare Akonadi
+Name[sl]=Nastavitev Akonadija
 Name[sv]=Akonadi-serverinst√§llning
 Name[tr]=Akonadi Yapƒ±landƒ±rmasƒ±
 Name[uk]=–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Akonadi
@@ -56,6 +59,7 @@
 Comment[ja]=Akonadi PIM (ÂÄã‰∫∫ÊÉÖÂ†±ÁÆ°ÁêÜ) „Éï„É¨„Éº„É†„ÉØ„Éº„ÇØ„ÅÆË®≠ÂÆö
 Comment[km]=·ûÄ·û∂·ûö‚Äã·ûÄ·üÜ·ûé·ûè·üã‚Äã·ûö·ûÖ·ûì·û∂·ûü·ûò·üí·ûñ·üê·ûì·üí·ûí‚Äã·ûÇ·ûò·üí·ûö·üÑ·ûÑ·ûÄ·û∂·ûö‚Äã·ûÄ·û∂·ûö‚Äã·ûÇ·üí·ûö·ûî·üã·ûÇ·üí·ûö·ûÑ‚Äã·ûñ·üê·ûè·üå·ûò·û∂·ûì‚Äã·ûï·üí·ûë·û∂·ûõ·üã·ûÅ·üí·ûõ·ûΩ·ûì Akonadi
 Comment[ko]=Akonadi Í∞úÏù∏ Ï†ïÎ≥¥ Í¥ÄÎ¶¨ ÌîÑÎ†àÏûÑÏõåÌÅ¨ ÏÑ§Ï†ï
+Comment[lt]=Akonadi asmeninƒós informacijos tvarkymo aplinkos konfig≈´ravimas
 Comment[lv]=Akonadi personƒ´gƒÅs informƒÅcijas pƒÅrvaldƒ´bas ietvara konfigurƒÅcija
 Comment[nb]=Sette opp rammeverket for Akonadi personlig informasjonsbehandler
 Comment[nds]=Den Pleger f√∂r pers√∂√∂nliche Informatschonen Akonadi instellen
@@ -65,6 +69,7 @@
 Comment[pl]=Konfiguracja Akonadi - systemu zarzƒÖdzania informacjƒÖ osobistƒÖ
 Comment[pt]=Configura√ß√£o da plataforma de Gest√£o de Informa√ß√£o Pessoal do Akonadi
 Comment[pt_BR]=Configura√ß√£o da plataforma do gerenciador de informa√ß√µes pessoais do Akonadi
+Comment[sl]=Nastavitev ogrodja Akonadi za upravljanje z osebnimi podatki
 Comment[sv]=Inst√§llning av Akonadi: Ramverk f√∂r personlig informationshantering
 Comment[tr]=Akonadi Ki≈üisel Bilgi Y√∂netimi √ßalƒ±≈üma ortamƒ±nƒ±n yapƒ±landƒ±rmasƒ±
 Comment[uk]=–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –æ–±–æ–ª–æ–Ω–∫–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –æ—Å–æ–±–∏—Å—Ç–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é Akonadi
Index: akonadi/resources/distlist/distlistresource.desktop
===================================================================
--- akonadi/resources/distlist/distlistresource.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/distlist/distlistresource.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -7,6 +7,7 @@
 Name[es]=Archivo de lista de distribuci√≥n
 Name[et]=Postiloendi fail
 Name[fr]=Fichier de liste de distribution
+Name[ga]=Comhad Liosta D√°ilte
 Name[gl]=Ficheiro Distributionlist
 Name[it]=File lista di distribuzione
 Name[ja]=ÈÖçÂ∏É„É™„Çπ„Éà„Éï„Ç°„Ç§„É´
@@ -22,6 +23,7 @@
 Name[pt]=Ficheiro de Lista de Distribui√ß√£o
 Name[pt_BR]=Arquivo de lista de distribui√ß√£o
 Name[ro]=Fi»ôier-listƒÉ distribu»õie
+Name[sl]=Datoteka s seznamom za razpo≈°iljanje
 Name[sv]=Fil med f√∂rdelningslista
 Name[tr]=Daƒüƒ±tƒ±m Listesi Dosyasƒ±
 Name[uk]=–§–∞–π–ª —Å–ø–∏—Å–∫—É —Ä–æ–∑–ø–æ–≤—Å—é–¥–∂–µ–Ω–Ω—è
@@ -36,6 +38,7 @@
 Comment[es]=Carga datos desde un archivo de lista de distribuci√≥n.
 Comment[et]=Andmete laadimine postiloendi failist
 Comment[fr]=Charger les donn√©es depuis un fichier de liste de distribution
+Comment[ga]=Breise√°n a luchta√≠onn sonra√≠ √≥ chomhad liosta d√°ilte
 Comment[gl]=Carrega datos desde un ficheiro de distribuci√≥n
 Comment[it]=Carica dati da un file contenente una lista di distribuzione
 Comment[ja]=ÈÖçÂ∏É„É™„Çπ„Éà„Éï„Ç°„Ç§„É´„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åô
@@ -50,6 +53,7 @@
 Comment[pt]=Carrega os dados a partir de um ficheiro de lista de distribui√ß√£o
 Comment[pt_BR]=Carrega os dados de um arquivo de lista de distribui√ß√£o
 Comment[ro]=√éncarcƒÉ date dintr-un fi»ôier distributionlist
+Comment[sl]=Nalo≈æi podatke iz datoteke s seznamom za razpo≈°iljanje
 Comment[sv]=Laddar data fr√•n en fil med en f√∂rdelningslista
 Comment[tr]=Bir daƒüƒ±tƒ±m listesi dosyasƒ±ndan veri y√ºkler
 Comment[uk]=–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –¥–∞–Ω—ñ –∑ —Ñ–∞–π–ª–∞ —Å–ø–∏—Å–∫—É —Ä–æ–∑–ø–æ–≤—Å—é–¥–∂–µ–Ω–Ω—è
Index: akonadi/resources/nntp/nntpresource.desktop
===================================================================
--- akonadi/resources/nntp/nntpresource.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/nntp/nntpresource.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -20,6 +20,7 @@
 Name[pl]=Grupy Usenet (NNTP)
 Name[pt]=Grupos de Not√≠cias da Usenet (NNTP)
 Name[pt_BR]=Grupos de not√≠cias da Usenet (NNTP)
+Name[sl]=Noviƒçarske skupine (NNTP)
 Name[sv]=Usenet-nyhetsgrupper (NNTP)
 Name[tr]=Usenet Haber Grubu (NNTP)
 Name[uk]=–ì—Ä—É–ø–∏ –Ω–æ–≤–∏–Ω Usenet (NNTP)
@@ -48,6 +49,7 @@
 Comment[pl]=Umo≈ºliwia czytanie wiadomo≈õci z serwer√≥w nius√≥w
 Comment[pt]=Possibilita a leitura de artigos de um servidor de not√≠cias
 Comment[pt_BR]=Possibilita a leitura de artigos de um servidor de not√≠cias
+Comment[sl]=Omogoƒça branje sestavkov na stre≈æniku z noviƒçarskimi skupinami
 Comment[sv]=G√∂r det m√∂jligt att l√§sa artiklar fr√•n en nyhetsserver
 Comment[tr]=Bir haber sunucusundan haberleri okumak i√ßin bir ara√ß
 Comment[uk]=–†–æ–±–∏—Ç—å –º–æ–∂–ª–∏–≤–∏–º —á–∏—Ç–∞–Ω–Ω—è —Å—Ç–∞—Ç–µ–π –∑ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–æ–≤–∏–Ω
Index: akonadi/resources/vcard/vcardresource.desktop
===================================================================
--- akonadi/resources/vcard/vcardresource.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/vcard/vcardresource.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -8,6 +8,7 @@
 Name[es]=Archivo VCard
 Name[et]=VCard-fail
 Name[fr]=Fichier VCard
+Name[ga]=Comhad v-Ch√°rta
 Name[gl]=Ficheiro de VCard
 Name[it]=File vCard
 Name[ja]=VCard „Éï„Ç°„Ç§„É´
@@ -39,6 +40,7 @@
 Comment[es]=Carga datos de un archivo VCard
 Comment[et]=Andmete laadimine VCard-failist
 Comment[fr]=Charge des donn√©es depuis un fichier au format VCard
+Comment[ga]=Breise√°n a luchta√≠onn sonra√≠ √≥ chomhad v-Ch√°rta
 Comment[gl]=Carrega datos desde un ficheiro VCard
 Comment[it]=Caricare dati da un file vCard
 Comment[ja]=VCard „Éï„Ç°„Ç§„É´„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åô
@@ -54,6 +56,7 @@
 Comment[pt]=Carrega os dados de um ficheiro VCard
 Comment[pt_BR]=Carrega os dados de um arquivo VCard
 Comment[ro]=√éncarcƒÉ date dintr-un fi»ôier vCard
+Comment[sl]=Nalo≈æi podatke iz datoteke VCard
 Comment[sv]=Laddar data fr√•n en vCard-fil
 Comment[tr]=VCard dosyasƒ±ndan veri y√ºkler
 Comment[uk]=–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –¥–∞–Ω—ñ –∑ —Ñ–∞–π–ª–∞ VCard
Index: akonadi/resources/kabc/kabcresource.desktop
===================================================================
--- akonadi/resources/kabc/kabcresource.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/kabc/kabcresource.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -23,6 +23,7 @@
 Name[pt]=Livro de Endere√ßos do KDE (tradicional)
 Name[pt_BR]=Livro de endere√ßos do KDE (tradicional)
 Name[ro]=Carte de adrese KDE (tradi»õionalƒÉ)
+Name[sl]=KDE-jev adresar (tradicionalni)
 Name[sv]=KDE:s adressbok (traditionell)
 Name[tr]=KDE Adres Defteri (geleneksel)
 Name[uk]=–ê–¥—Ä–µ—Å–Ω–∞ –∫–Ω–∏–≥–∞ KDE (—Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–∞)
@@ -38,6 +39,7 @@
 Comment[es]=Carga datos desde un recurso tradicional de Libreta de Direcciones de KDE
 Comment[et]=Andmete laadimine traditsioonilisest KDE aadressiraamatu ressursist
 Comment[fr]=Charge des donn√©es depuis un carnet d'adresses KDE traditionnel
+Comment[ga]=Breise√°n a luchta√≠onn sonra√≠ √≥ acmhainn thraidisi√∫nta leabhair seolta√≠ KDE
 Comment[gl]=Carrega datos desde un recurso de caderno de enderezos do KDE
 Comment[it]=Carica dati da una tradizionale risorsa rubrica di KDE
 Comment[ja]=ÂæìÊù•„ÅÆ KDE „Ç¢„Éâ„É¨„ÇπÂ∏≥„É™„ÇΩ„Éº„Çπ„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åô
@@ -52,6 +54,7 @@
 Comment[pt]=Carrega os dados de um recurso de livro de endere√ßos tradicional do KDE
 Comment[pt_BR]=Carrega os dados do tradicional recurso do livro de endere√ßos do KDE
 Comment[ro]=√éncarcƒÉ date dintr-o resursƒÉ KDE de tip carte de adrese tradi»õionalƒÉ
+Comment[sl]=Nalo≈æi podatke iz tradicionalnega KDE-jevega adresarja
 Comment[sv]=Laddar data fr√•n en traditionell adressboksresurs i KDE
 Comment[tr]=Geleneksel KDE adres defteri kaynaƒüƒ±ndan veri y√ºkler
 Comment[uk]=–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –¥–∞–Ω—ñ –∑—ñ –∑–≤–∏—á–∞–π–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å—É –∞–¥—Ä–µ—Å–Ω–æ—ó –∫–Ω–∏–≥–∏ –¥–ª—è KDE
Index: akonadi/resources/kabc/kabcresource.cpp
===================================================================
--- akonadi/resources/kabc/kabcresource.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/kabc/kabcresource.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -22,6 +22,7 @@
 
 #include <akonadi/cachepolicy.h>
 #include <akonadi/changerecorder.h>
+#include <akonadi/entitydisplayattribute.h>
 #include <akonadi/itemfetchscope.h>
 
 #include <kabc/addressbook.h>
@@ -115,8 +116,10 @@
                  i18nc( "@info:status", "Changing address book plugin configuration" ) );
     KRES::ConfigDialog dlg( 0, QLatin1String( "contact" ), mBaseResource );
     KWindowSystem::setMainWindow( &dlg, windowId );
-    if ( dlg.exec() )
+    if ( dlg.exec() ) {
+      setName( mBaseResource->resourceName() );
       manager->writeConfig( KGlobal::config().data() );
+    }
 
     emit status( Idle, QString() );
     // TODO: need to react on name changes, but do we need to react on data changes?
@@ -184,6 +187,11 @@
   topLevelCollection.setRemoteId( mBaseResource->identifier() );
   topLevelCollection.setName( mBaseResource->resourceName() );
 
+  EntityDisplayAttribute* attr =
+    topLevelCollection.attribute<EntityDisplayAttribute>( Collection::AddIfMissing );
+  attr->setDisplayName( mBaseResource->resourceName() );
+  attr->setIconName( QLatin1String( "office-address-book" ) );
+
   QStringList mimeTypes;
   mimeTypes << QLatin1String( "text/directory" );
 
@@ -218,6 +226,10 @@
       bool readOnly = !mFolderResource->subresourceWritable( subResource );
       childCollection.setRights( readOnly ? readOnlyRights : readWriteRights );
 
+      attr = childCollection.attribute<EntityDisplayAttribute>( Collection::AddIfMissing );
+      attr->setDisplayName( childCollection.name() );
+      attr->setIconName( QLatin1String( "office-address-book" ) );
+
       list << childCollection;
     }
   }
@@ -487,8 +499,16 @@
   }
 
   if ( collection.parent() == Collection::root().id() ) {
-    if ( collection.name() != mBaseResource->resourceName() ) {
-      mBaseResource->setResourceName( collection.name() );
+    QString newName = collection.name();
+    if ( collection.hasAttribute<EntityDisplayAttribute>() ) {
+      EntityDisplayAttribute *attr = collection.attribute<EntityDisplayAttribute>();
+      if ( !attr->displayName().isEmpty() )
+        newName = attr->displayName();
+    }
+
+    if ( newName != mBaseResource->resourceName() ) {
+      mBaseResource->setResourceName( newName );
+      setName( newName );
       mAddressBook->getResourceManager()->writeConfig( KGlobal::config().data() );
     }
   } else
@@ -540,6 +560,8 @@
   // do not react on addressbook changes until we have finished its initial loading
   mAddressBook->blockSignals( true );
 
+  setName( mBaseResource->resourceName() );
+
   return true;
 }
 
Index: akonadi/resources/knut/knutresource.desktop
===================================================================
--- akonadi/resources/knut/knutresource.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/knut/knutresource.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -27,6 +27,7 @@
 Comment[pt]=Um agente para fins de depura√ß√£o
 Comment[pt_BR]=Um agente para depura√ß√£o
 Comment[ro]=Agent pentru scopuri de depanare
+Comment[sl]=Posrednik za potrebe razhro≈°ƒçevanja
 Comment[sv]=En modul f√∂r fels√∂kningssyften
 Comment[tr]=Hata ayƒ±klama ama√ßlƒ± bir ara√ß
 Comment[uk]=–ê–≥–µ–Ω—Ç –¥–ª—è –∑–Ω–µ–≤–∞–¥–∂–µ–Ω–Ω—è
Index: akonadi/resources/maildir/maildirresource.desktop
===================================================================
--- akonadi/resources/maildir/maildirresource.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/maildir/maildirresource.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -13,6 +13,7 @@
 Comment[es]=Carga datos de una carpeta de maildir local.
 Comment[et]=Andmete laadimine kohalikust maildir-kaustast
 Comment[fr]=Charge des donn√©es d'un dossier au format maildir
+Comment[ga]=Breise√°n a luchta√≠onn sonra√≠ √≥ fhillte√°n log√°nta maildir
 Comment[gl]=Carrega datos desde un cartafol de correo local
 Comment[it]=Carica dati da una cartella locale maildir
 Comment[ja]=„É≠„Éº„Ç´„É´„ÅÆ maildir „Éï„Ç©„É´„ÉÄ„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åô
@@ -28,6 +29,7 @@
 Comment[pt]=Carrega os dados de uma pasta Maildir local
 Comment[pt_BR]=Carrega os dados de uma pasta maildir local
 Comment[ro]=√éncarcƒÉ date dintr-un dosar maildir local
+Comment[sl]=Nalo≈æi podatke is krajevne mape s po≈°to (maildir)
 Comment[sv]=Laddar data fr√•n en lokal maildir-katalog
 Comment[tr]=Yerel maildir dizininden veri y√ºkleme aracƒ±
 Comment[uk]=–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –¥–∞–Ω—ñ –∑ –ª–æ–∫–∞–ª—å–Ω–æ—ó —Ç–µ–∫–∏ maildir
Index: akonadi/resources/localbookmarks/localbookmarksresource.desktop
===================================================================
--- akonadi/resources/localbookmarks/localbookmarksresource.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/localbookmarks/localbookmarksresource.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -8,6 +8,7 @@
 Name[es]=Marcadores locales
 Name[et]=Kohalikud j√§rjehoidjad
 Name[fr]=Ressource de signets locaux
+Name[ga]=Leabharmharcanna Log√°nta
 Name[it]=Segnalibri locali
 Name[ja]=„É≠„Éº„Ç´„É´„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ
 Name[km]=·ûÖ·üÜ·ûé·û∂·üÜ‚Äã·ûò·ûº·ûõ·ûä·üí·ûã·û∂·ûì
@@ -21,6 +22,7 @@
 Name[pt]=Favoritos Locais
 Name[pt_BR]=Favoritos locais
 Name[ro]=SemneDeCarteLocale
+Name[sl]=Krajevni zaznamki
 Name[sv]=Lokala bokm√§rken
 Name[tr]=Yerel Yer ƒ∞mleri
 Name[uk]=–õ–æ–∫–∞–ª—å–Ω—ñ –∑–∞–∫–ª–∞–¥–∫–∏
@@ -36,6 +38,7 @@
 Comment[es]=Carga datos de un archivo de marcadores local
 Comment[et]=Andmete laadimine kohalikust j√§rjehoidjafailist
 Comment[fr]=Charge des donn√©es depuis un fichier local de signets
+Comment[ga]=Breise√°n a luchta√≠onn sonra√≠ √≥ chomhad log√°nta leabharmharcanna
 Comment[gl]=Carrega datos desde un ficheiro local de marcadores
 Comment[it]=Carica dati da un file locale di segnalibri
 Comment[ja]=„É≠„Éº„Ç´„É´„ÅÆ„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ„Éï„Ç°„Ç§„É´„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åô
@@ -51,6 +54,7 @@
 Comment[pt]=Carrega os dados a partir de um ficheiro de favoritos local
 Comment[pt_BR]=Carrega os dados de um arquivo de favoritos local
 Comment[ro]=√éncarcƒÉ date dintr-un fi»ôier local de tip semn de carte
+Comment[sl]=Nalo≈æi podatke iz krajevne datoteke z zaznamki
 Comment[sv]=Laddar data fr√•n en lokal bokm√§rkesfil
 Comment[tr]=Yerel bir yer imleri dosyasƒ±ndan veri y√ºkler
 Comment[uk]=–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –¥–∞–Ω—ñ –∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∑–∞–∫–ª–∞–¥–æ–∫
Index: akonadi/resources/imap/imaplibresource.desktop
===================================================================
--- akonadi/resources/imap/imaplibresource.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/imap/imaplibresource.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -10,6 +10,7 @@
 Name[pt]=IMAP do Mailody
 Name[pt_BR]=IMAP do Mailody
 Name[ro]=Imap Mailody
+Name[sl]=Mailody IMAP
 Name[sv]=Mailody IMAP
 Name[x-test]=xxMailody Imapxx
 Name[zh_CN]=Mailody IMAP
@@ -34,6 +35,7 @@
 Comment[pl]=≈ÅƒÖczy z serwerem IMAP. Bazuje na bibliotece IMAP z Mailody.
 Comment[pt]=Liga-se a um servidor de IMAP. Baseia-se na biblioteca de IMAP do Mailody.
 Comment[pt_BR]=Conecta a um servidor IMAP. Baseado na biblioteca de IMAP do Mailody.
+Comment[sl]=Se pove≈æe s stre≈ænikom IMAP. Temelji na knji≈ænici za IMAP iz Mailodya.
 Comment[sv]=Ansluter till en IMAP-server. Baserad p√• IMAP-biblioteket fr√•n Mailody.
 Comment[tr]=Bir IMAP-sunucuya baƒülanƒ±r. Mailody IMAP-kitaplƒ±ƒüƒ±nƒ± temel alƒ±r.
 Comment[uk]=–ó‚Äô—î–¥–Ω—É—î—Ç—å—Å—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º IMAP. –ó–∞—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –±—ñ–±–ª—ñ–æ—Ç–µ—Ü—ñ IMAP –∑ Mailody.
Index: akonadi/resources/shared/singlefileresource.h
===================================================================
--- akonadi/resources/shared/singlefileresource.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/shared/singlefileresource.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -102,6 +102,7 @@
           KDirWatch::self()->addFile( mCurrentUrl.path() );
 
         emit status( Idle, i18nc( "@info:status", "Ready" ) );
+        synchronize();
       }
       else
       {
Index: akonadi/resources/shared/singlefileresourcebase.cpp
===================================================================
--- akonadi/resources/shared/singlefileresourcebase.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/shared/singlefileresourcebase.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -88,7 +88,6 @@
     writeFile();
 
   readFile();
-  synchronize();
 }
 
 void SingleFileResourceBase::handleProgress( KJob *, unsigned long pct )
@@ -127,13 +126,14 @@
   if ( job->error() && job->error() != KIO::ERR_DOES_NOT_EXIST ) {
     emit status( Broken, i18n( "Could not load file '%1'.", mCurrentUrl.prettyUrl() ) );
   } else {
-    readFromFile( KUrl( cacheFile() ).url() );
+    readFromFile( KUrl( cacheFile() ).toLocalFile() );
   }
 
   mDownloadJob = 0;
   KGlobal::deref();
 
   emit status( Idle, i18nc( "@info:status", "Ready" ) );
+  synchronize();
 }
 
 void SingleFileResourceBase::slotUploadJobResult( KJob *job )
Index: akonadi/resources/openchange/ocresource.desktop
===================================================================
--- akonadi/resources/openchange/ocresource.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/openchange/ocresource.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -10,6 +10,7 @@
 Comment[es]=Hace posible trabajar con un servidor OpenChange / Exchange
 Comment[et]=V√µimaldab kasutada OpenChange'i/Exchange'i serverit
 Comment[fr]=Permet de collaborer avec un serveur OpenChange ou Exchange
+Comment[ga]=Breise√°n lenar f√©idir oibri√∫ le freastala√≠ OpenChange / Exchange
 Comment[gl]=Permite traballar cun servidor OpenChange / Exchange
 Comment[it]=Permette di lavorare con un server OpenChange / Exchange
 Comment[ja]=OpenChange/Exchange „Çµ„Éº„Éê„Å®„ÇÑ„Çä„Å®„Çä„Åß„Åç„Çã„Çà„ÅÜ„Å´„Åó„Åæ„Åô
@@ -23,6 +24,7 @@
 Comment[pl]=Umo≈ºliwia wsp√≥≈Çpracƒô z serwerami OpenChange / Exchange
 Comment[pt]=Possibilita a integra√ß√£o com um servidor de OpenChange / Exchange
 Comment[pt_BR]=Possibilita trabalhar com um servidor OpenChange / Exchange
+Comment[sl]=Omogoƒça delo s stre≈ænikom OpenChange/Exchange
 Comment[sv]=G√∂r det m√∂jligt att arbeta med en Openchange- eller Exchange-server
 Comment[tr]=OpenChange / Exchange sunucusu ile √ßalƒ±≈üabilmek i√ßin bir ara√ß
 Comment[uk]=–†–æ–±–∏—Ç—å –º–æ–∂–ª–∏–≤–æ—é —Ä–æ–±–æ—Ç—É –∑ —Å–µ—Ä–≤–µ—Ä–∞–º–∏ OpenChange / Exchange
Index: akonadi/resources/ical/icalresource.cpp
===================================================================
--- akonadi/resources/ical/icalresource.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/ical/icalresource.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -24,6 +24,7 @@
 #include <kcal/calendarlocal.h>
 #include <kcal/incidence.h>
 
+#include <akonadi/kcal/assignmentvisitor.h>
 #include <akonadi/kcal/kcalmimetypevisitor.h>
 
 #include <kdebug.h>
@@ -39,7 +40,9 @@
 typedef boost::shared_ptr<KCal::Incidence> IncidencePtr;
 
 ICalResource::ICalResource( const QString &id )
-    : SingleFileResource<Settings>( id ), mCalendar( 0 ), mMimeVisitor( new KCalMimeTypeVisitor() )
+    : SingleFileResource<Settings>( id ), mCalendar( 0 ),
+      mMimeVisitor( new KCalMimeTypeVisitor() ),
+      mIncidenceAssigner( new AssignmentVisitor() )
 {
   QStringList mimeTypes;
   mimeTypes << QLatin1String( "text/calendar" );
@@ -55,6 +58,7 @@
 {
   delete mCalendar;
   delete mMimeVisitor;
+  delete mIncidenceAssigner;
 }
 
 bool ICalResource::retrieveItem( const Akonadi::Item &item, const QSet<QByteArray> &parts )
@@ -139,8 +143,20 @@
     // not in the calendar yet, should not happen -> add it
     mCalendar->addIncidence( payload.get()->clone() );
   } else {
-    *incidence = *(payload.get());
-    mCalendar->setModified( true );
+    // make sure any observer the resource might have installed gets properly notified
+    incidence->startUpdates();
+    bool assignResult = mIncidenceAssigner->assign( incidence, payload.get() );
+    if ( assignResult )
+      incidence->updated();
+    incidence->endUpdates();
+
+    if ( !assignResult ) {
+      kWarning() << "Item changed incidence type. Replacing it.";
+
+      mCalendar->deleteIncidence( incidence );
+      delete incidence;
+      mCalendar->addIncidence( payload.get()->clone() );
+    }
   }
   fileDirty();
   changeCommitted( item );
Index: akonadi/resources/ical/icalresource.h
===================================================================
--- akonadi/resources/ical/icalresource.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/ical/icalresource.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -24,6 +24,7 @@
 #include "settings.h"
 
 namespace KCal {
+  class AssignmentVisitor;
   class CalendarLocal;
   class IncidenceBase;
 }
@@ -59,6 +60,7 @@
   private:
     KCal::CalendarLocal *mCalendar;
     Akonadi::KCalMimeTypeVisitor *mMimeVisitor;
+    KCal::AssignmentVisitor *mIncidenceAssigner;
 };
 
 #endif
Index: akonadi/resources/ical/icalresource.desktop
===================================================================
--- akonadi/resources/ical/icalresource.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/ical/icalresource.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -8,11 +8,13 @@
 Name[es]=Archivo de calendario ICal
 Name[et]=ICali kalendrifail
 Name[fr]=Fichier de calendrier au format ICal
+Name[ga]=Comhad F√©ilire ICal
 Name[gl]=Ficheiro de Calendario de ICal
 Name[it]=Calendario iCal
 Name[ja]=iCal „Ç´„É¨„É≥„ÉÄ„Éº„Éï„Ç°„Ç§„É´
 Name[km]=·ûØ·ûÄ·ûü·û∂·ûö‚Äã·ûî·üí·ûö·ûè·û∑·ûë·û∑·ûì ICal
 Name[ko]=ICal Îã¨Î†• ÌååÏùº
+Name[lt]=ICal kalendoriaus failas
 Name[lv]=ICal kalendƒÅra failƒÅ
 Name[nb]=ICal kalenderfil
 Name[nds]=ICal-Kalennerdatei
@@ -23,6 +25,7 @@
 Name[pt]=Ficheiro de Calend√°rio ICal
 Name[pt_BR]=Arquivo de calend√°rio ICal
 Name[ro]=Fi»ôier-calendar ICal
+Name[sl]=Koledarska datoteka iCal
 Name[sv]=ICal-kalenderfil
 Name[tr]=ICal Takvim Dosyasƒ±
 Name[uk]=–§–∞–π–ª –∫–∞–ª–µ–Ω–¥–∞—Ä—è ICal
@@ -38,6 +41,7 @@
 Comment[es]=Carga datos de un archivo iCal local
 Comment[et]=Andmete laadimine iCal-failist
 Comment[fr]=Charge des donn√©es depuis un fichier au format iCal
+Comment[ga]=Breise√°n a luchta√≠onn sonra√≠ √≥ chomhad iCal
 Comment[gl]=Carrega datos desde un ficheiro iCal
 Comment[it]=Carica dati da un file iCal
 Comment[ja]=iCal „Éï„Ç°„Ç§„É´„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åô
@@ -53,6 +57,7 @@
 Comment[pt]=Carrega os dados de um ficheiro iCal
 Comment[pt_BR]=Carrega os dados de um arquivo iCal
 Comment[ro]=√éncarcƒÉ date dintr-un fi»ôier iCal
+Comment[sl]=Nalo≈æi podatke iz datoteke iCal
 Comment[sv]=Laddar data fr√•n en iCal-fil
 Comment[tr]=iCal dosyasƒ±ndan veri y√ºkler
 Comment[uk]=–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –¥–∞–Ω—ñ –∑ —Ñ–∞–π–ª–∞ iCal
Index: akonadi/resources/kcal/kcalresource.cpp
===================================================================
--- akonadi/resources/kcal/kcalresource.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/kcal/kcalresource.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1,5 +1,5 @@
 /*
-    Copyright (c) 2008 Kevin Krammer <kevin.krammer@gmx.at>
+    Copyright (c) 2008-2009 Kevin Krammer <kevin.krammer@gmx.at>
 
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
@@ -26,7 +26,9 @@
 #include <kresources/configdialog.h>
 
 #include <akonadi/changerecorder.h>
+#include <akonadi/entitydisplayattribute.h>
 #include <akonadi/itemfetchscope.h>
+#include <akonadi/kcal/assignmentvisitor.h>
 #include <akonadi/kcal/kcalmimetypevisitor.h>
 
 #include <kconfig.h>
@@ -50,7 +52,8 @@
     mResource( 0 ),
     mMimeVisitor( new KCalMimeTypeVisitor() ),
     mFullItemRetrieve( false ),
-    mDelayedSaveTimer( new QTimer( this ) )
+    mDelayedSaveTimer( new QTimer( this ) ),
+    mIncidenceAssigner( new KCal::AssignmentVisitor() )
 {
   // setup for UID generation
   const QString prodId = QLatin1String( "-//Akonadi//NONSGML KDE Compatibility Resource %1//EN" );
@@ -69,6 +72,7 @@
 KCalResource::~KCalResource()
 {
   delete mMimeVisitor;
+  delete mIncidenceAssigner;
 }
 
 void KCalResource::configure( WId windowId )
@@ -78,8 +82,10 @@
                  i18nc( "@info:status", "Changing calendar plugin configuration" ) );
     KRES::ConfigDialog dlg( 0, QLatin1String( "calendar" ), mResource );
     KWindowSystem::setMainWindow( &dlg, windowId );
-    if ( dlg.exec() )
+    if ( dlg.exec() ) {
+      setName( mResource->resourceName() );
       mManager->writeConfig( KGlobal::config().data() );
+    }
 
     emit status( Idle, QString() );
     // TODO: need to react on name changes, but do we need to react on data changes?
@@ -141,6 +147,11 @@
   topLevelCollection.setRemoteId( mResource->identifier() );
   topLevelCollection.setName( mResource->resourceName() );
 
+  EntityDisplayAttribute* attr =
+    topLevelCollection.attribute<EntityDisplayAttribute>( Collection::AddIfMissing );
+  attr->setDisplayName( mResource->resourceName() );
+  attr->setIconName( QLatin1String( "office-calendar" ) );
+
   QStringList mimeTypes;
   mimeTypes << QLatin1String( "text/calendar" );
   mimeTypes += mMimeVisitor->allMimeTypes();
@@ -175,14 +186,26 @@
     childCollection.setRemoteId( subResource );
     childCollection.setName( mResource->labelForSubresource( subResource ) );
 
+    attr = childCollection.attribute<EntityDisplayAttribute>( Collection::AddIfMissing );
+    attr->setDisplayName( childCollection.name() );
+
     const QString type = mResource->subresourceType( subResource );
 
     if ( !type.isEmpty() ) {
       QStringList childMimeTypes( Collection::mimeType() );
       childMimeTypes << QLatin1String( "application/x-vnd.akonadi.calendar." ) + type;
       childCollection.setContentMimeTypes( childMimeTypes );
-    } else
+
+      if ( type == QLatin1String( "journal" ) )
+        attr->setIconName( QLatin1String( "view-pim-journal" ) );
+      else if ( type == QLatin1String( "todo" ) )
+        attr->setIconName( QLatin1String( "view-pim-tasks" ) );
+      else
+        attr->setIconName( QLatin1String( "office-calendar" ) );
+    } else {
+      attr->setIconName( QLatin1String( "office-calendar" ) );
       childCollection.setContentMimeTypes( mimeTypes );
+    }
 
     // TODO we have no API for adding incidences to specific sub resources, so we should
     // not tell Akonadi adding that items is allowed
@@ -330,9 +353,8 @@
   if ( item.hasPayload<IncidencePtr>() ) {
     IncidencePtr incidencePtr = item.payload<IncidencePtr>();
 
-    // TODO check if there is a way to update an incidence instead of delete/add
     KCal::Incidence *incidence = mResource->incidence( incidencePtr->uid() );
-    if ( incidence == 0 || mResource->deleteIncidence( incidence ) ) {
+    if ( incidence == 0 ) {
       incidence = incidencePtr->clone();
       if ( mResource->addIncidence( incidence ) ) {
         if ( !mResource->save( incidence ) ) {
@@ -344,8 +366,30 @@
       }
 
       kError() << "Failed to add incidence to resource";
-    } else
-      kError() << "Failed to delete old incidence from resource";
+    } else {
+      // make sure any observer the resource might have installed gets properly notified
+      incidence->startUpdates();
+      bool assignResult = mIncidenceAssigner->assign( incidence, incidencePtr.get() );
+      if ( assignResult )
+        incidence->updated();
+      incidence->endUpdates();
+
+      if ( !assignResult ) {
+        kWarning() << "Item changed incidence type. Replacing it.";
+
+        mResource->deleteIncidence( incidence );
+        delete incidence;
+        mResource->addIncidence( incidencePtr->clone() );
+        scheduleSaveCalendar();
+      } else {
+        if ( !mResource->save( incidence ) ) {
+          kError() << "Failed to save incidence" << incidence->uid();
+          // resource error emitted by savingError()
+        }
+      }
+      changeCommitted( item );
+      return;
+    }
   }
 
   changeProcessed();
@@ -363,8 +407,12 @@
 
   KCal::Incidence *incidence = mResource->incidence( item.remoteId() );
   if ( incidence != 0 && mResource->deleteIncidence( incidence ) ) {
+    if ( !mResource->save( incidence ) ) {
+      kError() << "Failed to save incidence" << incidence->uid();
+      // resource error emitted by savingError()
+    }
+    delete incidence;
     changeCommitted( item );
-    scheduleSaveCalendar();
     return;
   }
 
@@ -404,8 +452,16 @@
 
   // currently only changing the top level collection's name supported
   if ( collection.parent() == Collection::root().id() ) {
-    if ( collection.name() != mResource->resourceName() ) {
-      mResource->setResourceName( collection.name() );
+    QString newName = collection.name();
+    if ( collection.hasAttribute<EntityDisplayAttribute>() ) {
+      EntityDisplayAttribute *attr = collection.attribute<EntityDisplayAttribute>();
+      if ( !attr->displayName().isEmpty() )
+        newName = attr->displayName();
+    }
+
+    if ( newName != mResource->resourceName() ) {
+      mResource->setResourceName( newName );
+      setName( newName );
       changeCommitted( collection );
       // TODO save config
       return;
@@ -454,6 +510,8 @@
              this, SLOT( loadingError( ResourceCalendar*, const QString& ) ) );
   }
 
+  setName( mResource->resourceName() );
+
   return true;
 }
 
Index: akonadi/resources/kcal/kcalresource.h
===================================================================
--- akonadi/resources/kcal/kcalresource.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/kcal/kcalresource.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -1,5 +1,5 @@
 /*
-    Copyright (c) 2008 Kevin Krammer <kevin.krammer@gmx.at>
+    Copyright (c) 2008-2009 Kevin Krammer <kevin.krammer@gmx.at>
 
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
@@ -26,6 +26,7 @@
 }
 
 namespace KCal {
+  class AssignmentVisitor;
   class ResourceCalendar;
 
   typedef KRES::Manager<ResourceCalendar> CalendarResourceManager;
@@ -79,6 +80,8 @@
 
     QTimer *mDelayedSaveTimer;
 
+    KCal::AssignmentVisitor *mIncidenceAssigner;
+
   private:
     bool openConfiguration();
     void closeConfiguration();
Index: akonadi/resources/kcal/kcalresource.desktop
===================================================================
--- akonadi/resources/kcal/kcalresource.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/kcal/kcalresource.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -8,6 +8,7 @@
 Name[es]=Calendario de KDE (tradicional)
 Name[et]=KDE kalender (traditsiooniline)
 Name[fr]=Calendrier KDE (traditionnel)
+Name[ga]=F√©ilire KDE (traidisi√∫nta)
 Name[gl]=Calendario do KDE (tradicional)
 Name[it]=Calendario di KDE (tradizionale)
 Name[ja]=KDE „Ç´„É¨„É≥„ÉÄ„Éº (ÂæìÊù•„ÅÆ„Çø„Ç§„Éó)
@@ -23,6 +24,7 @@
 Name[pt]=Calend√°rio do KDE (tradicional)
 Name[pt_BR]=Calend√°rio do KDE (tradicional)
 Name[ro]=Calendar KDE (tradi»õional)
+Name[sl]=KDE-jev koledar (tradicionalni)
 Name[sv]=KDE:s kalender (traditionell)
 Name[tr]=KDE Takvimi (geleneksel)
 Name[uk]=–ö–∞–ª–µ–Ω–¥–∞—Ä KDE (—Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–∏–π)
@@ -38,6 +40,7 @@
 Comment[es]=Carga datos desde un recurso tradicional de Calendario de KDE
 Comment[et]=Andmete laadimine traditsioonilisest KDE kalendri ressursist
 Comment[fr]=Charge des donn√©es depuis un calendrier KDE traditionnel
+Comment[ga]=Breise√°n a luchta√≠onn sonra√≠ √≥ acmhainn thraidisi√∫nta fh√©ilire KDE
 Comment[gl]=Carrega datos desde un recurso de calendario tradicional do KDE
 Comment[it]=Carica dati da una tradizionale risorsa calendario di KDE
 Comment[ja]=ÂæìÊù•„ÅÆ KDE „Ç´„É¨„É≥„ÉÄ„Éº„É™„ÇΩ„Éº„Çπ„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åô
@@ -51,6 +54,7 @@
 Comment[pl]=Wczytuje dane z tradycyjnego zasobu kalendarza KDE
 Comment[pt]=Carrega os dados de um recurso de calend√°rio tradicional do KDE
 Comment[pt_BR]=Carrega os dados do tradicional recurso de calend√°rio do KDE
+Comment[sl]=Nalo≈æi podatke iz tradicionalnega KDE-jevega koledarja
 Comment[sv]=Laddar data fr√•n en traditionell kalenderresurs i KDE
 Comment[tr]=Geleneksel KDE takvim kaynaƒüƒ±ndan veri y√ºkler
 Comment[uk]=–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –¥–∞–Ω—ñ –∑—ñ –∑–≤–∏—á–∞–π–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å—É –∫–∞–ª–µ–Ω–¥–∞—Ä—è –¥–ª—è KDE
Index: akonadi/resources/nepomuktag/nepomuktagresource.desktop
===================================================================
--- akonadi/resources/nepomuktag/nepomuktagresource.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/nepomuktag/nepomuktagresource.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -23,6 +23,7 @@
 Name[pt]=Marcas do Nepomuk (Pastas Virtuais)
 Name[pt_BR]=Marcas do Nepomuk (Pastas virtuais)
 Name[ro]=Etichete Nepomuk (dosare virtuale)
+Name[sl]=Oznake Nepomuk (navidezne mape)
 Name[sv]=Nepomuk-etiketter (virtuella korgar)
 Name[tr]=Nepomuk Etiketleri (Sanal Dizinler)
 Name[uk]=–ú—ñ—Ç–∫–∏ Nepomuk (–í—ñ—Ä—Ç—É–∞–ª—å–Ω—ñ —Ç–µ–∫–∏)
@@ -50,6 +51,7 @@
 Comment[pl]=Foldery wirtualne s≈Çu≈ºƒÖce wybieraniu wiadomo≈õci, kt√≥re posiadajƒÖ znaczniki Nepomuka.
 Comment[pt]=Pastas virtuais para seleccionar as mensagens que tenham Marcas do Nepomuk.
 Comment[pt_BR]=Pastas virtuais para selecionar as mensagens que possuam marcas do Nepomuk.
+Comment[sl]=Navidezne mape za izbiranje sporoƒçil z oznakami Nepomuk.
 Comment[sv]=Virtuella korgar f√∂r att v√§lja brev som har Nepomuk-etiketter.
 Comment[tr]=Nepomuk Etiketi olan iletileri se√ßmek i√ßin sanal dizinler
 Comment[uk]=–í—ñ—Ä—Ç—É–∞–ª—å–Ω—ñ —Ç–µ–∫–∏ –¥–ª—è –≤–∏–±–æ—Ä—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å, —è–∫—ñ –º–∞—é—Ç—å –º—ñ—Ç–∫–∏ Nepomuk.
Index: akonadi/resources/vcarddir/vcarddirresource.desktop
===================================================================
--- akonadi/resources/vcarddir/vcarddirresource.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ akonadi/resources/vcarddir/vcarddirresource.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -8,11 +8,13 @@
 Name[es]=Directorio VCard
 Name[et]=VCardide kataloog
 Name[fr]=Dossier VCard
+Name[ga]=Comhadlann v-Ch√°rta
 Name[gl]=Directorio de VCard
 Name[it]=Cartella vCard
 Name[ja]=VCard „Éá„Ç£„É¨„ÇØ„Éà„É™
 Name[km]=·ûê·ûè VCard
 Name[ko]=VCard ÎîîÎ†âÌÑ∞Î¶¨
+Name[lt]=VCard aplankas
 Name[lv]=VCard mape
 Name[nb]=VCard-mappe
 Name[nds]=VCard-Verteken
@@ -39,6 +41,7 @@
 Comment[es]=Carga datos de un directorio con archivos VCard
 Comment[et]=Andmete laadimine VCardide kataloogist
 Comment[fr]=Charge des donn√©es depuis un dossier contenant des fichiers VCard
+Comment[ga]=Gn√≠omhaire a luchta√≠onn sonra√≠ √≥ chomhadlann ina bhfuil v-Ch√°rta√≠
 Comment[gl]=Carregar datos desde un cartafol con VCards 
 Comment[it]=Caricare dati da una cartella con file vCard
 Comment[ja]=VCard „ÅÆ„Éá„Ç£„É¨„ÇØ„Éà„É™„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åô
@@ -53,6 +56,7 @@
 Comment[pt]=Carrega os dados de uma pasta com ficheiros VCard
 Comment[pt_BR]=Carrega os dados de uma pasta com VCards
 Comment[ro]=√éncarcƒÉ date dintr-un director cu vCard-uri
+Comment[sl]=Nalo≈æi podatke iz mape z datotekami VCard
 Comment[sv]=Laddar data fr√•n en katalog med vCard-filer
 Comment[tr]=VCard dosyalarƒ± bulunan bir dizinden verileri y√ºkler
 Comment[uk]=–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –¥–∞–Ω—ñ –∑ –∫–∞—Ç–∞–ª–æ–≥—É –∑ VCard
Index: korganizer/koeditorgeneraltodo.cpp
===================================================================
--- korganizer/koeditorgeneraltodo.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/koeditorgeneraltodo.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -351,6 +351,9 @@
   QDate tmpSDate, tmpDDate;
   QTime tmpSTime, tmpDTime;
   KDateTime tmpStartDT, tmpDueDT;
+  tmpDueDT.setTimeSpec( dueSpec );
+  tmpStartDT.setTimeSpec( startSpec );
+
   if ( mTimeButton->isChecked() ) {
     todo->setAllDay( false );
 
@@ -359,7 +362,6 @@
     tmpDTime = mDueTimeEdit->getTime();
     tmpDueDT.setDate( tmpDDate );
     tmpDueDT.setTime( tmpDTime );
-    tmpDueDT.setTimeSpec( dueSpec );
 
     // set start date/time
     if ( mStartCheck->isChecked() ) {
@@ -367,7 +369,6 @@
       tmpSTime = mStartTimeEdit->getTime();
       tmpStartDT.setDate( tmpSDate );
       tmpStartDT.setTime( tmpSTime );
-      tmpStartDT.setTimeSpec( startSpec );
     } else {
       tmpStartDT = tmpDueDT;
     }
Index: korganizer/korganizer.cpp
===================================================================
--- korganizer/korganizer.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/korganizer.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -305,9 +305,10 @@
       title += " [" + i18nc( "the calendar is read-only", "read-only" ) + ']';
     }
   }
+  if ( mCalendarView->isFiltered() ) {
+    title += " - <" + mCalendarView->currentFilterName() + "> ";
+  }
 
-  title += " - <" + mCalendarView->currentFilterName() + "> ";
-
   setCaption( title, !mCalendarView->isReadOnly() &&
                       mCalendarView->isModified() );
 }
Index: korganizer/koprefs.h
===================================================================
--- korganizer/koprefs.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/koprefs.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -82,6 +82,7 @@
     /// Return true if the given email belongs to the user
     bool thatIsMe( const QString &email );
 
+    QColor defaultCategoryColor() const;
     void setCategoryColor( const QString &cat, const QColor &color );
     QColor categoryColor( const QString &cat ) const;
     bool hasCategoryColor( const QString &cat ) const;
Index: korganizer/kodaymatrix.h
===================================================================
--- korganizer/kodaymatrix.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/kodaymatrix.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -164,7 +164,7 @@
     /* reimplemented from KCal::Calendar::Observer */
     void calendarIncidenceAdded( Incidence *incidence );
     void calendarIncidenceChanged( Incidence *incidence );
-    void calendarIncidenceRemoved( Incidence *incidence );
+    void calendarIncidenceDeleted( Incidence *incidence );
 
   public slots:
     /** Recalculates all the flags of the days in the matrix like holidays or
Index: korganizer/dbuscalendar.desktop
===================================================================
--- korganizer/dbuscalendar.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/dbuscalendar.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -6,6 +6,7 @@
 Name[ga]=F√©ilire DBUS
 Name[gl]=Calendario DBUS
 Name[ja]=D-Bus „Ç´„É¨„É≥„ÉÄ„Éº
+Name[lt]=DBUSkalendorius
 Name[nb]=DBUSKalender
 Name[nds]=D-Bus-Kalenner
 Name[pl]=KalendarzDBUS
Index: korganizer/kocorehelper.cpp
===================================================================
--- korganizer/kocorehelper.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/kocorehelper.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -29,13 +29,13 @@
 QColor KOCoreHelper::categoryColor( const QStringList &categories )
 {
   if ( categories.isEmpty() ) {
-    return defaultEventColor();
+    return KOPrefs::instance()->defaultCategoryColor();
   }
   // FIXME: Correctly treat events with multiple categories
   QString cat = categories.first();
   QColor bgColor;
   if (cat.isEmpty())
-    bgColor = defaultEventColor();
+    bgColor = KOPrefs::instance()->defaultCategoryColor();
   else
     bgColor = KOPrefs::instance()->categoryColor( cat );
   return bgColor;
@@ -43,6 +43,6 @@
 
 QString KOCoreHelper::holidayString( const QDate &dt )
 {
-  QStringList lst(KOGlobals::self()->holiday( dt ));
-  return lst.join( i18nc("delimiter for joining holiday names", "," ) );
+  QStringList lst( KOGlobals::self()->holiday( dt ) );
+  return lst.join( i18nc( "@item:intext delimiter for joining holiday names", "," ) );
 }
Index: korganizer/actionmanager.cpp
===================================================================
--- korganizer/actionmanager.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/actionmanager.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -203,7 +203,9 @@
   mResourceView = factory.resourceView();
 
   connect( mCalendarResources, SIGNAL(calendarChanged()),
-           mCalendarView, SLOT(slotCalendarChanged()) );
+           mCalendarView, SLOT(resourcesChanged()) );
+  connect( mCalendarResources, SIGNAL(calendarLoaded()),
+           mCalendarView, SLOT(resourcesChanged()) );
   connect( mCalendarResources, SIGNAL(signalErrorMessage(const QString &)),
            mCalendarView, SLOT(showErrorMessage(const QString &)) );
 
@@ -675,13 +677,6 @@
                                         SLOT(showTip()) );
   mACollection->addAction( "help_tipofday", a );
 
-  /************************* TOOLBAR ACTIONS *******************************/
-  QLabel *filterLabel = new QLabel( i18n( "Filter: " ), mCalendarView );
-  filterLabel->hide();
-  QWidgetAction *act = new QWidgetAction( this );
-  act->setText( i18n( "Filter: " ) );
-  mACollection->addAction( "filter_label", act );
-  act->setDefaultWidget( filterLabel );
 }
 
 void ActionManager::slotChangeComboActionItem( int index )
Index: korganizer/calendarview.h
===================================================================
--- korganizer/calendarview.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/calendarview.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -157,6 +157,9 @@
         is no selection, return the selected todo from the todo list on the left */
     Incidence *selectedIncidence();
 
+    /** Returns true if there's a filter applied */
+    bool isFiltered() const;
+
     /** Returns the name of the current filter */
     QString currentFilterName() const;
 
@@ -577,8 +580,6 @@
 
     void purgeCompleted();
 
-    void slotCalendarChanged();
-
     void slotAutoArchivingSettingsModified() { emit autoArchivingSettingsModified(); }
 
     void showErrorMessage( const QString & );
@@ -603,8 +604,13 @@
 
     /**
       Returns the best guess at the current active date in the view.
+
+      @param fallbackToToday If guessing doesn't work, some views will prefer 
+                             today to be returned instead of the first select date
+                             in the day matrix, Journal view for example.
+      
     */
-    QDate activeDate();
+    QDate activeDate( bool fallbackToToday = false );
 
   protected:
     void setIncidenceChanger( IncidenceChangerBase *changer );
Index: korganizer/koeditorattachments.h
===================================================================
--- korganizer/koeditorattachments.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/koeditorattachments.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -71,7 +71,8 @@
 
   protected slots:
     void urlChanged( const KUrl &url );
-    virtual void slotApply();
+  void urlChanged( const QString & url );
+  virtual void slotApply();
 
   private:
     KMimeType::Ptr mMimeType;
Index: korganizer/kocorehelper.h
===================================================================
--- korganizer/kocorehelper.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/kocorehelper.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -40,7 +40,6 @@
     KOCoreHelper() {}
     virtual ~KOCoreHelper() {}
 
-    virtual QColor defaultEventColor() { return KOPrefs::instance()->agendaCalendarItemsEventsBackgroundColor(); }
     virtual QColor textColor( const QColor &bgColor ) { return getTextColor( bgColor ); }
     virtual QColor categoryColor( const QStringList &cats );
     virtual QString holidayString( const QDate &dt );
Index: korganizer/interfaces/korganizer/korgprintplugin.desktop
===================================================================
--- korganizer/interfaces/korganizer/korgprintplugin.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/interfaces/korganizer/korgprintplugin.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -14,6 +14,7 @@
 Name[ja]=KOrganizer Âç∞Âà∑„Éó„É©„Ç∞„Ç§„É≥„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ
 Name[km]=·ûÖ·üÜ·ûé·ûª·ûÖ‚Äã·ûî·üí·ûö·ûë·û∂·ûÄ·üã‚Äã·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûá·üÜ·ûì·ûΩ·ûô‚Äã‚Äã·ûî·üÑ·üá·ûñ·ûª·ûò·üí·ûñ KOrganizer
 Name[ko]=KOrganizer Ïù∏ÏáÑ ÌîåÎü¨Í∑∏Ïù∏ Ïù∏ÌÑ∞ÌéòÏù¥Ïä§
+Name[lt]=KOrganizer spausdinimo priedo sƒÖsaja
 Name[lv]=KOrganizer drukƒÅ≈°anas spraud≈Üa saskarne
 Name[nb]=KOrganizer grensesnitt for utskrifts-programtillegg
 Name[nds]=KOrganizer-Druckmoduul-Koppelsteed
Index: korganizer/interfaces/korganizer/korganizerpart.desktop
===================================================================
--- korganizer/interfaces/korganizer/korganizerpart.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/interfaces/korganizer/korganizerpart.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -14,6 +14,7 @@
 Name[ja]=KOrganizer „Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„ÅÆ„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ
 Name[km]=·ûÖ·üÜ·ûé·ûª·ûÖ‚Äã·ûî·üí·ûö·ûë·û∂·ûÄ·üã‚Äã·ûï·üí·ûì·üÇ·ûÄ‚Äã·ûö·ûî·ûü·üã KOrganizer
 Name[ko]=KOrganizer Î∂ÄÎ∂Ñ Ïù∏ÌÑ∞ÌéòÏù¥Ïä§
+Name[lt]=KOrganizer dalies sƒÖsaja
 Name[lv]=KOrganizer daƒºas saskarne
 Name[nb]=KOrganizer Part-grensesnitt
 Name[nds]=KOrganizer-Komponent-Koppelsteed
Index: korganizer/interfaces/korganizer/corehelper.h
===================================================================
--- korganizer/interfaces/korganizer/corehelper.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/interfaces/korganizer/corehelper.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -38,7 +38,6 @@
     CoreHelper() {}
     virtual ~CoreHelper() {}
 
-    virtual QColor defaultEventColor() = 0;
     virtual QColor textColor( const QColor &bgColor ) = 0;
     virtual QColor categoryColor( const QStringList &cats ) = 0;
     virtual QString holidayString( const QDate &dt ) = 0;
Index: korganizer/kodaymatrix.cpp
===================================================================
--- korganizer/kodaymatrix.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/kodaymatrix.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -83,7 +83,6 @@
 
   mTodayMarginWidth = 2;
   mSelEnd = mSelStart = NOSELECTION;
-  setAttribute( Qt::WA_NoSystemBackground, true );
 
   recalculateToday();
 }
@@ -278,43 +277,47 @@
   }
 
   Event::List eventlist = mCalendar->events( mDays[0], mDays[NUMDAYS-1],
-                                             mCalendar->timeSpec());
+                                             mCalendar->timeSpec() );
   mEvents.clear();
   Event::List::ConstIterator it;
 
-  for ( it = eventlist.constBegin(); it != eventlist.constEnd(); ++it ) {
+  for ( it=eventlist.constBegin(); it != eventlist.constEnd(); ++it ) {
     Event *event = *it;
     ushort recurType = event->recurrenceType();
-	
+
     if ( !( recurType == Recurrence::rDaily  && !KOPrefs::instance()->mDailyRecur ) &&
          !( recurType == Recurrence::rWeekly && !KOPrefs::instance()->mWeeklyRecur ) ) {
-          
+
       DateTimeList timeDateList;
-      
-      if (event->recurs()) {
+
+      if ( event->recurs() ) {
         //Its a recurring event, find out in which days it occurs
-      	timeDateList = event->recurrence()->timesInInterval( *new KDateTime( mDays[0],         mCalendar->timeSpec() ),
-                                                             *new KDateTime( mDays[NUMDAYS-1], mCalendar->timeSpec() ) );
+        timeDateList = event->recurrence()->timesInInterval(
+          *new KDateTime( mDays[0], mCalendar->timeSpec() ),
+          *new KDateTime( mDays[NUMDAYS-1], mCalendar->timeSpec() ) );
       } else {
-        timeDateList.append( event->dtStart() );
-      }							 
-        
-      const int eventDuration = event->dtStart().daysTo(event->dtEnd())+1;
+        if ( event->dtStart().date() >= mDays[0] ) {
+          timeDateList.append( event->dtStart() );
+        } else {
+          // The event starts in another month (not visible))
+          timeDateList.append( KDateTime( mDays[0], mCalendar->timeSpec() ) );
+        }
+      }
 
       DateTimeList::iterator t;
-      for ( t = timeDateList.begin(); t != timeDateList.end(); ++t ) {
+      for ( t=timeDateList.begin(); t != timeDateList.end(); ++t ) {
         //This could be a multiday event, so iterate from dtStart() to dtEnd()
         QDate d = t->date();
         int j   = 0;
 
         do {
-                                                                            
+
           mEvents.append( d );
-      
+
           ++j;
           d = d.addDays( 1 );
 
-        } while ( j < eventDuration && j < NUMDAYS );
+        } while ( d <= event->dtEnd().date() && j < NUMDAYS );
       }
     }
   }
@@ -356,7 +359,7 @@
   mPendingChanges = true;
 }
 
-void KODayMatrix::calendarIncidenceRemoved( Incidence *incidence )
+void KODayMatrix::calendarIncidenceDeleted( Incidence *incidence )
 {
   Q_UNUSED( incidence );
   mPendingChanges = true;
@@ -611,6 +614,9 @@
 
   p.begin( this );
 
+  // draw background
+  p.fillRect( 0, 0, sz.width(), sz.height(), QBrush( pal.color( QPalette::Base ) ) );
+
   // draw topleft frame
   p.setPen( pal.color( QPalette::Mid ) );
   p.drawRect( 0, 0, sz.width() - 1, sz.height() - 1 );
@@ -661,9 +667,9 @@
   QColor textColor = pal.color( QPalette::Text );
   QColor textColorShaded = getShadedColor( textColor );
   QColor actcol = textColorShaded;
-  p.setPen(actcol);
+  p.setPen( actcol );
   QPen tmppen;
-  for ( int i = 0; i < NUMDAYS; ++i ) {
+  for ( int i=0; i<NUMDAYS; ++i ) {
     row = i / 7;
     col = isRTL ? 6 - ( i - row * 7 ) : i - row * 7;
 
@@ -711,7 +717,7 @@
     }
 
     // if any events are on that day then draw it using a bold font
-    if ( mEvents.contains(mDays[i]) ) {
+    if ( mEvents.contains( mDays[i] ) ) {
       QFont myFont = font();
       myFont.setBold( true );
       p.setFont( myFont );
@@ -740,7 +746,7 @@
       p.setPen( actcol );
     }
     // reset bold font to plain font
-    if ( mEvents.contains(mDays[i]) > 0 ) {
+    if ( mEvents.contains( mDays[i] ) > 0 ) {
       QFont myFont = font();
       myFont.setBold( false );
       p.setFont( myFont );
Index: korganizer/plugins/picoftheday/picoftheday.desktop
===================================================================
--- korganizer/plugins/picoftheday/picoftheday.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/plugins/picoftheday/picoftheday.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -17,6 +17,7 @@
 Name[ja]=Wikipedia ‰ªäÊó•„ÅÆÂÜôÁúü„Éó„É©„Ç∞„Ç§„É≥
 Name[km]=·ûö·ûº·ûî·ûó·û∂·ûñ‚Äã·ûö·ûî·ûü·üã Wikipedia ·ûì·üÉ‚Äã‚Äã·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûá·üÜ·ûì·ûΩ·ûô‚Äã·ûê·üí·ûÑ·üÉ‚Äã·ûü·ûò·üí·ûö·û∂·ûî·üã‚Äã·ûî·üí·ûö·ûè·û∑·ûë·û∑·ûì
 Name[ko]=Îã¨Î†•ÏùÑ ÏúÑÌïú ÏúÑÌÇ§Î∞±Í≥º Ïò§ÎäòÏùò Í∑∏Î¶º ÌîåÎü¨Í∑∏Ïù∏
+Name[lt]=Wikipedijos dienos nuotrauk≈≥ priedas kalendoriams
 Name[lv]=Wikipedia dienas attƒìla kalendƒÅru spraudnis
 Name[nb]=Wikipedia Dagens Bilde programtillegg for Kalender
 Name[nds]=Wikipedia-"Bild f√∂r Vundaag"-Moduul f√∂r Kalenners
@@ -48,13 +49,16 @@
 Comment[ja]=Wikipedia „ÅÆ„Äå‰ªäÊó•„ÅÆÂÜôÁúü„Äç„ÇíÊèê‰æõ„Åó„Åæ„Åô„ÄÇ
 Comment[km]=·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûá·üÜ·ûì·ûΩ·ûô‚Äã·ûì·üÅ·üá ·ûï·üí·ûä·ûõ·üã‚Äã·ûì·ûº·ûú‚Äã·ûö·ûº·ûî·ûó·û∂·ûñ‚Äã·ûê·üí·ûÑ·üÉ·ûì·üÅ·üá‚Äã·ûö·ûî·ûü·üã Wikipedia
 Comment[ko]=ÏúÑÌÇ§Î∞±Í≥º Ïò§ÎäòÏùò Í∑∏Î¶ºÏùÑ ÌëúÏãúÌï©ÎãàÎã§
+Comment[lt]=≈†is priedas pateikia Wikipedijos dienos nuotraukƒÖ
 Comment[lv]=≈†is spraudnis piegƒÅdƒÅ Vikipƒìdijas dienas attƒìlu
+Comment[nb]=Dette programtillegget henter Wikipedias Dagens bilde
 Comment[nds]=Dit Moduul stellt dat ¬ªBild f√∂r Vundaag¬´ vun Wikipedia praat
 Comment[nl]=Deze plugin geeft de Wikipedia-afbeelding van de dag
 Comment[nn]=Dette programtillegget viser dagens bilete fr√• Wikipedia.
 Comment[pl]=Wtyczka dostarcza Obrazek Dnia Wikipedii
 Comment[pt]=Este 'plugin' oferece a Imagem do Dia do Wikip√©dia
 Comment[pt_BR]=Este plug-in oferece a Imagem do Dia da Wikipedia
+Comment[sl]=Ta vstavek ponuja sliko dneva z Wikipedije
 Comment[sv]=Insticksprogrammet tillhandah√•ller Wikipedias 'Dagens bild'
 Comment[tr]=Bu eklenti Wikipedia'dan G√ºn√ºn Resmini getirir
 Comment[uk]=–¶–µ–π –¥–æ–¥–∞—Ç–æ–∫ –ø—Ä–∞—Ü—é—î –∑ ¬´–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è–º–∏ –¥–Ω—è¬ª –∑ –í—ñ–∫—ñ–ø–µ–¥—ñ—ó
Index: korganizer/plugins/timespanview/timespanview.desktop
===================================================================
--- korganizer/plugins/timespanview/timespanview.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/plugins/timespanview/timespanview.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -66,7 +66,7 @@
 Comment[ka]=·Éî·É° ·Éõ·Éù·Éì·É£·Éö·Éò ·É£·Éñ·É†·É£·Éú·Éï·Éî·Éö·É∞·Éß·Éù·É§·É° korganizer-·É° ·Éì·É†·Éù·Éò·É° ·Éì·Éò·Éê·Éí·É†·Éê·Éõ·Éò·Éê·Éú·Éò ·ÉÆ·Éî·Éì·Éò·Éó (·Éõ·Éê·Éí.:·Éì·Éê·Éï·Éê·Éö·Éî·Éë·Éî·Éë·Éò ·Éê·Éú ·Éó·Éï·Éò·É£·É†·Éò ·Éõ·Éò·Éõ·Éù·ÉÆ·Éò·Éö·Éï·Éê). ·Éó·É£ ·Éê·Éõ ·Éõ·Éù·Éì·É£·Éö·É° ·Éí·Éê·Éê·Éê·É•·É¢·Éò·É£·É†·Éî·Éë·Éó,·Éó·É•·Éï·Éî·Éú ·É®·Éî·Éí·Éò·É´·Éö·Éò·Éê·Éó ·Éí·Éê·Éì·Éê·É†·Éó·Éù·Éó ·Éì·É†·Éù·Éò·É° ·Éì·Éò·Éê·Éí·É†·Éê·Éõ·Éò·Éê·Éú ·ÉÆ·Éî·Éì·Éñ·Éî ·Éì·Éê ·Éò·ÉÆ·Éò·Éö·Éù·Éó ·Éõ·Éù·Éï·Éö·Éî·Éú·Éî·Éë·Éò ·Éí·Éê·Éú·É¢·Éò·É° ·Éì·Éò·Éê·Éí·É†·Éê·Éõ·Éò·É° ·É°·Éê·ÉÆ·Éò·Éó. 
 Comment[kk]=–ë“±–ª KOrganizer-–Ω—ñ“£ —É–∞“õ—ã—Ç –∞—Ä–∞–ª—ã“ì—ã –∫”©—Ä—ñ–Ω—ñ—Å—ñ–Ω—ñ“£ –º–æ–¥—É–ª—ñ. –ú–æ–¥—É–ª—ñ–Ω –æ—Ä–Ω–∞—Ç—Å–∞“£—ã–∑, –æ—Å—ã –∫”©—Ä—ñ–Ω—ñ—Å–∫–µ –∞—É—ã—Å—ã–ø –æ“õ–∏“ì–∞–ª–∞—Ä—ã“£—ã–∑–¥—ã –ì–∞–Ω—Ç –¥–∏–∞–≥—Ä–∞–º–º–∞ —Ç“Ø—Ä—ñ–Ω–µ –∫–µ–ª—Ç—Ä–µ –∞–ª–∞—Å—ã–∑.
 Comment[km]=·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûá·üÜ·ûì·ûΩ·ûô‚Äã·ûì·üÅ·üá‚Äã·ûï·üí·ûä·ûõ·üã‚Äã·ûì·ûº·ûú‚Äã·ûë·û∑·ûä·üí·ûã·ûó·û∂·ûñ‚Äã·ûö·ûô·üà·ûñ·üÅ·ûõ‚Äã·ûü·ûò·üí·ûö·û∂·ûî·üã korganizer (·ûä·ûº·ûÖ·ûá·û∂ ·ûë·û∑·ûä·üí·ûã·ûó·û∂·ûñ‚Äã·ûÄ·û∂·ûö·ûÑ·û∂·ûö‚Äã·ûè·üí·ûö·ûº·ûú‚Äã·ûí·üí·ûú·ûæ ·û¨ ·ûë·û∑·ûä·üí·ûã·ûó·û∂·ûñ‚Äã·ûÅ·üÇ‚Äã·ûá·û∂·ûä·ûæ·ûò)¬†·üî ·ûî·ûæ‚Äã·û¢·üí·ûì·ûÄ‚Äã·ûí·üí·ûú·ûæ‚Äã·û≤·üí·ûô‚Äã·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûá·üÜ·ûì·ûΩ·ûô‚Äã·ûì·üÅ·üá‚Äã·ûî·üí·ûö·ûæ‚Äã·ûî·û∂·ûì ·û¢·üí·ûì·ûÄ‚Äã·ûì·ûπ·ûÑ‚Äã·û¢·û∂·ûÖ‚Äã·ûî·üí·ûä·ûº·ûö‚Äã·ûë·û∑·ûä·üí·ûã·ûó·û∂·ûñ‚Äã·ûö·ûô·üà·ûñ·üÅ·ûõ ·û†·ûæ·ûô‚Äã·ûò·ûæ·ûõ‚Äã·ûñ·üí·ûö·ûπ·ûè·üí·ûè·û∑·ûÄ·û∂·ûö·ûé·üç‚Äã·ûö·ûî·ûü·üã‚Äã·û¢·üí·ûì·ûÄ‚Äã·ûä·ûº·ûÖ·ûá·û∂‚Äã·ûì·üÖ‚Äã·ûÄ·üí·ûì·ûª·ûÑ·ûä·üí·ûô·û∂·ûÄ·üí·ûö·û∂·ûò Gantt ·û¢·ûâ·üí·ûÖ·ûπ·ûÑ‚Äã·ûä·üÇ·ûö¬†·üî
-Comment[lt]=≈†is priedas korganizer programoje sudaro galimybƒô ap≈ævelgti laiko tarpƒÖ (pvz., darb≈≥ arba mƒónesio per≈æi≈´ra). ƒÆgalinus ≈°ƒØ priedƒÖ galƒósite persijungti ƒØ laiko tarpo per≈æi≈´rƒÖ ir ≈æi≈´rƒóti ƒØvykius tarsi Gantt diagramoje.
+Comment[lt]=≈†is priedas KOrganizer programoje sudaro galimybƒô ap≈ævelgti laiko tarpƒÖ (pvz., darb≈≥ arba mƒónesio per≈æi≈´ra). ƒÆgalinus ≈°ƒØ priedƒÖ galƒósite persijungti ƒØ laiko tarpo per≈æi≈´rƒÖ ir ≈æi≈´rƒóti ƒØvykius tarsi Gantt diagramoje.
 Comment[lv]=≈†is spraudnis nodro≈°ina KOrganizer laika intervƒÅla skatƒ´jumu (piemƒìram darƒÅmie darbi vai mƒìne≈°a skats). Ieslƒìdzot ≈°o spraudni, j≈´s varat pƒÅrslƒìgties uz laika intervƒÅla skatu un apskatƒ´t notikumus Gantt diagrammas veidƒÅ.
 Comment[ms]=Plugin ini menyediakan paparan kitar waktu  untuk korganizer (seperti tugasan atau paparan bulan). Jika plugin ini diaktifkan,anda boleh beralih ke paparan kitar masa dan paparkan peristiwa seperti dalam diagram Gantt. 
 Comment[nb]=Dette programtillegget lager en periodevisning for korganizer (slik som gj√∏reliste og m√•nedsvisning). Hvis du sl√•r p√• dette programtillegget kan du bytte til periodevisning og se hendelser som i et Gantt-diagram.
Index: korganizer/plugins/hebrew/hebrew.desktop
===================================================================
--- korganizer/plugins/hebrew/hebrew.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/plugins/hebrew/hebrew.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -68,6 +68,7 @@
 Comment[ja]=KOrganizer „ÅÆ„Åô„Åπ„Å¶„ÅÆÊó•‰ªò„Çí„É¶„ÉÄ„É§Êö¶„Åß„ÇÇË°®Á§∫„Åó„Åæ„Åô„ÄÇ
 Comment[km]=·ûî·ûÑ·üí·û†·û∂·ûâ‚Äã·ûÄ·û∂·ûõ·ûî·ûö·û∑·ûÖ·üí·ûÜ·üÅ·ûë‚Äã·ûë·û∂·üÜ·ûÑ·û¢·ûü·üã‚Äã·ûì·üÖ‚Äã·ûÄ·üí·ûì·ûª·ûÑ KOrganizer ·ûì·üÖ‚Äã·ûÄ·üí·ûì·ûª·ûÑ‚Äã·ûî·üí·ûö·ûñ·üê·ûì·üí·ûí‚Äã·ûî·üí·ûö·ûè·û∑·ûë·û∑·ûì Jewish ·ûï·ûÑ·ûä·üÇ·ûö¬†‚Äã‚Äã·üî
 Comment[ko]=KOrganizerÏùò Î™®Îì† ÎÇ†ÏßúÎ•º ÌûàÎ∏åÎ¶¨ Îã¨Î†•Ïùò ÎÇ†ÏßúÎ°úÎèÑ ÌëúÏãúÌï©ÎãàÎã§.
+Comment[lt]=Rodo visas dienas KOrganizer taip pat ir ≈æyd≈≥ kalendoriaus sistema.
 Comment[lv]=ParƒÅda visus KOrganizer datumus arƒ´ eberju kalendƒÅra sistƒìmƒÅ.
 Comment[nb]=Viser alle datoer i KOrganizer ogs√• i det j√∏diske kalendersystemet.
 Comment[nds]=Wiest all Daten vun KOrganizer ok in't juudsche Kalennersysteem.
Index: korganizer/plugins/thisdayinhistory/thisdayinhistory.desktop
===================================================================
--- korganizer/plugins/thisdayinhistory/thisdayinhistory.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/plugins/thisdayinhistory/thisdayinhistory.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -15,6 +15,7 @@
 Name[ja]=Wikipedia ‰ªäÊó•„ÅØ‰Ωï„ÅÆÊó•„Éó„É©„Ç∞„Ç§„É≥
 Name[km]=·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏ '·ûê·üí·ûÑ·üÉ·ûì·üÅ·üá‚Äã·ûÄ·üí·ûì·ûª·ûÑ‚Äã·ûî·üí·ûö·ûú·ûè·üí·ûè·û∑' ·ûö·ûî·ûü·üã·ûú·û∏·ûÇ·û∏·ûó·û∏·ûå·üÄ
 Name[ko]=ÏúÑÌÇ§Î∞±Í≥º 'Ïò§ÎäòÏùò Ïó≠ÏÇ¨' ÌîåÎü¨Í∑∏Ïù∏
+Name[lt]=Wikipedios ‚Äû≈†i diena istorijoje‚Äú priedas
 Name[lv]=Wikipedia '≈†ƒ´ diena vƒìsturƒì' spraudnis
 Name[nb]=Programtillegg for Wikipedias ¬´Denne dag i historien¬ª
 Name[nds]=Wikipedia-"Disse Dag in de Historie"-Moduul
@@ -46,6 +47,7 @@
 Comment[km]=·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏‚Äã·ûì·üÅ·üá ·ûï·üí·ûä·ûõ·üã‚Äã·ûì·ûº·ûú‚Äã·ûè·üÜ·ûé‚Äã·ûë·üÖ‚Äã·ûÄ·û∂·ûì·üã‚Äã·ûë·üÜ·ûñ·üê·ûö‚Äã·ûì·üÉ‚Äã·ûî·üí·ûö·ûú·ûè·üí·ûè·û∑‚Äã·ûê·üí·ûÑ·üÉ‚Äã·ûì·üÅ·üá‚Äã·ûö·ûî·ûü·üã Wikipedia
 Comment[ko]=Ïù¥ ÌîåÎü¨Í∑∏Ïù∏ÏùÄ ÏúÑÌÇ§Î∞±Í≥ºÏùò 'Ïò§ÎäòÏùò Ïó≠ÏÇ¨' ÌéòÏù¥ÏßÄÎ°ú Í∞ÄÎäî ÎßÅÌÅ¨Î•º Ï†úÍ≥µÌï©ÎãàÎã§
 Comment[lv]=≈†is spraudnis pievieno saites uz Vikipƒìdijas '≈†ƒ´ diena vƒìsturƒì' lapƒÅm
+Comment[nb]=Dette programtillegget gir lenker til ¬´This day in History¬ª p√• engelsk Wikipedia.
 Comment[nds]=Dit Moduul stellt Links na de ¬ªDisse Dag in de Historie¬´-Sieden op Wikipedia praat
 Comment[nl]=Deze plugin levert links tot de Wikipedia-pagina's over een bepaalde dag
 Comment[nn]=Dette programtillegget gjev lenkjer til ¬´Dagen i dag¬ª i Wikipedia
Index: korganizer/korganizer.kcfg
===================================================================
--- korganizer/korganizer.kcfg	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/korganizer.kcfg	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -418,11 +418,6 @@
       <whatsthis>Select the to-do overdue color here.</whatsthis>
       <default>255, 100, 100</default>
     </entry>
-    <entry type="Color" key="EventColor">
-      <label>Default event color</label>
-      <whatsthis>Select the default event color here. The default event color will be used for events categories in your agenda. Note that you can specify a separate color for each event category below.</whatsthis>
-      <default>151, 235, 121</default>
-    </entry>
 
     <entry type="Bool" key="AssignDefaultResourceColors">
       <default>true</default>
@@ -561,11 +556,6 @@
     <entry key="Agenda CalendarItems Icon" type="String">
     </entry>
 
-    <entry key="Agenda CalendarItems Events Background Color" type="Color">
-      <label>Default event color</label>
-      <whatsthis>Select the default event color here. The default event color will be used for events categories in your agenda. Note that you can specify a separate color for each event category below.</whatsthis>
-      <default>151, 235, 121</default>
-    </entry>
     <entry key="Agenda CalendarItems Events Background Image" type="String">
     </entry>
     <entry key="Agenda CalendarItems Events Font" type="Font">
Index: korganizer/views/monthview/monthitem.cpp
===================================================================
--- korganizer/views/monthview/monthitem.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/views/monthview/monthitem.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -340,10 +340,12 @@
 QDate IncidenceMonthItem::realEndDate() const
 {
   KDateTime dt;
-  if ( mIsEvent || mIsJournal ) {
+  if ( mIsEvent ) {
     dt = mIncidence->dtEnd();
   } else if ( mIsTodo ) {
     dt = static_cast<Todo *>( mIncidence )->dtDue();
+  } else if ( mIsJournal ) {
+    dt = mIncidence->dtStart();
   }
 
   QDate end;
Index: korganizer/views/todoview/kotodoviewquicksearch.cpp
===================================================================
--- korganizer/views/todoview/kotodoviewquicksearch.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/views/todoview/kotodoviewquicksearch.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -64,7 +64,7 @@
 
   mCategoryCombo = new KCheckComboBox( this );
   mCategoryCombo->setDefaultText( i18nc( "@item:inlistbox", "Select Categories" ) );
-  mCategoryCombo->setSeparator( i18nc( "@info delimiter for joining category names", "," ) );
+  mCategoryCombo->setSeparator( i18nc( "@item delimiter for joining category names", "," ) );
 
   connect( mCategoryCombo, SIGNAL(checkedItemsChanged(const QStringList &)),
            this, SIGNAL(searchCategoryChanged(const QStringList &)) );
Index: korganizer/views/todoview/kotodoview.cpp
===================================================================
--- korganizer/views/todoview/kotodoview.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/views/todoview/kotodoview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -35,6 +35,13 @@
 #include "koprefs.h"
 #include "koglobals.h"
 
+#include "kocorehelper.h"
+//#include "korganizer/baseview.h"
+//#include "actionmanager.h"
+#ifndef KORG_NOPRINTER
+#include "calprinter.h"
+#endif
+
 #include <kcal/todo.h>
 #include <kcal/incidence.h>
 
@@ -469,8 +476,32 @@
 
 void KOTodoView::printTodo()
 {
-  //TODO
-  kDebug() << "this is a stub";
+#ifndef KORG_NOPRINTER
+  QModelIndexList selection = mView->selectionModel()->selectedRows();
+  if ( selection.size() != 1 ) {
+    return;
+  }
+
+  Todo *todo = static_cast<Todo *>( selection[0].data( KOTodoModel::TodoRole ).value<void *>() );
+
+  KOCoreHelper helper;
+  CalPrinter printer( this, BaseView::calendar(), &helper );
+  connect( this, SIGNAL(configChanged()), &printer, SLOT(updateConfig()) );
+
+  Incidence::List selectedIncidences;
+  selectedIncidences.append( todo );
+
+  KDateTime todoDate;
+  if ( todo->hasStartDate() ) {
+    todoDate = todo->dtStart();
+  } else {
+    todoDate = todo->dtDue();
+  }
+
+  printer.print( KOrg::CalPrinterBase::Incidence,
+                 todoDate.date(), todoDate.date(), selectedIncidences, false );
+
+#endif
 }
 
 void KOTodoView::deleteTodo()
Index: korganizer/views/multiagendaview/multiagendaview.cpp
===================================================================
--- korganizer/views/multiagendaview/multiagendaview.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/views/multiagendaview/multiagendaview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -468,11 +468,11 @@
   }
 }
 
-void MultiAgendaView::resourcesChanged()
+void MultiAgendaView::setUpdateNeeded()
 {
   mPendingChanges = true;
   foreach ( KOAgendaView *agenda, mAgendaViews ) {
-    agenda->resourcesChanged();
+    agenda->setUpdateNeeded();
   }
 }
 
Index: korganizer/views/multiagendaview/multiagendaview.h
===================================================================
--- korganizer/views/multiagendaview/multiagendaview.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/views/multiagendaview/multiagendaview.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -64,7 +64,7 @@
 
     void finishTypeAhead();
 
-    void resourcesChanged();
+    void setUpdateNeeded();
 
   protected:
     void resizeEvent( QResizeEvent *ev );
Index: korganizer/views/agendaview/agendaview.h
===================================================================
--- korganizer/views/agendaview/agendaview.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/views/agendaview/agendaview.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -34,7 +34,7 @@
 
   public slots:
     virtual void finishTypeAhead() = 0;
-    virtual void resourcesChanged() = 0;
+    virtual void setUpdateNeeded() = 0;
 };
 
 }
Index: korganizer/views/agendaview/koagendaview.cpp
===================================================================
--- korganizer/views/agendaview/koagendaview.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/views/agendaview/koagendaview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -260,7 +260,6 @@
 
   if ( cal ) {
     cal->registerObserver( this );
-    connect( cal, SIGNAL(calendarChanged()), SLOT(resourcesChanged()) );
   }
 }
 
@@ -788,7 +787,14 @@
     thisDate = mSelectedDates[ item->cellXLeft() ];
   }
   QDate oldThisDate( item->itemDate() );
-  int daysOffset = oldThisDate.daysTo( thisDate );
+  int daysOffset = 0;
+
+  // daysOffset should only be calculated if item->cellXLeft() is positive which doesn't happen
+  // if the event's start isn't visible.
+  if ( item->cellXLeft() >= 0 ) {
+    daysOffset = oldThisDate.daysTo( thisDate );
+  }
+
   int daysLength = 0;
 //  startDt.setDate( startDate );
 
@@ -1144,7 +1150,7 @@
   mAgenda->selectItemByUID( first->uid() );
 }
 
-void KOAgendaView::insertIncidence( Incidence *incidence, const QDate &curDate, int curCol )
+void KOAgendaView::insertIncidence( Incidence *incidence, const QDate &curDate )
 {
   if ( !filterByResource( incidence ) ) {
     return;
@@ -1154,43 +1160,51 @@
   Event *event = dynamic_cast<Event *>( incidence );
   Todo  *todo  = dynamic_cast<Todo  *>( incidence );
 
+  int curCol = mSelectedDates.first().daysTo( curDate );
+
+  // In case incidence->dtStart() isn't visible (crosses bounderies)
   if ( curCol < 0 ) {
-    curCol = mSelectedDates.indexOf( curDate );
+    curCol = 0;
   }
+
   // The date for the event is not displayed, just ignore it
-  if ( curCol < 0 || curCol > int( mSelectedDates.size() ) ) {
+  if ( curCol >= mSelectedDates.count() ) {
     return;
   }
 
+  // Default values, which can never be reached
+  mMinY[curCol] = mAgenda->timeToY( QTime( 23, 59 ) ) + 1;
+  mMaxY[curCol] = mAgenda->timeToY( QTime( 0, 0 ) ) - 1;
+
   int beginX;
   int endX;
+  QDate columnDate;
   if ( event ) {
-    beginX = curDate.daysTo(
-      incidence->dtStart().toTimeSpec( KOPrefs::instance()->timeSpec() ).date() ) + curCol;
-    endX = curDate.daysTo(
-      event->dtEnd().toTimeSpec( KOPrefs::instance()->timeSpec() ).date() ) + curCol;
+    QDate firstVisibleDate = mSelectedDates.first();
+    // its crossing bounderies, lets calculate beginX and endX
+    if ( curDate < firstVisibleDate ) {
+      beginX = curCol + firstVisibleDate.daysTo( curDate );
+      endX   = beginX + event->dtStart().daysTo( event->dtEnd() );
+      columnDate = firstVisibleDate;
+    } else {
+      beginX = curCol;
+      endX   = beginX + event->dtStart().daysTo( event->dtEnd() );
+      columnDate = curDate;
+    }
   } else if ( todo ) {
     if ( !todo->hasDueDate() ) {
       return;  // todo shall not be displayed if it has no date
     }
-    beginX = curDate.daysTo( todo->dtDue().date() ) + curCol;
-    endX = beginX;
+    columnDate = curDate;
+    beginX = endX = curCol;
+
   } else {
     return;
   }
   if ( todo && todo->isOverdue() ) {
-    mAllDayAgenda->insertAllDayItem( incidence, curDate, curCol, curCol );
+    mAllDayAgenda->insertAllDayItem( incidence, columnDate, curCol, curCol );
   } else if ( incidence->allDay() ) {
-// FIXME: This breaks with recurring multi-day events!
-    if ( incidence->recurrence()->recurs() ) {
-      mAllDayAgenda->insertAllDayItem( incidence, curDate, curCol, curCol );
-    } else {
-      // Insert multi-day events only on the first day, otherwise it will
-      // appear multiple times
-      if ( ( beginX <= 0 && curCol == 0 ) || beginX == curCol ) {
-        mAllDayAgenda->insertAllDayItem( incidence, curDate, beginX, endX );
-      }
-    }
+      mAllDayAgenda->insertAllDayItem( incidence, columnDate, beginX, endX );
   } else if ( event && event->isMultiDay( KOPrefs::instance()->timeSpec() ) ) {
     int startY = mAgenda->timeToY(
       event->dtStart().toTimeSpec( KOPrefs::instance()->timeSpec() ).time() );
@@ -1200,7 +1214,8 @@
     }
     int endY = mAgenda->timeToY( endtime ) - 1;
     if ( ( beginX <= 0 && curCol == 0 ) || beginX == curCol ) {
-      mAgenda->insertMultiItem( event, curDate, beginX, endX, startY, endY );
+      mAgenda->insertMultiItem( event, columnDate, beginX, endX, startY, endY );
+
     }
     if ( beginX == curCol ) {
       mMaxY[curCol] = mAgenda->timeToY( QTime( 23, 59 ) );
@@ -1235,7 +1250,7 @@
     if ( endY < startY ) {
       endY = startY;
     }
-    mAgenda->insertItem( incidence, curDate, curCol, startY, endY );
+    mAgenda->insertItem( incidence, columnDate, curCol, startY, endY );
     if ( startY < mMinY[curCol] ) {
       mMinY[curCol] = startY;
     }
@@ -1254,40 +1269,7 @@
     return;
   }
 
-  QDate f = mSelectedDates.first();
-  QDate l = mSelectedDates.last();
-
-  QDate startDt = incidence->dtStart().toTimeSpec( KOPrefs::instance()->timeSpec() ).date();
-
-  if ( incidence->recurs() ) {
-    DateList::ConstIterator dit;
-    QDate curDate;
-    for ( dit = mSelectedDates.constBegin(); dit != mSelectedDates.constEnd(); ++dit ) {
-      curDate = *dit;
-// FIXME: This breaks with recurring multi-day events!
-      if ( incidence->recursOn( curDate, KOPrefs::instance()->timeSpec() ) ) {
-        insertIncidence( incidence, curDate );
-      }
-    }
-    return;
-  }
-
-  QDate endDt;
-  if ( incidence->type() == "Event" ) {
-    endDt = ( static_cast<Event *>( incidence ) )->dtEnd().toTimeSpec(
-      KOPrefs::instance()->timeSpec() ).date();
-  }
-  if ( todo ) {
-    endDt = todo->isOverdue() ? QDate::currentDate() : todo->dtDue().date();
-
-    if ( endDt >= f && endDt <= l ) {
-      insertIncidence( incidence, endDt );
-      return;
-    }
-  }
-  if ( startDt >= f && startDt <= l ) {
-    insertIncidence( incidence, startDt );
-  }
+  displayIncidence( incidence );
 }
 
 void KOAgendaView::changeIncidenceDisplay( Incidence *incidence, int mode )
@@ -1301,17 +1283,16 @@
       // still in an agendaItems' code, which was deleted in the mean time.
       // Thus KOrg crashes...
       changeIncidenceDisplayAdded( incidence );
+      updateEventIndicators();
       break;
     }
     case KOGlobals::INCIDENCEEDITED:
     {
-      if ( !mAllowAgendaUpdate ) {
-        updateEventIndicators();
-      } else {
+      if ( mAllowAgendaUpdate ) {
         removeIncidence( incidence );
-        updateEventIndicators();
         changeIncidenceDisplayAdded( incidence );
       }
+      updateEventIndicators();
       break;
     }
     case KOGlobals::INCIDENCEDELETED:
@@ -1354,97 +1335,122 @@
   mMinY.resize( mSelectedDates.count() );
   mMaxY.resize( mSelectedDates.count() );
 
-  Event::List dayEvents;
+  mAgenda->setDateList( mSelectedDates );
 
-  // ToDo items shall be displayed for the day they are due, but only shown
-  // today if they are already overdue. Therefore, get all of them.
-  Todo::List todos  = calendar()->todos();
+  bool somethingReselected = false;
+  Incidence::List incidences = calendar()->incidences();
 
-  mAgenda->setDateList( mSelectedDates );
+  foreach ( Incidence *incidence, incidences ) {
+    displayIncidence( incidence );
 
+    if( incidence->uid() == selectedAgendaUid && !selectedAgendaUid.isNull() ) {
+      mAgenda->selectItemByUID( incidence->uid() );
+      somethingReselected = true;
+    }
+
+    if( incidence->uid() == selectedAllDayAgendaUid && !selectedAllDayAgendaUid.isNull() ) {
+      mAllDayAgenda->selectItemByUID( incidence->uid() );
+      somethingReselected = true;
+    }
+  }
+
+  mAgenda->checkScrollBoundaries();
+  updateEventIndicators();
+
+  //  mAgenda->viewport()->update();
+  //  mAllDayAgenda->viewport()->update();
+
+  // make invalid
+  deleteSelectedDateTime();
+
+  if( !somethingReselected ) {
+    emit incidenceSelected( 0 );
+  }
+}
+
+void KOAgendaView::displayIncidence( Incidence *incidence ) {
+
   QDate today = QDate::currentDate();
+  DateTimeList::iterator t;
 
-  bool somethingReselected = false;
-  DateList::ConstIterator dit;
-  int curCol = 0;
-  for ( dit = mSelectedDates.constBegin(); dit != mSelectedDates.constEnd(); ++dit ) {
-    QDate currentDate = *dit;
-    dayEvents = calendar()->events( currentDate, KOPrefs::instance()->timeSpec(),
-                                    EventSortStartDate,
-                                    SortDirectionAscending );
+  // FIXME: use a visitor here
+  Todo *todo = dynamic_cast<Todo *>( incidence );
+  Event *event = dynamic_cast<Event *>( incidence );
 
-    // Default values, which can never be reached
-    mMinY[curCol] = mAgenda->timeToY( QTime( 23, 59 ) ) + 1;
-    mMaxY[curCol] = mAgenda->timeToY( QTime( 0, 0 ) ) - 1;
+  KDateTime firstVisibleDateTime( mSelectedDates.first(), KOPrefs::instance()->timeSpec() );
+  KDateTime lastVisibleDateTime( mSelectedDates.last(), KOPrefs::instance()->timeSpec() );
 
-    int numEvent;
-    for ( numEvent=0; numEvent<dayEvents.count(); ++numEvent ) {
-      Event *event = dayEvents.at( numEvent );
-      insertIncidence( event, currentDate, curCol );
-      if( event->uid() == selectedAgendaUid && !selectedAgendaUid.isNull() ) {
-        mAgenda->selectItemByUID( event->uid() );
-        somethingReselected = true;
-      }
-      if( event->uid() == selectedAllDayAgendaUid && !selectedAllDayAgendaUid.isNull() ) {
-        mAllDayAgenda->selectItemByUID( event->uid() );
-        somethingReselected = true;
-      }
+  lastVisibleDateTime.setTime( QTime( 23, 59 ) );
+  firstVisibleDateTime.setTime( QTime( 0, 0 ) );
+  DateTimeList dateTimeList;
 
-    }
+  if ( todo &&
+       ( !KOPrefs::instance()->showAllDayTodo() || !todo->hasDueDate() ) ) {
+    return;
+  }
 
-    // ---------- [display Todos --------------
-    if ( KOPrefs::instance()->showAllDayTodo() ) {
-      int numTodo;
-      for ( numTodo = 0; numTodo < todos.count(); ++numTodo ) {
-        Todo *todo = todos.at( numTodo );
-        if ( !todo->hasDueDate() ) {
-          continue;  // todo shall not be displayed if it has no date
-        }
+  if ( incidence->recurs() ) {
+    int eventDuration = incidence->dtStart().daysTo( incidence->dtEnd() );
 
-        // ToDo items shall be displayed for the day they are due, but only
-        // showed today if they are already overdue. Already completed items
-        // can be displayed on their original due date
-        bool overdue = todo->isOverdue();
+    // if there's a multiday event that starts before firstVisibleDateTime but ends after
+    // lets include it. timesInInterval() ignores incidences that aren't totaly inside
+    // the range
+    KDateTime startDateTimeWithOffset = firstVisibleDateTime.addDays( -eventDuration );
+    dateTimeList =
+      incidence->recurrence()->timesInInterval( startDateTimeWithOffset,
+                                                lastVisibleDateTime );
+  } else {
+    KDateTime dateToAdd; // date to add to our date list
+    KDateTime incidenceStart; 
+    KDateTime incidenceEnd;
 
-        if ( ( ( todo->dtDue().date() == currentDate ) && !overdue ) ||
-             ( ( currentDate == today ) && overdue ) ||
-             ( todo->recursOn( currentDate, KOPrefs::instance()->timeSpec() ) ) ) {
-          if ( todo->allDay() || overdue ) {  // Todo has no due-time set or is already overdue
-            mAllDayAgenda->insertAllDayItem( todo, currentDate, curCol, curCol );
-          } else {
-            int endY = mAgenda->timeToY(
-              todo->dtDue().toTimeSpec( KOPrefs::instance()->timeSpec() ).time() ) - 1;
-            int startY = endY - 1;
+    if ( todo && todo->hasDueDate() && !todo->isOverdue() ) {
+      // If it's not overdue it will be shown at the original date (not today)
+      dateToAdd = todo->dtDue();
+      incidenceEnd = dateToAdd;
+    } else if ( event ) {
+      dateToAdd = incidence->dtStart();
+      incidenceEnd = incidence->dtEnd();
 
-            mAgenda->insertItem( todo, currentDate, curCol, startY, endY );
-
-            if ( startY < mMinY[curCol] ) {
-              mMinY[curCol] = startY;
-            }
-            if ( endY > mMaxY[curCol] ) {
-              mMaxY[curCol] = endY;
-            }
-          }
-        }
+      if ( dateToAdd.isDateOnly() ) {
+        // so comparisons with < > actually work
+        dateToAdd.setTime( QTime( 0, 0 ) );
       }
     }
-    // ---------- display Todos] --------------
 
-    ++curCol;
+    if  ( dateToAdd <= lastVisibleDateTime && incidenceEnd >= firstVisibleDateTime ) {
+      dateTimeList += dateToAdd;
+    } 
   }
 
-  mAgenda->checkScrollBoundaries();
-  updateEventIndicators();
+  // ToDo items shall be displayed today if they are already overdude
+  KDateTime dateTimeToday = KDateTime( today, KOPrefs::instance()->timeSpec() );
+  if ( todo &&
+       todo->isOverdue() &&
+       dateTimeToday >= firstVisibleDateTime &&
+       dateTimeToday <= lastVisibleDateTime ) {
 
-//  mAgenda->viewport()->update();
-//  mAllDayAgenda->viewport()->update();
+    bool doAdd = true;
 
-// make invalid
-  deleteSelectedDateTime();
+    if ( todo->recurs() ) {
+      /* If there's a recurring instance showing up today don't add "today" again 
+       * we don't want the event to appear duplicated */
+      for ( t = dateTimeList.begin(); t != dateTimeList.end(); ++t ) {
+        if ( t->date() == today ) {
+          doAdd = false;
+          break;
+        }
+      }
+    }
 
-  if( !somethingReselected ) {
-    emit incidenceSelected( 0 );
+    if ( doAdd ) {
+      dateTimeList += dateTimeToday;
+    }
   }
+
+  for ( t = dateTimeList.begin(); t != dateTimeList.end(); ++t ) {
+    insertIncidence( incidence, t->date() );
+  }
 }
 
 void KOAgendaView::clearView()
@@ -1538,9 +1544,7 @@
   KConfigGroup group = config->group( "Views" );
 
   QList<int> sizes = group.readEntry( "Separator AgendaView", QList<int>() );
-  if ( sizes.count() == 3 ) { // Number of sections divided by separators in the view
-    mSplitterAgenda->setSizes( sizes );
-  }
+  mSplitterAgenda->setSizes( sizes );
 
   updateConfig();
 }
@@ -1688,7 +1692,7 @@
   return true;
 }
 
-void KOAgendaView::resourcesChanged()
+void KOAgendaView::setUpdateNeeded()
 {
   mPendingChanges = true;
 }
Index: korganizer/views/agendaview/koagendaitem.cpp
===================================================================
--- korganizer/views/agendaview/koagendaitem.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/views/agendaview/koagendaitem.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -691,7 +691,7 @@
 
 void KOAgendaItem::addConflictItem( KOAgendaItem *ci )
 {
-  if ( mConflictItems.contains( ci ) ) {
+  if ( !mConflictItems.contains( ci ) ) {
     mConflictItems.append( ci );
   }
 }
@@ -829,7 +829,7 @@
     cat = categories.first();
   }
   if ( cat.isEmpty() ) {
-    categoryColor = KOPrefs::instance()->mEventColor;
+    categoryColor = KOPrefs::instance()->defaultCategoryColor();
   } else {
     categoryColor = KOPrefs::instance()->categoryColor( cat );
   }
Index: korganizer/views/agendaview/koagenda.cpp
===================================================================
--- korganizer/views/agendaview/koagenda.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/views/agendaview/koagenda.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -636,14 +636,10 @@
         }
         showNewEventPopupSignal();
       } else {
-        // if mouse pointer is in selection, don't change selection
-        QPoint gpos = contentsToGrid( viewportToContents( viewportPos ) );
-        if ( !ptInSelection( gpos ) ) {
-          selectItem( 0 );
-          mActionItem = 0;
-          setCursor( Qt::ArrowCursor );
-          startSelectAction( viewportPos );
-        }
+        selectItem( 0 );
+        mActionItem = 0;
+        setCursor( Qt::ArrowCursor );
+        startSelectAction( viewportPos );
       }
     }
     break;
@@ -895,8 +891,8 @@
 
   // Cursor left active agenda area.
   // This starts a drag.
-  if ( clipperPos.y() < 0 || clipperPos.y() > visibleHeight() ||
-       clipperPos.x() < 0 || clipperPos.x() > visibleWidth() ) {
+  if ( clipperPos.y() < 0 || clipperPos.y() >= visibleHeight() ||
+       clipperPos.x() < 0 || clipperPos.x() >= visibleWidth() ) {
     if ( mActionType == MOVE ) {
       mScrollUpTimer.stop();
       mScrollDownTimer.stop();
@@ -1087,6 +1083,9 @@
   // FIXME: do the cloning here...
   Incidence *inc = mActionItem->incidence();
 
+  mItemMoved = mItemMoved && !( mStartCell.x() == mEndCell.x() &&
+                                mStartCell.y() == mEndCell.y() );
+
   if ( mItemMoved ) {
     bool modify = true;
     if ( mActionItem->incidence()->recurs() ) {
@@ -1402,7 +1401,7 @@
 //    QPixmap bgImage( KOPrefs::instance()->agendaGridBackgroundImage() );
 //    dbp.drawPixmap( 0, 0, cw, ch, bgImage ); FIXME
 //  }
-  dbp.fillRect( cx, cy, cw, ch,
+  dbp.fillRect( 0, 0, cw, ch,
                 KOPrefs::instance()->agendaGridBackgroundColor() );
   dbp.translate( -cx, -cy );
 
@@ -1801,6 +1800,10 @@
 
   QList<KOAgendaItem*>::iterator it;
   for ( it = conflictItems.begin(); it != conflictItems.end(); ++it ) {
+      (*it)->setSubCells( ( *it )->subCells()-1 );
+  }
+
+  for ( it = conflictItems.begin(); it != conflictItems.end(); ++it ) {
     // the item itself is also in its own conflictItems list!
     if ( *it != thisItem ) {
       placeSubCells( *it );
Index: korganizer/views/agendaview/koagendaview.h
===================================================================
--- korganizer/views/agendaview/koagendaview.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/views/agendaview/koagendaview.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -147,7 +147,7 @@
     virtual void showDates( const QDate &start, const QDate &end );
     virtual void showIncidences( const Incidence::List &incidenceList );
 
-    void insertIncidence( Incidence *incidence, const QDate &curDate, int curCol = -1 );
+    void insertIncidence( Incidence *incidence, const QDate &curDate );
     void changeIncidenceDisplayAdded( Incidence *incidence );
     void changeIncidenceDisplay( Incidence *incidence, int mode );
 
@@ -181,7 +181,8 @@
 
     void clearTimeSpanSelection();
 
-    void resourcesChanged();
+    /** Notifies agenda that there are pending changes */ 
+    void setUpdateNeeded();
 
     // Used by the timelabelszone
     void updateTimeBarWidth();
@@ -234,6 +235,7 @@
     bool filterByResource( Incidence *incidence );
     void setupTimeLabel( TimeLabels *timeLabel );
     int timeLabelsWidth();
+    void displayIncidence( Incidence *incidence );
 
   private:
     // view widgets
Index: korganizer/views/agendaview/agendaview.cpp
===================================================================
--- korganizer/views/agendaview/agendaview.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/views/agendaview/agendaview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -27,11 +27,11 @@
   KCal::CalendarResources *calres = dynamic_cast<KCal::CalendarResources *>( cal );
   if ( calres ) {
     connect( calres, SIGNAL(signalResourceAdded(ResourceCalendar *)),
-             SLOT(resourcesChanged()) );
+             SLOT(setUpdateNeeded()) );
     connect( calres, SIGNAL(signalResourceModified(ResourceCalendar *)),
-             SLOT(resourcesChanged()) );
+             SLOT(setUpdateNeeded()) );
     connect( calres, SIGNAL(signalResourceDeleted(ResourceCalendar *)),
-             SLOT(resourcesChanged()) );
+             SLOT(setUpdateNeeded()) );
   }
 }
 
Index: korganizer/version.h
===================================================================
--- korganizer/version.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/version.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -53,6 +53,6 @@
     3.2 alpha1
 */
 
-static const char korgVersion[] = "4.2 rc1";
+static const char korgVersion[] = "4.2.1";
 
 #endif
Index: korganizer/korganizerui.rc
===================================================================
--- korganizer/korganizerui.rc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/korganizerui.rc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -149,7 +149,6 @@
   </ToolBar>
 
   <ToolBar noMerge="1" name="filter_toolbar" hidden="true"><text>Filters Toolbar</text>
-    <Action name="filter_label"/>
     <Action name="filter_select"/>
     <Action name="edit_filters"/>
   </ToolBar>
Index: korganizer/korganizer_part.cpp
===================================================================
--- korganizer/korganizer_part.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/korganizer_part.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -70,6 +70,7 @@
   KGlobal::locale()->insertCatalog( "libkcal" );
   KGlobal::locale()->insertCatalog( "libkdepim" );
   KGlobal::locale()->insertCatalog( "kdgantt1" );
+  KGlobal::locale()->insertCatalog( "libkresources" );
 
   KOCore::self()->addXMLGUIClient( mTopLevelWidget, this );
 
Index: korganizer/calendarview.cpp
===================================================================
--- korganizer/calendarview.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/calendarview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -325,7 +325,7 @@
   }
 }
 
-QDate CalendarView::activeDate()
+QDate CalendarView::activeDate( bool fallbackToToday )
 {
   KOrg::BaseView *curView = mViewManager->currentView();
   if ( curView ) {
@@ -344,8 +344,13 @@
     }
   }
 
-  // When all else fails, use the navigator start date.
-  return mNavigator->selectedDates().first();
+  // When all else fails, use the navigator start date, or today.
+  if ( fallbackToToday ) {
+    return QDate::currentDate();
+  } else {  
+    return mNavigator->selectedDates().first();
+  }
+
 }
 
 QDate CalendarView::startDate()
@@ -1056,7 +1061,7 @@
 
 void CalendarView::newJournal()
 {
-  newJournal( QString(), activeDate() );
+  newJournal( QString(), activeDate( true ) );
 }
 
 void CalendarView::newJournal( const QDate &date )
@@ -1402,6 +1407,11 @@
   PublishDialog publishdlg;
   if ( publishdlg.exec() == QDialog::Accepted ) {
     QString recipients = publishdlg.addresses();
+    if ( incidence->organizer().isEmpty() ) {
+      incidence->setOrganizer( Person( KOPrefs::instance()->fullName(),
+                                       KOPrefs::instance()->email() ) );
+    }
+
     ICalFormat format;
     QString messageText = format.createScheduleMessage( incidence, iTIPRequest );
     KOMailClient mailer;
@@ -1555,13 +1565,16 @@
   QString filename = KFileDialog::getSaveFileName( KUrl( "icalout.ics" ),
                                                    i18n( "*.ics|ICalendars" ), this );
 
-  // Force correct extension
-  if ( filename.right( 4 ) != ".ics" ) {
-    filename += ".ics";
+  if ( !filename.isEmpty() )
+  {
+    // Force correct extension
+    if ( filename.right( 4 ) != ".ics" ) {
+      filename += ".ics";
+    }
+
+    FileStorage storage( mCalendar, filename, new ICalFormat );
+    storage.save();
   }
-
-  FileStorage storage( mCalendar, filename, new ICalFormat );
-  storage.save();
 }
 
 void CalendarView::exportVCalendar()
@@ -1582,15 +1595,18 @@
 
   QString filename = KFileDialog::getSaveFileName( KUrl( "vcalout.vcs" ),
                                                    i18n( "*.vcs|vCalendars" ), this );
+  if ( !filename.isEmpty() )
+  {
 
-  // TODO: I don't like forcing extensions:
-  // Force correct extension
-  if ( filename.right( 4 ) != ".vcs" ) {
-    filename += ".vcs";
+    // TODO: I don't like forcing extensions:
+    // Force correct extension
+    if ( filename.right( 4 ) != ".vcs" ) {
+      filename += ".vcs";
+    }
+
+    FileStorage storage( mCalendar, filename, new VCalFormat );
+    storage.save();
   }
-
-  FileStorage storage( mCalendar, filename, new VCalFormat );
-  storage.save();
 }
 
 void CalendarView::eventUpdated(Incidence *)
@@ -1718,11 +1734,16 @@
   if ( newFilter != mCurrentFilter ) {
     mCurrentFilter = newFilter;
     mCalendar->setFilter( mCurrentFilter );
+    mViewManager->setUpdateNeeded();
     updateView();
   }
   emit filterChanged();
 }
 
+bool CalendarView::isFiltered() const {
+  return mCurrentFilter != 0;
+}
+
 QString CalendarView::currentFilterName() const
 {
   if ( mCurrentFilter ) {
@@ -2247,11 +2268,6 @@
   }
 }
 
-void CalendarView::slotCalendarChanged()
-{
-  updateView();
-}
-
 void CalendarView::warningChangeFailed( Incidence *incidence )
 {
   Q_UNUSED( incidence );
@@ -2377,7 +2393,7 @@
 
 void CalendarView::resourcesChanged()
 {
-  mViewManager->resourcesChanged();
+  mViewManager->setUpdateNeeded();
   updateView();
 }
 
Index: korganizer/koviewmanager.h
===================================================================
--- korganizer/koviewmanager.h	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/koviewmanager.h	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -118,7 +118,7 @@
     void zoomInVertically();
     void zoomOutVertically();
 
-    void resourcesChanged();
+    void setUpdateNeeded();
 
   private slots:
     void currentAgendaViewTabChanged( QWidget * );
Index: korganizer/koprefs.cpp
===================================================================
--- korganizer/koprefs.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/koprefs.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -86,7 +86,6 @@
 
   agendaTimeLabelsFontItem()->setDefaultValue( mDefaultAgendaTimeLabelsFont );
   monthViewFontItem()->setDefaultValue( mDefaultMonthViewFont );
-  agendaCalendarItemsEventsBackgroundColorItem()->setDefaultValue( mDefaultCategoryColor );
 }
 
 KOPrefs::~KOPrefs()
@@ -301,6 +300,11 @@
   KPimPrefs::usrWriteConfig();
 }
 
+QColor KOPrefs::defaultCategoryColor() const
+{
+  return mDefaultCategoryColor;
+}
+
 void KOPrefs::setCategoryColor( const QString &cat, const QColor &color )
 {
   mCategoryColors.insert( cat, color );
Index: korganizer/koeditorattachments.cpp
===================================================================
--- korganizer/koeditorattachments.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/koeditorattachments.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -242,6 +242,9 @@
     grid->addWidget( mURLRequester, 4, 2 );
     connect( mURLRequester, SIGNAL(urlSelected(const KUrl &)),
              SLOT(urlChanged(const KUrl &)) );
+    connect( mURLRequester, SIGNAL( textChanged( const QString& ) ),
+             SLOT( urlChanged( const QString& ) ) );
+    urlChanged(  item->uri() );
   } else {
     grid->addWidget( new QLabel( i18nc( "@label", "Size:" ), page ), 4, 0 );
     grid->addWidget( new QLabel( QString::fromLatin1( "%1 (%2)" ).
@@ -292,6 +295,11 @@
   KDialog::accept();
 }
 
+void AttachmentEditDialog::urlChanged( const QString& url )
+{
+  enableButtonOk( !url.isEmpty() );
+}
+
 void AttachmentEditDialog::urlChanged( const KUrl &url )
 {
   mMimeType = KMimeType::findByUrl( url );
Index: korganizer/koincidenceeditor.cpp
===================================================================
--- korganizer/koincidenceeditor.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/koincidenceeditor.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -76,8 +76,8 @@
     showButton( Default, false );
   } else {
     setButtonText( Default, i18n( "Manage &Templates..." ) );
+    setButtonToolTip( Default, i18n( "Manage Templates" ) );
   }
-
   connect( this, SIGNAL(defaultClicked()), SLOT(slotManageTemplates()) );
   connect( this, SIGNAL(finished()), SLOT(delayedDestruct()) );
 }
@@ -112,6 +112,9 @@
       KDialog::reject();
     }
     break;
+  default:
+    KPageDialog::slotButtonClicked( button );
+    break;
   }
 }
 
@@ -166,7 +169,6 @@
 void KOIncidenceEditor::slotManageTemplates()
 {
   QString tp = type();
-
   TemplateManagementDialog * const d = new TemplateManagementDialog( this, templates() );
   connect( d, SIGNAL( loadTemplate( const QString& ) ),
            this, SLOT( slotLoadTemplate( const QString& ) ) );
@@ -175,7 +177,7 @@
   connect( d, SIGNAL( saveTemplate( const QString& ) ),
            this, SLOT( slotSaveTemplate( const QString& ) ) );
   d->exec();
-  return;
+  delete d;
 }
 
 void KOIncidenceEditor::saveAsTemplate( Incidence *incidence, const QString &templateName )
Index: korganizer/resourceview.cpp
===================================================================
--- korganizer/resourceview.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/resourceview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -185,10 +185,12 @@
         }
       }
     } else {
+      // mView->requestClose must be called before mResource->save() because 
+      // save causes closeResource do be called.
+      mView->requestClose( mResource );
       if ( mResource->save() ) {
         mResource->setActive( false );
       }
-      mView->requestClose( mResource );
     }
 
     setExpanded( mResource->isActive() && childCount() > 0 );
Index: korganizer/korganizer_part.rc
===================================================================
--- korganizer/korganizer_part.rc	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/korganizer_part.rc	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -157,7 +157,6 @@
   </ToolBar>
 
   <ToolBar noMerge="1" name="filter_toolbar" hidden="true"><text>Filters Toolbar</text>
-    <Action name="filter_label"/>
     <Action name="filter_select"/>
     <Action name="edit_filters"/>
   </ToolBar>
Index: korganizer/main.cpp
===================================================================
--- korganizer/main.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/main.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -50,6 +50,7 @@
   KGlobal::locale()->insertCatalog( "libkcal" );
   KGlobal::locale()->insertCatalog( "libkdepim" );
   KGlobal::locale()->insertCatalog( "kdgantt1" );
+  KGlobal::locale()->insertCatalog( "libkresources" );
 
   if ( app.isSessionRestored() ) {
     RESTORE( KOrganizer )
Index: korganizer/koviewmanager.cpp
===================================================================
--- korganizer/koviewmanager.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/koviewmanager.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -532,12 +532,12 @@
     showView( static_cast<KOrg::BaseView*>( widget ) );
 }
 
-void KOViewManager::resourcesChanged()
+void KOViewManager::setUpdateNeeded()
 {
   if ( mAgendaView ) {
-    mAgendaView->resourcesChanged();
+    mAgendaView->setUpdateNeeded();
   }
   if ( mAgendaSideBySideView ) {
-    mAgendaSideBySideView->resourcesChanged();
+    mAgendaSideBySideView->setUpdateNeeded();
   }
 }
Index: korganizer/kcmconfigs/korganizer_configviews.desktop
===================================================================
--- korganizer/kcmconfigs/korganizer_configviews.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/kcmconfigs/korganizer_configviews.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -41,7 +41,7 @@
 Name[kk]=–ö”©—Ä—ñ–Ω—ñ—Å—Ç–µ—Ä—ñ
 Name[km]=·ûë·û∑·ûä·üí·ûã·ûó·û∂·ûñ
 Name[ko]=Î≥¥Í∏∞
-Name[lt]=≈Ωi≈´rikliai
+Name[lt]=Per≈æi≈´ros
 Name[lv]=Skati
 Name[mk]=–ü—Ä–∏–∫–∞–∑
 Name[ms]=Paparan
@@ -98,7 +98,7 @@
 Comment[kk]=KOrganizer-–¥—ñ“£ –∫”©—Ä—ñ–Ω—ñ—Å—ñ–Ω—ñ“£ –ø–∞—Ä–∞–º–µ—Ç—Ä–ª–µ—Ä—ñ
 Comment[km]=·ûÄ·û∂·ûö‚Äã·ûÄ·üÜ·ûé·ûè·üã‚Äã·ûö·ûÖ·ûì·û∂·ûü·ûò·üí·ûñ·üê·ûì·üí·ûí‚Äã·ûë·û∑·ûä·üí·ûã·ûó·û∂·ûñ‚Äã·ûö·ûî·ûü·üã KOrganizer
 Comment[ko]=KOrganizer Î≥¥Í∏∞ ÏÑ§Ï†ï
-Comment[lt]=KOrganizer ≈æi≈´rikli≈≥ konfig≈´ravimas
+Comment[lt]=KOrganizer per≈æi≈´r≈≥ konfig≈´ravimas
 Comment[lv]=KOrganizer skata konfigurƒÅcija
 Comment[mk]=–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—ò–∞ –Ω–∞ –ø—Ä–∏–∫–∞–∑–æ—Ç
 Comment[ms]=Konfigurasi Paparan KOrganizer 
Index: korganizer/kcmconfigs/korganizer_configcolorsandfonts.desktop
===================================================================
--- korganizer/kcmconfigs/korganizer_configcolorsandfonts.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/kcmconfigs/korganizer_configcolorsandfonts.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -28,6 +28,7 @@
 Name[ja]=Ëâ≤„Å®„Éï„Ç©„É≥„Éà
 Name[km]=·ûñ·ûé·üå ·ûì·û∑·ûÑ‚Äã·ûñ·ûª·ûò·üí·ûñ·û¢·ûÄ·üí·ûü·ûö
 Name[ko]=ÏÉâÍ≥º Í∏ÄÍº¥
+Name[lt]=Spalvos ir ≈°riftai
 Name[lv]=KrƒÅsas un fonti
 Name[nb]=Farger og skrifter
 Name[nds]=Kl√∂ren un Schriftoorden
@@ -63,6 +64,7 @@
 Comment[ja]=KOrganizer Ëâ≤„Å®„Éï„Ç©„É≥„Éà„ÅÆË®≠ÂÆö
 Comment[km]=·ûÄ·û∂·ûö‚Äã·ûÄ·üÜ·ûé·ûè·üã‚Äã·ûö·ûÖ·ûì·û∂·ûü·ûò·üí·ûñ·üê·ûì·üí·ûí‚Äã·ûñ·ûª·ûò·üí·ûñ·û¢·ûÄ·üí·ûü·ûö ·ûì·û∑·ûÑ‚Äã·ûñ·ûé·üå KOrganizer
 Comment[ko]=KOrganizer ÏÉâÍ≥º Í∏ÄÍº¥ ÏÑ§Ï†ï
+Comment[lt]=KOrganizer spalv≈≥ ir ≈°rift≈≥ konfig≈´ravimas
 Comment[lv]=KOrganizer krƒÅsu un fontu konfigurƒÅcija
 Comment[nb]=KOrganizer farge- og skriftoppsett
 Comment[nds]=KOrganizer sien Kl√∂ren un Schriftoorden instellen
Index: korganizer/kcmconfigs/korganizer_configtime.desktop
===================================================================
--- korganizer/kcmconfigs/korganizer_configtime.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/kcmconfigs/korganizer_configtime.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -65,6 +65,7 @@
 Comment[ja]=KOrganizer Êó•‰ªò„Å®ÊôÇÈñì„ÅÆË®≠ÂÆö
 Comment[km]=·ûÄ·û∂‚Äã·ûö·ûÄ·üÜ·ûé·ûè·üã‚Äã·ûö·ûÖ·ûì·û∂·ûü·ûò·üí·ûñ·üê·ûì·üí·ûí‚Äã·ûÄ·û∂·ûõ·ûî·ûö·û∑·ûÖ·üí·ûÜ·üÅ·ûë ·ûì·û∑·ûÑ‚Äã·ûñ·üÅ·ûõ·ûú·üÅ·ûõ·û∂ KOrganizer
 Comment[ko]=KOrganizer ÏãúÍ∞Ñ Î∞è ÎÇ†Ïßú ÏÑ§Ï†ï
+Comment[lt]=KOrganizer laiko ir datos konfig≈´ravimas
 Comment[lv]=KOrganizer laika un datuma konfigurƒÅcija
 Comment[nb]=KOrganizer oppsett av dato og klokkeslett
 Comment[nds]=KOrganizer sien Tieden un Daten instellen
Index: korganizer/kcmconfigs/korganizer_configfreebusy.desktop
===================================================================
--- korganizer/kcmconfigs/korganizer_configfreebusy.desktop	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/kcmconfigs/korganizer_configfreebusy.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -33,7 +33,7 @@
 Name[hu]=Foglalts√°g
 Name[is]=T√≠mar√°√∞st√∂fun
 Name[it]=Libero/Occupato
-Name[ja]=ÂãïÈùôÊÉÖÂ†±
+Name[ja]=„Éï„É™„Éº/„Éì„Ç∏„Éº
 Name[ka]=·Éó·Éê·Éï·Éò·É°·É£·É§·Éê·Éö·Éò/·Éì·Éê·Éô·Éê·Éï·Éî·Éë·É£·Éö·Éò
 Name[kk]=–ë–æ—Å/–Ü—Å—Ç–µ
 Name[km]=·ûë·üÜ·ûì·üÅ·ûö/·ûö·ûú·ûõ·üã
@@ -89,7 +89,7 @@
 Comment[hu]=KOrganizer foglalts√°gi be√°ll√≠t√°sok
 Comment[is]=KOrganizer stillingar fyrir t√≠mar√°√∞st√∂fun
 Comment[it]=Configurazione Libero/Occupato di KOrganizer
-Comment[ja]=KOrganizer ÂãïÈùôÊÉÖÂ†±„ÅÆË®≠ÂÆö
+Comment[ja]=KOrganizer „Éï„É™„Éº/„Éì„Ç∏„Éº„ÅÆË®≠ÂÆö
 Comment[ka]=KOrganizer-·Éò·É° ·Éó·Éê·Éï·Éò·É°·É£·É§·Éê·Éö·Éò/·Éì·Éê·Éô·Éê·Éï·Éî·Éë·É£·Éö·Éù·Éë·Éò·É° ·Éô·Éù·Éú·É§·Éò·Éí·É£·É†·Éê·É™·Éò·Éê
 Comment[kk]=KOrganizer--–¥—ñ“£ –ë–æ—Å/–Ü—Å—Ç–µ –º”ô–ª—ñ–º–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–ª–µ—Ä—ñ
 Comment[km]=·ûÄ·û∂·ûö‚Äã·ûÄ·üÜ·ûé·ûè·üã‚Äã·ûö·ûÖ·ûì·û∂·ûü·ûò·üí·ûñ·üê·ûì·üí·ûí‚Äã·ûë·üÜ·ûì·üÅ·ûö/·ûö·ûú·ûõ·üã ·ûö·ûî·ûü·üã KOrganizer
Index: korganizer/koprefsdialog.cpp
===================================================================
--- korganizer/koprefsdialog.cpp	(.../tags/KDE/4.2.0/kdepim)	(wersja 930540)
+++ korganizer/koprefsdialog.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 930540)
@@ -542,8 +542,11 @@
 
       QBoxLayout *agendaLayout = new QVBoxLayout( agendaFrame );
 
+      QVBoxLayout *displayLayout = new QVBoxLayout;
+      QGroupBox *displayBox = new QGroupBox( i18nc( "@title:group", "Display Options" ) );
+
       QBoxLayout *hourSizeLayout = new QHBoxLayout;
-      agendaLayout->addLayout( hourSizeLayout );
+      displayLayout->addLayout( hourSizeLayout );
 
       KPrefsWidInt *hourSize =
         addWidInt( KOPrefs::instance()->hourSizeItem() );
@@ -555,7 +558,7 @@
       hourSizeLayout->addStretch( 1 );
 
       QBoxLayout *nextDaysLayout = new QHBoxLayout;
-      agendaLayout->addLayout( nextDaysLayout );
+      displayLayout->addLayout( nextDaysLayout );
 
       KPrefsWidInt *nextDays =
         addWidInt( KOPrefs::instance()->nextXDaysItem() );
@@ -568,20 +571,24 @@
 
       KPrefsWidBool *marcusBainsEnabled =
         addWidBool( KOPrefs::instance()->marcusBainsEnabledItem() );
-      agendaLayout->addWidget( marcusBainsEnabled->checkBox() );
+      displayLayout->addWidget( marcusBainsEnabled->checkBox() );
 
       KPrefsWidBool *marcusBainsShowSeconds =
         addWidBool( KOPrefs::instance()->marcusBainsShowSecondsItem() );
       connect( marcusBainsEnabled->checkBox(), SIGNAL(toggled(bool)),
                marcusBainsShowSeconds->checkBox(), SLOT(setEnabled(bool)) );
 
-      agendaLayout->addWidget( marcusBainsShowSeconds->checkBox() );
-      agendaLayout->addWidget(
+      displayLayout->addWidget( marcusBainsShowSeconds->checkBox() );
+      displayLayout->addWidget(
         addWidBool( KOPrefs::instance()->selectionStartsEditorItem() )->checkBox() );
+
+      displayBox->setLayout( displayLayout );
+
+      agendaLayout->addWidget( displayBox );
       agendaLayout->addWidget(
-        addWidCombo( KOPrefs::instance()->agendaViewColorsItem() )->comboBox() );
+        addWidRadios( KOPrefs::instance()->agendaViewColorsItem() )->groupBox() );
       agendaLayout->addWidget(
-        addWidCombo( KOPrefs::instance()->agendaViewCalendarDisplayItem() )->comboBox() );
+        addWidRadios( KOPrefs::instance()->agendaViewCalendarDisplayItem() )->groupBox() );
 
       agendaLayout->addStretch( 1 );
 
@@ -653,11 +660,6 @@
   colorLayout->addWidget( holidayColor->label(), 0, 0 );
   colorLayout->addWidget( holidayColor->button(), 0, 1 );
 
-  KPrefsWidColor *eventColor =
-    addWidColor( KOPrefs::instance()->agendaCalendarItemsEventsBackgroundColorItem(), colorFrame );
-  colorLayout->addWidget( eventColor->label(), 2, 0 );
-  colorLayout->addWidget( eventColor->button(), 2, 1 );
-
   // agenda view background color
   KPrefsWidColor *agendaBgColor =
     addWidColor( KOPrefs::instance()->agendaGridBackgroundColorItem(), colorFrame );
@@ -864,9 +866,9 @@
 
 void KOPrefsDialogColorsAndFonts::updateResourceColor()
 {
-  QString res= mResourceIdentifier[mResourceCombo->currentIndex()];
+  QString res = mResourceIdentifier[mResourceCombo->currentIndex()];
   QColor color = mCategoryDict.value( res );
-  if ( color.isValid() )  {
+  if ( !color.isValid() )  {
     color = KOPrefs::instance()->resourceColor( res );
   }
   if ( color.isValid() ) {

Zmiany atrybut√≥w dla: .
___________________________________________________________________
Zmienione: svn:ignore
   - configure.in
aclocal.m4
acinclude.m4
stamp-h.in
config.h.in
Makefile.in
configure
subdirs
config.h
inst-apps
stamp-h
Makefile
stamp-h1.in
stamp-h1
libtool
*.moc
*.moc.cpp
.autoconf_trace
configure.files
autom4te.cache
Makefile.am

   + configure.in
aclocal.m4
acinclude.m4
stamp-h.in
config.h.in
Makefile.in
configure
subdirs
config.h
inst-apps
stamp-h
Makefile
stamp-h1.in
stamp-h1
libtool
*.moc
*.moc.cpp
.autoconf_trace
configure.files
autom4te.cache
Makefile.am
Doxyfile
backport-commit-message.txt
*.kdevelop.pcs
svn-prop.tmp

Dodane: svn:externals
   + 


