Index: akregator/Messages.sh
===================================================================
--- akregator/Messages.sh	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ akregator/Messages.sh	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -1,3 +1,3 @@
 #! /bin/sh
 $EXTRACTRC `find . -name "*.rc" -o -name "*.ui" -o -name "*.kcfg"` >> rc.cpp || exit 11
-$XGETTEXT $(find -name "*.cpp" ) -o $podir/akregator.pot
+$XGETTEXT $(find . -name "*.cpp" -o -name "*.h") -o $podir/akregator.pot
Index: akregator/src/subscriptionlistmodel.cpp
===================================================================
--- akregator/src/subscriptionlistmodel.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ akregator/src/subscriptionlistmodel.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -447,6 +447,9 @@
     {
         const TreeNode* const droppedOnNode = qobject_cast<const TreeNode*>( nodeForIndex( parent, m_feedList ) );
 
+        if ( !droppedOnNode )
+            return false;
+
         const Folder* const destFolder = droppedOnNode->isGroup() ? qobject_cast<const Folder*>( droppedOnNode ) : droppedOnNode->parent();
         if ( !destFolder )
             return false;
Index: libkleo/libkleopatrarc.desktop
===================================================================
--- libkleo/libkleopatrarc.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ libkleo/libkleopatrarc.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -288,6 +288,7 @@
 Name[it]=Chiavi per le firme qualificate
 Name[ja]=適格電子署名用の鍵
 Name[km]=សោ​សម្រាប់​ហត្ថលេខា​ដែល​មាន​​គុណភាព
+Name[lt]=Raktai kvalifikuotiems parašams
 Name[lv]=Derīgo parakstu atslēgas
 Name[nb]=Nøkler for kvalifiserte signaturer
 Name[nds]=Slötels för pröövt Ünnerschriften
Index: kode/kwsdl/kwsdl_compiler.desktop
===================================================================
--- kode/kwsdl/kwsdl_compiler.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kode/kwsdl/kwsdl_compiler.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -14,6 +14,7 @@
 Name[kk]=KWSDL компиляторы
 Name[km]=កម្មវិធី​ចងក្រង KWSDL
 Name[ko]=KWSDL 컴파일러
+Name[lt]=KWSDL kompiliatorius
 Name[lv]=KWSDL kompilators
 Name[nb]=KWSDL-kompilator
 Name[nds]=KWSDL-Kompilerer
Index: kode/kxforms/kxforms.desktop
===================================================================
--- kode/kxforms/kxforms.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kode/kxforms/kxforms.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -23,6 +23,7 @@
 GenericName[kk]=XML пішін өңдегіші
 GenericName[km]=កម្មវិធី​និពន្ធ​សំណុំ​បែបបទ​របស់ XML
 GenericName[ko]=XML 폼 편집기
+GenericName[lt]=XML formų rengyklė
 GenericName[lv]=XML formu redaktors
 GenericName[nb]=XML skjemaredigerer
 GenericName[nds]=XML-Kiekwarkeditor
Index: kleopatra/kwatchgnupg/kwatchgnupgmainwin.cpp
===================================================================
--- kleopatra/kwatchgnupg/kwatchgnupgmainwin.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kleopatra/kwatchgnupg/kwatchgnupgmainwin.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -105,7 +105,7 @@
 
 void KWatchGnuPGMainWindow::createActions()
 {
-  QAction *action = actionCollection()->addAction( "clear_log" );
+  KAction *action = actionCollection()->addAction( "clear_log" );
   action->setIcon( KIcon("edit-clear-history") );
   action->setText( i18n("C&lear History") );
   connect(action, SIGNAL(triggered()), SLOT( slotClear() ));
Index: kleopatra/kleopatra_import.desktop
===================================================================
--- kleopatra/kleopatra_import.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kleopatra/kleopatra_import.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -16,7 +16,7 @@
 Comment[ca]=Gestor de certificats i IGU criptogràfica unificada
 Comment[cs]=Správce certifikátů a rozhraní pro šifrování
 Comment[da]=Certifikathåndtering og forenet krypterings-GUI
-Comment[de]=Zertifikatsverwaltung und Kryptographie-Oberfläche
+Comment[de]=Zertifikatsverwaltung und Kryptografie-Oberfläche
 Comment[el]=Διαχειριστής πιστοποιητικών και GUI ενοποιημένης κρυπτογράφησης
 Comment[es]=Gestor de certificados e interfaz gráfica unificada de criptografía
 Comment[et]=Sertifikaadihaldur ja ühendatud krüptimise graafiline kasutajaliides
Index: kresources/scalix/kabc/scalix.desktop
===================================================================
--- kresources/scalix/kabc/scalix.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kresources/scalix/kabc/scalix.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -44,6 +44,7 @@
 Comment[it]=Consente l'accesso ai contatti memorizzati su un server Scalix che usa IMAP tramite KMail o Kontact
 Comment[ja]=KMail または Kontact 経由で IMAP を使って、Scalix サーバに保存されている連絡先へのアクセスを提供します
 Comment[km]=ផ្ដល់​សិទ្ធិ​ចូល​ដំណើរការ​ទៅកាន់​ទំនាក់ទំនង​ដែល​បាន​រក្សាទុក​នៅ​លើ​ម៉ាស៊ីន​បម្រើ Scalix ដោយប្រើ IMAP តាមរយៈ KMail ឬ Kontact
+Comment[lt]=Suteikia prieigą prie kontaktų, saugomų Scalix serveryje, naudojant KMail (Kontact) programos IMAP protokolą
 Comment[lv]=Nodrošina piekļuvi kontaktiem, kas glabājas Scalix severī, izmantojot IMAP caur KMail vai Kontact
 Comment[nb]=Gir tilgang til en kalender lagret på en Scalix-tjener som bruker IMAP, via KMail eller Kontact
 Comment[nds]=Stellt mit KMail oder Kontact över IMAP Topgriep op Kontakten op en Scalix-Server praat
Index: kresources/slox/kabc_ox.desktop
===================================================================
--- kresources/slox/kabc_ox.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kresources/slox/kabc_ox.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -57,6 +57,7 @@
 Comment[it]=Consente l'accesso ai contatti memorizzati su un server Open-Xchange
 Comment[ja]=Open-Xchange サーバに保存されている連絡先へのアクセスを提供します
 Comment[km]=ផ្ដល់​សិទ្ធិ​ចូល​ដំណើរការ​ទៅកាន់​ទំនាក់ទំនង​ដែល​បាន​រក្សាទុក​នៅ​លើ​ម៉ាស៊ីន​បម្រើ Open-Xchange
+Comment[lt]=Suteikia prieigą prie kontaktų, saugomų Open-Xchange serveryje
 Comment[lv]=Nodrošina piekļuvi kontaktiem, kas glabājas Open-Xchange serverī.
 Comment[nb]=Gir tilgang til kontakter lagret på en Open-Xchange-tjener
 Comment[nds]=Stellt Togriep op de op en Open-Xchange-Server wohrten Kontakten praat
Index: kresources/akonadi/kabc/akonadi.desktop
===================================================================
--- kresources/akonadi/kabc/akonadi.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kresources/akonadi/kabc/akonadi.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -13,6 +13,7 @@
 Name[it]=Rubrica indirizzi di Akonadi
 Name[ja]=Akonadi アドレス帳
 Name[km]=សៀវភៅ​អាសយដ្ឋាន Akonadi
+Name[lt]=Akonadi adresų knygelės
 Name[lv]=Akonadi adrešu grāmatas
 Name[nb]=Akonadi adressebøker
 Name[nds]=Akonadi-Adressbook instellen
Index: kresources/featureplan/kcal_resourcefeatureplan.desktop
===================================================================
--- kresources/featureplan/kcal_resourcefeatureplan.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kresources/featureplan/kcal_resourcefeatureplan.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -23,6 +23,7 @@
 Name[lt]=XML bruožų planas
 Name[lv]=XML iespēju plāns
 Name[ms]=Pelan Cirian XML 
+Name[nb]=XML-funksjonsplan
 Name[nds]=XML-Funkschonenplaan
 Name[ne]=एक्सएमएल विशेषता योजना
 Name[nl]=Functionaliteitsplanning in XML
Index: kmail/dbusmail.desktop
===================================================================
--- kmail/dbusmail.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/dbusmail.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -20,6 +20,7 @@
 Comment[kk]=DBUS интерфейсті пошта бағдарламасы
 Comment[km]=កម្មវិធី​សំបុត្រ​ដែល​មាន​ចំណុច​ប្រទាក់ DBUS
 Comment[ko]=DBUS 인터페이스를 사용하는 전자 우편 프로그램
+Comment[lt]=Pašto programa su D-Bus sąsaja
 Comment[lv]=Pasta programma ar DBUS saskarni
 Comment[nb]=E-postprogram med DBUS-grensesnitt
 Comment[nds]=Nettpostprogramm mit en D-Bus-Koppelsteed
Index: kmail/messagelistview/storagemodel.cpp
===================================================================
--- kmail/messagelistview/storagemodel.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/messagelistview/storagemodel.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -87,6 +87,9 @@
   connect( mFolder, SIGNAL( msgHeaderChanged( KMFolder * , int ) ),
            SLOT( slotMessageHeaderChanged( KMFolder *, int ) ) );
 
+  connect( mFolder, SIGNAL( viewConfigChanged() ),
+           SLOT( slotViewConfigChanged() ) );
+
 #if 0
   // FIXME: Do we need to handle these remaining signals ?
 
@@ -109,8 +112,6 @@
   /** Emitted when a folder was removed */
   void removed(KMFolder*, bool);
 
-  /** Emitted when the variables for the config of the view have changed */
-  void viewConfigChanged();
 #endif
 
   mMessageCount = mFolder->count();
@@ -179,6 +180,12 @@
       this, SLOT( slotMessageHeaderChanged( KMFolder *, int ) )
     );
 
+  disconnect(
+      mFolder, SIGNAL( viewConfigChanged() ),
+      this, SLOT( slotViewConfigChanged() )
+    );
+
+
   //mFolder->markNewAsUnread(); <-- do we REALLY need to do this ?.. couldn't we use a timed-expire instead ?
   if ( mFolder->dirty() )
     mFolder->writeIndex(); // this is straight from KMHeaders...
@@ -596,6 +603,11 @@
   reset();
 }
 
+void StorageModel::slotViewConfigChanged()
+{
+  reset();
+}
+
 void StorageModel::slotFolderExpunged()
 {
   slotFolderClosed();
Index: kmail/messagelistview/core/model.cpp
===================================================================
--- kmail/messagelistview/core/model.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/messagelistview/core/model.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -472,7 +472,7 @@
 
   if ( mStorageModel && column->isSenderOrReceiver() )
   {
-    if ( mStorageModel->containsOutboundMessages() )
+    if ( mStorageModelContainsOutboundMessages )
       return QVariant( i18n( "Receiver" ) );
     return QVariant( i18n( "Sender" ) );
   }
@@ -648,6 +648,7 @@
 
   mPreSelectionMode = preSelectionMode;
   mUniqueIdOfLastSelectedMessageInFolder = Manager::instance()->preSelectedMessageForStorageModel( mStorageModel );
+  mStorageModelContainsOutboundMessages = mStorageModel->containsOutboundMessages();
 
   connect( mStorageModel, SIGNAL( rowsInserted( const QModelIndex &, int, int ) ),
            this, SLOT( slotStorageModelRowsInserted( const QModelIndex &, int, int ) ) );
@@ -808,6 +809,37 @@
   viewItemJobStep();
 }
 
+void Model::checkIfDateChanged()
+{
+  // This function is called by MessageListView::Core::Manager once in a while (every 1 minute or sth).
+  // It is used to check if the current date has changed (with respect to mTodayDate).
+  //
+  // Our message items cache the formatted dates (as formatting them
+  // on the fly would be too expensive). We also cache the labels of the groups which often display dates.
+  // When the date changes we would need to fix all these strings.
+  //
+  // A dedicated algorithm to refresh the labels of the items would be either too complex
+  // or would block on large trees. Fixing the labels of the groups is also quite hard...
+  //
+  // So to keep the things simple we just reload the view.
+
+  if ( !mStorageModel )
+    return; // nothing to do
+
+  if ( mLoading )
+    return; // not now
+
+  if ( !mViewItemJobs->isEmpty() )
+    return; // not now
+
+  if ( mTodayDate.day() == QDate::currentDate().day() )
+    return; // date not changed
+
+  // date changed, reload the view (and try to preserve the current selection)
+  setStorageModel( mStorageModel, PreSelectLastSelected );
+}
+
+
 void Model::abortMessagePreSelection()
 {
   // This is used to abort a message pre-selection before we actually could apply it.
@@ -1535,6 +1567,49 @@
 
 // Subject threading cache stuff
 
+#if 0
+// Debug helpers
+void dump_iterator_and_list( QList< MessageItem * >::Iterator &iter, QList< MessageItem * > *list )
+{
+  kDebug() << "Threading cache part dump" << endl;
+  if ( iter == list->end() )
+    kDebug() << "Iterator pointing to end of the list" << endl;
+  else
+    kDebug() << "Iterator pointing to " << *iter << " subject [" << (*iter)->subject() << "] date [" << (*iter)->date() << "]" << endl;
+
+  for ( QList< MessageItem * >::Iterator it = list->begin(); it != list->end(); ++it )
+  {
+    kDebug() << "List element " << *it << " subject [" << (*it)->subject() << "] date [" << (*it)->date() << "]" << endl;
+  }
+
+  kDebug() << "End of threading cache part dump" << endl;
+}
+
+void dump_list( QList< MessageItem * > *list )
+{
+  kDebug() << "Threading cache part dump" << endl;
+
+  for ( QList< MessageItem * >::Iterator it = list->begin(); it != list->end(); ++it )
+  {
+    kDebug() << "List element " << *it << " subject [" << (*it)->subject() << "] date [" << (*it)->date() << "]" << endl;
+  }
+
+  kDebug() << "End of threading cache part dump" << endl;
+}
+#endif // debug helpers
+
+// a helper class used in a qLowerBound() call below
+class MessageLessThanByDate
+{
+public:
+  inline bool operator()( const MessageItem * mi1, const MessageItem * mi2 ) const
+  {
+    if ( mi1->date() == mi2->date() )
+      return mi1 < mi2;
+    return mi1->date() < mi2->date();
+  }
+};
+
 void Model::addMessageToSubjectBasedThreadingCache( MessageItem * mi )
 {
   // Unfortunately the entries in the cache can't be sorted by date. This is
@@ -1554,35 +1629,16 @@
   Q_ASSERT( !messagesWithTheSameStrippedSubject->contains( mi ) );
 
   // Binary search based insertion
-  QList< MessageItem * >::Iterator it = qLowerBound( messagesWithTheSameStrippedSubject->begin(), messagesWithTheSameStrippedSubject->end(), mi );
+  QList< MessageItem * >::Iterator it = qLowerBound( messagesWithTheSameStrippedSubject->begin(), messagesWithTheSameStrippedSubject->end(), mi, MessageLessThanByDate() );
   messagesWithTheSameStrippedSubject->insert( it, mi );
 }
 
-#if 0
-// Debug helper
-void dump_iterator_and_list( QList< MessageItem * >::Iterator &iter, QList< MessageItem * > *list )
-{
-  kDebug() << "Threading cache part dump" << endl;
-  if ( iter == list->end() )
-    kDebug() << "Iterator pointing to end of the list" << endl;
-  else
-    kDebug() << "Iterator pointing to " << *iter << " subject [" << (*iter)->subject() << "] date [" << (*iter)->date() << "]" << endl;
-
-  for ( QList< MessageItem * >::Iterator it = list->begin(); it != list->end(); ++it )
-  {
-    kDebug() << "List element " << *it << " subject [" << (*it)->subject() << "] date [" << (*it)->date() << "]" << endl;
-  }
-
-  kDebug() << "End of threading cache part dump" << endl;
-}
-#endif
-
 void Model::removeMessageFromSubjectBasedThreadingCache( MessageItem * mi )
 {
   QList< MessageItem * > * messagesWithTheSameStrippedSubject = mThreadingCacheMessageSubjectMD5ToMessageItem->value( mi->strippedSubjectMD5(), 0 );
   Q_ASSERT( messagesWithTheSameStrippedSubject );
 
-  QList< MessageItem * >::Iterator it = qLowerBound( messagesWithTheSameStrippedSubject->begin(), messagesWithTheSameStrippedSubject->end(), mi );
+  QList< MessageItem * >::Iterator it = qLowerBound( messagesWithTheSameStrippedSubject->begin(), messagesWithTheSameStrippedSubject->end(), mi, MessageLessThanByDate() );
   Q_ASSERT( it != messagesWithTheSameStrippedSubject->end() );
   Q_ASSERT( *it == mi );
 
@@ -2619,7 +2675,7 @@
   int elapsed;
 
   // Should we use the receiver or the sender field for sorting ?
-  bool bUseReceiver = ( mStorageModel->containsOutboundMessages() );
+  bool bUseReceiver = mStorageModelContainsOutboundMessages;
 
   // The begin storage index of our work
   int curIndex = job->currentIndex();
@@ -2926,9 +2982,9 @@
       // Handle saving the current selection: if this item was the current before the step
       // then zero it out. We have killed it and it's OK for the current item to change.
 
-      if ( dyingMessage->isViewable() &&
-           dyingMessage == mCurrentItemToRestoreAfterViewItemJobStep )
+      if ( dyingMessage == mCurrentItemToRestoreAfterViewItemJobStep )
       {
+        Q_ASSERT( dyingMessage->isViewable() );
         // Try to select the item below the removed one as it helps in doing a "readon" of emails:
         // you read a message, decide to delete it and then go to the next.
         // Qt tends to select the message above the removed one instead (this is a hardcoded logic in
@@ -3028,12 +3084,21 @@
       // Parent is gone
       childMessage->setThreadingStatus( MessageItem::ParentMissing );
 
-      // If the child is going to be selected, we must immediately
-      // reattach it to a temporary group in order for the selection
-      // to be preserved across multiple steps. Otherwise we could end
+      // If the child (or any message in its subtree) is going to be selected,
+      // then we must immediately reattach it to a temporary group in order for the
+      // selection to be preserved across multiple steps. Otherwise we could end
       // with the child-to-be-selected being non viewable at the end
       // of the view job step. Attach to a temporary group.
-      if ( childMessage == mCurrentItemToRestoreAfterViewItemJobStep )
+      if (
+           // child is going to be re-selected
+           ( childMessage == mCurrentItemToRestoreAfterViewItemJobStep ) ||
+           (
+             // there is a message that is going to be re-selected
+             mCurrentItemToRestoreAfterViewItemJobStep && 
+             // that message is in the childMessage subtree
+             mCurrentItemToRestoreAfterViewItemJobStep->hasAncestor( childMessage )
+           )
+         )
       {
         attachMessageToGroupHeader( childMessage );
 
Index: kmail/messagelistview/core/view.cpp
===================================================================
--- kmail/messagelistview/core/view.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/messagelistview/core/view.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -230,6 +230,9 @@
   if ( !mTheme )
     return;
 
+  kDebug() << "Apply theme columns";
+
+
   const QList< Theme::Column * > & columns = mTheme->columns();
 
   if ( columns.count() < 1 )
@@ -278,12 +281,15 @@
   {
     if ( ( *it )->currentlyVisible() || ( idx == 0 ) )
     {
+      kDebug() << "Column " << idx << " will be visible";
       // Column visible
       int savedWidth = ( *it )->currentWidth();
       int hintWidth = mDelegate->sizeHintForItemTypeAndColumn( Item::Message, idx ).width();
       totalVisibleWidthHint += savedWidth > 0 ? savedWidth : hintWidth;
       lColumnSizeHints.append( hintWidth );
+      kDebug() << "Column " << idx << " size hint is " << hintWidth;
     } else {
+      kDebug() << "Column " << idx << " will be not visible";
       // The column is not visible
       lColumnSizeHints.append( -1 ); // dummy
     }
@@ -422,9 +428,12 @@
 
   idx = 0;
 
+  kDebug() << "Entering colum show/hide loop";
+
   for ( it = columns.begin(); it != columns.end(); ++it )
   {
     bool visible = ( idx == 0 ) || ( *it )->currentlyVisible();
+    kDebug() << "Column " << idx << " visible " << visible;
     ( *it )->setCurrentlyVisible( visible );
     header()->setSectionHidden( idx, !visible );
     idx++;
@@ -441,7 +450,7 @@
   {
     if ( ( *it )->currentlyVisible() )
     {
-      // kDebug() << "Resize section " << idx << " to " << lColumnWidths[ idx ];
+      kDebug() << "Resize section " << idx << " to " << lColumnWidths[ idx ];
       ( *it )->setCurrentWidth( lColumnWidths[ idx ] );
       header()->resizeSection( idx, lColumnWidths[ idx ] );
       totalVisibleWidth += lColumnWidths[ idx ];
@@ -501,6 +510,11 @@
   if ( !mTheme )
     return;
 
+  if ( mNeedToApplyThemeColumns )
+    return; // don't save the state if it hasn't been applied at all
+
+  kDebug() << "Save theme column state";
+
   const QList< Theme::Column * > & columns = mTheme->columns();
 
   if ( columns.count() < 1 )
@@ -513,9 +527,11 @@
   {
     if ( header()->isSectionHidden( idx ) )
     {
+      kDebug() << "Section " << idx << " is hidden";
       ( *it )->setCurrentlyVisible( false );
       ( *it )->setCurrentWidth( -1 ); // reset (hmmm... we could use the "don't touch" policy here too...)
     } else {
+      kDebug() << "Section " << idx << " is visible and has size " << header()->sectionSize( idx );
       ( *it )->setCurrentlyVisible( true );
       ( *it )->setCurrentWidth( header()->sectionSize( idx ) );
     }
@@ -872,9 +888,51 @@
 
 void View::setAllThreadsExpanded( bool expand )
 {
-  setChildrenExpanded( mModel->rootItem(), expand );
+  if ( mAggregation->grouping() == Aggregation::NoGrouping )
+  {
+    // we have no groups so threads start under the root item: just expand/unexpand all
+    setChildrenExpanded( mModel->rootItem(), expand );
+    return;
+  }
+
+  // grouping is in effect: must expand/unexpand one level lower
+
+  QList< Item * > * childList = mModel->rootItem()->childItems();
+  if ( !childList )
+    return;
+
+  foreach ( Item * item, *childList )
+    setChildrenExpanded( item, expand );
 }
 
+void View::setAllGroupsExpanded( bool expand )
+{
+  if ( mAggregation->grouping() == Aggregation::NoGrouping )
+    return; // no grouping in effect
+
+  Item * item = mModel->rootItem();
+
+  QList< Item * > * childList = item->childItems();
+  if ( !childList )
+    return;
+
+  foreach ( Item * item, *childList )
+  {
+    Q_ASSERT( item->type() == Item::GroupHeader );
+    QModelIndex idx = mModel->index( item, 0 );
+    Q_ASSERT( idx.isValid() );
+    Q_ASSERT( static_cast< Item * >( idx.internalPointer() ) == item );
+    if ( expand )
+    {
+      if ( !isExpanded( idx ) )
+        setExpanded( idx, true );
+    } else {
+      if ( isExpanded( idx ) )
+        setExpanded( idx, false );
+    }
+  }
+}
+
 void View::selectMessageItems( const QList< MessageItem * > &list )
 {
   QItemSelection selection;
@@ -2252,46 +2310,12 @@
 
 void View::slotCollapseAllGroups()
 {
-  if ( mAggregation->grouping() == Aggregation::NoGrouping )
-    return;
-
-  Item * item = mModel->rootItem();
-
-  QList< Item * > * childList = item->childItems();
-  if ( !childList )
-    return;
-
-  for ( QList< Item * >::Iterator it = childList->begin(); it != childList->end(); ++it )
-  {
-    Q_ASSERT( ( *it )->type() == Item::GroupHeader );
-    QModelIndex idx = mModel->index( *it, 0 );
-    Q_ASSERT( idx.isValid() );
-    Q_ASSERT( static_cast< Item * >( idx.internalPointer() ) == ( *it ) );
-    if ( isExpanded( idx ) )
-      setExpanded( idx, false );
-  }
+  setAllGroupsExpanded( false );
 }
 
 void View::slotExpandAllGroups()
 {
-  if ( mAggregation->grouping() == Aggregation::NoGrouping )
-    return;
-
-  Item * item = mModel->rootItem();
-
-  QList< Item * > * childList = item->childItems();
-  if ( !childList )
-    return;
-
-  for ( QList< Item * >::Iterator it = childList->begin(); it != childList->end(); ++it )
-  {
-    Q_ASSERT( ( *it )->type() == Item::GroupHeader );
-    QModelIndex idx = mModel->index( *it, 0 );
-    Q_ASSERT( idx.isValid() );
-    Q_ASSERT( static_cast< Item * >( idx.internalPointer() ) == ( *it ) );
-    if ( !isExpanded( idx ) )
-      setExpanded( idx, true );
-  }
+  setAllGroupsExpanded( true );
 }
 
 } // namespace Core
Index: kmail/messagelistview/core/manager.h
===================================================================
--- kmail/messagelistview/core/manager.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/messagelistview/core/manager.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -24,8 +24,10 @@
 #include "messagelistview/core/sortorder.h"
 #include <QList>
 #include <QHash>
+#include <QObject>
 
 class QPixmap;
+class QTimer;
 
 namespace KMime
 {
@@ -63,20 +65,22 @@
  * before the first MessageListView::Widget and destroyed after the last MessageListView::Widget.
  * But in KMail this is always the case :)
  */
-class Manager
+class Manager : public QObject
 {
+  Q_OBJECT
 protected:
   Manager();
   ~Manager();
 
 private:
-  static Manager *mInstance;
+  static Manager * mInstance;
   QList< Widget * > mWidgetList;
   QHash< QString, Aggregation * > mAggregations;
   QHash< QString, Theme * > mThemes;
   KMime::DateFormatter * mDateFormatter;
   bool mDisplayMessageToolTips;
   QString mCachedLocalizedUnknownText;
+  QTimer * mHeartBeatTimer;
 
   // pixmaps, never null
 
@@ -258,6 +262,15 @@
    */
   void reloadAllWidgets();
 
+protected slots:
+  /**
+   * This slot is connected to a very slow timer (1 minute).
+   * It actually sweeps through the registered models calling
+   * checkIfDateChanged() in order to fix date displays.
+   * Later we could find other uses for the heartbeat.
+   */
+  void slotHeartBeat();
+
 private:
   // internal configuration stuff
   void loadConfiguration();
Index: kmail/messagelistview/core/model.h
===================================================================
--- kmail/messagelistview/core/model.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/messagelistview/core/model.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -51,6 +51,7 @@
 class Filter;
 class GroupHeaderItem;
 class Item;
+class Manager;
 class MessageItem;
 class Theme;
 class StorageModel;
@@ -76,6 +77,7 @@
 class Model : public QAbstractItemModel
 {
   friend class Item;
+  friend class Manager;
 
   Q_OBJECT
 public:
@@ -183,7 +185,7 @@
 
   /**
    * Owned invisible root item, useful to implement algorithms that not need
-   * to handle the special case of parentless items
+   * to handle the special case of parentless items. This is never 0.
    */
   Item *mRootItem;
 
@@ -339,6 +341,13 @@
    */
   Model * mModelForItemFunctions;
 
+  /**
+   * The cached result of StorageModel::containsOutboundMessages().
+   * We access this property at each incoming message and StorageModel::containsOutboundMessages() is
+   * virtual (so it's always an indirect function call). Caching makes sense.
+   */
+  bool mStorageModelContainsOutboundMessages;
+
 public:
 
   /**
@@ -389,6 +398,7 @@
 
   /**
    * Returns the hidden root item that all the messages are (or will be) attached to.
+   * The returned value is never 0.
    */
   Item * rootItem() const
     { return mRootItem; };
@@ -466,8 +476,16 @@
   void deletePersistentSet( MessageItemSetReference ref );
 
 protected:
+
   void fillView();
 
+  /**
+   * This is called by MessageListView::Manager once in a while.
+   * It is a good place to check if the date has changed and
+   * trigger a view reload.
+   */
+  void checkIfDateChanged();
+
 protected slots:
   void viewItemJobStep();
 
Index: kmail/messagelistview/core/manager.cpp
===================================================================
--- kmail/messagelistview/core/manager.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/messagelistview/core/manager.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -27,8 +27,10 @@
 #include "messagelistview/core/configurethemesdialog.h"
 #include "messagelistview/core/widgetbase.h"
 #include "messagelistview/core/storagemodelbase.h"
+#include "messagelistview/core/model.h"
 
 #include <QPixmap>
+#include <QTimer>
 
 #include <kmime/kmime_dateformatter.h> // kdepimlibs
 
@@ -53,6 +55,7 @@
 Manager * Manager::mInstance = 0;
 
 Manager::Manager()
+  : QObject()
 {
   mInstance = this;
 
@@ -96,14 +99,26 @@
 
   mCachedLocalizedUnknownText = i18nc( "Unknown date", "Unknown" ) ;
 
+  mHeartBeatTimer = new QTimer(this);
+  QObject::connect(
+      mHeartBeatTimer,SIGNAL(timeout()),
+      this,SLOT(slotHeartBeat())
+    );
+
+  mHeartBeatTimer->start(60000); // 1 minute
+
   loadConfiguration();
 }
 
 Manager::~Manager()
 {
+  mHeartBeatTimer->stop();
+
   saveConfiguration();
   removeAllAggregations();
 
+  delete mHeartBeatTimer;
+
   delete mPixmapMessageNew;
   delete mPixmapMessageUnread;
   delete mPixmapMessageRead;
@@ -138,10 +153,22 @@
   ConfigureAggregationsDialog::cleanup(); // make sure it's dead
   ConfigureThemesDialog::cleanup(); // make sure it's dead
 
-
   mInstance = 0;
 }
 
+void Manager::slotHeartBeat()
+{
+  // sweep through all the models asking them to check their dates
+  for( QList< Widget * >::Iterator it = mWidgetList.begin(); it != mWidgetList.end(); ++it )
+  {
+    if ( !( *it )->view() )
+      continue;
+    if ( !( *it )->view()->model() )
+      continue;
+    ( *it )->view()->model()->checkIfDateChanged();
+  }
+}
+
 void Manager::showConfigureAggregationsDialog( Widget *requester, const QString &preselectAggregationId )
 {
   ConfigureAggregationsDialog::display( requester ? requester->window() : 0, preselectAggregationId );
Index: kmail/messagelistview/core/view.h
===================================================================
--- kmail/messagelistview/core/view.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/messagelistview/core/view.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -260,6 +260,14 @@
   void setAllThreadsExpanded( bool expand );
 
   /**
+   * If expand is true then it expands all the groups (only the toplevel
+   * group item: inner threads are NOT expanded). If expand is false
+   * then it collapses all the groups. If no grouping is in effect
+   * then this function does nothing.
+   */
+  void setAllGroupsExpanded( bool expand );
+
+  /**
    * Selects the next message item in the view.
    *
    * messageTypeFilter can be used to limit the selection to
Index: kmail/messagelistview/core/themedelegate.cpp
===================================================================
--- kmail/messagelistview/core/themedelegate.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/messagelistview/core/themedelegate.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -65,6 +65,10 @@
 void ThemeDelegate::setTheme( const Theme * theme )
 {
   mTheme = theme;
+
+  if ( !mTheme )
+    return; // hum
+
   // yep..we're violating const here
   // But most of the QStyledItemDelegate virtual methods are const and expect
   // const behaviour. So we need the const pointer to avoid compiler complains
Index: kmail/messagelistview/storagemodel.h
===================================================================
--- kmail/messagelistview/storagemodel.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/messagelistview/storagemodel.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -227,6 +227,11 @@
   /**
    * Internal handler of KMFolder signal.
    */
+  void slotViewConfigChanged();
+
+  /**
+   * Internal handler of KMFolder signal.
+   */
   void slotMessageHeaderChanged( KMFolder *folder, int idx );
 
 };
Index: kmail/mainfolderview.cpp
===================================================================
--- kmail/mainfolderview.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/mainfolderview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -174,6 +174,7 @@
 
       popup->setObjectName( "subMenu" );
       popup->setTitle( label );
+      popup->setIcon( KIcon( fvi->normalIcon() ) );
 
       folderToPopupMenuInternal( action, target, popup, fvi );
 
@@ -199,12 +200,13 @@
 
       if ( subMenu )
       {
+        popup->addSeparator();
+
         QAction* act;
         if ( action == MoveMessage || action == MoveFolder )
           act = popup->addAction( i18n("Move to This Folder") );
         else
           act = popup->addAction( i18n("Copy to This Folder") );
-        popup->addSeparator();
 
         act->setData( QVariant::fromValue<void *>( (void *)( fvi->folder() ) ) );
       }
@@ -214,7 +216,7 @@
     } else {
 
       // insert an item
-      QAction* act = menu->addAction( label );
+      QAction* act = menu->addAction( KIcon( fvi->normalIcon() ), label );
       if ( fvi->folder() )
         act->setData( QVariant::fromValue<void *>( (void *)( fvi->folder() ) ) );
       bool enabled = (fvi->folder() ? true : false);
Index: kmail/identitylistview.cpp
===================================================================
--- kmail/identitylistview.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/identitylistview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -113,7 +113,8 @@
     header()->setMovable( false );
     setAllColumnsShowFocus( true );
     setAlternatingRowColors( true );
-    setSortingEnabled( false ); // disabled
+    setSortingEnabled( true );
+    sortByColumn( 0, Qt::AscendingOrder );
     setSelectionMode( SingleSelection ); // ### Extended would be nicer...
     setColumnWidth( 0, 175 );
 
Index: kmail/kmail_config_composer.desktop
===================================================================
--- kmail/kmail_config_composer.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/kmail_config_composer.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -80,6 +80,7 @@
 Comment[ja]=メール作成の設定
 Comment[km]=ការ​កំណត់​កម្មវិធី​តែង​សារ
 Comment[ko]=메시지 작성기 설정
+Comment[lt]=Laiškų rengyklės nustatymai
 Comment[lv]=Vēstuļu rastītāja iestatījumi
 Comment[nb]=Innstillinger for meldingskomposer
 Comment[nds]=Narichteneditor instellen
Index: kmail/kmreaderwin.cpp
===================================================================
--- kmail/kmreaderwin.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/kmreaderwin.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -699,7 +699,7 @@
   connect( mCopyURLAction, SIGNAL(triggered(bool)), SLOT(slotUrlCopy()) );
 
   // open URL
-  mUrlOpenAction = new KAction( i18n( "Open URL" ), this );
+  mUrlOpenAction = new KAction( KIcon( "document-open" ), i18n( "Open URL" ), this );
   ac->addAction( "open_url", mUrlOpenAction );
   connect( mUrlOpenAction, SIGNAL(triggered(bool)), SLOT(slotUrlOpen()) );
 
Index: kmail/dbusimap.desktop
===================================================================
--- kmail/dbusimap.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/dbusimap.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -20,6 +20,7 @@
 Comment[kk]=DBUS интерфейсті пошта бағдарламасы
 Comment[km]=កម្មវិធី​សំបុត្រ​ដែល​មាន​ចំណុច​ប្រទាក់ DBUS
 Comment[ko]=DBUS 인터페이스를 사용하는 전자 우편 프로그램
+Comment[lt]=Pašto programa su D-Bus sąsaja
 Comment[lv]=Pasta programma ar DBUS saskarni
 Comment[nb]=E-postprogram med DBUS-grensesnitt
 Comment[nds]=Nettpostprogramm mit en D-Bus-Koppelsteed
Index: kmail/kmcommands.cpp
===================================================================
--- kmail/kmcommands.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/kmcommands.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -2937,7 +2937,7 @@
 
   KTemporaryFile *linkFile = new KTemporaryFile();
   linkFile->setPrefix(atmFileInfo.fileName() +"_[");
-  linkFile->setSuffix("]."+ atmFileInfo.suffix());
+  linkFile->setSuffix( "]." + KMimeType::extractKnownExtension( atmFileInfo.fileName() ) );
   linkFile->open();
   QString linkName = linkFile->fileName();
   delete linkFile;
Index: kmail/kmfoldercachedimap.cpp
===================================================================
--- kmail/kmfoldercachedimap.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/kmfoldercachedimap.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -202,7 +202,8 @@
     /*mHoldSyncs( false ),*/
     mFolderRemoved( false ),
     mRecurse( true ),
-    mStatusChangedLocally( false ), mAnnotationFolderTypeChanged( false ),
+    mStatusChangedLocally( false ),
+    mAnnotationFolderTypeChanged( false ),
     mIncidencesForChanged( false ), mPersonalNamespacesCheckDone( true ),
     mQuotaInfo(), mAlarmsBlocked( false ),
     mRescueCommandCount( 0 ),
@@ -303,18 +304,22 @@
   KMFolderMaildir::readConfig();
 
   mStatusChangedLocally = group.readEntry( "StatusChangedLocally", false );
+  QStringList uidsChanged = group.readEntry( "UIDStatusChangedLocally", QStringList() );
+  foreach( const QString &uid, uidsChanged ) {
+    mUIDsOfLocallyChangedStatuses.append( uid.toUInt() );
+  }
   mAnnotationFolderTypeChanged = group.readEntry( "AnnotationFolderTypeChanged", false );
   mIncidencesForChanged = group.readEntry( "IncidencesForChanged", false );
   if ( mImapPath.isEmpty() ) {
     mImapPathCreation = group.readEntry("ImapPathCreation");
   }
 
-  QStringList uids = group.readEntry( "UIDSDeletedSinceLastSync", QStringList() );
+  QStringList delUids = group.readEntry( "UIDSDeletedSinceLastSync" , QStringList() );
 #if MAIL_LOSS_DEBUGGING
   kDebug( 5006 ) << "READING IN UIDSDeletedSinceLastSync: " << folder()->prettyUrl() << endl << uids;
 #endif
-  for ( QStringList::iterator it = uids.begin(); it != uids.end(); ++it ) {
-      mDeletedUIDsSinceLastSync.insert( (*it).toULong(), 0);
+  for ( QStringList::iterator it = delUids.begin(); it != delUids.end(); it++ ) {
+    mDeletedUIDsSinceLastSync.insert( (*it).toULong(), 0);
   }
 }
 
@@ -331,7 +336,14 @@
   configGroup.writeEntry( "NoContent", mNoContent );
   configGroup.writeEntry( "ReadOnly", mReadOnly );
   configGroup.writeEntry( "FolderAttributes", mFolderAttributes );
-  configGroup.writeEntry( "StatusChangedLocally", mStatusChangedLocally );
+
+  // StatusChangedLocally is always false, as we use UIDStatusChangedLocally now
+  configGroup.writeEntry( "StatusChangedLocally", false );
+  QStringList uidsToWrite;
+  foreach( const ulong uid, mUIDsOfLocallyChangedStatuses ) {
+    uidsToWrite.append( QString::number( uid ) );
+  }
+  configGroup.writeEntry( "UIDStatusChangedLocally", uidsToWrite );
   if ( !mImapPathCreation.isEmpty() ) {
     if ( mImapPath.isEmpty() ) {
       configGroup.writeEntry( "ImapPathCreation", mImapPathCreation );
@@ -953,12 +965,13 @@
       // Upload flags, unless we know from the ACL that we're not allowed
       // to do that or they did not change locally
       if ( mUserRights <= 0 || ( mUserRights & KMail::ACLJobs::WriteFlags ) ) {
-        if ( mStatusChangedLocally ) {
+        if ( !mUIDsOfLocallyChangedStatuses.isEmpty() || mStatusChangedLocally ) {
           uploadFlags();
           break;
         }
-      } else if ( mUserRights & KMail::ACLJobs::WriteSeenFlag ) {
-        if ( mStatusChangedLocally ) {
+      }
+      else if ( mUserRights & KMail::ACLJobs::WriteSeenFlag ) {
+        if ( !mUIDsOfLocallyChangedStatuses.isEmpty() || mStatusChangedLocally ) {
           uploadSeenFlags();
           break;
         }
@@ -1425,6 +1438,10 @@
         // Either not a valid message or not one that is on the server yet
         continue;
       }
+      if ( mUIDsOfLocallyChangedStatuses.indexOf( msg->UID() ) < 0 && !mStatusChangedLocally ) {
+        // This message has not had its status changed locally
+        continue;
+      }
 
       QString flags = KMFolderImap::statusToFlags( msg->status(), mPermanentFlags );
       // Collect uids for each typem of flags.
@@ -1468,6 +1485,11 @@
         // Either not a valid message or not one that is on the server yet
         continue;
 
+      if ( mUIDsOfLocallyChangedStatuses.indexOf( msg->UID() ) < 0 && !mStatusChangedLocally ) {
+        // This message has not had its status changed locally
+        continue;
+      }
+
       if ( msg->status().isOld() || msg->status().isRead() )
         seenUids.append( msg->UID() );
       else
@@ -1525,13 +1547,21 @@
 void KMFolderCachedImap::setStatus( int idx, const MessageStatus &status, bool toggle )
 {
   KMFolderMaildir::setStatus( idx, status, toggle );
-  mStatusChangedLocally = true;
+  const KMMsgBase *msg = getMsgBase( idx );
+  Q_ASSERT( msg );
+  if ( msg )
+    mUIDsOfLocallyChangedStatuses.append( msg->UID() );
 }
 
 void KMFolderCachedImap::setStatus( QList<int> &ids, const MessageStatus &status, bool toggle )
 {
   KMFolderMaildir::setStatus( ids, status, toggle );
-  mStatusChangedLocally = true;
+  foreach( const int id, ids ) {
+    const KMMsgBase *msg = getMsgBase( id );
+    Q_ASSERT( msg );
+    if ( msg )
+      mUIDsOfLocallyChangedStatuses.append( msg->UID() );
+  }
 }
 
 /* Upload new folders to server */
@@ -1888,7 +1918,8 @@
   } else {
     if ( lastSet ) { // always true here (this comes from online-imap...)
       mContentState = imapFinished;
-      mStatusChangedLocally = false; // we are up to date again
+      mUIDsOfLocallyChangedStatuses.clear(); // we are up to date again
+      mStatusChangedLocally = false;
     }
   }
   serverSyncInternal();
Index: kmail/kmfoldercachedimap.h
===================================================================
--- kmail/kmfoldercachedimap.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/kmfoldercachedimap.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -627,12 +627,18 @@
     bool mFolderRemoved;
     bool mRecurse;
 
+   /**
+    * UIDs added by setStatus. Indicates that the client has changed
+    * the status of those mails. The mail flags for changed mails will be
+    * uploaded to the server, overwriting the server's notion of the status
+    * of the mails in this folder.
+    */
+    QList<ulong> mUIDsOfLocallyChangedStatuses;
+
     /**
-      Set to true by setStatus. Indicates that the client has changed
-      the status of at least one mail. The mail flags will therefore be
-      uploaded to the server, overwriting the server's notion of the status
-      of the mails in this folder.
-    */
+     * Same as above, but uploads the flags of all mails, even if not all changed.
+     * Only still here for config compatibility.
+     */
     bool mStatusChangedLocally;
 
     /**
Index: kmail/kmmainwidget.cpp
===================================================================
--- kmail/kmmainwidget.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/kmmainwidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -1277,6 +1277,7 @@
   KMFolderDialog props( folder, folder->parent(), mMainFolderView,
                         i18n("Properties of Folder %1", folder->label() ) );
   props.exec();
+
   updateFolderMenu();
 }
 
Index: kmail/kmail_view.desktop
===================================================================
--- kmail/kmail_view.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/kmail_view.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -13,6 +13,7 @@
 Name[ja]=KMail ビュー
 Name[km]=ទិដ្ឋភាព KMail
 Name[ko]=KMail 보기
+Name[lt]=KMail peržiūra
 Name[lv]=KMail skats
 Name[nb]=KMail-visning
 Name[nds]=KMail-Ansicht
Index: kmail/configuredialog.cpp
===================================================================
--- kmail/configuredialog.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/configuredialog.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -2036,14 +2036,16 @@
            this, SLOT( slotEmitChanged() ) );
 
   // "Show expand/collaps quote marks" check box;
-  QHBoxLayout *hlay= new QHBoxLayout(); // inherits spacing
-  vlay->addLayout( hlay );
   populateCheckBox( mShowExpandQuotesMark= new QCheckBox( this ), showExpandQuotesMark);
-  hlay->addWidget( mShowExpandQuotesMark);
+  vlay->addWidget( mShowExpandQuotesMark);
   connect( mShowExpandQuotesMark, SIGNAL ( stateChanged( int ) ),
            this, SLOT( slotEmitChanged() ) );
 
-  hlay->addStretch( 1 );
+  //New HBoxLayout to show the collapseQuoteLevel spin+label one line down
+  QHBoxLayout * hlay = new QHBoxLayout();
+  vlay->addLayout( hlay );
+  hlay->addSpacing( 40 );
+
   mCollapseQuoteLevelSpin = new KIntSpinBox( 0/*min*/,10/*max*/,1/*step*/,
       3/*init*/,this );
 
@@ -2061,6 +2063,8 @@
   connect( mShowExpandQuotesMark, SIGNAL( toggled( bool ) ),
       mCollapseQuoteLevelSpin, SLOT( setEnabled( bool ) ) );
 
+  hlay->addStretch();
+
   // Fallback Character Encoding
   hlay = new QHBoxLayout(); // inherits spacing
   vlay->addLayout( hlay );
Index: kmail/accountmanager.cpp
===================================================================
--- kmail/accountmanager.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/accountmanager.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -94,6 +94,32 @@
     uint id = group.readEntry( "Id", 0 );
     KAccount::Type acctType = KAccount::typeForName( group.readEntry( "Type" ) );
     QString accountName = group.readEntry( "Name" );
+
+    // Fixes for config compatibilty: We do have an update script, but that is not reliable, because
+    // sometimes the scripts don't run (or already run in KDE3, but don't actually change anything)
+    // This is a big problem, since incorrect account type values make you loose your account settings,
+    // which in case of disconnected IMAP means you'll loose your cache.
+    // So for extra saftey, convert the account type values here as well.
+    // See also kmail-4.0-misc.pl
+    if ( acctType == -1 ) {
+      kWarning() << "Config upgrade failed! Danger! Trying to convert old account type for account" << accountName;
+      const QString accountTypeName = group.readEntry( "Type" );
+      if ( accountTypeName == "cachedimap" )
+        acctType = KAccount::DImap;
+      if ( accountTypeName == "pop" )
+        acctType = KAccount::Pop;
+      if ( accountTypeName == "local" )
+        acctType = KAccount::Local;
+      if ( accountTypeName == "maildir" )
+        acctType = KAccount::Maildir;
+      if ( accountTypeName == "imap" )
+        acctType = KAccount::Imap;
+      if ( acctType == -1 )
+        kWarning() << "Unrecognized account type. Your account settings are now lost, sorry.";
+      else
+        kDebug() << "Account type upgraded.";
+    }
+
     if ( accountName.isEmpty() )
       accountName = i18n( "Account %1", accountNum++ );
     KMAccount *account = create( acctType, accountName, id );
Index: kmail/objecttreeparser.cpp
===================================================================
--- kmail/objecttreeparser.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kmail/objecttreeparser.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -2099,12 +2099,16 @@
   if ( auditLog.isEmpty() )
     return i18n("No Audit Log available");
 
-  KUrl url;
-  url.setProtocol( "kmail" );
-  url.setPath( "showAuditLog" );
-  url.addQueryItem( "log", auditLog );
+  if ( !auditLog.isEmpty() ) {
+    KUrl url;
+    url.setProtocol( "kmail" );
+    url.setPath( "showAuditLog" );
+    url.addQueryItem( "log", auditLog );
 
-  return "<a href=\"" + url.url() + "\">" + i18nc("The Audit Log is a detailed error log from the gnupg backend", "Show Audit Log") + "</a>";
+    return "<a href=\"" + url.url() + "\">" + i18nc("The Audit Log is a detailed error log from the gnupg backend", "Show Audit Log") + "</a>";
+  }
+
+  return QString();
 }
 
 static QString endVerboseSigstatHeader( const PartMetaData & pmd )
Index: knode/kncomposerview.cpp
===================================================================
--- knode/kncomposerview.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ knode/kncomposerview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -93,6 +93,7 @@
   e_dit=new KNComposerEditor(this);
   e_dit->switchToPlainText();
   e_dit->setMinimumHeight(50);
+  e_dit->setFont(KGlobalSettings::fixedFont());
 
   QVBoxLayout *notL=new QVBoxLayout(e_dit);
   notL->addStretch(1);
Index: knode/knarticle.cpp
===================================================================
--- knode/knarticle.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ knode/knarticle.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -70,8 +70,10 @@
 {
   // filter out internal headers
   for ( Headers::Base::List::Iterator it = h_eaders.begin(); it != h_eaders.end(); ) {
-    if ( (*it)->isXHeader() && ( strncasecmp( (*it)->type(), "X-KNode", 7 ) == 0 ) )
+    if ( (*it)->isXHeader() && ( strncasecmp( (*it)->type(), "X-KNode", 7 ) == 0 ) ) {
+      delete *it;
       it = h_eaders.erase( it );
+    }
     else
       ++it;
   }
Index: dependency-graph.dot
===================================================================
--- dependency-graph.dot	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ dependency-graph.dot	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -48,7 +48,6 @@
         "konsolekalendar"[style=filled, fillcolor=lightcyan, URL="konsolekalendar/html/index.html"];
         "kontact"[style=filled, fillcolor=lightcyan, URL="kontact/html/index.html"];
         "korganizer"[style=filled, fillcolor=lightcyan, URL="korganizer/html/index.html"];
-        "korn"[style=filled, fillcolor=lightcyan];
         "kresources"[style=filled, fillcolor=palegreen];
         "libakonadi"[style=filled, fillcolor=lightyellow, URL="akonadi/libakonadi/html/index.html"];
         "libkdepim"[style=filled, fillcolor=lightyellow, URL="libkdepim/html/index.html"];
Index: doc/kleopatra/index.docbook
===================================================================
--- doc/kleopatra/index.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ doc/kleopatra/index.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -13,48 +13,6 @@
 
   <!ENTITY dn "<acronym>DN</acronym>">
   <!ENTITY ca "<acronym>CA</acronym>">
-
-  <!-- Expanded all entities to make them translatable - lueck
-    FILE menu 
-  <!ENTITY file-new-key-pair "<menuchoice><guimenu>File</guimenu><guimenuitem>New Key Pair...</guimenuitem></menuchoice>">
-  <!ENTITY file-export-certificates "<menuchoice><guimenu>File</guimenu><guimenuitem>Export Certificates...</guimenuitem></menuchoice>">
-  <!ENTITY file-export-secret-key "<menuchoice><guimenu>File</guimenu><guimenuitem>Export Secret key...</guimenuitem></menuchoice>">
-  <!ENTITY file-import-certificates "<menuchoice><guimenu>File</guimenu><guimenuitem>Import Certificates...</guimenuitem></menuchoice>">
-  <!ENTITY file-import-crls "<menuchoice><guimenu>File</guimenu><guimenuitem>Import CRLs...</guimenuitem></menuchoice>">
-  <!ENTITY file-quit "<menuchoice><shortcut><keycombo action="simul">&Ctrl;<keycap>Q</keycap></keycombo></shortcut><guimenu>File</guimenu><guimenuitem>Quit</guimenuitem></menuchoice>">
-
-   VIEW menu
-  <!ENTITY view-redisplay "<menuchoice><shortcut><keycombo action="simul"><keycap>F5</keycap></keycombo></shortcut><guimenu>View</guimenu><guimenuitem>Redisplay</guimenuitem></menuchoice>">
-  <!ENTITY view-stop-operation "<menuchoice><shortcut><keycombo action="simul"><keycap>Esc</keycap></keycombo></shortcut><guimenu>View</guimenu><guimenuitem>Stop Operation</guimenuitem></menuchoice>">
-  <!ENTITY view-certificate-details "<menuchoice><guimenu>View</guimenu><guimenuitem>Certificate Details</guimenuitem></menuchoice>">
-  <!ENTITY view-hierarchical-key-list "<menuchoice><guimenu>View</guimenu><guimenuitem>Hierarchical Key List</guimenuitem></menuchoice>">
-  <!ENTITY view-expand-all "<menuchoice><shortcut><keycombo action="simul">&Ctrl;<keycap>.</keycap></keycombo></shortcut><guimenu>View</guimenu><guimenuitem>Expand All</guimenuitem></menuchoice>">
-  <!ENTITY view-collapse-all "<menuchoice><shortcut><keycombo action="simul">&Ctrl;<keycap>,</keycap></keycombo></shortcut><guimenu>View</guimenu><guimenuitem>Collapse All</guimenuitem></menuchoice>">
-
-   CERTIFICATES menu 
- <!ENTITY certificates-validate "<menuchoice><shortcut><keycombo action="simul">&Shift;<keycap>F5</keycap></keycombo></shortcut><guimenu>Certificates</guimenu><guimenuitem>Validate</guimenuitem></menuchoice>">
-  <!ENTITY certificates-refresh-crls "<menuchoice><guimenu>Certificates</guimenu><guimenuitem>Refresh CRLs</guimenuitem></menuchoice>">
-  <!ENTITY certificates-delete "<menuchoice><shortcut><keycombo action="simul"><keycap>Delete</keycap></keycombo></shortcut><guimenu>Certificates</guimenu><guimenuitem>Delete</guimenuitem></menuchoice>">
-  <!ENTITY certificates-download "<menuchoice><guimenu>Certificates</guimenu><guimenuitem>Download</guimenuitem></menuchoice>">
-
-   CRLS menu
-  <!ENTITY crls-clear-crl-cache "<menuchoice><guimenu>CRLs</guimenu><guimenuitem>Clear CRL Cache</guimenuitem></menuchoice>">
-  <!ENTITY crls-dump-crl-cache "<menuchoice><guimenu>CRLs</guimenu><guimenuitem>Dump CRL Cache</guimenuitem></menuchoice>">
-
-   TOOLS menu 
-  <!ENTITY tools-gnupg-log-viewer "<menuchoice><guimenu>Tools</guimenu><guimenuitem>GnuPG Log Viewer...</guimenuitem></menuchoice>">
-
-   SETTINGS menu 
-  <!ENTITY settings-show-statusbar "<menuchoice><guimenu>Settings</guimenu><guimenuitem>Show Statusbar</guimenuitem></menuchoice>">
-  <!ENTITY settings-configure-shortcuts "<menuchoice><guimenu>Settings</guimenu><guimenuitem>Configure Shortcuts...</guimenuitem></menuchoice>">
-  <!ENTITY settings-configure-kleopatra "<menuchoice><guimenu>Settings</guimenu><guimenuitem>Configure &kleopatra;...</guimenuitem></menuchoice>">
-  <!ENTITY settings-configure-gpgme-backend "<menuchoice><guimenu>Settings</guimenu><guimenuitem>Configure GpgME Backend...</guimenuitem></menuchoice>">
-   -->
-
-  <!-- Command line options -->
-  <!ENTITY commandline-option-external "<option>--external</option>">
-  <!ENTITY commandline-option-query "<option>--query</option>">
-  <!ENTITY commandline-option-import-certificate "<option>--import-certificate</option>">
 ]>
 
 <book lang="&language;">
@@ -114,12 +72,12 @@
 
 <legalnotice>&GPLNotice;</legalnotice>
 
-<date>2007-12-19</date>
-<releaseinfo>1.9.0</releaseinfo>
+<date>2009-02-19</date>
+<releaseinfo>2.0.5</releaseinfo>
 
 <abstract>
 <para>
-&kleopatra; is a tool for managing X.509 certificates.
+&kleopatra; is a tool for managing X.509 and OpenPGP certificates.
 </para>
 </abstract>
 
@@ -137,11 +95,12 @@
 
 <chapter id="introduction"> <title>Introduction</title> 
 
-<para>&kleopatra; is the &kde; tool for managing X.509 certificates in
+<para>&kleopatra; is the &kde; tool for managing X.509 and OpenPGP certificates in
 the &gpgsm; keybox and for retrieving certificates from
 <acronym>LDAP</acronym> servers.</para>
 
-<para>&kleopatra; can be started from &kmail;'s <guimenu>Tools</guimenu>
+<para>&kleopatra; can be started from &kmail;'s <menuchoice><guimenu>Tools</guimenu>
+<guimenuitem>Certificate Manager</guimenuitem></menuchoice>
 menu, as well as from the command line. The &kleopatra; executable is
 named <userinput><command>kleopatra</command></userinput>.</para>
 
@@ -166,7 +125,7 @@
 of the local keybox, which is similar to &gpg;'s concept of keyrings,
 albeit one should not stretch this analogy too much.</para>
 
-<para>The main window is divided into the large key listing area, the
+<para>The main window is divided into the large key listing area consisting of several tabs, the
 menubar and the <link linkend="functions-search">search bar</link> on
 top, and a status bar at the bottom.</para>
 
@@ -181,8 +140,7 @@
 certificates, but usually the terms <quote>certificate</quote> and
 <quote>(public) key</quote> are used interchangeably, and we will not
 distinguish between them in this manual either, except when explicitly
-noted. The name of the &ca; which issued the certificate (its &dn;)
-is shown in the <guilabel>Issuer &dn;</guilabel> column.</para>
+noted.</para>
 
 <para>&ca;s must in turn be signed by other &ca;s to be valid. Of
 course, this must end somewhere, so the top-level &ca; (root-&ca;)
@@ -193,11 +151,10 @@
 the vendor of a product using certificates, but can be done by the
 user via &gpgsm;'s command line interface.</para>
 
-<para>To see which of the certificates are root certificates, you can
-either compare <guilabel>Subject &dn;</guilabel> and <guilabel>Issuer
-&dn;</guilabel>, or you switch to hierarchical keylist mode with <link
+<para>To see which of the certificates are root certificates, you
+switch to the hierarchical keylist mode with <link
 linkend="view-hierarchical-key-list"><menuchoice><guimenu>View</guimenu>
-<guimenuitem>Hierarchical Key List</guimenuitem></menuchoice></link>.</para>
+<guimenuitem>Hierarchical Certificate List</guimenuitem></menuchoice></link>.</para>
 
 <para>You can see the details of any certificate by double-clicking it
 or using <link linkend="view-certificate-details"><menuchoice><guimenu>View</guimenu>
@@ -213,17 +170,18 @@
 <keycap>F5</keycap></keycombo></shortcut><guimenu>View</guimenu>
 <guimenuitem>Redisplay</guimenuitem></menuchoice></link>.</para>
 
-<para>Since validating a key may take some time (&eg; CRLs might need
+<!-- no longer in kde 4
+para>Since validating a key may take some time (&eg; CRLs might need
 to be fetched), the normal keylisting does not attempt to check the
 validity of keys. For this, <link linkend="certificates-validate">
 <menuchoice><shortcut><keycombo action="simul">&Shift;<keycap>F5</keycap></keycombo>
-</shortcut><guimenu>Certificates</guimenu><guimenuitem>Validate</guimenuitem></menuchoice></link>, a
-special variant of <link
+</shortcut><guimenu>Certificates</guimenu><guimenuitem>Validate</guimenuitem></menuchoice></link>,
+a special variant of <link
 linkend="view-redisplay"><menuchoice><shortcut><keycombo action="simul">
 <keycap>F5</keycap></keycombo></shortcut><guimenu>View</guimenu>
 <guimenuitem>Redisplay</guimenuitem></menuchoice></link>, is provided. It
 either checks the selected certificates, or all keys if none are
-selected.</para>
+selected.</para-->
 
 </sect1>
 
@@ -233,30 +191,31 @@
 signatures in emails, since certificates are embedded in the
 signatures made using them most of the time. However, if you need to
 send a mail to someone you have not yet had contact with, you need to
-fetch the certificate from an LDAP directory (although &gpgsm; can do
+fetch the certificate from an LDAP folder (although &gpgsm; can do
 this automatically), or from a file. You also need to import your own
 certificate after receiving the &ca; answer to your certification
 request.</para>
 
-<para>To search for a certificate in an LDAP directory, switch the
-dropdown menu of the search bar from <guilabel>in Local
-Certificates</guilabel> to <guilabel>in External
-Certificates</guilabel>, enter some text (&eg; the name of the person
-you want the certificate for) into the line edit, and click on the
-<guilabel>Find</guilabel> icon. The results will be displayed in the
+<para>To search for a certificate in an LDAP directory, select 
+<menuchoice><guimenu>File</guimenu><guimenuitem>Lookup Certificates on Server</guimenuitem></menuchoice>
+and enter some text (&eg; the name of the person
+you want the certificate for) into the line edit of the <guilabel>Keyserver 
+Certificate Lookup</guilabel> dialog, then click on the
+<guilabel>Search</guilabel> button. The results will be displayed in the
 key list below the search bar, where you can select certificates to
-either look at them with <link linkend="view-certificate-details">
-<menuchoice><guimenu>View</guimenu><guimenuitem>Certificate Details</guimenuitem></menuchoice></link> or
-download them with <link linkend="certificates-download">
-<menuchoice><guimenu>Certificates</guimenu><guimenuitem>Download</guimenuitem></menuchoice></link> into the
-local keybox. Note that you can also download the certificate from the
+look at them by clicking the <guibutton>Details</guibutton> button
+or download them with <guibutton>Import</guibutton> into the
+local keybox.</para>
+<!--
+Note that you can also download the certificate from the
 details dialog, using the <guilabel>Import to Local</guilabel>
 button.</para>
+not found in 4.2
+-->
 
 <para>You can configure the list of LDAP servers to search in the
 <link linkend="configuration-directory-services"><guilabel>Directory
-Services</guilabel></link> page of &kleopatra;'s <link
-linkend="configuration">configure dialog</link>.</para>
+Services</guilabel></link> page of &kleopatra;'s configure dialog.</para>
 
 <para>If you received the certificate as a file, try <link
 linkend="file-import-certificates"><menuchoice><guimenu>File</guimenu>
@@ -269,7 +228,7 @@
 public key (as well as the secret key) from the PKCS#12 file you got from
 the &ca;. You can do this on the command line with <link
 linkend="commandline-option-import-certificate"><userinput><command>kleopatra
-&commandline-option-import-certificate;
+<option>--import-certificate</option>
 <filename>filename</filename></command></userinput></link> or from
 within &kleopatra; with <link
 linkend="file-import-certificates"><menuchoice><guimenu>File</guimenu>
@@ -281,49 +240,71 @@
 <sect1 id="functions-newkey"><title>Creating New Key Pairs</title>
 
 <para>The menu item <link linkend="file-new-key-pair"><menuchoice>
-<guimenu>File</guimenu><guimenuitem>New Key Pair...</guimenuitem></menuchoice></link> starts the
-certificate-request-creating wizard which will guide you through a
-number of steps to create a certificate request; this request can, on the 
-last page of the wizard, either be sent to a certificate authority (&ca;)
-to be signed or saved to a file (for example to a floppy, so it can be
-shipped to the &ca;).</para> <para>Whenever you are done with a step in
+<guimenu>File</guimenu><guimenuitem>New Certificate...</guimenuitem></menuchoice></link> starts the
+<guilabel>Certificate Creation Wizard</guilabel> which will guide you through a
+number of steps to create a certificate request.</para> 
+<para>Whenever you are done with a step in
 the wizard, press <guibutton>Next</guibutton> to go to the next step
 (or <guibutton>Back</guibutton> to review steps that are already
 completed). The certificate request creation can be canceled at any
 time by pressing the <guibutton>Cancel</guibutton> button.
 </para>
-<para>The first step in the wizard is to type in your personal data
+<para>On the first page of the wizard choose which type of certificate you want to create:</para>
+
+<variablelist>
+
+<varlistentry>
+<term><guilabel>Create a personal OpenPGP key pair</guilabel></term>
+<listitem><para>OpenPGP key pairs are created locally, and certified by your friends and 
+acquaintances. There is no central certification authority; instead, every 
+individual creates a personal Web Of Trust by certifying other user's key 
+pairs with his own certificate.</para>
+<para>You have to enter a <guilabel>Name</guilabel>, <guilabel>EMail</guilabel> and 
+optional a <guilabel>Comment</guilabel>.</para>
+</listitem>
+</varlistentry>
+<varlistentry>
+<term><guilabel>Create a personal X.509 key pair and certification request</guilabel></term>
+<listitem>
+<para>X.509 key pairs are created locally, but certified centrally by a 
+certification authority (&ca;). CAs can certify other CAs, creating a central, 
+hierarchical chain of trust.</para>
+<para>The next step in the wizard is to type in your personal data
 for the certificate. The fields to fill out are:
 <itemizedlist>
 <listitem>
-<para><guilabel>Name:</guilabel> Your name;</para>
+<para><guilabel>Common Name (CN): </guilabel>Your name;</para>
 </listitem>
 <listitem>
-<para><guilabel>Location:</guilabel>The town or city in which you live;</para>
+<para><guilabel>Email address (EMAIL): </guilabel>Your email address; be sure
+to type this in correctly&mdash;this will be the address people will be
+sending mail to when they use your certificate.</para>
 </listitem>
 <listitem>
-<para><guilabel>Organization:</guilabel>The organization you represent
-(for example, the company you work for);</para>
+<para><guilabel>Location (L): </guilabel>The town or city in which you live;</para>
 </listitem>
 <listitem>
-<para><guilabel>Department:</guilabel>The organizational unit you are
+<para><guilabel>Organizational unit (OU): </guilabel>The organizational unit you are
 in (for example, "Logistics");</para> 
 </listitem>
 <listitem>
-<para><guilabel>Country code:</guilabel>The two letter code for the
-country in which you are living (for example, "US");</para>
+<para><guilabel>Organization (O): </guilabel>The organization you represent
+(for example, the company you work for);</para>
 </listitem>
 <listitem>
-<para><guilabel>Email address:</guilabel>Your email address; be sure
-to type this in correctly&mdash;this will be the address people will be
-sending mail to when they use your certificate.</para>
+<para><guilabel>Country code (C): </guilabel>The two letter code for the
+country in which you are living (for example, "US");</para>
 </listitem>
 </itemizedlist>
 </para><para>
 The next step in the wizard is to select whether to store the
 certificate in a file or send it directly to a &ca;. You will have to
 specify the filename or email address to send the certificate request to.
-</para></sect1>
+</para>
+</listitem>
+</varlistentry>
+</variablelist>
+</sect1>
 
 
 <sect1 id="functions-keybox-management"><title>Keybox Management</title>
@@ -337,13 +318,13 @@
 
 <para>These functions include deleting certificates from the local
 keybox with <link linkend="certificates-delete"><menuchoice><shortcut>
-<keycombo action="simul"><keycap>Delete</keycap></keycombo></shortcut>
+<keycombo action="simul"><keycap>Del</keycap></keycombo></shortcut>
 <guimenu>Certificates</guimenu><guimenuitem>Delete</guimenuitem></menuchoice></link>, as well 
 as manual handling of CRLs (<link linkend="certificates-refresh-crls">
-<menuchoice><guimenu>Certificates</guimenu><guimenuitem>Refresh CRLs</guimenuitem>
-</menuchoice></link>, <link linkend="crls-clear-crl-cache"><menuchoice><guimenu>CRLs</guimenu>
+<menuchoice><guimenu>Tools</guimenu><guimenuitem>Refresh Certificates</guimenuitem> <!--???-->
+</menuchoice></link>, <link linkend="crls-clear-crl-cache"><menuchoice><guimenu>Tools</guimenu>
 <guimenuitem>Clear CRL Cache</guimenuitem></menuchoice></link>, <link
-linkend="crls-dump-crl-cache"><menuchoice><guimenu>CRLs</guimenu>
+linkend="crls-dump-crl-cache"><menuchoice><guimenu>Tools</guimenu>
 <guimenuitem>Dump CRL Cache</guimenuitem></menuchoice></link>).</para>
 
 </sect1>
@@ -357,7 +338,8 @@
 <variablelist>
 
 <varlistentry id="file-new-key-pair">
-<term><menuchoice><guimenu>File</guimenu><guimenuitem>New Key Pair...</guimenuitem></menuchoice></term>
+<term><menuchoice><shortcut><keycombo action="simul">&Ctrl;<keycap>N</keycap></keycombo></shortcut>
+<guimenu>File</guimenu><guimenuitem>New Certificate...</guimenuitem></menuchoice></term>
 
 <listitem>
 <para><action>Creates a new key pair (public and private)</action> and
@@ -375,17 +357,39 @@
 <guimenuitem>Import Certificates...</guimenuitem></menuchoice>.</para>
 </listitem>
 </varlistentry>
+<!-- missing menu item
+<varlistentry>
+<term><menuchoice><shortcut><keycombo action="simul">&Ctrl;&Shift;<keycap>I</keycap></keycombo></shortcut>
+<guimenu>File</guimenu><guimenuitem>Lookup Certificates on Server</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
+</varlistentry>
+-->
+<varlistentry id="file-import-certificates">
+<term><menuchoice><shortcut><keycombo action="simul">&Ctrl;<keycap>I</keycap></keycombo></shortcut>
+<guimenu>File</guimenu><guimenuitem>Import Certificates...</guimenuitem></menuchoice></term>
 
+<listitem>
+<para><action>Imports certificates and/or secret keys from files into
+the local keybox.</action></para>
 
+<para>The format of the certificate file must be supported by
+&gpgsm;. Please refer to the &gpgsm; manual for a list of supported
+formats.</para>
+</listitem>
+</varlistentry>
+
 <varlistentry id="file-export-certificates">
-<term><menuchoice><guimenu>File</guimenu><guimenuitem>Export Certificates...</guimenuitem></menuchoice></term>
+<term><menuchoice><shortcut><keycombo action="simul">&Ctrl;<keycap>E</keycap></keycombo></shortcut>
+<guimenu>File</guimenu><guimenuitem>Export Certificates...</guimenuitem></menuchoice></term>
 
 <listitem>
 <para><action>Exports the selected certificates</action> into a file.</para>
 
 <note><para>This exports only the public keys, even if the
 secret key is available. Use <menuchoice><guimenu>File</guimenu><guimenuitem>Export 
-Secret key...</guimenuitem></menuchoice> to export both
+Secret Key...</guimenuitem></menuchoice> to export both
 public and secret keys into a file, but note that this is almost
 always a bad idea.</para></note>
 </listitem>
@@ -393,7 +397,7 @@
 
 
 <varlistentry id="file-export-secret-key">
-<term><menuchoice><guimenu>File</guimenu><guimenuitem>Export Secret key...</guimenuitem></menuchoice></term>
+<term><menuchoice><guimenu>File</guimenu><guimenuitem>Export Secret Key...</guimenuitem></menuchoice></term>
 
 <listitem>
 <para><action>Exports both the public and the secret key to a
@@ -406,22 +410,38 @@
 among other things.</para></warning>
 </listitem>
 </varlistentry>
+<!--missing menu items
+<varlistentry>
+<term><menuchoice><shortcut><keycombo action="simul">&Ctrl;&Shift;<keycap>E</keycap></keycombo></shortcut>
+<guimenu>File</guimenu><guimenuitem>Export Certificates to Server...</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
+</varlistentry>
 
-
-<varlistentry id="file-import-certificates">
-<term><menuchoice><guimenu>File</guimenu><guimenuitem>Import Certificates...</guimenuitem></menuchoice></term>
-
+<varlistentry>
+<term><menuchoice>
+<guimenu>File</guimenu><guimenuitem>Decrypt/Verify Files...</guimenuitem></menuchoice></term>
 <listitem>
-<para><action>Imports certificates and/or secret keys from files into
-the local keybox.</action></para>
-
-<para>The format of the certificate file must be supported by
-&gpgsm;. Please refer to the &gpgsm; manual for a list of supported
-formats.</para>
+<para>???</para>
 </listitem>
 </varlistentry>
-
-
+<varlistentry>
+<term><menuchoice>
+<guimenu>File</guimenu><guimenuitem>Sign/Encrypt Files...</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
+</varlistentry>
+<varlistentry>
+<term><menuchoice><shortcut><keycombo action="simul">&Ctrl;<keycap>W</keycap></keycombo></shortcut>
+<guimenu>File</guimenu><guimenuitem>Close...</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
+</varlistentry>
+-->
+<!--not in 4.2
 <varlistentry id="file-import-crls">
 <term><menuchoice><guimenu>File</guimenu><guimenuitem>Import CRLs...</guimenuitem></menuchoice></term>
 
@@ -447,8 +467,8 @@
 </para>
 </listitem>
 </varlistentry>
+-->
 
-
 <varlistentry id="file-quit">
 <term><menuchoice><shortcut><keycombo action="simul">&Ctrl;<keycap>Q</keycap></keycombo></shortcut>
 <guimenu>File</guimenu><guimenuitem>Quit</guimenuitem></menuchoice></term>
@@ -525,7 +545,7 @@
 
 
 <varlistentry id="view-hierarchical-key-list">
-<term><menuchoice><guimenu>View</guimenu><guimenuitem>Hierarchical Key List</guimenuitem></menuchoice></term>
+<term><menuchoice><guimenu>View</guimenu><guimenuitem>Hierarchical Certificate List</guimenuitem></menuchoice></term>
 
 <listitem>
 <para><action> Toggles between hierarchical and flat keylist mode.
@@ -552,7 +572,7 @@
 <listitem>
 <para>(This function is only available when <link
 linkend="view-hierarchical-key-list"><menuchoice><guimenu>View</guimenu>
-<guimenuitem>Hierarchical Key List</guimenuitem></menuchoice></link> is on.)</para>
+<guimenuitem>Hierarchical Certificate List</guimenuitem></menuchoice></link> is on.)</para>
 
 <para><action>Expands all list items in the certificate list
 view,</action> &ie; makes all items visible.</para>
@@ -565,8 +585,6 @@
 </listitem>
 </varlistentry>
 
-
-
 <varlistentry id="view-collapse-all">
 <term><menuchoice><shortcut><keycombo action="simul">&Ctrl;<keycap>,</keycap>
 </keycombo></shortcut><guimenu>View</guimenu><guimenuitem>Collapse All</guimenuitem></menuchoice></term>
@@ -574,7 +592,7 @@
 <listitem>
 <para>(This function is only available when <link
 linkend="view-hierarchical-key-list"><menuchoice><guimenu>View</guimenu>
-<guimenuitem>Hierarchical Key List</guimenuitem></menuchoice></link> is on.)</para>
+<guimenuitem>Hierarchical Certificate List</guimenuitem></menuchoice></link> is on.)</para>
 
 <para><action>Collapses all list items in the certificate list
 view,</action> &ie; hides all but the top-level items.</para>
@@ -591,14 +609,14 @@
 <sect1 id="menucertificates"><title><guimenu>Certificates</guimenu> Menu</title>
 
 <variablelist>
-
-<varlistentry id="certificates-validate">
-<term><menuchoice><shortcut><keycombo action="simul">&Shift;<keycap>F5</keycap></keycombo>
-</shortcut><guimenu>Certificates</guimenu><guimenuitem>Validate</guimenuitem></menuchoice></term>
-
+<!-- missing menu item
+<varlistentry id="certificates-certify">
+<term><menuchoice>
+<guimenu>Certificates</guimenu><guimenuitem>Certify Certificate...</guimenuitem></menuchoice></term>
 <listitem>
-<para><action>Validates selected (or all) keys.</action></para>
+<para><action>???</action></para>
 
+no longer in kde4
 <para>This is similar to <link
 linkend="view-redisplay"><menuchoice><shortcut><keycombo action="simul">
 <keycap>F5</keycap></keycombo></shortcut><guimenu>View</guimenu>
@@ -619,10 +637,9 @@
 decryption).</para></warning>
 </listitem>
 </varlistentry>
-
-
-
-<varlistentry id="certificates-refresh-crls">
+-->
+<!--not in 4.2
+varlistentry id="certificates-refresh-crls">
 <term><menuchoice><guimenu>Certificates</guimenu><guimenuitem>Refresh CRLs</guimenuitem></menuchoice></term>
 
 <listitem>
@@ -646,12 +663,42 @@
 
 <para>Use this function scarcely.</para></warning>
 </listitem>
+</varlistentry-->
+<!-- missing menu items
+<varlistentry>
+<term><menuchoice>
+<guimenu>Certificates</guimenu><guimenuitem>Change Ownertrust...</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
 </varlistentry>
 
+<varlistentry>
+<term><menuchoice>
+<guimenu>Certificates</guimenu><guimenuitem>Expire Date...</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
+</varlistentry>
 
+<varlistentry>
+<term><menuchoice>
+<guimenu>Certificates</guimenu><guimenuitem>Change Passphrase...</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
+</varlistentry>
 
+<varlistentry>
+<term><menuchoice>
+<guimenu>Certificates</guimenu><guimenuitem>Add User-ID...</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
+</varlistentry>
+-->
 <varlistentry id="certificates-delete">
-<term><menuchoice><shortcut><keycombo action="simul"><keycap>Delete</keycap></keycombo></shortcut>
+<term><menuchoice><shortcut><keycombo action="simul"><keycap>Del</keycap></keycombo></shortcut>
 <guimenu>Certificates</guimenu><guimenuitem>Delete</guimenuitem></menuchoice></term>
 
 <listitem>
@@ -669,40 +716,65 @@
 </listitem>
 </varlistentry>
 
+<varlistentry>
+<term><menuchoice><guimenu>Certificates</guimenu><guimenuitem>Dump Certificate</guimenuitem></menuchoice></term>
+<listitem>
+<para>Shows the detailed contents of the &gpgsm; CRL cache.</para>
+</listitem>
+</varlistentry>
 
-
-<varlistentry id="certificates-download">
+<!--not in 4.2
+varlistentry id="certificates-download">
 <term><menuchoice><guimenu>Certificates</guimenu><guimenuitem>Download</guimenuitem></menuchoice></term>
 
 <listitem>
 <para><action>Downloads the selected certificate(s) from the LDAP to the local keybox.</action></para>
 </listitem>
-</varlistentry>
+</varlistentry-->
 
 </variablelist>
 
 </sect1>
 
+<sect1 id="menutools"><title><guimenu>Tools</guimenu> Menu</title>
 
+<variablelist>
 
-<sect1 id="menucrls"><title><guimenu>CRLs</guimenu> Menu</title>
+<varlistentry id="tools-gnupg-log-viewer">
+<term><menuchoice><guimenu>Tools</guimenu><guimenuitem>GnuPG Log Viewer...</guimenuitem></menuchoice></term>
 
-<variablelist>
+<listitem>
+<para><action>Starts <ulink url="help:/kwatchgnupg/index.html">&kwatchgnupg;</ulink></action>, a tool to present the debug output of GnuPG application. If signing, encryption, or verification mysteriously stop working, you might find out why by looking at the log.</para>
+</listitem>
+</varlistentry>
 
+<varlistentry id="certificates-refresh-crls">
+<term><menuchoice><guimenu>Tools</guimenu><guimenuitem>Refresh X.509 or OpenPGP Certificates</guimenuitem></menuchoice></term>
+
+<listitem>
+<para>Refreshing X.509 or OpenPGP certificates implies downloading all certificates
+and CRLs, to check if any of them have been revoked in the meantime.</para>
+<para>This can put a severe strain on your own as well as other
+people's network connections, and can take up to an hour or more to
+complete, depending on your network connection, and the number of
+certificates to check.</para>
+</listitem>
+</varlistentry>
+
 <varlistentry id="crls-clear-crl-cache">
-<term><menuchoice><guimenu>CRLs</guimenu><guimenuitem>Clear CRL Cache</guimenuitem></menuchoice></term>
+<term><menuchoice><guimenu>Tools</guimenu><guimenuitem>Clear CRL Cache</guimenuitem></menuchoice></term>
 
 <listitem>
 <para><action>Clears the &gpgsm; CRL cache.</action></para>
 
 <para>You probably never need this. You can force a refresh of the CRL
 cache by selecting all certificates and using <link linkend="certificates-refresh-crls"><menuchoice>
-<guimenu>Certificates</guimenu><guimenuitem>Refresh CRLs</guimenuitem></menuchoice></link> instead.</para>
+<guimenu>Tools</guimenu><guimenuitem>Refresh Certificates</guimenuitem></menuchoice></link> instead.</para>
 </listitem>
 </varlistentry>
 
 <varlistentry id="crls-dump-crl-cache">
-<term><menuchoice><guimenu>CRLs</guimenu><guimenuitem>Dump CRL Cache</guimenuitem></menuchoice></term>
+<term><menuchoice><guimenu>Tools</guimenu><guimenuitem>Dump CRL Cache</guimenuitem></menuchoice></term>
 
 <listitem>
 <para><action>Shows the detailed contents of the &gpgsm; CRL
@@ -710,22 +782,20 @@
 </listitem>
 </varlistentry>
 
-</variablelist>
+<varlistentry id="settings-configure-gpgme-backend">
+<term><menuchoice><guimenu>Tools</guimenu><guimenuitem>Configure GnuPG Backend...</guimenuitem></menuchoice></term>
 
-</sect1>
+<listitem>
+<para><action>Opens a dialog that allows you to configure every aspect of
+&gpgsm; and other backend modules.</action></para>
 
-<sect1 id="menutools"><title><guimenu>Tools</guimenu> Menu</title>
-
-<variablelist>
-
-<varlistentry id="tools-gnupg-log-viewer">
-<term><menuchoice><guimenu>Tools</guimenu><guimenuitem>GnuPG Log Viewer...</guimenuitem></menuchoice></term>
-
-<listitem>
-<para><action>Starts <ulink url="help:/kwatchgnupg/index.html">&kwatchgnupg;</ulink></action></para>
+<para>This dialog is dynamically built from the output of the
+&gpgconf; utility and may thus change when backend modules are
+updated.</para>
 </listitem>
 </varlistentry>
 
+
 </variablelist>
 
 </sect1>
@@ -733,20 +803,23 @@
 <sect1 id="menusettings"><title><guimenu>Settings</guimenu> Menu</title>
 
 <variablelist>
+<!-- missing items
+<varlistentry>
+<term><menuchoice>
+<guimenu>Settings</guimenu><guimenuitem>Perform Selftest</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
+</varlistentry>
 
-<varlistentry id="settings-configure-gpgme-backend">
-<term><menuchoice><guimenu>Settings</guimenu><guimenuitem>Configure GpgME Backend...</guimenuitem></menuchoice></term>
-
+<varlistentry>
+<term><menuchoice>
+<guimenu>Settings</guimenu><guisubmenu>Toolbars</guisubmenu></menuchoice></term>
 <listitem>
-<para><action>Opens a dialog that allows you to configure every aspect of
-&gpgsm; and other backend modules.</action></para>
-
-<para>This dialog is dynamically built from the output of the
-&gpgconf; utility and may thus change when backend modules are
-updated.</para>
+<para>???</para>
 </listitem>
 </varlistentry>
-
+-->
 <varlistentry id="settings-show-statusbar">
 <term><menuchoice><guimenu>Settings</guimenu><guimenuitem>Show Statusbar</guimenuitem></menuchoice></term>
 
@@ -754,7 +827,14 @@
 <para><action>Toggles the visibility of the bottom status bar.</action></para>
 </listitem>
 </varlistentry>
-
+<!-- missing item
+<varlistentry>
+<term><menuchoice><guimenu>Settings</guimenu><guimenuitem>Configure Toolbars...</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
+</varlistentry>
+-->
 <varlistentry id="settings-configure-shortcuts">
 <term><menuchoice><guimenu>Settings</guimenu><guimenuitem>Configure Shortcuts...</guimenuitem></menuchoice></term>
 
@@ -779,9 +859,15 @@
 
 </sect1>
 
+<sect1 id="menuwindow"><title><guimenu>Window</guimenu> Menu</title>
+<para>The <guimenu>Window</guimenu> menu allows you to manage the tabs.
+Using the items in this menu you can rename a tab, add a new tab, duplicate the current tab, close the current tab, and move the current tab to the left or right.</para>
+
+<para>By clicking with the &RMB; click on a tab you open a context menu, where you can also select the same actions.</para>
+</sect1>
+
 <sect1 id="menuhelp"><title><guimenu>Help</guimenu> Menu</title>
 
-
 <para>The <guimenu>Help</guimenu> menu contains the standard &kde;
 help menu.</para>
 
@@ -800,28 +886,29 @@
 
 <variablelist>
 
-<varlistentry id="commandline-option-external">
-<term>&commandline-option-external;</term>
+<varlistentry>
+<term><option>--external</option></term>
+<listitem>
+<para>Run UI server only, hide main window</para>
+</listitem>
+</varlistentry>
 
+<varlistentry>
+<term><option>-p</option> <option>--openpgp</option></term>
 <listitem>
-<para><action>Specifies that &commandline-option-query; shall search
-remotely instead of in the local keybox.</action></para>
+<para>Use OpenPGP for the following operation</para>
 </listitem>
 </varlistentry>
 
-<varlistentry id="commandline-option-query">
-<term>&commandline-option-query;</term>
-
+<varlistentry>
+<term><option>-c</option> <option>--cms</option></term>
 <listitem>
-<para><action>Specifies that &kleopatra; shall start with the given
-query string instead of listing the complete local
-keybox.</action></para>
+<para>Use CMS (X.509, S/MIME) for the following operation</para>
 </listitem>
 </varlistentry>
 
 <varlistentry id="commandline-option-import-certificate">
-<term>&commandline-option-import-certificate;</term>
-
+<term><option>-i</option> <option>--import-certificate</option></term>
 <listitem>
 <para><action>Specifies a file or &URL; from which to import
 certificates (or secret keys) from.</action></para>
@@ -832,6 +919,48 @@
 </listitem>
 </varlistentry>
 
+<varlistentry>
+<term><option>-e</option> <option>--encrypt</option></term>
+<listitem>
+<para>Encrypt file(s)</para>
+</listitem>
+</varlistentry>
+
+<varlistentry>
+<term><option>-s</option> <option>--sign</option></term>
+<listitem>
+<para>Sign file(s)</para>
+</listitem>
+</varlistentry>
+
+<varlistentry>
+<term><option>-E</option> <option>--encrypt-sign</option></term>
+<listitem>
+<para>Encrypt and/or sign file(s)</para>
+</listitem>
+</varlistentry>
+
+<varlistentry>
+<term><option>-d</option> <option>--decrypt</option></term>
+<listitem>
+<para>Decrypt file(s)</para>
+</listitem>
+</varlistentry>
+
+<varlistentry>
+<term><option>-V</option> <option>--verify</option></term>
+<listitem>
+<para>Verify file/signature</para>
+</listitem>
+</varlistentry>
+
+<varlistentry>
+<term><option>-D</option> <option>--decrypt-verify</option></term>
+<listitem>
+<para>Decrypt and/or verify file(s)</para>
+</listitem>
+</varlistentry>
+
 </variablelist>
 
 </chapter>
@@ -850,30 +979,29 @@
 certificate searches. You can also configure their order, as well as
 some selected LDAP-related settings from the dynamic backend
 configuration dialog, available via <link
-linkend="settings-configure-gpgme-backend"><menuchoice><guimenu>Settings</guimenu>
-<guimenuitem>Configure GpgME Backend...</guimenuitem></menuchoice></link>.</para>
+linkend="settings-configure-gpgme-backend"><menuchoice><guimenu>Tools</guimenu>
+<guimenuitem>Configure GnuPG Backend...</guimenuitem></menuchoice></link>.</para>
 
-<para>To add a new server, click on the <guilabel>Add
-Service...</guilabel> button. In the dialog that appears, you can set
-the <guilabel>Server name</guilabel>, the <guilabel>Port</guilabel>
+<para>To add a new server, click on the <guilabel>New</guilabel> button. 
+Then you can set
+the <guilabel>Server Name</guilabel>, the <guilabel>Server Port</guilabel>
 (preset to the default LDAP port), the <guilabel>Base &dn;</guilabel>
 (sometimes referred to as the search root or search base), and the
-usual <guilabel>User name</guilabel> and
+usual <guilabel>User Name</guilabel> and
 <guilabel>Password</guilabel>, both of which are only needed if the
-server requires authentication. Clicking <guilabel>OK</guilabel> adds
-the server details to the list of servers, while
-<guilabel>Cancel</guilabel> dismisses the input.</para>
+server requires authentication.</para>
 
 <para>To remove a server from the search list, select it in the list,
-then press the <guilabel>Remove Service</guilabel> button.</para>
+then press the <guilabel>Delete</guilabel> button.</para>
 
+<!-- not in 4.2
 <para>To change the relative search order of servers, select one of
 them and move it up or down with the arrow buttons right next to the
 list.</para>
-
+-->
 <para>To set the LDAP timeout, &ie; the maximum time the backend will
 wait for a server to respond, simply use the corresponding input field
-labelled <guilabel>LDAP timeout</guilabel>.</para>
+labeled <guilabel>LDAP timeout (minutes:seconds)</guilabel>.</para>
 
 <para>If one of your servers has a large database, so that even
 reasonable searches like <userinput>Smith</userinput> hit the
@@ -938,7 +1066,7 @@
 
 </sect1>
 
-<sect1 id="configuration-dn-order"><title>Configuring the <guilabel>&dn;Attribute Order</guilabel></title>
+<sect1 id="configuration-dn-order"><title>Configuring the <guilabel>&dn; Attribute Order</guilabel></title>
 
 <para>Although &dn;s are hierarchical, the order of the individual
 components (called relative &dn;s (RDNs), or &dn; attributes) is not
@@ -1097,7 +1225,7 @@
 	linkend="configuration-appearance">visual appearance</link> of
 	keys based on a concept called <guilabel>Key
 	Categories</guilabel>. <guilabel>Key Categories</guilabel> are
-	also used to filter the list of certificates.This section
+	also used to filter the list of certificates. This section
 	describes how you can edit the available categories and add
 	new ones.
       </para>
@@ -1303,9 +1431,7 @@
 	      <entry><varname>was-validated</varname></entry>
 	      <entry>boolean</entry>
 	      <entry>
-		the key has been validated (see <link
-		linkend="certificates-validate"><menuchoice><shortcut><keycombo action="simul">&Shift;<keycap>F5</keycap></keycombo></shortcut>
-		<guimenu>Certificates</guimenu><guimenuitem>Validate</guimenuitem></menuchoice></link>).
+		the key has been validated.
 	      </entry>
 	    </row>
 	    <row>
@@ -1403,7 +1529,7 @@
         by an exclamation point (<literal>!</literal>), indicating negation. The tokens act
         in order on an internal list of contexts, which starts out
         empty. This is best explained by an example: <literal>any
-        !apperance</literal> is the same as
+        !appearance</literal> is the same as
         <literal>filtering</literal>, and <literal>appearance
         !appearance</literal> is producing the empty set, as is
         <literal>!any</literal>. However, the last two will be
@@ -1424,7 +1550,7 @@
         wins over less specific ones. If two filters have the same
         specificity, the one that comes first in the config file
         wins. A filter's specificity is proportional to the number of
-        critera it contains.
+        criteria it contains.
       </para>
 
       <example>
Index: doc/ktimetracker/index.docbook
===================================================================
--- doc/ktimetracker/index.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ doc/ktimetracker/index.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -99,12 +99,13 @@
 <sect1 id="starting">
 <title>Starting &karm;</title>
 
-<para>Type <command>karm</command> at a command prompt or select
-<guimenuitem>Personal Time Tracker</guimenuitem> from the
-<guisubmenu>Utilities</guisubmenu> group in the <guimenu>KDE start
+<para>Type <command>ktimetracker</command> at a command prompt or select
+<guimenuitem>Personal Time Tracker</guimenuitem> from the <menuchoice>
+<guimenu>Applications</guimenu><guisubmenu>Utilities</guisubmenu> 
+</menuchoice> group in the <guimenu>KDE start
 menu</guimenu>. The standard &Qt; and &kde; command options are
 available, and can be listed by entering
-<userinput><command>karm</command> <option>--help</option></userinput>
+<userinput><command>ktimetracker</command> <option>--help</option></userinput>
 at the command line.</para>
 
 <para>&karm; provides an additional command option that allows you to enter
@@ -921,7 +922,7 @@
 <term>
 <menuchoice>
 <guimenu>Settings</guimenu>
-<guimenuitem>Configure KArm</guimenuitem>
+<guimenuitem>Configure &karm;</guimenuitem>
 </menuchoice>
 </term>
 <listitem><para><action>Opens</action> a dialog to allow the user to
@@ -997,7 +998,7 @@
 
 <para>Contributors (in alphabetical order)</para>
 <itemizedlist>
-<listitem><para>Allen Winter <email>winterz@verizon.net</email></para></listitem>
+<listitem><para>Allen Winter <email>winter@kde.org</email></para></listitem>
 <listitem><para>&David.Faure; &David.Faure.mail;</para></listitem>
 <listitem><para>&Espen.Sand; <email>espen@kde.org</email></para></listitem>
 <listitem><para>Gioele Barabucci <email>gioele@gioelebarabucci.com</email></para></listitem>
Index: doc/kjots/index.docbook
===================================================================
--- doc/kjots/index.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ doc/kjots/index.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -155,12 +155,12 @@
 <guimenuitem>Delete Page</guimenuitem></menuchoice>.</para>
 
 <tip><para>If you need to insert the current date and time while you are 
-writing a note, you can use  <keycombo action="simul">&Ctrl;<keycap>I
+writing a note, you can use  <keycombo action="simul">&Ctrl;&Shift;<keycap>I
 </keycap></keycombo>.</para></tip>
 
 <para>So that you can get to the page you want to see, pages can (and
 should) be given a name. This can be done in the way you are used to: 
-select the page you want to rename, wait a second and click it once more. 
+double click the page you want to rename.
 You are then able to rename the page. Of course there is also a keyboard 
 shortcut, you can use that at any time while writing a note. The shortcut 
 is: <keycombo action="simul">&Ctrl;<keycap>M</keycap></keycombo>.</para>
Index: doc/knode/using-morefeatures.docbook
===================================================================
--- doc/knode/using-morefeatures.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ doc/knode/using-morefeatures.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -644,7 +644,7 @@
 the rules which are shown &mdash; you have the choice whether to show all
 rules or only the rules for a specific <glossterm>newsgroup</glossterm>.</para> 
 
-<para>If you chose a rule-name in the list you the rule will be displayed
+<para>If you choose a rule-name in the list the rule will be displayed
 on the right-hand side; now you can edit the rule. At the top you can change
 the name of the rule and set the newsgroups to which this rule applies.
 You can choose one or
@@ -725,7 +725,7 @@
 raise or lower the score, by the configured value, for articles to which
 this rule applies.  &knode; can also show you a little message when finding
 such an article or colorize the header in the article list; for example, you could make
-interesting articles scraeming pink so you would notice them very
+interesting articles screaming pink so you would notice them very
 quickly.</para> 
 
 <para>When leaving the editor, or when the 
Index: doc/knode/using-firststart.docbook
===================================================================
--- doc/knode/using-firststart.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ doc/knode/using-firststart.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -246,7 +246,7 @@
 <para>If this option is activated, the signature file is not handled
 as a text file, but as a program. The signature file will be started
 as a program and the output will be used as a signature. Through that
-you'll be able to chose a signature by accident or to use fortune to
+you'll be able to choose a signature by accident or to use fortune to
 generate a cool slogan every time.</para>
 
 </sect3>
@@ -825,7 +825,7 @@
 it as read.</para>
 
 <para>If <guilabel>Go to next unread thread</guilabel> is
-checked, &knode; automatically shows the next thread if you mark the
+checked, &knode; automatically shows the next thread if you mark
 the previous thread as read.</para>
 
 </sect3>
@@ -942,7 +942,7 @@
 
 <para>The <guibutton>Down</guibutton> button does the opposite
 action: select the filter you just shifted one up and
-press<guibutton>Down</guibutton> until it reaches its old
+press <guibutton>Down</guibutton> until it reaches its old
 position.</para>
 
 <para>With the two buttons <guibutton>Add Separator</guibutton> and
Index: doc/knode/using-subscribing.docbook
===================================================================
--- doc/knode/using-subscribing.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ doc/knode/using-subscribing.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -184,7 +184,7 @@
 </tip> 
 
 <para>Unfortunately there is no guarantee that your newsserver is
-providing all available newsgroups: many newsserver refuse groups
+providing all available newsgroups: many newsservers refuse groups
 publishing binary attachments; other groups are only available from
 special servers. &knode; provides you the possibility to use more than
 one news-server if you want to access alternative servers providing
@@ -446,7 +446,7 @@
 <varlistentry> 
 <term><guilabel>From</guilabel></term> 
 <listitem> 
-<para>The <guilabel>From</guilabel> column shows the author, or their
+<para>The <guilabel>From</guilabel> column shows the author, or his
 e-mail address if the author didn't give a name. You can configure
 your settings in
 <menuchoice><guimenu>Settings</guimenu><guimenuitem>Configure
@@ -578,7 +578,7 @@
 <para>You can navigate in articles, display an article and open or
 close threads with your mouse or keyboard.</para> 
 
-<para>When you select an article with your mouse its entry in the the
+<para>When you select an article with your mouse its entry in the
 article view gets colored; at the same time the header and body of
 this article appear in in the article window. If you want to read
 another article you can use the mouse to select it, or you can use
Index: doc/kpilot/faq.docbook
===================================================================
--- doc/kpilot/faq.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ doc/kpilot/faq.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -334,7 +334,7 @@
 </sect1>
 
 
-<sect1>
+<sect1 id="faq-dcop">
 <title>&kpilot;'s &DCOP; interface</title>
 
 <qandaset>
Index: doc/kalarm/index.docbook
===================================================================
--- doc/kalarm/index.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ doc/kalarm/index.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -261,20 +261,10 @@
 </listitem>
 
 <listitem>
-<para>Click the <mousebutton>Middle</mousebutton> mouse button on the
-system tray icon.</para>
-</listitem>
-
-<listitem>
 <para><mousebutton>Right</mousebutton> click in the alarm list and
 choose <menuchoice><guimenuitem>New</guimenuitem></menuchoice> from
 the context menu.</para>
 </listitem>
-
-<listitem>
-<para>Double click on empty space below the last entry in the alarm
-list.</para>
-</listitem>
 </itemizedlist>
 
 <para>Alternatively, you can create new alarms preconfigured from
@@ -423,32 +413,6 @@
 </sect2>
 
 <sect2>
-<title>Viewing an Alarm</title>
-
-<para>To view an existing alarm without the ability to modify it, do
-one of the following:</para>
-
-<itemizedlist>
-<listitem>
-<para>Select it by clicking on its entry in the alarm list. Then choose
-<menuchoice>
-<guimenu>Actions</guimenu><guimenuitem>View</guimenuitem>
-</menuchoice>.</para>
-</listitem>
-<listitem>
-<para><mousebutton>Right</mousebutton> click on its entry in the alarm
-list and choose
-<menuchoice><guimenuitem>View</guimenuitem></menuchoice>
-from the context menu.</para>
-</listitem>
-</itemizedlist>
-
-<para>This displays the <link linkend="alarm-edit-dlg">Alarm Edit
-dialog</link> in read-only mode.</para>
-
-</sect2>
-
-<sect2>
 <title>Acknowledging an Alarm</title>
 
 <para>See <link linkend="message-window">Alarm Message Window</link>
@@ -1745,7 +1709,7 @@
 when the message is to be redisplayed, or select <guilabel>Defer for
 time interval</guilabel> to enter how long after now (in hours and
 minutes) the message should be redisplayed. Then click
-<guibutton>Defer</guibutton> to defer the alarm message and close its
+<guibutton>OK</guibutton> to defer the alarm message and close its
 window.</para>
 
 <note><para>The time the alarm is deferred to must be earlier than its
@@ -1848,8 +1812,7 @@
 <variablelist>
 <varlistentry>
 <term><menuchoice><guimenuitem>Enable Alarms</guimenuitem></menuchoice></term>
-<listitem><para><action>Enables monitoring of alarms. This option
-only appears if alarms are currently disabled.</action></para>
+<listitem><para><action>Enables or disables monitoring of alarms.</action></para>
 <para>See
 <link linkend="enable-disable">Enabling and Disabling Alarms</link>
 for details.</para>
@@ -1857,16 +1820,6 @@
 </varlistentry>
 
 <varlistentry>
-<term><menuchoice><guimenuitem>Disable Alarms</guimenuitem></menuchoice></term>
-<listitem><para><action>Disables monitoring of alarms. This option
-only appears if alarms are currently enabled.</action></para>
-<para>See
-<link linkend="enable-disable">Enabling and Disabling Alarms</link>
-for details.</para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
 <term><menuchoice><guimenuitem>New Alarm</guimenuitem></menuchoice></term>
 <listitem><para><action>After you select the alarm type from the list
 which appears, opens the Alarm Edit dialog to create a new
@@ -2029,14 +1982,14 @@
 
 <itemizedlist>
 <listitem>
-<para>Select <menuchoice><guimenu>Actions</guimenu>
-<guimenuitem>Disable Alarms</guimenuitem></menuchoice>.</para>
+<para>Unselect <menuchoice><guimenu>Actions</guimenu>
+<guimenuitem>Enable Alarms</guimenuitem></menuchoice>.</para>
 </listitem>
 
 <listitem>
 <para><mousebutton>Right</mousebutton> click on the system tray icon
-and choose
-<menuchoice><guimenuitem>Disable Alarms</guimenuitem></menuchoice>
+and uncheck
+<menuchoice><guimenuitem>Enable Alarms</guimenuitem></menuchoice>
 from the context menu.</para>
 </listitem>
 
Index: doc/kaddressbook/index.docbook
===================================================================
--- doc/kaddressbook/index.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ doc/kaddressbook/index.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -544,8 +544,8 @@
 <para>The Photo will be shown in the contact preview and in the Icon view mode. However the Logo picture will only be shown in Icon view and only if there's no photo available.</para>
 <para>To reset a photo or logo simply click on it with the &RMB; and select <guilabel>Reset</guilabel>.</para>
 </sect3>
-<sect3 id="managing-contacts-misc-free-busy-informations">
-<title>Location of Free/Busy informations</title>
+<sect3 id="managing-contacts-misc-free-busy-information">
+<title>Location of Free/Busy information</title>
 <para>Here you can select a path to a contact's Free/Busy information, which are used when you add him to an event in &korganizer; or &kontact;'s calendar view.</para>
 </sect3>
 </sect2>
@@ -813,7 +813,7 @@
 <varlistentry>
 <term><guilabel>CSV List</guilabel></term>
 <listitem><para>CSV (comma separated value) is a format that is used
-by many (address book) applications, it stores the contact informations in a plaintext field separated by commas. This makes CSV very flexible and good for interaction with scripts.</para></listitem>
+by many (address book) applications, it stores the contact information in a plaintext field separated by commas. This makes CSV very flexible and good for interaction with scripts.</para></listitem>
 </varlistentry>
 
 <varlistentry>
Index: doc/korganizer/index.docbook
===================================================================
--- doc/korganizer/index.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ doc/korganizer/index.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -454,7 +454,7 @@
 </procedure>
 
 <para>Alternatively, you can configure the &korganizer; resources (plus all
-other &kde; resources), in the &kcontrolcenter;, using the <guilabel>&kde;
+other &kde; resources), in the &systemsettings;, using the <guilabel>&kde;
 Resources</guilabel> configuration module.</para>
 
 <para>Among the existing resources, you can find:</para>
@@ -512,7 +512,7 @@
 <listitem><para>
 If you have access to a server that supports the
 <ulink url="http://www.groupdav.org">GroupDav protocol</ulink>, add this
-resource in order to be able to to save (and load) events<!--, journals, free/busy information?--> and to-dos
+resource in order to be able to save (and load) events<!--, journals, free/busy information?--> and to-dos
 to the server. To add the resource, you will need to know the server &URL;, your
 user name and your password. The GroupDav protocol supports the storage of 
 contacts, so you may want to add and configure the &kaddressbook;
@@ -530,7 +530,7 @@
 <listitem><para>
 If you have access to a
 <ulink url="http://www.novell.com/products/groupwise">Novell GroupWise Server</ulink>
-(version 6.5 or later), add this resource in order to be able to to save (and load)
+(version 6.5 or later), add this resource in order to be able to save (and load)
 events, free/busy information <!--,journals ?-->and to-dos to the server. To add the resource, you will
 need to know the server &URL;, your user name and your password. There is
 support for storage of contacts, so you may want to configure &kaddressbook;
@@ -550,7 +550,7 @@
 <term><guilabel>Calendar on IMAP Server via &kmail;</guilabel></term>
 <listitem><para>
 If you have access to a server that shares calendar data via IMAP, add this
-resource in order to be able to to save (and load) events, to-dos, free/busy
+resource in order to be able to save (and load) events, to-dos, free/busy
 information and journal entries to the IMAP server. To enable IMAP access, you
 will need to configure &kmail; first, then add the &korganizer; resource.
 Also, since you are using &kmail; to contact the server, &korganizer; will
@@ -615,7 +615,7 @@
 <listitem><para>
 If you have access to a
 <ulink url="http://www.microsoft.com/exchange">Exchange 2000 Server</ulink>,
-add this resource in order to be able to to save (and load)
+add this resource in order to be able to save (and load)
 events FIXME:,journals, free/busy information and to-dos? to the server. To add the resource, you will
 need to know the server &URL;, FIXME:port? your user name and your password. There
 is support for (read only) contacts, so you may want to configure &kaddressbook;
@@ -704,13 +704,13 @@
 <term><guilabel>SUSE &Linux; OpenExchange Server</guilabel></term>
 <listitem><para>
 If you have access to a
-<ulink url="http://www.novell.com/products/groupwise">SUSE &Linux; OpenExchange
-Server</ulink>, version 4.1, add this resource in order to be able to to save
+<ulink url="http://www.novell.com/coolsolutions/openexchange/">SUSE &Linux; OpenExchange
+Server</ulink>, version 4.1, add this resource in order to be able to save
 (and load) events, free/busy information <!--,journals ?-->and to-dos to the server. To add the
 resource, you will need to know the server &URL;, your user name and your
 password. There is support for storage of contacts, so you may want to configure
 &kaddressbook; resource.</para>
-<para>The most practical way to configure the access to a GroupWise server is
+<para>The most practical way to configure the access to an OpenExchange server is
 to use the <application>sloxwizard</application> wizard. You can start it
 from the command line prompt:
 
@@ -728,7 +728,7 @@
 <listitem><para>
 If you have access to a
 <ulink url="http://www.egroupware.org">eGroupware
-Server</ulink>, version 1.0, add this resource in order to be able to to save
+Server</ulink>, version 1.0, add this resource in order to be able to save
 (and load) events, free/busy information <!--,journals ?-->and to-dos to the server. To add the
 resource, you will need to know the server &URL;, your user name and your
 password. There is support for storage of contacts, so you may want to configure
@@ -1060,7 +1060,7 @@
 times. Hovering the mouse over an calendar item will bring up a tooltip
 with the item detailed information. To make &korganizer; show a red line
 marking the current-time on the current day (the Marcus Bains line),
-check the <guilabel>Show current-time (Marcus Bains Line)</guilabel> box in the
+check the <guilabel>Show current-time (Marcus Bains) line</guilabel> box in the
 <link linkend="config-main-views">&korganizer; view
 configuration</link>.</para>
 
@@ -1334,7 +1334,7 @@
 <para>The <menuchoice><guimenu>View</guimenu>
 <guisubmenu>Filter</guisubmenu></menuchoice> submenu and the filter toolbar drop
 down offer access to all available filters  created using
-the <link linkend="menu-settings-edit-filters"><guilabel>Edit
+the <link linkend="menu-settings-edit-filters"><guilabel>Edit Calendar 
 Filters</guilabel></link> dialog. To toggle the display of the filters toolbar
 on and off, choose the <menuchoice><guimenu>Settings</guimenu>
 <guisubmenu>Toolbars</guisubmenu><guimenuitem>Filter toolbar</guimenuitem></menuchoice>.
@@ -1429,7 +1429,7 @@
 
 <para>This is a thorough description of the individual event window fields and
 widgets. Not all fields have to be filled in; some can be left empty. Read the
-<link linkend="entering-data-required-fields">Required fields section</link>
+<link linkend="entering-data-required-fields">Required fields</link> section 
 for detailed information. And if you prefer to learn by example, there's one
 in the <link linkend="examples-entering-event">Entering event</link> section.
 </para>
@@ -1491,7 +1491,7 @@
 reminded, or click the <guibutton>Advanced</guibutton> button to open the
 <guilabel>Edit Reminders</guilabel> dialog. Using this dialog, you can set
 repeating intervals for your reminders, and create special reminders that play
-sounds, run programs, or send emails.</para>
+sounds, or run programs.</para>
 
 <!--Click the musical <guiicon>Note</guiicon> symbol to choose the
 alarm sound. Click the <guiicon>Gear</guiicon> icon to browse for a
@@ -1502,7 +1502,7 @@
 <term><guilabel>Show Time As:</guilabel></term>
 <listitem><para>The duration of the event may be shown as Busy or Free in your
 schedule. Choose it from the <guilabel>Show Time As</guilabel>
-menu.</para></listitem>
+drop down box.</para></listitem>
 </varlistentry>
 
 <varlistentry>
@@ -1520,7 +1520,7 @@
 <term><guilabel>Select Categories</guilabel></term>
 <listitem><para>You can assign several
 <link linkend="categories-view">categories</link> to a calendar item. Click the
-<guilabel>Select Categories</guilabel> button to open the
+<guilabel>Select</guilabel> button to open the
 <guilabel>Select Categories</guilabel> dialog. Check the category boxes to
 assign suitable categories to the event. You can also add a new category, modify
 a category or delete a category by pressing the button
@@ -1552,7 +1552,7 @@
 
 </variablelist>
 
-<para>When you want to confirm, call off or revert the entered data, choose
+<para>When you want to confirm, apply or call off the entered data, choose
 among the <link linkend="reference-action-buttons">Action Buttons</link>,
 <guibutton>OK</guibutton>, <guibutton>Apply</guibutton> and
 <guibutton>Cancel</guibutton>.</para>
@@ -1629,7 +1629,7 @@
 <para>This is similar to Monthly.  You need to choose whether or not you
 are indicating a calendar day of the year (&eg;, the 250th day of the
 year) - <guilabel>Recur on day <replaceable>#</replaceable> of the
-year</guilabel>, in in a specific week on a specific day of the week of a month
+year</guilabel>, in a specific week on a specific day of the week of a month
 (&eg;, the 2nd Tuesday of March), or the day of the month in a
 particular month of the year - <guilabel>Recur on day <replaceable>#</replaceable>
 of the <replaceable>month</replaceable></guilabel>.  By default, &korganizer;
@@ -1695,9 +1695,9 @@
 identity can be set in the <guilabel>Personal</guilabel> section of the
 &korganizer; configuration, other identities in the <guilabel>Security &amp;
 Privacy</guilabel>-&gt;<guilabel>Password &amp; User Account</guilabel> section
-of the &kcontrolcenter;. In addition, identities are gathered from your &kmail;
+of the &systemsettings;. In addition, identities are gathered from your &kmail;
 settings and from your address book. If you choose to set it globally for &kde;
-in the &kcontrolcenter;, be sure to check the <guilabel>Use email settings from
+in the &systemsettings;, be sure to check the <guilabel>Use email settings from
 Control Center</guilabel>' box in the <guilabel>Personal</guilabel> section of
 the &korganizer; configuration.</para></listitem>
 </varlistentry>
@@ -1953,7 +1953,7 @@
 <varlistentry>
 <term><guilabel>Priority</guilabel></term>
 <listitem><para>Assign a priority to your to-do.  This drop down menu offers
-priorities from one to five, one being the highest.  Initially to-dos are set
+priorities from one to nine, one being the highest.  Initially to-dos are set
 to priority five (medium).</para></listitem>
 </varlistentry>
 
@@ -1969,7 +1969,7 @@
 reminded, or click the <guibutton>Advanced</guibutton> button to open the
 <guilabel>Edit Reminders</guilabel> dialog. Using this dialog, you can set
 repeating intervals for your reminders, and create special reminders that play
-sounds, run programs, or send emails.</para>
+sounds, or run programs.</para>
 
 <!--Click the musical <guiicon>Note</guiicon> symbol to choose the
 alarm sound. Click the <guiicon>Gear</guiicon> icon to browse for a
@@ -2469,13 +2469,13 @@
 &korganizer; window.</para>
 
 <para>Localization information like date and time formats can be
-configured from &kcontrolcenter; within the <menuchoice>
+configured from &systemsettings; within the <menuchoice>
 <guisubmenu>Regional &amp; Accessibility</guisubmenu> <guimenuitem>Country/Region &amp;
 Language</guimenuitem> </menuchoice> module.  This control module can be
 accessed from within &korganizer;: just choose the <menuchoice><guimenu>
 Settings</guimenu><guimenuitem>Configure Date &amp;
 Time...</guimenuitem></menuchoice> menu item.  &korganizer; has to be restarted
-for changes done in &kcontrolcenter; to take effect.</para>
+for changes done in &systemsettings; to take effect.</para>
 
 <para>To configure where &korganizer; stores and retrieves calendar events,
 journal entries and to-dos, (in local files, groupware servers, journal entries as blogs,
@@ -2499,7 +2499,7 @@
 <varlistentry>
 <term><guilabel>Use email settings from control center</guilabel></term>
 <listitem><para>Check this box to use your name and email address as set in
-&kcontrolcenter; (<menuchoice><guimenuitem>Security &amp; Privacy</guimenuitem>
+&systemsettings; (<menuchoice><guimenuitem>Security &amp; Privacy</guimenuitem>
 <guimenuitem>Password &amp; User Account</guimenuitem></menuchoice>).</para>
 </listitem>
 </varlistentry>
@@ -2509,7 +2509,7 @@
 <listitem><para><guilabel>Full name</guilabel> is initially set to
 <quote>Anonymous</quote> with an email address of
 <quote>nobody@nowhere</quote>. You can change your name by directly
-entering it here or you can use your Email Settings from &kcontrolcenter; (see
+entering it here or you can use your Email Settings from &systemsettings; (see
 above).  This name will be displayed by default as
 <guilabel>Organizer</guilabel> in to-dos and Events.</para></listitem> 
 </varlistentry>
@@ -2649,10 +2649,10 @@
 <variablelist>
 
 <varlistentry>
-<term><guilabel>Enable tooltips displaying summary of events</guilabel></term>
+<term><guilabel>Enable tooltips for displaying summaries</guilabel></term>
 <listitem><para>If your summary for an event is longer than would fit in the
-current View, the remaining characters are not displayed. Check <guilabel>Enable
-tooltips displaying summary of events</guilabel> if you want the full summary
+current View, the remaining characters are not displayed. Check <guilabel>Enable 
+tooltips for dispaying summaries</guilabel> if you want the full summary
 displayed when the hovering the mouse pointer over the appointment for a few
 seconds.</para></listitem>
 </varlistentry>
@@ -2884,7 +2884,7 @@
 <varlistentry>
 <term><guilabel>Working hours color</guilabel></term>
 <listitem><para>This button opens the <guilabel>Select Color</guilabel> dialog,
-allowing you to select the agenda view.</para></listitem>
+allowing you to select color of the working hours background in the agenda view.</para></listitem>
 </varlistentry>
 
 <varlistentry>
@@ -3029,7 +3029,7 @@
 <variablelist>
 
 <varlistentry>
-<term><guilabel>Publish free/busy information</guilabel></term>
+<term><guilabel>Publish free/busy information automatically</guilabel></term>
 <listitem><para>Enable this option if you wish your Free/Busy information to be
 uploaded automatically. Note that you may skip this option and choose to mail or
 upload your Free/Busy information via the <guilabel>Schedule</guilabel> menu of
@@ -3043,7 +3043,7 @@
 </varlistentry>
 
 <varlistentry>
-<term><guilabel>Minimum time between uploads in minutes</guilabel></term>
+<term><guilabel>Minimum time between uploads (in minutes)</guilabel></term>
 <listitem><para>In case you choose to publish your information automatically,
 you may configure the interval of time in minutes between each upload.</para>
 </listitem>
@@ -3205,7 +3205,7 @@
 <itemizedlist>
 <listitem><para>The tool set is configured in the <menuchoice><guimenu>
 Settings</guimenu><guimenuitem>Configure
-Toolbars....</guimenuitem></menuchoice> menu item.
+Toolbars...</guimenuitem></menuchoice> menu item.
 </para></listitem>
 <listitem><para>The graphic style (icon size, text position, &etc;) is
 adjusted through the <guimenu>Toolbar Context Menu</guimenu>. Right click the
@@ -4001,7 +4001,7 @@
 <guimenuitem>New Sub-to-do...</guimenuitem>
 </menuchoice></term>
 <listitem><para>Choose <guilabel>New Sub-to-do...</guilabel> to <action>start
-writing a new sub-to-do. The currently selected to-do will be the the
+writing a new sub-to-do. The currently selected to-do will be the
 sub-to-do parent.</action>. Initially the to-do has no due date, but you can
 specify one.</para>
 <para>You can get a detailed description of the to-do window in <link
Index: kalarm/kalarm.h
===================================================================
--- kalarm/kalarm.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kalarm/kalarm.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -23,7 +23,7 @@
 
 #undef QT3_SUPPORT
 
-#define KALARM_VERSION "2.1.5"
+#define KALARM_VERSION "2.1.6"
 #define KALARM_NAME "KAlarm"
 #define KALARM_DBUS_SERVICE  "org.kde.kalarm"  // D-Bus service name of KAlarm application
 
Index: kalarm/mainwindow.cpp
===================================================================
--- kalarm/mainwindow.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kalarm/mainwindow.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -51,6 +51,7 @@
 #include <QDropEvent>
 #include <QResizeEvent>
 #include <QCloseEvent>
+#include <QTimer>
 
 #include <kmenubar.h>
 #include <ktoolbar.h>
@@ -518,7 +519,10 @@
 	mActionFindPrev = KStandardAction::findPrev(mListView, SLOT(slotFindPrev()), actions);
 	KStandardAction::selectAll(mListView, SLOT(selectAll()), actions);
 	KStandardAction::deselect(mListView, SLOT(clearSelection()), actions);
-	KStandardAction::quit(this, SLOT(slotQuit()), actions);
+	// Quit only once the event loop is called; otherwise, the parent window will
+	// be deleted while still processing the action, resulting in a crash.
+	KAction* act = KStandardAction::quit(0, 0, actions);
+	connect(act, SIGNAL(triggered(bool)), SLOT(slotQuit()), Qt::QueuedConnection);
 	KStandardAction::keyBindings(this, SLOT(slotConfigureKeys()), actions);
 	KStandardAction::configureToolbars(this, SLOT(slotConfigureToolbar()), actions);
 	KStandardAction::preferences(this, SLOT(slotPreferences()), actions);
@@ -1069,7 +1073,10 @@
 }
 
 /******************************************************************************
-*  Called when the Quit menu item is selected.
+* Called when the Quit menu item is selected.
+* Note that this must be called by the event loop, not directly from the menu
+* item, since otherwise the window will be deleted while still processing the
+* menu, resulting in a crash.
 */
 void MainWindow::slotQuit()
 {
@@ -1097,7 +1104,9 @@
 		{
 			// There is no system tray icon, and this is the last main
 			// window, so closing it will quit the application.
-			theApp()->doQuit(this);
+			// Quit once the close event has been processed. Deleting the
+			// window while still processing the event handler can cause a crash.
+			QTimer::singleShot(0, this, SLOT(slotDoQuit()));
 			ce->ignore();
 			return;
 		}
Index: kalarm/Changelog
===================================================================
--- kalarm/Changelog	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kalarm/Changelog	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -1,6 +1,9 @@
 KAlarm Change Log
 
-=== Version 2.1.5 --- 7 February 2009 ===
+=== Version 2.1.6 --- 4 March 2009 ===
+Fix crash when KAlarm quits.
+
+=== Version 2.1.5 (KDE 4.2.1) --- 7 February 2009 ===
 - Disable inapplicable alarm types in alarm edit dialogue Load Template list.
 - Prevent multiple identical error messages being displayed for the same alarm.
 - Fix possible crash on alarm refresh, or removal or disabling of a resource.
Index: kalarm/kalarmapp.cpp
===================================================================
--- kalarm/kalarmapp.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kalarm/kalarmapp.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -1021,7 +1021,6 @@
 void KAlarmApp::removeWindow(TrayWindow*)
 {
 	mTrayWindow = 0;
-	quitIf();
 }
 
 /******************************************************************************
Index: kalarm/resources/resourcelocaldir.cpp
===================================================================
--- kalarm/resources/resourcelocaldir.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kalarm/resources/resourcelocaldir.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -1,8 +1,8 @@
 /*
  *  resourcelocaldir.cpp  -  KAlarm local directory calendar resource
  *  Program:  kalarm
- *  Copyright © 2006-2008 by David Jarvie <djarvie@kde.org>
- *  Based on resourcelocaldir.cpp in libkcal (updated to rev 779953),
+ *  Copyright © 2006-2009 by David Jarvie <djarvie@kde.org>
+ *  Based on resourcelocaldir.cpp in libkcal (updated to rev 779953,938673,938806),
  *  Copyright (c) 2003 Cornelius Schumacher <schumacher@kde.org>
  *
  *  This program is free software; you can redistribute it and/or modify
@@ -149,6 +149,9 @@
 #ifdef __GNUC__
 #warning Only reload the individual file which has changed
 #endif
+	if (filepath.contains(QRegExp("(~|\\.new|\\.tmp)$"))
+	||  filepath.startsWith(mURL.path() + "/qt_temp."))
+		return;   // ignore backup or temporary file
 	doLoad(false);
 }
 /******************************************************************************
@@ -203,8 +206,9 @@
 		{
 			// Check the next file in the directory
 			QString id = entries[i];
-			if (id.endsWith('~'))   // backup file, ignore it
-				continue;
+			if (id.contains(QRegExp("(~|\\.new|\\.tmp)$"))
+			||  id.startsWith("qt_temp."))
+				continue;   // ignore backup or temporary file
 			QString fileName = dirName + '/' + id;
 			foundFile = true;
 
@@ -218,7 +222,6 @@
 				Event* ev = calendar()->event(id);
 				if (ev  &&  changes.indexOf(ev) < 0)
 				{
-kDebug(KARES_DEBUG) << "Loading" << id;
 					ModifiedMap::ConstIterator mit = oldLastModified.constFind(id);
 					if (mit != oldLastModified.constEnd()  &&  mit.value() == readLastModified(fileName))
 					{
@@ -367,6 +370,12 @@
 
 bool KAResourceLocalDir::doSave(bool, Incidence* incidence)
 {
+	if (mDeletedIncidences.contains(incidence))
+	{
+		mDeletedIncidences.removeAll(incidence);
+		return true;
+	}
+
 	QString id = incidence->uid();
 	QString fileName = mURL.path() + '/' + id;
 	kDebug(KARES_DEBUG) << fileName;
@@ -404,6 +413,8 @@
 	clearChange(event);
 	disableChangeNotification();    // don't record this deletion as pending
 	bool success = calendar()->deleteEvent(event);
+	if (success)
+		mDeletedIncidences.append(event);
 	enableChangeNotification();
 	return success;
 }
Index: kalarm/resources/resourcelocalwidget.cpp
===================================================================
--- kalarm/resources/resourcelocalwidget.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kalarm/resources/resourcelocalwidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -40,6 +40,7 @@
 	QLabel* label = new QLabel(i18nc("@label:textbox", "Location:"), this);
 	layout->addWidget(label, 1, 0);
 	mURL = new KUrlRequester(this);
+	mURL->setFilter(QString::fromLatin1("*.vcs *.ics|%1").arg(i18nc("@info/plain", "Calendar Files")));
 	layout->addWidget(mURL, 1, 1);
 }
 
Index: kalarm/resources/resourcelocaldir.h
===================================================================
--- kalarm/resources/resourcelocaldir.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kalarm/resources/resourcelocaldir.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -1,7 +1,7 @@
 /*
  *  resourcelocaldir.h  -  KAlarm local directory alarm calendar resource
  *  Program:  kalarm
- *  Copyright © 2006-2008 by David Jarvie <djarvie@kde.org>
+ *  Copyright © 2006-2009 by David Jarvie <djarvie@kde.org>
  *  Based on resourcelocaldir.h in libkcal,
  *  Copyright (c) 2003 Cornelius Schumacher <schumacher@kde.org>
  *
@@ -25,12 +25,13 @@
 
 /* @file resourcelocaldir.h - KAlarm local directory alarm calendar resource */
 
-#include <QMap>
+#include "alarmresource.h"
+
 #include <kurl.h>
 #include <kdirwatch.h>
+#include <QMap>
+#include <QList>
 
-#include "alarmresource.h"
-
 namespace KCal {
     class Incidence;
 }
@@ -94,6 +95,7 @@
 		KDirWatch   mDirWatch;
 		typedef QMap<QString, QDateTime> ModifiedMap;
 		ModifiedMap mLastModified;
+		QList<KCal::Incidence*> mDeletedIncidences;
 		bool        mDirReadOnly;  // directory is read-only
 };
 
Index: kalarm/resources/kalarm_manager.desktop
===================================================================
--- kalarm/resources/kalarm_manager.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kalarm/resources/kalarm_manager.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -18,6 +18,7 @@
 Name[kk]=Ескертулер
 Name[km]=ជូន​ដំណឹង
 Name[ko]=알람
+Name[lt]=Priminimai
 Name[lv]=Atgādinājumi
 Name[nb]=Varslinger
 Name[ne]=संसूचक
Index: kalarm/traywindow.h
===================================================================
--- kalarm/traywindow.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kalarm/traywindow.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -1,7 +1,7 @@
 /*
  *  traywindow.h  -  the KDE system tray applet
  *  Program:  kalarm
- *  Copyright © 2002-2008 by David Jarvie <djarvie@kde.org>
+ *  Copyright © 2002-2009 by David Jarvie <djarvie@kde.org>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -45,9 +45,6 @@
 		MainWindow*  assocMainWindow() const               { return mAssocMainWindow; }
 		void         setAssocMainWindow(MainWindow* win)   { mAssocMainWindow = win; }
 
-	public slots:
-		void         slotQuit();
-
 	signals:
 		void         deleted();
 
@@ -63,6 +60,7 @@
 		void         slotPreferences();
 		void         setEnabledStatus(bool status);
 		void         slotResourceStatusChanged();
+		void         slotQuit();
 
 	private:
 		QString      tooltipAlarmText() const;
Index: kalarm/traywindow.cpp
===================================================================
--- kalarm/traywindow.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kalarm/traywindow.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -39,6 +39,7 @@
 #include <QToolTip>
 #include <QMouseEvent>
 #include <QList>
+#include <QTimer>
 
 #include <kactioncollection.h>
 #include <ktoggleaction.h>
@@ -108,7 +109,10 @@
 	// Replace the default handler for the Quit context menu item
 	const char* quitName = KStandardAction::name(KStandardAction::Quit);
 	delete actions->action(quitName);
-	KStandardAction::quit(this, SLOT(slotQuit()), actions);
+	// Quit only once the event loop is called; otherwise, the parent tray icon
+	// will be deleted while still processing the action, resulting in a crash.
+	a = KStandardAction::quit(0, 0, actions);
+	connect(a, SIGNAL(triggered(bool)), SLOT(slotQuit()), Qt::QueuedConnection);
 
 	// Set icon to correspond with the alarms enabled menu status
 	setEnabledStatus(theApp()->alarmsEnabled());
@@ -163,6 +167,9 @@
 
 /******************************************************************************
 * Called when the Quit context menu item is selected.
+* Note that this must be called by the event loop, not directly from the menu
+* item, since otherwise the tray icon will be deleted while still processing
+* the menu, resulting in a crash.
 */
 void TrayWindow::slotQuit()
 {
Index: Mainpage.dox
===================================================================
--- Mainpage.dox	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ Mainpage.dox	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -30,8 +30,6 @@
         * - <a href="kmail/html/index.html"><b>kmail</b></a>
         *   (<a href="kmail/html/classes.html">classes</a>)\n
         *   <i>A fully-featured email client.</i>
-        * - <a href="kmobiletools/html/index.html"><b>kmobiletools</b></a>
-        *   (<a href="kmobiletools/html/classes.html">classes</a>)\n
         *   <i>An application specially designed to manage mobile phones.</i>
         * - <a href="knode/html/index.html"><b>knode</b></a>
         *   (<a href="knode/html/classes.html">classes</a>)\n
Index: kaddressbook/printing/kabentrypainter.cpp
===================================================================
--- kaddressbook/printing/kabentrypainter.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kaddressbook/printing/kabentrypainter.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -220,8 +220,10 @@
   y += fmBody.lineSpacing() / 2;
 
   painter->setPen( mForegroundColor );
-  if ( !addr.prefix().isEmpty() ) {
-    line1 = addr.prefix().trimmed();
+  // This used to be addr.prefix(), but that makes no sense, it's part of the formattedName already.
+  // The role, OTOH, can be useful. E.g. formattedName="Dr Foo Bar", role="Dentist"                 
+  if ( !addr.role().isEmpty() ) {                                                                   
+    const QString line1 = addr.role().trimmed();                                                    
 
     if ( fake ) {
       rect = painter->boundingRect( Ruler1, y, Width-Ruler1, Height,
Index: kaddressbook/printing/detailledstyle.cpp
===================================================================
--- kaddressbook/printing/detailledstyle.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kaddressbook/printing/detailledstyle.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -215,7 +215,6 @@
 
   QPrinter *printer = wizard()->printer();
 
-  QPainter painter;
   progress->addMessage( i18n( "Setting up margins and spacing" ) );
   int marginTop = 0,
       marginLeft = 64, // to allow stapling, need refinement with two-side prints
@@ -224,15 +223,14 @@
 
   register int left, top, width, height;
 
-  painter.begin( printer );
-  printer->setFullPage( true ); // use whole page
+  QPainter painter( printer );
 
-
-  left = qMax( printer->paperRect().left() - printer->pageRect().left(), marginLeft );
-  top = qMax( printer->paperRect().top() - printer->pageRect().top(), marginTop );
+  left = qMax( printer->pageRect().left() - printer->paperRect().left(), marginLeft );
+  top = qMax( printer->pageRect().top() - printer->paperRect().top(), marginTop );
   width = printer->width() - left - qMax( printer->paperRect().right() - printer->pageRect().right(), marginRight );
   height = printer->height() - top - qMax( printer->paperRect().bottom() - printer->pageRect().bottom(), marginBottom );
 
+  printer->setFullPage( true ); // use whole page
   painter.setViewport( left, top, width, height );
   progress->addMessage( i18n( "Printing" ) );
 
@@ -240,7 +238,6 @@
                 QRect( 0, 0, printer->width(), printer->height() ) );
 
   progress->addMessage( i18n( "Done" ) );
-  painter.end();
 
   config.sync();
 }
Index: kaddressbook/xxport/vcard_xxport.desktop
===================================================================
--- kaddressbook/xxport/vcard_xxport.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kaddressbook/xxport/vcard_xxport.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -30,7 +30,7 @@
 Name[lt]=KAB vCard XXPort priedas
 Name[lv]=KAB vCard XXPort spraudnis
 Name[ms]=Plugin KAB vCard XXPort 
-Name[nb]=KAB-programtillegg for vCard
+Name[nb]=KAB-programtillegg for vCard XXPort
 Name[nds]=vCard-Im-/Exportmoduul för KAdressbook
 Name[ne]=KAB भीकार्ड XXPort प्लगइन
 Name[nl]=KAB vCard XXPort-plugin
Index: kaddressbook/xxport/pab_xxport.desktop
===================================================================
--- kaddressbook/xxport/pab_xxport.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kaddressbook/xxport/pab_xxport.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -27,7 +27,7 @@
 Name[lt]=KAB MS Exchange asmeninės adresų knygelės XXPort priedas
 Name[lv]=KAB MS Exchange personīgo adrešu grāmatu XXPort spraudnis
 Name[ms]=Plugin Buku Alamat Peribadi KAB MS Exchange  XXPort Plugin
-Name[nb]=KAB-programtillegg for import fra MS Exchange
+Name[nb]=KAB-programtillegg for import fra MS Exchange XXPort personlig adressebok
 Name[nds]=MSExchange-Importmoduul för KAdressbook
 Name[ne]=KAB MS विनिमय व्यक्तिगत ठेगाना पुस्तिका XXPort प्लगइन
 Name[nl]=KAB MS Exchange Personal Addressbook XXPort-plugin
Index: kaddressbook/editors/cryptosettings.desktop
===================================================================
--- kaddressbook/editors/cryptosettings.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kaddressbook/editors/cryptosettings.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -7,7 +7,7 @@
 Name[ca]=Preferències de criptografia
 Name[cs]=Nastavení šifrování
 Name[da]=Krypto-indstillinger
-Name[de]=Kryptographie-Einstellungen
+Name[de]=Kryptografie-Einstellungen
 Name[el]=Προτιμήσεις κρυπτογραφίας
 Name[eo]=Agordoj pri Ĉifrado
 Name[es]=Preferencias de cifrado
Index: CMakeLists.txt
===================================================================
--- CMakeLists.txt	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ CMakeLists.txt	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -89,15 +89,6 @@
     macro_log_feature(X11_Xscreensaver_FOUND "X11 screensaver extension" "X Window Screen Saver Development Library" "http://xorg.freedesktop.org" FALSE "" "Required for building the KTimeTracker Program")
   endif(X11_FOUND)
 
-# uncomment the following block for 4.3 in order to enable kitchensync
-#  if (NOT WIN32)
-#     set(OPENSYNC_MIN_VERSION 0.38)
-#     macro_optional_find_package(OpenSync)
-#     macro_log_feature(OPENSYNC_FOUND "opensync" "OpenSync Development Libraries" "http://www.opensync.org" FALSE "0.38 or greater" "Needed to provide syncing functionality in KDE PIM applications. Necessary to compile kitchensync.")
-#     macro_optional_find_package(GLIB2)
-#     macro_log_feature(GLIB2_FOUND "glib2" "Low-level core library for data structure handling, portability wrappers, etc." "http://www.gtk.org" FALSE "2.x" "Needed to provide synching applications from KDE PIM applications. Necessary to compile kitchensync and other PIM applications.")
-#  endif (NOT WIN32)
-
   macro_optional_find_package(GNOKII)
   macro_bool_to_01(GNOKII_FOUND HAVE_GNOKII_H)
   macro_log_feature(GNOKII_FOUND "gnokii" "Gnokii Development Libraries" "http://www.gnokii.org" FALSE "" "Needed to provide the ability to import and export KDE addressbook entries to/from mobile phones that are accessible via gnokii")
@@ -219,43 +210,15 @@
   endif(KMAIL_SUPPORTED)
 
   if(NOT WIN32)
-#enable kmobiletools 4.3 if there is interest
-#     set(KMOBILETOOLS_SUPPORTED TRUE)
-#     add_definitions(-DKMOBILETOOLS_SUPPORTED)
-#     message(STATUS "KMobileTools support enabled.")
-#     macro_optional_add_subdirectory(kmobiletools)
-      set(KMOBILETOOLS_SUPPORTED FALSE)
-
      set(KPILOT_SUPPORTED TRUE)
      add_definitions(-DKPILOT_SUPPORTED)
      message(STATUS "KPilot support enabled.")
      macro_optional_add_subdirectory(kpilot)
-
-     if(OPENSYNC_FOUND AND GLIB2_FOUND)
-       set(KITCHENSYNC_SUPPORTED TRUE)
-       add_definitions(-DKITCHENSYNC_SUPPORTED)
-       message(STATUS "KitchenSync support enabled.")
-       macro_optional_add_subdirectory(kitchensync)
-     else(OPENSYNC_FOUND AND GLIB2_FOUND)
-       set(KITCHENSYNC_SUPPORTED FALSE)
-       if(NOT OPENSYNC_FOUND)
-         message(STATUS "KitchenSync support disabled (OpenSync not found).")
-       endif(NOT OPENSYNC_FOUND)
-       if(NOT GLIB2_FOUND)
-         message(STATUS "KitchenSync support disabled (GLIB not found).")
-       endif(NOT GLIB2_FOUND)
-     endif(OPENSYNC_FOUND AND GLIB2_FOUND)
   else(NOT WIN32)
-     set(KMOBILETOOLS_SUPPORTED FALSE)
-     message(STATUS "KMobileTools support DISABLED (Windows target).")
      set(KPILOT_SUPPORTED FALSE)
      message(STATUS "KPilot support DISABLED (Windows target).")
-     set(KITCHENSYNC_SUPPORTED FALSE)
-     message(STATUS "KitchenSync support DISABLED (Windows target).")
   endif(NOT WIN32)
 
-#enable korn in 4.3 if there is interest
-# macro_optional_add_subdirectory(korn)
   add_subdirectory(kresources)
   macro_optional_add_subdirectory(kontact)
 
Index: libkholidays/holidays/holiday_se
===================================================================
--- libkholidays/holidays/holiday_se	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ libkholidays/holidays/holiday_se	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -23,8 +23,8 @@
 :Before 2005
 :black "Nationaldagen" black on 6.6
 weekend "Nationaldagen" weekend on 6.6
-black "Midsommarafton" black on friday before 26.6
-weekend "Midsommardagen" weekend on saturday before 27.6
+black "Midsommarafton" black on friday before 25.6
+weekend "Midsommardagen" weekend on saturday before 26.6
 blue "Vintertid" on last sunday in october
 weekend "Alla helgons dag" weekend on first sunday in november minus 1
 black "1. Advent" on sunday before 24.12 minus 21 days
Index: ktimetracker/timetrackerwidget.cpp
===================================================================
--- ktimetracker/timetrackerwidget.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ ktimetracker/timetrackerwidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -692,6 +692,7 @@
   dialog->addPage( storagePage, i18n( "Storage" ), "system-file-manager" );
 
   dialog->exec();
+  delete dialog;
   showSearchBar( !KTimeTrackerSettings::configPDA() );
   reconfigureFiles();
 }
Index: ktimetracker/kcmconfigs/ktimetrackerconfig.desktop
===================================================================
--- ktimetracker/kcmconfigs/ktimetrackerconfig.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ ktimetracker/kcmconfigs/ktimetrackerconfig.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -35,7 +35,7 @@
 Comment[ko]=KTimeTracker 설정
 Comment[lt]=Konfigūruoti ktimetracker
 Comment[lv]=Konfigurēt ktimetracker
-Comment[nb]=Oppsett for ktimettracker
+Comment[nb]=Oppsett for ktimetracker
 Comment[nds]=Tietlogbook instellen
 Comment[nl]=KTimeTracker instellen
 Comment[nn]=Set opp KTidtakar
Index: kjots/Kjots.desktop
===================================================================
--- kjots/Kjots.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kjots/Kjots.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -20,7 +20,7 @@
 GenericName[ja]=メモ帳
 GenericName[km]=កម្មវិធី​ទទួល​ចំណាំ
 GenericName[ko]=메모장
-GenericName[lt]=Pastabų gavėjas
+GenericName[lt]=Konspektavimo įrankis
 GenericName[lv]=Piezīmju blociņš
 GenericName[nb]=Notisblokk
 GenericName[nds]=Notizenprogramm
Index: kjots/kjotspart.desktop
===================================================================
--- kjots/kjotspart.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kjots/kjotspart.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -1,5 +1,6 @@
 [Desktop Entry]
 Name=KJotsPart
+Name[lt]=KJots dalis
 Name[nn]=KJots-del
 Name[pa]=ਕੇਜੋਟਸਪਾਰਟ
 Name[pl]=Moduł Notatek
Index: README
===================================================================
--- README	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ README	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -22,7 +22,6 @@
 * kaddressbook: The KDE addressbook application.
 * kmail: the KDE mail client
 * kmailcvt: tool for importing mail related data from other programs
-* kmobiletools: an application specially designed to manage mobile phones
 * knode: UseNet client
 * korganizer: a calendar-of-events, todo-list manager, journal 
 * kalarm: gui for setting up personal alarm messages, emails and commands
@@ -33,7 +32,6 @@
 * kfile-plugins: vCard KFIleItem plugin.
 * knotes: yellow notes application
 * konsolekalendar: Command line tool for accessing calendar files.
-* korn: mail checker
 * akregator: Feed reader
 * kjots: manager for several "books" with a subject and notes
 
Index: libkdepim/utils.cpp
===================================================================
--- libkdepim/utils.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ libkdepim/utils.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -57,7 +57,7 @@
 
 static PPERF_INSTANCE_DEFINITION NextInstance( PPERF_INSTANCE_DEFINITION PerfInst )
 {
-  PPERF_COUNTER_BLOCK PerfCntrBlk 
+  PPERF_COUNTER_BLOCK PerfCntrBlk
     = (PPERF_COUNTER_BLOCK)((PBYTE)PerfInst + PerfInst->ByteLength);
   return (PPERF_INSTANCE_DEFINITION)((PBYTE)PerfCntrBlk + PerfCntrBlk->ByteLength);
 }
@@ -110,6 +110,7 @@
 
   // Get the first object type.
   perfObject = FirstObject( perfData );
+  if ( !perfObject ) return;
 
   // Process all objects.
   for( uint i = 0; i < perfData->NumObjectTypes; i++ ) {
@@ -124,7 +125,7 @@
     qDebug() << "INSTANCES: " << perfObject->NumInstances;
     for( int instance = 0; instance < perfObject->NumInstances; instance++ ) {
       curCounter = perfCounter;
-      const QString foundProcessName( 
+      const QString foundProcessName(
         fromWChar( (wchar_t *)( (PBYTE)perfInstance + perfInstance->NameOffset ) ) );
       qDebug() << "foundProcessName: " << foundProcessName;
       if ( foundProcessName == processName ) {
Index: kpilot/Messages.sh
===================================================================
--- kpilot/Messages.sh	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kpilot/Messages.sh	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -1,2 +1,3 @@
 #! /usr/bin/env bash
+$EXTRACTRC `find . -name \*.rc -o -name \*.ui -o -name \*.kcfg` >> rc.cpp
 $XGETTEXT `find . -name \*.cc -o -name \*.cpp -o -name \*.h` -o $podir/kpilot.pot
Index: kpilot/conduits/notepadconduit/notepad-conduit.desktop
===================================================================
--- kpilot/conduits/notepadconduit/notepad-conduit.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kpilot/conduits/notepadconduit/notepad-conduit.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -47,7 +47,7 @@
 Comment[lt]=Šis kanalas padaro NotePad piešinių atsargines kopijas į vietinį aplanką.
 Comment[lv]=Šī ķēde saglabā piezīmju zīmējumu rezerves kopijas datora mapē.
 Comment[ms]=Saluran ini menyandarkan lukisan NotePad ke folder setempat.
-Comment[nb]=Denne kanalen tar sikkerhetskopi av NotePad tegninger til en lokal mappe.
+Comment[nb]=Denne koblingen tar sikkerhetskopi av NotePad tegninger til en lokal mappe.
 Comment[nds]=Sekert NotePad-Teken binnen en lokaal Orner.
 Comment[ne]=यो कन्ड्युटले स्थानीय फाइलमा नोटप्याड रेखाचित्र ब्याकअप गर्छ ।
 Comment[nl]=Dit conduit maakt een backup van de notitie-aantekeningen naar een lokale map.
Index: kpilot/conduits/sysinfoconduit/sysinfo_conduit.desktop
===================================================================
--- kpilot/conduits/sysinfoconduit/sysinfo_conduit.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kpilot/conduits/sysinfoconduit/sysinfo_conduit.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -26,7 +26,7 @@
 Comment[lt]=Šis kanalas įrašo informaciją apie Jūsų delninuką ir sinchronizavimą į failą.
 Comment[lv]=Šī ķēde ieraksta failā informācijau par jūsu pārnēsājamo ierīci un tās sinhronizāciju.
 Comment[ms]=Saluran ini menulis maklumat tentang komputer telapak dan segerakan ke fail.
-Comment[nb]=Denne kanalen skriver informasjon om hånddatoren og synkroniseringen til en fil.
+Comment[nb]=Denne koblingen skriver informasjon om hånddatoren og synkroniseringen til en fil.
 Comment[nds]=De Kanaal schrifft Informatschonen över den Handreekner un de Synkroniseren na en Datei.
 Comment[ne]=यो कन्ड्युटले ह्यान्डहेल्ड बारेमा सूचना लेख्दछ र फाइलमा समक्रमण गर्दछ ।
 Comment[nl]=Dit conduit slaat informatie over uw handheld en de synchronisatie op in een bestand.
Index: kpilot/conduits/memofileconduit/memofile-conduit.desktop
===================================================================
--- kpilot/conduits/memofileconduit/memofile-conduit.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kpilot/conduits/memofileconduit/memofile-conduit.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -74,7 +74,7 @@
 Comment[lt]=Šis kanalas sinchronizuoja Jūsų užrašus su vietiniu aplanku.
 Comment[lv]=Šī ķēde sinhronizē jūsu rokas datora piezīmes ar mapi datorā.
 Comment[ms]=Saluran ini mensegerakkan memo komputer telapak anda dengan direktori setempat.
-Comment[nb]=Denne kanalen synkroniserer hånddatorens notater med en lokal mappe.
+Comment[nb]=Denne koblingen synkroniserer hånddatorens notater med en lokal mappe.
 Comment[nds]=Synkroniseert de Notizen op den Handreekner mit en lokaal Orner.
 Comment[ne]=यो कन्ड्युटले स्थानीय डाइरेक्टरीमा तपाईँका ह्यान्डहेल्ड मेमो समक्रमण गर्दछ ।
 Comment[nl]=Dit conduit synchroniseert de memo's van uw handheld met een lokale map.
Index: kpilot/conduits/timeconduit/time_conduit.desktop
===================================================================
--- kpilot/conduits/timeconduit/time_conduit.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kpilot/conduits/timeconduit/time_conduit.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -29,7 +29,7 @@
 Comment[lv]=Šī ķēde uzstāda jūsu rokas datora pulksteni, izmantojot datora pulksteni.
 Comment[mk]=Овој канал го поставува времето на рачниот уред според времето на компјутерот.
 Comment[ms]=Saluran ini mengeset waktu pada komputer telapak anda dari jam PC.
-Comment[nb]=Denne kanalen stiller klokka på hånddatoren fra PC-klokka.
+Comment[nb]=Denne koblingen stiller klokka på hånddatoren fra PC-klokka.
 Comment[nds]=Synkroniseert stellt Handreekner-Klock na de PC-Klock.
 Comment[ne]=यो कन्ड्युटले पीसी घडीबाट ह्यान्डहेल्डमा समय सेट गर्दछ ।
 Comment[nl]=Dit conduit stelt de tijd van uw handheld in aan de hand van de pc-klok.
Index: kpilot/conduits/memofile/kpilot-conduit-memofile.desktop
===================================================================
--- kpilot/conduits/memofile/kpilot-conduit-memofile.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kpilot/conduits/memofile/kpilot-conduit-memofile.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -74,7 +74,7 @@
 Comment[lt]=Šis kanalas sinchronizuoja Jūsų užrašus su vietiniu aplanku.
 Comment[lv]=Šī ķēde sinhronizē jūsu rokas datora piezīmes ar mapi datorā.
 Comment[ms]=Saluran ini mensegerakkan memo komputer telapak anda dengan direktori setempat.
-Comment[nb]=Denne kanalen synkroniserer hånddatorens notater med en lokal mappe.
+Comment[nb]=Denne koblingen synkroniserer hånddatorens notater med en lokal mappe.
 Comment[nds]=Synkroniseert de Notizen op den Handreekner mit en lokaal Orner.
 Comment[ne]=यो कन्ड्युटले स्थानीय डाइरेक्टरीमा तपाईँका ह्यान्डहेल्ड मेमो समक्रमण गर्दछ ।
 Comment[nl]=Dit conduit synchroniseert de memo's van uw handheld met een lokale map.
Index: kpilot/conduits/keyringconduit/kpilot-conduit-keyring.desktop
===================================================================
--- kpilot/conduits/keyringconduit/kpilot-conduit-keyring.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kpilot/conduits/keyringconduit/kpilot-conduit-keyring.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -15,7 +15,7 @@
 Comment[km]=conduit syncs នេះ​មូលដ្ឋាន​ទិន្នន័យ keyring របស់​ឧបករណ៍​យួរដៃ​ជា​មួយ​មូលដ្ឋាន​ទិន្នន័យ​ដែល​បាន​ផ្ទុក​នៅ​ក្នុង​កុំព្យូទ័រ ។
 Comment[lt]=Šis kanalas sinchronizuoja delninuko raktų rato duomenų bazę su duomenų baze, esančia pc.
 Comment[lv]=Šī ķēde sinhronizē jūsu rokas datora un datora atslēgu saišķi.
-Comment[nb]=Denne kanalen synkroniserer hånddatorens nøkkelring-database med en database lagret på maskinen.
+Comment[nb]=Denne koblingen synkroniserer hånddatorens nøkkelring-database med en database lagret på maskinen.
 Comment[nds]=Disse Kanaal synkroniseert dat Slötelbund op den Handreekner mit een op den Reekner.
 Comment[nl]=Dit conduit synchroniseert de sleuteldatabase op de handheld met de database op uw PC.
 Comment[nn]=Denne koplinga synkroniserer den handhaldne nøkkelringdatabasen med ein database lagra på maskina.
Index: kpilot/conduits/todo/kpilot-conduit-todo.desktop
===================================================================
--- kpilot/conduits/todo/kpilot-conduit-todo.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kpilot/conduits/todo/kpilot-conduit-todo.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -13,7 +13,7 @@
 Comment[ja]=このコンジットはハンドヘルドの To-Do データベースを Akonadi の To-Do コレクションと同期させます。
 Comment[km]=conduit syncs នេះ​ជា​មូលដ្ឋាន​ទិន្នន័យ​ការងារ​ត្រូវ​ធ្វើ​ជា​មួយ​នឹង​ការ​ប្រមូលផ្ដុំ​ការងារ​ត្រូវ​ធ្វើ​របស់ Akonadi ។
 Comment[lv]=Šī ķēde sinhronizē jūsu rokas datora darāmo darbu sarakstu ar Akonadi darbu kolekciju.
-Comment[nb]=Denne kanalen synkroniserer hånddatorens  gjøremål-database med en Akonadi gjøremålssamling.
+Comment[nb]=Denne koblingen synkroniserer hånddatorens  gjøremål-database med en Akonadi gjøremålssamling.
 Comment[nds]=Disse Kanaal synkroniseert de Handreekner-Opgavenlist mit en Akonadi-Opgavenlist.
 Comment[nl]=Dit conduit synchroniseert de takendatabase op de handheld met een Akonadi-takenverzameling.
 Comment[nn]=Denne koplinga synkroniserer den handhaldne hugselistedatabasen med ei Akonadi-hugselistesamling.
@@ -42,6 +42,7 @@
 Name[ja]=To-Do
 Name[km]=​ការងារ​ត្រូវ​ធ្វើ
 Name[ko]=할 일
+Name[lt]=Darbas
 Name[lv]=Darbi
 Name[nb]=Gjøremål
 Name[nds]=Opgaav
Index: kpilot/conduits/calendar/calendarconduit.cc
===================================================================
--- kpilot/conduits/calendar/calendarconduit.cc	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kpilot/conduits/calendar/calendarconduit.cc	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -205,6 +205,11 @@
 			}
 			else
 			{
+				// Events that end at midnight cause problems
+				// (http://bugs.kde.org/show_bug.cgi?id=183631); however, events with
+				// no time associated with them are stored as beginning and ending
+				// at midnight on the same day, and these are OK.  Other events that end at
+				// midnight will need to be adjusted.
 				QDateTime hhDtEnd = hhEntry.dtEnd();
 				QDateTime hhDtStart = hhEntry.dtStart();
 				QDateTime pcDtEnd = pcEvent->dtEnd().dateTime().toLocalTime();
Index: kpilot/conduits/null/null-conduit.desktop
===================================================================
--- kpilot/conduits/null/null-conduit.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kpilot/conduits/null/null-conduit.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -43,7 +43,7 @@
 Comment[lv]=Šī ķēde nedara neko.
 Comment[mk]=Овој канал не прави ништо.
 Comment[ms]=Saluran ini tidak berbuat apa-apa.
-Comment[nb]=Denne kanalen gjør ingenting.
+Comment[nb]=Denne koblingen gjør ingenting.
 Comment[nds]=Disse Kanaal deit gor nix.
 Comment[ne]=यो कन्ड्युटले केही पनि गर्दैन ।
 Comment[nl]=Dit conduit doet niets.
Index: kpilot/conduits/contacts/kpilot-conduit-contacts.desktop
===================================================================
--- kpilot/conduits/contacts/kpilot-conduit-contacts.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kpilot/conduits/contacts/kpilot-conduit-contacts.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -14,7 +14,7 @@
 Comment[ja]=このコンジットはハンドヘルドのアドレス帳データベースを Akonadi のコレクションと同期させます。
 Comment[km]=conduit syncs នេះ​ជា​មូលដ្ឋាន​​សៀវភៅ​អាសយដ្ឋាន​ឧបករណ៍​​​យួរដៃ​ដែល​មាន​បណ្ដុំ Akonadi ។
 Comment[lv]=Šī ķēde sinhronizē jūsu rokas datora adrešu grāmatu ar Akonadi kolekciju.
-Comment[nb]=Denne kanalen synkroniserer hånddatorens adressebok-database med en Akonadi-samling.
+Comment[nb]=Denne koblingen synkroniserer hånddatorens adressebok-database med en Akonadi-samling.
 Comment[nds]=Disse Kanaal synkroniseert dat Handreekner-Adressbook mit en Akonadi-Sammeln.
 Comment[nl]=Dit conduit synchroniseert de adresboekdatabase op de handheld met eenAkonadi-verzameling.
 Comment[nn]=Denne koplinga synkroniserer den handhaldne adressedatabasen med ei Akonadi-samling.
Index: kpilot/kpilot/kpilotconduit.desktop
===================================================================
--- kpilot/kpilot/kpilotconduit.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kpilot/kpilot/kpilotconduit.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -31,7 +31,7 @@
 Comment[lv]=KPilot ķēde
 Comment[mk]=Канал за КПилот
 Comment[ms]=Saluran KPilot 
-Comment[nb]=KPilot-kanal
+Comment[nb]=KPilot-kobling
 Comment[nds]=KPilot-Kanaal (Synkroniseren)
 Comment[ne]=केडीई पाइलट कन्ड्युट
 Comment[nn]=KPilot-kopling
Index: kpilot/Documentation/base-conduit-template/kpilot-conduit-contacts.desktop
===================================================================
--- kpilot/Documentation/base-conduit-template/kpilot-conduit-contacts.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kpilot/Documentation/base-conduit-template/kpilot-conduit-contacts.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -15,7 +15,7 @@
 Comment[km]=conduit syncs នេះ​មូលដ្ឋាន​ទិន្នន័យ keyring របស់​ឧបករណ៍​យួរដៃ​ជា​មួយ​មូលដ្ឋាន​ទិន្នន័យ​ដែល​បាន​ផ្ទុក​នៅ​ក្នុង​កុំព្យូទ័រ ។
 Comment[lt]=Šis kanalas sinchronizuoja delninuko raktų rato duomenų bazę su duomenų baze, esančia pc.
 Comment[lv]=Šī ķēde sinhronizē jūsu rokas datora un datora atslēgu saišķi.
-Comment[nb]=Denne kanalen synkroniserer hånddatorens nøkkelring-database med en database lagret på maskinen.
+Comment[nb]=Denne koblingen synkroniserer hånddatorens nøkkelring-database med en database lagret på maskinen.
 Comment[nds]=Disse Kanaal synkroniseert dat Slötelbund op den Handreekner mit een op den Reekner.
 Comment[nl]=Dit conduit synchroniseert de sleuteldatabase op de handheld met de database op uw PC.
 Comment[nn]=Denne koplinga synkroniserer den handhaldne nøkkelringdatabasen med ein database lagra på maskina.
Index: kpilot/Documentation/base-conduit-template/contacts-conduit.desktop
===================================================================
--- kpilot/Documentation/base-conduit-template/contacts-conduit.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kpilot/Documentation/base-conduit-template/contacts-conduit.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -14,7 +14,7 @@
 Comment[ja]=このコンジットはハンドヘルドのアドレス帳を PC のデータベースと同期させます。
 Comment[km]=conduit syncs នេះ​ជា​សៀវភៅ​អាសយដ្ឋាន​ដែល​មាន​ទិន្នន័យ​បាន​ផ្ទុក​នៅ​ក្នុង​កុំព្យូទ័រ ។
 Comment[lv]=Šī ķēde sinhronizē jūsu rokas datora un datora adrešu grāmatu.
-Comment[nb]=Denne kanalen synkroniserer hånddatorens adressebok med en database lagret på PC-en.
+Comment[nb]=Denne koblingen synkroniserer hånddatorens adressebok med en database lagret på PC-en.
 Comment[nds]=Disse Kanaal synkroniseert dat Adressbook op den Handreekner mit een op den Reekner.
 Comment[nl]=Dit conduit synchroniseert het adresboek op de handheld met de database op uw PC.
 Comment[nn]=Denne koplinga synkroniserer den handhaldne adresseboka med ein database lagra på maskina.
Index: kontact/plugins/akregator/akregator.setdlg
===================================================================
--- kontact/plugins/akregator/akregator.setdlg	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/akregator/akregator.setdlg	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -66,6 +66,7 @@
 Comment[ja]=フィードリーダー
 Comment[km]=កម្មវិធី​អាន​មតិព័ត៌មាន
 Comment[ko]=피드 리더
+Comment[lt]=Kanalų skaitytuvė
 Comment[lv]=Ziņu lasītājs
 Comment[nb]=Kildeleser
 Comment[nds]=Mellenstroom-Kieker
Index: kontact/plugins/planner/planner.setdlg
===================================================================
--- kontact/plugins/planner/planner.setdlg	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/planner/planner.setdlg	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -12,6 +12,7 @@
 Name[ja]=スケジュール帳
 Name[km]=កម្មវិធីធ្វើ​គម្រោង
 Name[ko]=플래너
+Name[lt]=Planuoklis
 Name[lv]=Plānotājs
 Name[nb]=Planlegger
 Name[nn]=Planleggjar
@@ -41,6 +42,7 @@
 Comment[ja]=スケジュール帳の要約
 Comment[km]=សេចក្ដី​សង្ខេប​របស់​កម្មវិធីធ្វើ​គម្រោង
 Comment[ko]=플래너 요약
+Comment[lt]=Planuoklio santrauka
 Comment[lv]=Plānotāja kopsavilkums
 Comment[nb]=Planlegger-aammendrag
 Comment[nds]=Planer-Översicht
Index: kontact/plugins/planner/kcmplanner.desktop
===================================================================
--- kontact/plugins/planner/kcmplanner.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/planner/kcmplanner.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -24,6 +24,7 @@
 Name[ja]=スケジュール帳
 Name[km]=កម្មវិធីធ្វើ​គម្រោង
 Name[ko]=플래너
+Name[lt]=Planuoklis
 Name[lv]=Plānotājs
 Name[nb]=Planlegger
 Name[nn]=Planleggjar
@@ -53,6 +54,7 @@
 Comment[ja]=スケジュール帳の設定
 Comment[km]=កា​ររៀបចំ​កម្មវិធី​ធ្វើ​គម្រោង
 Comment[ko]=플래너 설정
+Comment[lt]=Planuoklio nustatymai
 Comment[lv]=Plānotāja iestatījumi
 Comment[nb]=Planlegger-oppsett
 Comment[nds]=Planner inrichten
Index: kontact/plugins/planner/plannerplugin.desktop
===================================================================
--- kontact/plugins/planner/plannerplugin.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/planner/plannerplugin.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -26,6 +26,7 @@
 Name[ja]=スケジュール帳
 Name[km]=កម្មវិធីធ្វើ​គម្រោង
 Name[ko]=플래너
+Name[lt]=Planuoklis
 Name[lv]=Plānotājs
 Name[nb]=Planlegger
 Name[nn]=Planleggjar
@@ -55,6 +56,7 @@
 Comment[ja]=スケジュール帳プラグイン
 Comment[km]=កម្មវិធី​ជំនួយ​​របស់​កម្មវិធី​ធ្វើ​គម្រោង
 Comment[ko]=플래너 플러그인
+Comment[lt]=Planuoklio priedas
 Comment[lv]=Plānotāja spraudnis
 Comment[nb]=Planlegger-programtillegg
 Comment[nds]=Planner-Moduul
Index: kontact/plugins/knode/knode.setdlg
===================================================================
--- kontact/plugins/knode/knode.setdlg	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/knode/knode.setdlg	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -24,6 +24,7 @@
 Comment[kk]=Пошта компоненті
 Comment[km]=មាសភាគ​របស់ Usenet
 Comment[ko]=유즈넷 구성 요소
+Comment[lt]=Usenet komponentas
 Comment[lv]=Usenet komponente
 Comment[nb]=Usenet-komponent
 Comment[nds]=Usenet-Komponent
Index: kontact/plugins/specialdates/kcmsdsummary.desktop
===================================================================
--- kontact/plugins/specialdates/kcmsdsummary.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/specialdates/kcmsdsummary.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -30,6 +30,7 @@
 Name[kk]=Болашақ ерекше күндер
 Name[km]=កាលបរិច្ឆេទ​ពិសេស​ដែលនឹង​កើត​ឡើង
 Name[ko]=다가오는 기념일
+Name[lt]=Artėjančios ypatingos datos
 Name[lv]=Gaidāmie īpašie datumi
 Name[nb]=Kommende spesielle datoer
 Name[nds]=Anstahn besünner Daag
@@ -68,6 +69,7 @@
 Comment[kk]=Болашақ ерекше күндер тұжырымының баптау
 Comment[km]=ការ​រៀបចំ​សេចក្ដី​សង្ខេប​កាលបរិច្ឆេទ​ពិសេស​ដែល​នឹង​កើតឡើង
 Comment[ko]=다가오는 기념일 요약 설정
+Comment[lt]=Artėjančių ypatingų datų santraukos sąranka
 Comment[lv]=Gaidāmo īpašo datumu kopsavilkuma iestatījumi
 Comment[nb]=Sammendragsoppsett for kommende spesielle datoer
 Comment[nds]=De Översicht för anstahn besünner Daten instellen
Index: kontact/plugins/kmobiletools/kmobiletools.setdlg
===================================================================
--- kontact/plugins/kmobiletools/kmobiletools.setdlg	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/kmobiletools/kmobiletools.setdlg	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -16,6 +16,7 @@
 Name[ja]=携帯電話
 Name[km]=ទូរស័ព្ទ​ចល័ត
 Name[ko]=휴대폰
+Name[lt]=Mobilieji telefonai
 Name[lv]=Mobilie telefoni
 Name[nb]=Mobiltelefoner
 Name[nds]=Mobiltelefonen
@@ -50,6 +51,7 @@
 Comment[ja]=携帯電話コンポーネント
 Comment[km]=សមាសភាគ​ទូរស័ព្ទ​ចល័ត
 Comment[ko]=휴대폰 구성 요소
+Comment[lt]=Mobilaus telefono komponentas
 Comment[lv]=Mobilo telefonu komponente
 Comment[nb]=Mobiltelefonkomponent
 Comment[nds]=Mobiltelefoon-Komponent
Index: kontact/plugins/kmobiletools/kmobiletools.desktop
===================================================================
--- kontact/plugins/kmobiletools/kmobiletools.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/kmobiletools/kmobiletools.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -27,6 +27,7 @@
 Comment[ja]=KMobileTools プラグイン
 Comment[km]=កម្មវិធី​ជំនួយ​របស់ KMmobileTools
 Comment[ko]=KMobileTools 플러그인
+Comment[lt]=KMobileTools priedas
 Comment[lv]=KMobileTools spraudnis
 Comment[nb]=KMobileTools programtillegg
 Comment[nds]=KMobileTools-Moduul
@@ -60,6 +61,7 @@
 Name[ja]=携帯電話
 Name[km]=ទូរស័ព្ទ​ចល័ត
 Name[ko]=휴대폰
+Name[lt]=Mobilieji telefonai
 Name[lv]=Mobilie telefoni
 Name[nb]=Mobiltelefoner
 Name[nds]=Mobiltelefonen
Index: kontact/plugins/knotes/knotes_part.h
===================================================================
--- kontact/plugins/knotes/knotes_part.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/knotes/knotes_part.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -92,6 +92,7 @@
 
     KNotesResourceManager *mManager;
     Q3Dict<KNotesIconViewItem> mNoteList;
+    QString mOldName;
 };
 
 #endif
Index: kontact/plugins/knotes/knotes.setdlg
===================================================================
--- kontact/plugins/knotes/knotes.setdlg	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/knotes/knotes.setdlg	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -14,6 +14,7 @@
 Name[ja]=ポップアップメモ
 Name[km]=ចំណាំ​លេច​ឡើង
 Name[ko]=팝업 노트
+Name[lt]=Lipnūs lapeliai
 Name[lv]=Piezīmju lapiņas
 Name[nb]=Sprettopp-notater
 Name[nds]=Opduk-Notizen
@@ -48,6 +49,7 @@
 Comment[ja]=ポップアップメモコンポーネント
 Comment[km]=សមាសភាគ​ចំណាំលេចឡើង​
 Comment[ko]=팝업 노트 구성 요소
+Comment[lt]=Lipnių lapelių komponentas
 Comment[lv]=Piezīmju lapiņu komponente
 Comment[nb]=Komponent for sprettoppnotater
 Comment[nds]=Opduknotiz-Komponent
Index: kontact/plugins/knotes/knotes_part.cpp
===================================================================
--- kontact/plugins/knotes/knotes_part.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/knotes/knotes_part.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -382,12 +382,14 @@
 
 void KNotesPart::renameNote()
 {
+  mOldName = mNotesView->currentItem()->text();
   mNotesView->currentItem()->rename();
 }
 
 void KNotesPart::renamedNote( Q3IconViewItem * )
 {
-  mManager->save();
+  if ( mOldName != mNotesView->currentItem()->text() )
+    mManager->save();
 }
 
 void KNotesPart::slotOnCurrentChanged( Q3IconViewItem * )
Index: kontact/plugins/knotes/knotesplugin.desktop
===================================================================
--- kontact/plugins/knotes/knotesplugin.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/knotes/knotesplugin.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -84,6 +84,7 @@
 Name[ja]=ポップアップメモ
 Name[km]=ចំណាំ​លេច​ឡើង
 Name[ko]=팝업 노트
+Name[lt]=Lipnūs lapeliai
 Name[lv]=Piezīmju lapiņas
 Name[nb]=Sprettopp-notater
 Name[nds]=Opduk-Notizen
Index: kontact/plugins/knotes/knotes_part_p.h
===================================================================
--- kontact/plugins/knotes/knotes_part_p.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/knotes/knotes_part_p.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -155,7 +155,7 @@
       hbl->addWidget( mTitleEdit, 1, Qt::AlignVCenter );
 
       mNoteEdit = new KNoteEdit( actionCollection(), page );
-      ( (KTextEdit*)mNoteEdit )->setTextFormat( Qt::RichText );
+      ( (KTextEdit*)mNoteEdit )->setAcceptRichText( true );
       mNoteEdit->setFocus();
 
       KXMLGUIBuilder builder( page );
@@ -163,7 +163,8 @@
       factory.addClient( this );
 
       mTool = static_cast<KToolBar *>( factory.container( "note_tool", this ) );
-
+      mNoteEdit->setContextMenu( dynamic_cast<KMenu *>(
+                                   factory.container( "note_edit", this ) ) );
       layout->addWidget( mTool );
       layout->addWidget( mNoteEdit );
 
Index: kontact/plugins/knotes/knotetip.cpp
===================================================================
--- kontact/plugins/knotes/knotetip.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/knotes/knotetip.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -31,6 +31,7 @@
 */
 
 #include "knotetip.h"
+#include <kdebug.h>
 #include "knotes_part_p.h"
 
 #include <kglobalsettings.h>
@@ -89,11 +90,7 @@
     }
   } else {
     KCal::Journal *journal = item->journal();
-    if ( journal->customProperty( "KNotes", "RichText" ) == "true" ) {
-      mPreview->setTextFormat( Qt::RichText );
-    } else {
-      mPreview->setTextFormat( Qt::PlainText );
-    }
+    mPreview->setAcceptRichText( journal->customProperty( "KNotes", "RichText" ) == "true" );
 
     QColor fg( journal->customProperty( "KNotes", "FgColor" ) );
     QColor bg( journal->customProperty( "KNotes", "BgColor" ) );
@@ -103,12 +100,12 @@
     //mPreview->zoomTo( 8 );
     mPreview->sync();
 
-    int w = 400;
-    int h = mPreview->heightForWidth( w );
+    mPreview->document()->adjustSize ();
+    int w = mPreview->document () ->size().width();
+    int h = mPreview->document () ->size().height();
     while ( w > 60 && h == mPreview->heightForWidth( w - 20 ) ) {
       w -= 20;
     }
-
     QRect desk = KGlobalSettings::desktopGeometry( mNoteIVI->rect().center() );
     resize( w, qMin( h, desk.height() / 2 - 20 ) );
 
Index: kontact/plugins/ktimetracker/ktimetracker.setdlg
===================================================================
--- kontact/plugins/ktimetracker/ktimetracker.setdlg	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/ktimetracker/ktimetracker.setdlg	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -14,6 +14,7 @@
 Name[ja]=タイムトラッカー
 Name[km]=កម្មវិធី​តាមដាន​ពេលវេលា
 Name[ko]=시간 추적기
+Name[lt]=Laiko sekiklis
 Name[lv]=Patērētā laika uzskatītājs
 Name[nb]=TimeTracker
 Name[nds]=Tietlogbook
@@ -45,6 +46,7 @@
 Comment[ja]=タイムトラッカーコンポーネント
 Comment[km]=សមាសភាគ​កម្មវិធី​តាមដាន​ពេលវេលា
 Comment[ko]=시간 추적기 구성 요소
+Comment[lt]=Laiko sekiklio komponentas
 Comment[lv]=Laika uzskaitītāja komponente
 Comment[nb]=Time Traacker-komponent
 Comment[nds]=Tietlogbook-Komponent
Index: kontact/plugins/ktimetracker/ktimetracker_plugin.desktop
===================================================================
--- kontact/plugins/ktimetracker/ktimetracker_plugin.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/ktimetracker/ktimetracker_plugin.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -29,6 +29,7 @@
 Comment[ja]=タイムトラッカープラグイン
 Comment[km]=កម្មវិធី​ជំនួយ TimeTracker
 Comment[ko]=시간 추적기 플러그인
+Comment[lt]=Laiko sekiklio priedas
 Comment[lv]=KTimeTracker spraudnis
 Comment[nb]=TimeTracker programtillegg
 Comment[nds]=Tietlogbook-Moduul
@@ -61,6 +62,7 @@
 Name[ja]=タイムトラッカー
 Name[km]=កម្មវិធី​តាមដាន​ពេលវេលា
 Name[ko]=시간 추적기
+Name[lt]=Laiko sekiklis
 Name[lv]=Patērētā laika uzskatītājs
 Name[nb]=TimeTracker
 Name[nds]=Tietlogbook
Index: kontact/plugins/kjots/kjots_plugin.desktop
===================================================================
--- kontact/plugins/kjots/kjots_plugin.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/kjots/kjots_plugin.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -62,6 +62,7 @@
 Name[ja]=メモ帳
 Name[km]=សៀវភៅ​ចំណាំ
 Name[ko]=공책
+Name[lt]=Užrašinės
 Name[lv]=Piezīmju grāmatiņas
 Name[nb]=Notisbøker
 Name[nds]=Notizböker
Index: kontact/plugins/kjots/kjots.setdlg
===================================================================
--- kontact/plugins/kjots/kjots.setdlg	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/kjots/kjots.setdlg	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -13,6 +13,7 @@
 Name[ja]=メモ帳
 Name[km]=សៀវភៅ​ចំណាំ
 Name[ko]=공책
+Name[lt]=Užrašinės
 Name[lv]=Piezīmju grāmatiņas
 Name[nb]=Notisbøker
 Name[nds]=Notizböker
@@ -46,6 +47,7 @@
 Comment[ja]=メモ帳コンポーネント
 Comment[km]=សមាសភាគ​សៀវភៅ​
 Comment[ko]=공책 구성 요소
+Comment[lt]=Užrašinių komponentas
 Comment[lv]=Piezīmju grāmatiņu komponente
 Comment[nb]=Notisbok-komponent
 Comment[nds]=Notizbook-Komponent
Index: kontact/plugins/korganizer/kcmapptsummary.desktop
===================================================================
--- kontact/plugins/korganizer/kcmapptsummary.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/korganizer/kcmapptsummary.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -28,6 +28,7 @@
 Name[kk]=Болашақ оқиғалар
 Name[km]=ព្រឹត្តិការណ៍​ដែល​នឹង​កើតឡើង
 Name[ko]=다가오는 약속
+Name[lt]=Artėjantys įvykiai
 Name[lv]=Gaidāmie notikumi
 Name[nb]=Kommende hendelser
 Name[nds]=Anstahn Begeefnissen
@@ -65,6 +66,7 @@
 Comment[kk]=Болашақ оқигалар тұжырымының баптау
 Comment[km]=ការ​រៀបចំ​សេចក្ដី​សង្ខេប​ព្រឹត្តិការណ៍​ដែល​នឹង​កើតឡើង
 Comment[ko]=다가오는 약속 요약 설정
+Comment[lt]=Artėjančių įvykių santraukos nustatymai
 Comment[lv]=Gaidāmo notikumu kopsavilkuma iestatījumi
 Comment[nb]=Sammendragsoppsett for kommende hendelser
 Comment[nds]=De Översicht för anstahn Begeefnissen instellen
Index: kontact/plugins/korganizer/kcmtodosummary.desktop
===================================================================
--- kontact/plugins/korganizer/kcmtodosummary.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/korganizer/kcmtodosummary.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -28,6 +28,7 @@
 Name[kk]=Кейінге қалдырылған жоспарлар
 Name[km]=ការងារ​ត្រូវធ្វើ​ដែល​មិនទាន់​សម្រេច
 Name[ko]=남아 있는 할 일
+Name[lt]=Neatlikti darbai
 Name[lv]=Darāmie darbi
 Name[nb]=Ventende gjøremål
 Name[nds]=Anstahn Opgaven
@@ -65,6 +66,7 @@
 Comment[kk]=Кейінге қалдырылған жоспарлар тұжырымының баптау
 Comment[km]=ការ​រៀបចំ​សេចក្ដីសង្ខេបការងារ​​ធ្វើ​ដែល​មិន​ទាន់សម្រេច
 Comment[ko]=남아 있는 할 일 요약 설정
+Comment[lt]=Neatliktų darbų santraukos nustatymai
 Comment[lv]=Darbu kopsavilkuma iestatījumi
 Comment[nb]=Oppsett av sammendraget av ventende gjøremål
 Comment[nds]=De Översicht för anstahn Opgaven instellen
Index: kontact/plugins/kmail/summarywidget.cpp
===================================================================
--- kontact/plugins/kmail/summarywidget.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/kmail/summarywidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -88,9 +88,13 @@
 {
   // check whether we need to update the message counts
   org::kde::kmail::kmail kmail( DBUS_KMAIL, "/KMail", QDBusConnection::sessionBus() );
-  const int timeOfLastMessageCountChange = kmail.timeOfLastMessageCountChange();
-  if ( timeOfLastMessageCountChange > mTimeOfLastMessageCountUpdate ) {
-    slotUnreadCountChanged();
+  if ( kmail.isValid() ) {
+    QDBusReply<int> timeOfLastMessageCountChange = kmail.timeOfLastMessageCountChange();
+    if ( timeOfLastMessageCountChange.isValid() ) {
+      if ( timeOfLastMessageCountChange > mTimeOfLastMessageCountUpdate ) {
+        slotUnreadCountChanged();
+      }
+    }
   }
 }
 
@@ -127,70 +131,87 @@
   int counter = 0;
   QStringList::ConstIterator it;
   org::kde::kmail::kmail kmail( DBUS_KMAIL, "/KMail", QDBusConnection::sessionBus() );
-  for ( it = folders.begin(); it != folders.end(); ++it ) {
-    if ( activeFolders.contains( *it ) ) {
-      QDBusReply<QString> ref = kmail.getFolder( *it );
-      if ( ref.isValid() && !ref.value().isEmpty() ) {
-        OrgKdeKmailFolderInterface folderInterface(
-          DBUS_KMAIL, "/Folder", QDBusConnection::sessionBus() );
-        QDBusReply<int> replyNumMsg = folderInterface.messages();
-        const int numMsg = replyNumMsg;
-        QDBusReply<int> replyUnreadNumMsg = folderInterface.unreadMessages();
-        const int numUnreadMsg=replyUnreadNumMsg;
+  if ( kmail.isValid() ) {
+    for ( it = folders.begin(); it != folders.end(); ++it ) {
+      if ( activeFolders.contains( *it ) ) {
+        QDBusReply<QString> ref = kmail.getFolder( *it );
+        if ( ref.isValid() && !ref.value().isEmpty() ) {
+          OrgKdeKmailFolderInterface folderInterface(
+            DBUS_KMAIL, "/Folder", QDBusConnection::sessionBus() );
+          if ( !folderInterface.isValid() )
+            continue;
 
-        if ( numUnreadMsg == 0 ) {
-          continue;
-        }
+          QDBusReply<int> replyNumMsg = folderInterface.messages();
+          if ( !replyNumMsg.isValid() )
+            continue;
 
-        // folder icon
-        QString name = folderInterface.unreadIconPath();
-        if ( name.isEmpty() ) {
-          name = defName;
-        }
-        label = new QLabel( this );
-        label->setPixmap( KIconLoader::global()->loadIcon( name, KIconLoader::Small ) );
-        label->setMaximumWidth( label->minimumSizeHint().width() );
-        label->setAlignment( Qt::AlignVCenter );
-        mLayout->addWidget( label, counter, 0 );
-        mLabels.append( label );
+          const int numMsg = replyNumMsg;
+          QDBusReply<int> replyUnreadNumMsg = folderInterface.unreadMessages();
+          if ( !replyUnreadNumMsg.isValid() )
+            continue;
 
-        // folder path
-        QString folderPath;
-        QDBusReply<QString> replyFolderPath;
-        if ( config.readEntry( "ShowFullPath", true ) ) {
-          replyFolderPath= folderInterface.displayPath();
-        } else {
-          replyFolderPath= folderInterface.displayName();
-        }
-        folderPath = replyFolderPath;
-        KUrlLabel *urlLabel = new KUrlLabel( *it, folderPath, this );
-        urlLabel->installEventFilter( this );
-        urlLabel->setAlignment( Qt::AlignLeft );
-        urlLabel->setWordWrap( true );
-        mLayout->addWidget( urlLabel, counter, 1 );
-        mLabels.append( urlLabel );
+          const int numUnreadMsg = replyUnreadNumMsg;
+          if ( numUnreadMsg == 0 ) {
+            continue;
+          }
 
-        connect( urlLabel, SIGNAL(leftClickedUrl(const QString&)),
-                 SLOT(selectFolder(const QString&)) );
+          // folder icon
+          QDBusReply<QString> dbusName = folderInterface.unreadIconPath();
+          QString name;
+          if ( dbusName.isValid() ) {
+            name = dbusName;
+            if ( name.isEmpty() )
+              name = defName;
+          }
+          else
+            name = defName;
+          label = new QLabel( this );
+          label->setPixmap( KIconLoader::global()->loadIcon( name, KIconLoader::Small ) );
+          label->setMaximumWidth( label->minimumSizeHint().width() );
+          label->setAlignment( Qt::AlignVCenter );
+          mLayout->addWidget( label, counter, 0 );
+          mLabels.append( label );
 
-        // unread of total
-        label = new QLabel( i18nc( "%1: number of unread messages "
-                                   "%2: total number of messages",
-                                   "%1 / %2", numUnreadMsg, numMsg ), this );
-        label->setAlignment( Qt::AlignLeft );
-        mLayout->addWidget( label, counter, 2 );
-        mLabels.append( label );
+          // folder path
+          QString folderPath;
+          QDBusReply<QString> replyFolderPath;
+          if ( config.readEntry( "ShowFullPath", true ) ) {
+            replyFolderPath= folderInterface.displayPath();
+          } else {
+            replyFolderPath= folderInterface.displayName();
+          }
+          if ( replyFolderPath.isValid() )
+            folderPath = replyFolderPath;
 
-        // tooltip
-        urlLabel->setToolTip( i18n( "<qt><b>%1</b>"
-                                    "<br/>Total: %2<br/>"
-                                    "Unread: %3</qt>",
-                                    folderPath,
-                                    numMsg,
-                                    numUnreadMsg ) );
-        //TODO: put the folder size in the tooltip
-        //so we need to add a folderSize() to the interface
-        counter++;
+          KUrlLabel *urlLabel = new KUrlLabel( *it, folderPath, this );
+          urlLabel->installEventFilter( this );
+          urlLabel->setAlignment( Qt::AlignLeft );
+          urlLabel->setWordWrap( true );
+          mLayout->addWidget( urlLabel, counter, 1 );
+          mLabels.append( urlLabel );
+
+          connect( urlLabel, SIGNAL(leftClickedUrl(const QString&)),
+                  SLOT(selectFolder(const QString&)) );
+
+          // unread of total
+          label = new QLabel( i18nc( "%1: number of unread messages "
+                                    "%2: total number of messages",
+                                    "%1 / %2", numUnreadMsg, numMsg ), this );
+          label->setAlignment( Qt::AlignLeft );
+          mLayout->addWidget( label, counter, 2 );
+          mLabels.append( label );
+
+          // tooltip
+          urlLabel->setToolTip( i18n( "<qt><b>%1</b>"
+                                      "<br/>Total: %2<br/>"
+                                      "Unread: %3</qt>",
+                                      folderPath,
+                                      numMsg,
+                                      numUnreadMsg ) );
+          //TODO: put the folder size in the tooltip
+          //so we need to add a folderSize() to the interface
+          counter++;
+        }
       }
     }
   }
Index: kontact/plugins/kmail/kcmkmailsummary.desktop
===================================================================
--- kontact/plugins/kmail/kcmkmailsummary.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/kmail/kcmkmailsummary.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -31,6 +31,7 @@
 Name[kk]=Жаңа хабарламалар
 Name[km]=សារ​ថ្មី
 Name[ko]=새 메시지
+Name[lt]=Nauji laiškai
 Name[lv]=Jaunas vēstules
 Name[nb]=Nye meldinger
 Name[nds]=Nieg Narichten
Index: kontact/plugins/summary/kcmkontactsummary.desktop
===================================================================
--- kontact/plugins/summary/kcmkontactsummary.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/summary/kcmkontactsummary.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -26,6 +26,7 @@
 Name[ja]=要約
 Name[km]=សេចក្ដីសង្ខេប
 Name[ko]=요약
+Name[lt]=Santraukos
 Name[lv]=Kopsavilkumi
 Name[nb]=Sammendrag
 Name[nds]=Tosamenfaten
@@ -60,6 +61,7 @@
 Comment[ja]=表示する要約を選択
 Comment[km]=ជម្រើស​សេចក្ដី​សង្ខេប
 Comment[ko]=요약 선택
+Comment[lt]=Santraukos pasirinkimas
 Comment[lv]=Kopsavilkuma izvēle
 Comment[nb]=Sammendragsutvalg
 Comment[nds]=Tosamenfaten utsöken
Index: kontact/plugins/newsticker/kcmkontactknt.desktop
===================================================================
--- kontact/plugins/newsticker/kcmkontactknt.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ kontact/plugins/newsticker/kcmkontactknt.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -30,6 +30,7 @@
 Name[kk]=Ақпарлар
 Name[km]=មតិ​ព័ត៌មាន
 Name[ko]=뉴스 피드
+Name[lt]=Naujienų kanalai
 Name[lv]=Ziņu barotnes
 Name[nb]=Nyhetskilder
 Name[nds]=Mellenströöm
Index: knotes/knotes_export.h
===================================================================
--- knotes/knotes_export.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ knotes/knotes_export.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -1,40 +0,0 @@
-/*  This file is part of the KDE project
-    Copyright (C) 2007 David Faure <faure@kde.org>
-
-    This library is free software; you can redistribute it and/or
-    modify it under the terms of the GNU Library General Public
-    License as published by the Free Software Foundation; either
-    version 2 of the License, or (at your option) any later version.
-
-    This library is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-    Library General Public License for more details.
-
-    You should have received a copy of the GNU Library General Public License
-    along with this library; see the file COPYING.LIB.  If not, write to
-    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
-    Boston, MA 02110-1301, USA.
-*/
-
-#ifndef KNOTES_EXPORT_H
-#define KNOTES_EXPORT_H
-
-/* needed for KDE_EXPORT and KDE_IMPORT macros */
-#include <kdemacros.h>
-
-#ifndef KNOTES_EXPORT
-# if defined(MAKE_KNOTES_LIB)
-   /* We are building this library */
-#  define KNOTES_EXPORT KDE_EXPORT
-# else
-   /* We are using this library */
-#  define KNOTES_EXPORT KDE_IMPORT
-# endif
-#endif
-
-# ifndef KNOTES_EXPORT_DEPRECATED
-#  define KNOTES_EXPORT_DEPRECATED KDE_DEPRECATED KNOTES_EXPORT
-# endif
-
-#endif
Index: knotes/knotesnetrecv.h
===================================================================
--- knotes/knotesnetrecv.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ knotes/knotesnetrecv.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -45,22 +45,22 @@
   public:
     KNotesNetworkReceiver( QTcpSocket * );
     ~KNotesNetworkReceiver();
-    
+
   signals:
     void sigNoteReceived( const QString &, const QString & );
-    
+
   private slots:
     void slotDataAvailable();
     void slotReceptionTimeout();
     void slotConnectionClosed();
-    void slotError( int err );
-    
+    void slotError( QAbstractSocket::SocketError );
+
   private:
     QTimer *m_timer;       // to avoid memory and connection floods
-    
+
     QByteArray *m_buffer;
     QTcpSocket *m_sock;
-    
+
     QString m_titleAddon;
 };
 
Index: knotes/resourcenotes.h
===================================================================
--- knotes/resourcenotes.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ knotes/resourcenotes.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -36,8 +36,6 @@
 #include <kcal/alarm.h>
 #include <kresources/resource.h>
 
-#include "knotes_export.h"
-
 class KNotesResourceManager;
 
 namespace KCal {
Index: knotes/knotesapp.h
===================================================================
--- knotes/knotesapp.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ knotes/knotesapp.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -57,79 +57,80 @@
   public:
     KNotesApp();
     ~KNotesApp();
-    
+
     void showNote( const QString &id ) const;
     void hideNote( const QString &id ) const;
-    
+
     void killNote( const QString &id );
     void killNote( const QString &id, bool force );
-    
+
     QString name( const QString &id ) const;
     QString text( const QString &id ) const;
-    
+
     void setName( const QString &id, const QString &newName );
     void setText( const QString &id, const QString &newText );
-    
+
     QMap<QString,QString> notes() const;
-    
+
     bool commitData( QSessionManager & );
-    
+
   public slots:
     QString newNote( const QString &name = QString(),
                      const QString &text = QString() );
     QString newNoteFromClipboard( const QString &name = QString() );
-    
+
     void hideAllNotes() const;
     void showAllNotes() const;
-    
+
   protected slots:
     void slotActivated( QSystemTrayIcon::ActivationReason );
     void slotShowNote();
     void slotWalkThroughNotes();
-    
+
     void slotOpenFindDialog();
     void slotFindNext();
-    
+
     void slotPreferences();
     void slotConfigureAccels();
-    
+
     void slotNoteKilled( KCal::Journal *journal );
-    
+
     void slotQuit();
-    
+
   private:
     void showNote( KNote *note ) const;
     void saveConfigs();
-    
+
   private slots:
     void acceptConnection();
     void saveNotes();
     void updateNoteActions();
     void updateNetworkListener();
     void updateStyle();
-    
+
     void createNote( KCal::Journal *journal );
     void killNote( KCal::Journal *journal );
-    
+
   private:
     QMap<QString, KNote *> m_notes;
     QList<QAction *>       m_noteActions;
-    
+
     KNotesResourceManager  *m_manager;
     KNotesAlarm            *m_alarm;
     QTcpServer             *m_listener;
     DNSSD::PublicService   *m_publisher;
-    
+
     KFind           *m_find;
     QMap<QString, KNote *>::iterator *m_findPos;
-    
+
     KMenu           *m_noteMenu;
     KMenu           *m_contextMenu;
-    
+
     KXMLGUIFactory  *m_guiFactory;
     KXMLGUIBuilder  *m_guiBuilder;
     KSystemTrayIcon *m_tray;
-    
+    KAction         *m_findAction;
+
     QDomDocument    m_noteGUI;
 };
 
Index: knotes/knote.cpp
===================================================================
--- knotes/knote.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ knotes/knote.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -31,7 +31,6 @@
 #include <QVBoxLayout>
 #include <QDesktopWidget>
 
-#include <k3colordrag.h>
 #include <kaction.h>
 #include <kactioncollection.h>
 #include <kapplication.h>
@@ -82,29 +81,28 @@
 using namespace KCal;
 
 
-KNote::KNote( QDomDocument buildDoc, Journal *j, QWidget *parent )
+KNote::KNote( const QDomDocument& buildDoc, Journal *j, QWidget *parent )
   : QFrame( parent, Qt::FramelessWindowHint ), m_label( 0 ), m_grip( 0 ),
     m_button( 0 ), m_tool( 0 ), m_editor( 0 ), m_config( 0 ), m_journal( j ),
-    m_find( 0 ), m_kwinConf( KSharedConfig::openConfig( "kwinrc" ) )
+    m_find( 0 ), m_kwinConf( KSharedConfig::openConfig( "kwinrc" ) ), m_blockEmitDataChanged( false )
 {
   setAcceptDrops( true );
   setAttribute( Qt::WA_DeleteOnClose );
   setDOMDocument( buildDoc );
-  setObjectName( m_journal->uid() );  
+  setObjectName( m_journal->uid() );
   setXMLFile( componentData().componentName() + "ui.rc", false, false );
-  
+
   // create the main layout
   m_noteLayout = new QVBoxLayout( this );
-  setLayout( m_noteLayout );
   m_noteLayout->setMargin( 0 );
-   
+
   // if there is no title yet, use the start date if valid
   // (KOrganizer's journals don't have titles but a valid start date)
   if ( m_journal->summary().isNull() && m_journal->dtStart().isValid() ) {
     QString s = KGlobal::locale()->formatDateTime( m_journal->dtStart() );
     m_journal->setSummary( s );
   }
-  
+
   createActions();
 
   buildGui();
@@ -122,6 +120,7 @@
 
 void KNote::slotKill( bool force )
 {
+  m_blockEmitDataChanged = true;
   if ( !force &&
        ( KMessageBox::warningContinueCancel( this,
          i18n( "<qt>Do you really want to delete note <b>%1</b>?</qt>",
@@ -130,20 +129,19 @@
          KGuiItem( i18n( "&Delete" ), "edit-delete" ),
          KStandardGuiItem::cancel(),
          "ConfirmDeleteNote" ) != KMessageBox::Continue ) ) {
-    return;
+     m_blockEmitDataChanged = false;
+     return;
   }
-  
   // delete the configuration first, then the corresponding file
   delete m_config;
   m_config = 0;
-  
+
   QString configFile = KGlobal::dirs()->saveLocation( "appdata", "notes/" );
   configFile += m_journal->uid();
-  
   if ( !KIO::NetAccess::del( KUrl( configFile ), this ) ) {
     kError( 5500 ) <<"Can't remove the note config:" << configFile;
   }
-  
+
   emit sigKillNote( m_journal );
 }
 
@@ -160,7 +158,7 @@
                                 m_config->bgColor().name() );
   m_journal->setCustomProperty( "KNotes", "RichText",
                                 m_config->richText() ? "true" : "false" );
-  
+
   emit sigDataChanged();
   m_editor->document()->setModified( false );
 }
@@ -175,7 +173,7 @@
     m_config->setHeight( 0 );
   }
   m_config->setPosition( pos() );
-  
+
 #ifdef Q_WS_X11
   NETWinInfo wm_client( QX11Info::display(), winId(),
                         QX11Info::appRootWindow(), NET::WMDesktop );
@@ -184,7 +182,7 @@
     m_config->setDesktop( wm_client.desktop() );
   }
 #endif
-  
+
   // actually store the config on disk
   m_config->writeConfig();
 }
@@ -208,7 +206,7 @@
 {
   m_label->setText( name );
   updateLabelAlignment();
-  
+
   if ( m_editor ) {    // not called from CTOR?
     saveData();
   }
@@ -218,25 +216,25 @@
                        NET::WMDesktop );
   note_win.setName( name.toUtf8() );
 #endif
-  
+
   emit sigNameChanged();
 }
 
 void KNote::setText( const QString& text )
 {
   m_editor->setText( text );
-  
+
   saveData();
 }
 
 void KNote::find( KFind* kfind )
 {
   m_find = kfind;
-  disconnect( m_find ); 
+  disconnect( m_find );
   connect( m_find, SIGNAL( highlight( const QString &, int, int ) ),
            this, SLOT( slotHighlight( const QString &, int, int ) ) );
   connect( m_find, SIGNAL( findNext() ), this, SLOT( slotFindNext() ) );
-  
+
   m_find->setData( m_editor->toPlainText() );
   slotFindNext();
 }
@@ -244,13 +242,13 @@
 void KNote::slotFindNext()
 {
   // TODO: honor FindBackwards
- 
+
   // Let KFind inspect the text fragment, and display a dialog if a match is
   // found
   KFind::Result res = m_find->find();
- 
+
   if ( res == KFind::NoMatch ) { // i.e. at end-pos
-   
+
     QTextCursor c = m_editor->textCursor(); //doesn't return by reference, so we use setTextCursor
     c.clearSelection();
     m_editor->setTextCursor( c );
@@ -258,7 +256,7 @@
     disconnect( m_find, 0, this, 0 );
     emit sigFindFinished();
   } else {
-	
+
     show();
 #ifdef Q_WS_X11
     KWindowSystem::setCurrentDesktop( KWindowSystem::windowInfo( winId(),
@@ -284,31 +282,33 @@
 
 void KNote::slotRename()
 {
+    m_blockEmitDataChanged = true;
   // pop up dialog to get the new name
   bool ok;
+  QString oldName = m_label->text();
   QString newName = KInputDialog::getText( QString::null,
     //krazy:exclude=nullstrassign for old broken gcc
     i18n( "Please enter the new name:" ), m_label->text(), &ok, this );
-  
-  if ( !ok ) { // handle cancel
+  m_blockEmitDataChanged = false;
+  if ( !ok || (oldName == newName) ) { // handle cancel
     return;
   }
-  
+
   setName( newName );
 }
 
 void KNote::slotUpdateReadOnly()
 {
   const bool readOnly = m_readOnly->isChecked();
-  
+
   m_editor->setReadOnly( readOnly );
   m_config->setReadOnly( readOnly );
-  
+
   // enable/disable actions accordingly
   actionCollection()->action( "configure_note" )->setEnabled( !readOnly );
   actionCollection()->action( "insert_date" )->setEnabled( !readOnly );
   actionCollection()->action( "delete_note" )->setEnabled( !readOnly );
-  
+
   actionCollection()->action( "edit_undo" )->setEnabled( !readOnly &&
                               m_editor->document()->isUndoAvailable() );
   actionCollection()->action( "edit_redo" )->setEnabled( !readOnly &&
@@ -317,7 +317,8 @@
                               m_editor->textCursor().hasSelection() );
   actionCollection()->action( "edit_paste" )->setEnabled( !readOnly );
   actionCollection()->action( "edit_clear" )->setEnabled( !readOnly );
-  
+
+  actionCollection()->action( "rename_note" )->setEnabled( !readOnly);
   updateFocus();
 }
 
@@ -331,11 +332,11 @@
     m_config->setDesktop( wm_client.desktop() );
   }
 #endif
-  
+
   m_editor->clearFocus();
   m_config->setHideNote( true );
   m_config->setPosition( pos() );
-  
+  m_config->writeConfig();
   // just hide the note so it's still available from the dock window
   hide();
 }
@@ -348,12 +349,14 @@
 
 void KNote::slotSetAlarm()
 {
+    m_blockEmitDataChanged = true;
   KNoteAlarmDlg dlg( name(), this );
   dlg.setIncidence( m_journal );
-  
+
   if ( dlg.exec() == QDialog::Accepted ) {
     emit sigDataChanged();
   }
+  m_blockEmitDataChanged = false;
 }
 
 void KNote::slotPreferences()
@@ -362,7 +365,7 @@
   if ( KNoteConfigDlg::showDialog( noteId() ) ) {
     return;
   }
-  
+
   // create a new preferences dialog...
   KNoteConfigDlg *dialog = new KNoteConfigDlg( m_config, name(), this, noteId() );
   connect( dialog, SIGNAL( settingsChanged( const QString & ) ) , this,
@@ -374,16 +377,18 @@
 
 void KNote::slotSend()
 {
+    m_blockEmitDataChanged = true;
   // pop up dialog to get the IP
   KNoteHostDlg hostDlg( i18n( "Send \"%1\"", name() ), this );
   bool ok = ( hostDlg.exec() == QDialog::Accepted );
-  
+
+  m_blockEmitDataChanged = false;
   if ( !ok ) { // handle cancel
     return;
   }
   QString host = hostDlg.host();
   quint16 port = hostDlg.port();
-  
+
   if ( !port ) { // not specified, use default
     port = KNotesGlobalConfig::port();
   }
@@ -392,9 +397,9 @@
     KMessageBox::sorry( this, i18n( "The host cannot be empty." ) );
     return;
   }
-  
+
   // Send the note
-  
+
   KNotesNetworkSender *sender = new KNotesNetworkSender(
     KSocketFactory::connectToHost( "knotes", host, port ) );
   sender->setSenderId( KNotesGlobalConfig::senderID() );
@@ -404,9 +409,9 @@
 void KNote::slotMail()
 {
   // get the mail action command
-  QStringList cmd_list = KNotesGlobalConfig::mailAction().split( QChar(' '),
+  const QStringList cmd_list = KNotesGlobalConfig::mailAction().split( QChar(' '),
       QString::SkipEmptyParts );
-  
+
   KProcess mail;
   foreach ( const QString& cmd, cmd_list ) {
     if ( cmd == "%f" ) {
@@ -417,7 +422,7 @@
       mail << cmd;
     }
   }
-  
+
   if ( !mail.startDetached() ) {
     KMessageBox::sorry( this, i18n( "Unable to start the mail process." ) );
   }
@@ -440,35 +445,37 @@
 void KNote::slotSaveAs()
 {
   // TODO: where to put pdf file support? In the printer??!??!
-  
+
   QCheckBox *convert = 0;
-  
+
   if ( m_editor->acceptRichText() ) {
     convert = new QCheckBox( 0 );
     convert->setText( i18n( "Save note as plain text" ) );
   }
-  
+  m_blockEmitDataChanged = true;
   KUrl url;
   KFileDialog dlg( url, QString(), this, convert );
   dlg.setOperationMode( KFileDialog::Saving );
   dlg.setCaption( i18n( "Save As" ) );
   dlg.exec();
-  
+
   QString fileName = dlg.selectedFile();
   if ( fileName.isEmpty() ) {
+      m_blockEmitDataChanged = false;
     return;
   }
-  
+
   QFile file( fileName );
-  
+
   if ( file.exists() &&
        KMessageBox::warningContinueCancel( this,
           i18n( "<qt>A file named <b>%1</b> already exists.<br />"
                 "Are you sure you want to overwrite it?</qt>",
                 QFileInfo( file ).fileName() ) ) != KMessageBox::Continue ) {
+      m_blockEmitDataChanged = false;
     return;
   }
-  
+
   if ( file.open( QIODevice::WriteOnly ) ) {
     QTextStream stream( &file );
     if ( convert && !convert->isChecked() ) {
@@ -477,6 +484,7 @@
       stream << m_editor->toPlainText();
     }
   }
+  m_blockEmitDataChanged = false;
 }
 
 void KNote::slotPopupActionToDesktop( int id )
@@ -494,15 +502,15 @@
   m_editor->setTextFont( m_config->font() );
   m_editor->setTabStop( m_config->tabSize() );
   m_editor->setAutoIndentMode( m_config->autoIndent() );
-  
+
   // if called as a slot, save the text, we might have changed the
   // text format - otherwise the journal will not be updated
   if ( sender() ) {
     saveData();
   }
-  
+
   setColor( m_config->fgColor(), m_config->bgColor() );
-  
+
   updateLayout();
   slotUpdateShowInTaskbar();
 }
@@ -567,20 +575,20 @@
                        NET::DesktopNames );
   NETWinInfo wm_client( QX11Info::display(), winId(),
                         QX11Info::appRootWindow(), NET::WMDesktop );
-  
+
   QStringList desktops;
   desktops.append( i18n( "&All Desktops" ) );
   desktops.append( QString::null );           // Separator
                                               // krazy:exclude=nullstrassign
                                               // for old broken gcc
-  
+
   int count = wm_root.numberOfDesktops();
   for ( int n = 1; n <= count; n++ ) {
     desktops.append( QString( "&%1 %2" ).arg( n ).arg(
       QString::fromUtf8( wm_root.desktopName( n ) ) ) );
   }
   m_toDesktop->setItems( desktops );
-  
+
   if ( wm_client.desktop() == NETWinInfo::OnAllDesktops ) {
     m_toDesktop->setCurrentItem( 0 );
   } else {
@@ -595,13 +603,13 @@
 
 void KNote::buildGui()
 {
-  createNoteHeader();  
+  createNoteHeader();
   createNoteEditor();
-  
+
   KXMLGUIBuilder builder( this );
   KXMLGUIFactory factory( &builder, this );
   factory.addClient( this );
-  
+
   m_menu = dynamic_cast<KMenu*>( factory.container( "note_context", this ) );
   m_editor->setContextMenu( dynamic_cast<KMenu *>(
                               factory.container( "note_edit", this ) ) );
@@ -624,12 +632,12 @@
   actionCollection()->addAction( "rename_note", action );
   connect( action, SIGNAL( triggered( bool ) ), SLOT( slotRename() ) );
 
-  m_readOnly  = new KToggleAction( KIcon( "system-lock-screen" ),
+  m_readOnly  = new KToggleAction( KIcon( "object-locked" ),
                                    i18n( "Lock" ), this );
   actionCollection()->addAction( "lock_note", m_readOnly );
   connect( m_readOnly, SIGNAL( triggered( bool ) ),
           SLOT( slotUpdateReadOnly() ) );
-  m_readOnly->setCheckedState( KGuiItem( i18n( "Unlock" ), "unlock" ) );
+  m_readOnly->setCheckedState( KGuiItem( i18n( "Unlock" ), "object-unlocked" ) );
 
   action  = new KAction( KIcon( "window-close" ), i18n( "Hide" ), this );
   actionCollection()->addAction( "hide_note", action );
@@ -638,8 +646,8 @@
 
   action  = new KAction( KIcon( "edit-delete" ), i18n( "Delete" ), this );
   actionCollection()->addAction( "delete_note", action );
-  connect( action, SIGNAL( triggered( bool ) ), SLOT( slotKill() ) );
-  
+  connect( action, SIGNAL( triggered( bool ) ), SLOT( slotKill() ) ,Qt::QueuedConnection);
+
   action  = new KAction( KIcon( "knotes_date" ), i18n( "Insert Date" ), this );
   actionCollection()->addAction( "insert_date", action );
   connect( action, SIGNAL( triggered( bool ) ), SLOT( slotInsDate() ) );
@@ -648,7 +656,7 @@
                          this );
   actionCollection()->addAction( "set_alarm", action );
   connect( action, SIGNAL( triggered( bool ) ), SLOT( slotSetAlarm() ) );
-  
+
   action  = new KAction( KIcon( "network-wired" ), i18n( "Send..." ), this );
   actionCollection()->addAction( "send_note", action );
   connect( action, SIGNAL( triggered( bool ) ), SLOT( slotSend() ) );
@@ -667,20 +675,20 @@
   action  = new KAction( KIcon( "configure" ), i18n( "Preferences..." ), this );
   actionCollection()->addAction( "configure_note", action );
   connect( action, SIGNAL( triggered( bool ) ), SLOT( slotPreferences() ) );
-  
-  
+
+
   m_keepAbove  = new KToggleAction( KIcon( "go-up" ),
                                     i18n( "Keep Above Others" ), this );
   actionCollection()->addAction( "keep_above", m_keepAbove );
   connect( m_keepAbove, SIGNAL( triggered( bool ) ),
            SLOT( slotKeepAbove() ) );
-  
+
   m_keepBelow  = new KToggleAction( KIcon( "go-down" ),
                                     i18n( "Keep Below Others" ), this );
   actionCollection()->addAction( "keep_below", m_keepBelow );
   connect( m_keepBelow, SIGNAL( triggered( bool ) ),
            SLOT( slotKeepBelow() ) );
-  
+
 #ifdef Q_WS_X11
   m_toDesktop  = new KSelectAction( i18n( "To Desktop" ), this );
   actionCollection()->addAction( "to_desktop", m_toDesktop );
@@ -689,7 +697,7 @@
   connect( m_toDesktop->menu(), SIGNAL( aboutToShow() ),
            SLOT( slotUpdateDesktopActions() ) );
 #endif
-  
+
   // invisible action to walk through the notes to make this configurable
   action  = new KAction( i18n( "Walk Through Notes" ), this );
   actionCollection()->addAction( "walk_notes", action );
@@ -705,18 +713,18 @@
 {
   // load style configuration
   KConfigGroup styleGroup( m_kwinConf, "Style" );
-  
+
   QBoxLayout::Direction headerLayoutDirection = QBoxLayout::LeftToRight;
-  
+
   if ( styleGroup.readEntry( "CustomButtonPositions", false ) ) {
     if ( styleGroup.readEntry( "ButtonsOnLeft" ).contains( 'X' ) ) {
       headerLayoutDirection = QBoxLayout::RightToLeft;
     }
   }
-  
-  QBoxLayout *headerLayout = new QBoxLayout( headerLayoutDirection, this );
-  
-  
+
+  QBoxLayout *headerLayout = new QBoxLayout( headerLayoutDirection);
+
+
   // create header label
   m_label = new QLabel( this );
   headerLayout->addWidget( m_label );
@@ -730,9 +738,9 @@
                                         // connected at this stage yet
   m_button = new KNoteButton( "knotes_close", this );
   headerLayout->addWidget( m_button );
-  
+
   connect( m_button, SIGNAL( clicked() ), this, SLOT( slotClose() ) );
-  
+
   m_noteLayout->addItem( headerLayout );
 }
 
@@ -741,7 +749,7 @@
   m_editor = new KNoteEdit( actionCollection(), this );
   m_noteLayout->addWidget( m_editor );
   m_editor->installEventFilter( this ); // receive focus events for modified
-  setFocusProxy( m_editor );  
+  setFocusProxy( m_editor );
 }
 
 void KNote::createNoteFooter()
@@ -751,22 +759,22 @@
     m_tool->setFixedHeight( 24 );
     m_tool->setToolButtonStyle( Qt::ToolButtonIconOnly );
   }
-  
+
   // create size grip
-  QHBoxLayout *gripLayout = new QHBoxLayout( this );
+  QHBoxLayout *gripLayout = new QHBoxLayout;
   m_grip = new QSizeGrip( this );
   m_grip->setFixedSize( m_grip->sizeHint() );
-  
+
   if ( m_tool ) {
     gripLayout->addWidget( m_tool );
     gripLayout->setAlignment( m_tool, Qt::AlignBottom | Qt::AlignLeft );
     m_tool->hide();
   }
-  
+
   gripLayout->addWidget( m_grip );
   gripLayout->setAlignment( m_grip, Qt::AlignBottom | Qt::AlignRight );
   m_noteLayout->addItem( gripLayout );
-  
+
   // if there was just a way of making KComboBox adhere the toolbar height...
   if ( m_tool ) {
     foreach ( KComboBox *combo, m_tool->findChildren<KComboBox *>() ) {
@@ -783,17 +791,17 @@
   // the config file location
   QString configFile = KGlobal::dirs()->saveLocation( "appdata", "notes/" );
   configFile += m_journal->uid();
-  
+
   // no config file yet? -> use the default display config if available
   // we want to write to configFile, so use "false"
   bool newNote = !KIO::NetAccess::exists( KUrl( configFile ),
                                           KIO::NetAccess::DestinationSide, 0 );
-  
+
   m_config = new KNoteConfig( KSharedConfig::openConfig( configFile,
                                                          KConfig::NoGlobals ) );
   m_config->readConfig();
   m_config->setVersion( KNOTES_VERSION );
-  
+
   if ( newNote ) {
     // until kdelibs provides copying of KConfigSkeletons (KDE 3.4)
     KNotesGlobalConfig *globalConfig = KNotesGlobalConfig::self();
@@ -801,14 +809,14 @@
     m_config->setFgColor( globalConfig->fgColor() );
     m_config->setWidth( globalConfig->width() );
     m_config->setHeight( globalConfig->height() );
-    
+
     m_config->setFont( globalConfig->font() );
     m_config->setTitleFont( globalConfig->titleFont() );
     m_config->setAutoIndent( globalConfig->autoIndent() );
     m_config->setRichText( globalConfig->richText() );
     m_config->setTabSize( globalConfig->tabSize() );
     m_config->setReadOnly( globalConfig->readOnly() );
-    
+
     m_config->setDesktop( globalConfig->desktop() );
     m_config->setHideNote( globalConfig->hideNote() );
     m_config->setPosition( globalConfig->position() );
@@ -816,26 +824,25 @@
     m_config->setRememberDesktop( globalConfig->rememberDesktop() );
     m_config->setKeepAbove( globalConfig->keepAbove() );
     m_config->setKeepBelow( globalConfig->keepBelow() );
-    
+
     m_config->writeConfig();
   }
-  
+
   // set up the look&feel of the note
   setFrameStyle( Panel | Raised );
   setMinimumSize( 20, 20 );
   setBackgroundRole( QPalette::Base );
-  
+
   m_editor->setContentsMargins( 0, 0, 0, 0 );
   m_editor->setBackgroundRole( QPalette::Base );
   m_editor->setFrameStyle( NoFrame );
   m_editor->setText( m_journal->description() );
-  m_editor->document()->setModified( false );
-  
+
   // load the display configuration of the note
   uint width = m_config->width();
   uint height = m_config->height();
   resize( width, height );
-  
+
   // let KWin do the placement if the position is illegal--at least 10 pixels
   // of a note need to be visible
   const QPoint& position = m_config->position();
@@ -844,7 +851,7 @@
   if ( desk.intersects( QRect( position, QSize( width, height ) ) ) ) {
     move( position );           // do before calling show() to avoid flicker
   }
-  
+
   // config items in the journal have priority
   QString property = m_journal->customProperty( "KNotes", "FgColor" );
   if ( !property.isNull() ) {
@@ -853,7 +860,7 @@
     m_journal->setCustomProperty( "KNotes", "FgColor",
                                   m_config->fgColor().name() );
   }
-  
+
   property = m_journal->customProperty( "KNotes", "BgColor" );
   if ( !property.isNull() ) {
     m_config->setBgColor( QColor( property ) );
@@ -868,26 +875,26 @@
     m_journal->setCustomProperty( "KNotes", "RichText",
                                   m_config->richText() ? "true" : "false" );
   }
-  
+
   // read configuration settings...
   slotApplyConfig();
-  
+
   // if this is a new note put on current desktop - we can't use defaults
   // in KConfig XT since only _changes_ will be stored in the config file
   int desktop = m_config->desktop();
-  
+
 #ifdef Q_WS_X11
   if ( ( desktop < 0 && desktop != NETWinInfo::OnAllDesktops ) ||
        !m_config->rememberDesktop() )
     desktop = KWindowSystem::currentDesktop();
 #endif
-  
+
   // show the note if desired
   if ( desktop != 0 && !m_config->hideNote() ) {
     // to avoid flicker, call this before show()
     toDesktop( desktop );
     show();
-    
+
     // because KWin forgets about that for hidden windows
 #ifdef Q_WS_X11
     if ( desktop == NETWinInfo::OnAllDesktops ) {
@@ -895,10 +902,10 @@
     }
 #endif
   }
-  
+
   m_readOnly->setChecked( m_config->readOnly() );
   slotUpdateReadOnly();
-  
+
   if ( m_config->keepAbove() ) {
     m_keepAbove->setChecked( true );
   } else if ( m_config->keepBelow() ) {
@@ -908,7 +915,7 @@
     m_keepBelow->setChecked( false );
   }
   slotUpdateKeepAboveBelow();
-  
+
   // HACK: update the icon color - again after showing the note, to make kicker
   // aware of the new colors
   KIconEffect effect;
@@ -925,6 +932,7 @@
 #ifdef Q_WS_X11
   KWindowSystem::setIcons( winId(), icon, miniIcon );
 #endif
+  m_editor->document()->setModified( false );
 }
 
 void KNote::toDesktop( int desktop )
@@ -932,7 +940,7 @@
   if ( desktop == 0 ) {
     return;
   }
-  
+
 #ifdef Q_WS_X11
   if ( desktop == NETWinInfo::OnAllDesktops ) {
     KWindowSystem::setOnAllDesktops( winId(), true );
@@ -945,45 +953,45 @@
 void KNote::setColor( const QColor &fg, const QColor &bg )
 {
   QPalette p = palette();
-  
+
   // better: from light(150) to light(100) to light(75)
   // QLinearGradient g( width()/2, 0, width()/2, height() );
   // g.setColorAt( 0, bg );
   // g.setColorAt( 1, bg.dark(150) );
-  
+
   p.setColor( QPalette::Window,     bg );
   // p.setBrush( QPalette::Window,     g );
   p.setColor( QPalette::Base,       bg );
   // p.setBrush( QPalette::Base,       g );
-  
+
   p.setColor( QPalette::WindowText, fg );
   p.setColor( QPalette::Text,       fg );
-  
+
   p.setColor( QPalette::Button,     bg.dark( 116 ) );
   p.setColor( QPalette::ButtonText, fg );
-  
+
   //p.setColor( QPalette::Highlight,  bg );
   //p.setColor( QPalette::HighlightedText, fg );
-  
+
   // order: Light, Midlight, Button, Mid, Dark, Shadow
-  
+
   // the shadow
   p.setColor( QPalette::Light, bg.light( 180 ) );
   p.setColor( QPalette::Midlight, bg.light( 150 ) );
   p.setColor( QPalette::Mid, bg.light( 150 ) );
   p.setColor( QPalette::Dark, bg.dark( 108 ) );
   p.setColor( QPalette::Shadow, bg.dark( 116 ) );
-  
+
   setPalette( p );
-  
+
   // darker values for the active label
   p.setColor( QPalette::Active, QPalette::Base, bg.dark( 116 ) );
-  
+
   m_label->setPalette( p );
-  
+
   // set the text color
   m_editor->setTextColor( fg );
-  
+
   // update the icon color
   KIconEffect effect;
   QPixmap icon = effect.apply( qApp->windowIcon().pixmap(
@@ -1018,11 +1026,11 @@
 {
   if ( hasFocus() ) {
     m_button->show();
-    m_grip->show();
-    
+
     if ( !m_editor->isReadOnly() ) {
       if ( m_tool && m_tool->isHidden() && m_editor->acceptRichText() ) {
         m_tool->show();
+	m_grip->show();
         setGeometry( x(), y(), width(), height() + m_tool->height() );
       }
     } else if ( m_tool && !m_tool->isHidden() ) {
@@ -1033,7 +1041,7 @@
   } else {
     m_button->hide();
     m_grip->hide();
-    
+
     if ( m_tool && !m_tool->isHidden() ) {
       m_tool->hide();
       setGeometry( x(), y(), width(), height() - m_tool->height() );
@@ -1092,7 +1100,7 @@
   if ( m_config->readOnly() ) {
     return;
   }
-  
+
   const QMimeData *md = e->mimeData();
   if ( md->hasColor() ) {
        QColor bg =  qvariant_cast<QColor>( md->colorData() );
@@ -1119,26 +1127,27 @@
     dragEnterEvent( static_cast<QDragEnterEvent *>( ev ) );
     return true;
   }
-  
+
   if ( ev->type() == QEvent::Drop &&
        static_cast<QDropEvent *>( ev )->mimeData()->hasColor() ) {
     dropEvent( static_cast<QDropEvent *>( ev ) );
     return true;
   }
-  
+
   if ( o == m_label ) {
     QMouseEvent *e = ( QMouseEvent * )ev;
-    
+
     if ( ev->type() == QEvent::MouseButtonDblClick ) {
-      slotRename();
+       if(!m_editor->isReadOnly())
+          slotRename();
     }
-    
+
     if ( ev->type() == QEvent::MouseButtonPress &&
         ( e->button() == Qt::LeftButton || e->button() == Qt::MidButton ) ) {
 #ifdef Q_WS_X11
       e->button() == Qt::LeftButton ? KWindowSystem::raiseWindow( winId() )
                                     : KWindowSystem::lowerWindow( winId() );
-      
+
       XUngrabPointer( QX11Info::display(), QX11Info::appTime() );
       NETRootInfo wm_root( QX11Info::display(), NET::WMMoveResize );
       wm_root.moveResizeRequest( winId(), e->globalX(), e->globalY(),
@@ -1146,7 +1155,7 @@
 #endif
       return true;
     }
-    
+
     if ( ev->type() == QEvent::MouseButtonRelease ) {
 #ifdef Q_WS_X11
         NETRootInfo wm_root( QX11Info::display(), NET::WMMoveResize );
@@ -1155,10 +1164,10 @@
 #endif
         return false;
     }
-    
+
     return false;
   }
-  
+
   if ( o == m_editor ) {
     if ( ev->type() == QEvent::FocusOut ) {
           QFocusEvent *fe = static_cast<QFocusEvent *>( ev );
@@ -1166,16 +1175,18 @@
                fe->reason() != Qt::MouseFocusReason ) {
             updateFocus();
             if ( isModified() ) {
-              saveData();
+              saveConfig();
+              if ( !m_blockEmitDataChanged )
+                  saveData();
             }
           }
     } else if ( ev->type() == QEvent::FocusIn ) {
       updateFocus();
     }
-    
+
     return false;
   }
-  
+
   return false;
 }
 
Index: knotes/knoteslegacy.cpp
===================================================================
--- knotes/knoteslegacy.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ knotes/knoteslegacy.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -71,9 +71,9 @@
   bool converted = false;
   
   QDir noteDir( KGlobal::dirs()->saveLocation( "appdata", "notes/" ) );
-  QStringList notes = noteDir.entryList( QDir::Files, QDir::Name );
-  for ( QStringList::Iterator note = notes.begin(); note != notes.end();
-        note++ ) {
+  const QStringList notes = noteDir.entryList( QDir::Files, QDir::Name );
+  for ( QStringList::ConstIterator note = notes.constBegin(); note != notes.constEnd();
+        ++note ) {
     QString file = noteDir.absoluteFilePath( *note );
     KConfig *test = new KConfig( file, KConfig::SimpleConfig );
     KConfigGroup grp( test, "General" );
@@ -260,7 +260,7 @@
   grp.deleteEntry( "state" );
   
   // load the saved text and put it in the journal
-  QFile infile( noteDir.absoluteFilePath( "." + file + "_data" ) );
+  QFile infile( noteDir.absoluteFilePath( '.' + file + "_data" ) );
   if ( infile.open( QIODevice::ReadOnly ) ) {
     QTextStream input( &infile );
     input.setCodec( "UTF-8" );
Index: knotes/knotesnetrecv.cpp
===================================================================
--- knotes/knotesnetrecv.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ knotes/knotesnetrecv.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -58,18 +58,18 @@
   QString date =
     KGlobal::locale()->formatDateTime( QDateTime::currentDateTime(),
                                        KLocale::ShortDate, false );
-  
+
   // Add the remote IP or hostname and the date to the title, to help the
   // user guess who wrote it.
   m_titleAddon = QString( " [%1, %2]" )
                   .arg( m_sock->peerAddress().toString() )
                   .arg( date );
-  
+
   // Setup the communications
   connect( m_sock, SIGNAL( readyRead() ), SLOT( slotDataAvailable() ) );
   connect( m_sock, SIGNAL( disconnected() ), SLOT( slotConnectionClosed() ) );
-  connect( m_sock, SIGNAL( error( int ) ), SLOT( slotError( int ) ) );
-  
+  connect( m_sock, SIGNAL(error(QAbstractSocket::SocketError)), SLOT(slotError(QAbstractSocket::SocketError)));
+
   // Setup the timer
   m_timer = new QTimer( this );
   m_timer->setSingleShot( true );
@@ -87,22 +87,22 @@
 {
   char smallBuffer[SBSIZE];
   int smallBufferLen;
-  
+
   do {
     // Append to "big buffer" only if we have some space left.
     int curLen = m_buffer->count();
-    
+
     smallBufferLen = m_sock->read( smallBuffer, SBSIZE );
-    
+
     // Limit max transfer over buffer, to avoid overflow.
     smallBufferLen = qMin( smallBufferLen, MAXBUFFER - curLen );
-    
+
     if ( smallBufferLen > 0 ) {
       m_buffer->resize( curLen + smallBufferLen );
       memcpy( m_buffer->data() + curLen, smallBuffer, smallBufferLen );
     }
   } while ( smallBufferLen == SBSIZE );
-  
+
   // If we are overflowing, close connection.
   if ( m_buffer->count() == MAXBUFFER ) {
     m_sock->close();
@@ -120,24 +120,24 @@
 {
   if ( m_timer->isActive() ) {
     QString noteText = QString( *m_buffer ).trimmed();
-    
+
     // First line is the note title or, in case of ATnotes, the id
     int pos = noteText.indexOf( QRegExp( "[\r\n]" ) );
     QString noteTitle = noteText.left( pos ).trimmed() + m_titleAddon;
-    
+
     noteText = noteText.mid( pos ).trimmed();
-    
+
     if ( !noteText.isEmpty() ) {
         emit sigNoteReceived( noteTitle, noteText );
     }
   }
-  
+
   deleteLater();
 }
 
-void KNotesNetworkReceiver::slotError( int err )
+void KNotesNetworkReceiver::slotError( QAbstractSocket::SocketError error )
 {
-  kWarning( 5500 ) << err << m_sock->errorString();
+    kWarning( 5500 ) <<"error type :"<< ( int ) error <<" error string : "<<m_sock->errorString();
 }
 
 #include "knotesnetrecv.moc"
Index: knotes/knoteedit.h
===================================================================
--- knotes/knoteedit.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ knotes/knoteedit.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -51,7 +51,6 @@
     QString text() const;
     
     void setTextFont( const QFont &font );
-    void setTextColor( const QColor &color );
     void setTabStop( int tabs );
     void setAutoIndentMode( bool newmode );
     
Index: knotes/knotesapp.cpp
===================================================================
--- knotes/knotesapp.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ knotes/knotesapp.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -69,25 +69,25 @@
     {
       setCaption( i18n( "Configure Shortcuts" ) );
       setButtons( Default | Ok | Cancel );
-      
+
       m_keyChooser = new KShortcutsEditor( globals, this );
       setMainWidget( m_keyChooser );
       connect( this, SIGNAL( defaultClicked() ),
                m_keyChooser, SLOT( allDefault() ) );
     }
-    
+
     void insert( KActionCollection *actions )
     {
         m_keyChooser->addCollection( actions, i18n( "Note Actions" ) );
     }
-    
+
     void configure()
     {
         if ( exec() == Accepted ) {
             m_keyChooser->save();
         }
     }
-    
+
   private:
     KShortcutsEditor *m_keyChooser;
 };
@@ -108,18 +108,18 @@
 
   // create the dock widget...
   m_tray = new KSystemTrayIcon();
-  
+
   m_tray->setToolTip( i18n( "KNotes: Sticky notes for KDE" ) );
   m_tray->setIcon( KSystemTrayIcon::loadIcon( "knotes" ) );
   connect( m_tray, SIGNAL( activated( QSystemTrayIcon::ActivationReason ) ),
            SLOT( slotActivated( QSystemTrayIcon::ActivationReason ) ) );
-  
+
   // set the initial style
 #ifdef __GNUC__
 #warning FIXME
 #endif
   //    KNote::setStyle( KNotesGlobalConfig::style() );
-  
+
   // create the GUI...
   KAction *action  = new KAction( KIcon( "document-new" ),
                                   i18n( "New Note" ), this );
@@ -127,31 +127,31 @@
                              KAction::DefaultShortcut );
   actionCollection()->addAction( "new_note", action );
   connect( action, SIGNAL( triggered() ), SLOT( newNote() ) );
-  
+
   action  = new KAction( KIcon( "edit-paste" ),
                          i18n( "New Note From Clipboard" ), this );
   action->setGlobalShortcut( KShortcut( Qt::ALT + Qt::SHIFT + Qt::Key_C ),
                              KAction::DefaultShortcut );
   actionCollection()->addAction( "new_note_clipboard", action );
   connect( action, SIGNAL( triggered() ), SLOT( newNoteFromClipboard() ) );
-  
+
   action  = new KAction( KIcon( "knotes" ), i18n( "Show All Notes" ), this );
   action->setGlobalShortcut( KShortcut( Qt::ALT + Qt::SHIFT + Qt::Key_S ),
                              KAction::DefaultShortcut );
   actionCollection()->addAction( "show_all_notes", action );
   connect( action, SIGNAL( triggered() ), SLOT( showAllNotes() ) );
-  
+
   action  = new KAction( KIcon( "window-close" ),
                          i18n( "Hide All Notes" ), this );
   action->setGlobalShortcut( KShortcut( Qt::ALT + Qt::SHIFT + Qt::Key_H ),
                              KAction::DefaultShortcut );
   actionCollection()->addAction( "hide_all_notes", action );
   connect( action, SIGNAL( triggered() ), SLOT( hideAllNotes() ) );
-  
+
   new KHelpMenu( this, KGlobal::mainComponent().aboutData(), false,
                  actionCollection() );
-  
-  KStandardAction::find( this, SLOT( slotOpenFindDialog() ),
+
+  m_findAction = KStandardAction::find( this, SLOT( slotOpenFindDialog() ),
                          actionCollection() );
   KStandardAction::preferences( this, SLOT( slotPreferences() ),
                          actionCollection() );
@@ -160,13 +160,13 @@
   //FIXME: no shortcut removing!?
   KStandardAction::quit( this, SLOT( slotQuit() ),
                          actionCollection() )->setShortcut( 0 );
-  
+
   setXMLFile( componentData().componentName() + "appui.rc" );
-  
+
   m_guiBuilder = new KXMLGUIBuilder( this );
   m_guiFactory = new KXMLGUIFactory( m_guiBuilder, this );
   m_guiFactory->addClient( this );
-  
+
   m_contextMenu = static_cast<KMenu *>( m_guiFactory->container(
                                         "knotes_context",
                                         this ) );
@@ -179,26 +179,26 @@
   QStringList fileList =
       componentData().dirs()->findAllResources( "data", filter ) +
       componentData().dirs()->findAllResources( "data", xmlFileName );
-  
+
   QString doc;
   KXMLGUIClient::findMostRecentXMLFile( fileList, doc );
   m_noteGUI.setContent( doc );
-  
+
   KConfigGroup config( KGlobal::config(), "Global Keybindings" );
-  
+
   // clean up old config files
   KNotesLegacy::cleanUp();
-  
+
   // create the resource manager
   m_manager = new KNotesResourceManager();
   connect( m_manager, SIGNAL( sigRegisteredNote( KCal::Journal * ) ),
            this,      SLOT( createNote( KCal::Journal * ) ) );
   connect( m_manager, SIGNAL( sigDeregisteredNote( KCal::Journal * ) ),
            this,      SLOT( killNote( KCal::Journal * ) ) );
-  
+
   // read the notes
   m_manager->load();
-  
+
   // read the old config files, convert and add them
   KCal::CalendarLocal calendar( QString::fromLatin1( "UTC" ) );
   if ( KNotesLegacy::convert( &calendar ) ) {
@@ -207,20 +207,20 @@
     for ( it = notes.constBegin(); it != notes.constEnd(); ++it ) {
       m_manager->addNewNote( *it );
     }
-    
+
     m_manager->save();
   }
-  
+
   // set up the alarm reminder - do it after loading the notes because this
   // is used as a check if updateNoteActions has to be called for a new note
   m_alarm = new KNotesAlarm( m_manager, this );
-  
+
    updateNetworkListener();
-  
+
   if ( m_notes.size() == 0 && !kapp->isSessionRestored() ) {
       newNote();
   }
-  
+
   updateNoteActions();
   m_tray->show();
 }
@@ -228,14 +228,20 @@
 KNotesApp::~KNotesApp()
 {
   saveNotes();
-  
+
   blockSignals( true );
   qDeleteAll( m_notes );
   m_notes.clear();
   qDeleteAll( m_noteActions );
   m_noteActions.clear();
   blockSignals( false );
-  
+
+  delete m_listener;
+  m_listener=0;
+  delete m_publisher;
+  m_publisher=0;
+  delete m_findPos;
+  m_findPos = 0;
   //delete m_listener;
   delete m_manager;
   delete m_guiBuilder;
@@ -254,7 +260,7 @@
 {
   // create the new note
   KCal::Journal *journal = new KCal::Journal();
-  
+
   // new notes have the current date/time as title if none was given
   if ( !name.isEmpty() ) {
     journal->setSummary( name );
@@ -262,14 +268,14 @@
     journal->setSummary( KGlobal::locale()->formatDateTime(
                                                QDateTime::currentDateTime() ) );
   }
-  
+
   // the body of the note
   journal->setDescription( text );
-  
+
   m_manager->addNewNote( journal );
-  
+
   showNote( journal->uid() );
-  
+
   return journal->uid();
 }
 
@@ -282,7 +288,7 @@
 void KNotesApp::hideAllNotes() const
 {
   foreach ( KNote *note, m_notes ) {
-    note->hide();
+    note->slotClose();
   }
 }
 
@@ -291,7 +297,7 @@
   foreach ( KNote *note, m_notes ) {
     // workaround to BUG 149116
     note->hide();
-    
+
     note->show();
     note->setFocus();
   }
@@ -336,11 +342,11 @@
 QMap<QString, QString> KNotesApp::notes() const
 {
   QMap<QString, QString> notes;
-  
+
   foreach ( KNote *note, m_notes ) {
     notes.insert( note->noteId(), note->name() );
   }
-  
+
   return notes;
 }
 
@@ -393,7 +399,7 @@
     case QSystemTrayIcon::Trigger:
       if ( m_notes.size() == 1 ) {
         showNote( *m_notes.begin() );
-      } else if ( m_notes.size() > 1 ) {
+      } else if ( m_notes.size() != 1 ) {
         m_noteMenu->popup( QCursor::pos () );
       }
       break;
@@ -437,20 +443,20 @@
   findDia.setHasSelection( false );
   findDia.setHasCursor( false );
   findDia.setSupportsBackwardsFind( false );
-  
-  if ( findDia.exec() != QDialog::Accepted ) {
+
+  if ( (findDia.exec() != QDialog::Accepted) || findDia.pattern().isEmpty() ) {
     return;
   }
-  
+
   delete m_findPos;
   m_findPos = new QMap<QString, KNote *>::iterator();
   *m_findPos = m_notes.begin();
-  
+
   // this could be in an own method if searching without a dialog
   // should be possible
   delete m_find;
   m_find = new KFind( findDia.pattern(), findDia.options(), this );
-  
+
   slotFindNext();
 }
 
@@ -488,25 +494,25 @@
 void KNotesApp::slotConfigureAccels()
 {
   KNotesKeyDialog keys( actionCollection(), this );
-  
+
   QMap<QString, KNote *>::const_iterator it = m_notes.constBegin();
-  
+
   if ( !m_notes.isEmpty() ) {
     keys.insert( ( *it )->actionCollection() );
   }
-  
+
   keys.configure();
-  
+
   // update GUI doc for new notes
   m_noteGUI.setContent(
     KXMLGUIFactory::readConfigFile( componentData().componentName() + "ui.rc",
                                     componentData() )
                       );
-  
+
   if ( m_notes.isEmpty() ) {
     return;
   }
-  
+
   foreach ( QAction *action, ( *it )->actionCollection()->actions() ) {
     it = m_notes.constBegin();
     for ( ++it; it != m_notes.constEnd(); ++it ) {
@@ -521,7 +527,7 @@
 */
       QAction *toChange =
         ( *it )->actionCollection()->action( action->objectName() );
-      
+
       if ( toChange ) {
         toChange->setShortcuts( action->shortcuts() );
       }
@@ -542,7 +548,7 @@
       note->saveData();
     }
   }
-  
+
   saveConfigs();
   kapp->quit();
 }
@@ -564,7 +570,7 @@
 {
   KNote *newNote = new KNote( m_noteGUI, journal, 0 );
   m_notes.insert( newNote->noteId(), newNote );
-  
+
   connect( newNote, SIGNAL( sigRequestNewNote() ),
            SLOT( newNote() ) );
   connect( newNote, SIGNAL( sigShowNextNote() ),
@@ -579,7 +585,7 @@
            SLOT( updateNoteActions() ) );
   connect( newNote, SIGNAL( sigFindFinished() ),
            SLOT( slotFindNext() ) );
-  
+
   // don't call this during startup for each and every loaded note
   if ( m_alarm ) {
     updateNoteActions();
@@ -601,7 +607,7 @@
 {
   // Accept the connection and make KNotesNetworkReceiver do the job
   QTcpSocket *s = m_listener->nextPendingConnection();
-  
+
   if ( s ) {
     KNotesNetworkReceiver *recv = new KNotesNetworkReceiver( s );
     connect( recv,
@@ -644,18 +650,26 @@
                     1,
                     note->palette().color( note->backgroundRole() ),
                     false );
-    
+
     action->setIcon( icon );
     m_noteActions.append( action );
   }
-  
-	qSort( m_noteActions.begin(), m_noteActions.end(), qActionLessThan );
-  
+
   if ( m_noteActions.isEmpty() ) {
+      actionCollection()->action( "hide_all_notes" )->setEnabled( false );
+      actionCollection()->action( "show_all_notes" )->setEnabled( false );
+      m_findAction->setEnabled( false );
     KAction *action = new KAction( i18n( "No Notes" ), this );
     m_noteActions.append( action );
   }
-  
+  else
+  {
+      qSort( m_noteActions.begin(), m_noteActions.end(), qActionLessThan );
+      actionCollection()->action( "hide_all_notes" )->setEnabled( true );
+      actionCollection()->action( "show_all_notes" )->setEnabled( true );
+      m_findAction->setEnabled( true );
+  }
+
   plugActionList( "notes", m_noteActions );
 }
 
@@ -665,7 +679,7 @@
     m_listener=0;
     delete m_publisher;
     m_publisher=0;
-    
+
     if ( KNotesGlobalConfig::receiveNotes() ) {
         // create the socket and start listening for connections
         m_listener=KSocketFactory::listen( "knotes" , QHostAddress::Any,
@@ -683,7 +697,7 @@
 #warning FIXME!
 #endif
   //    KNote::setStyle( KNotesGlobalConfig::style() );
-  
+
   foreach ( KNote *note, m_notes ) {
     QApplication::postEvent( note, new QEvent( QEvent::LayoutRequest ) );
   }
Index: knotes/knotesalarm.cpp
===================================================================
--- knotes/knotesalarm.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ knotes/knotesalarm.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -48,9 +48,9 @@
 {
   setObjectName( name );
   // TODO: fix timezone stuff?
-  
+
   connect( &m_checkTimer, SIGNAL( timeout() ), SLOT( checkAlarms() ) );
-  
+
   // interval in seconds
   m_checkTimer.start( 1000 * KNotesGlobalConfig::self()->checkInterval() );
 }
@@ -61,19 +61,21 @@
   if ( !from.isValid() ) {
     from.setTime_t( 0 );
   }
-  
+
   KDateTime now = KDateTime::currentLocalDateTime();
   KNotesGlobalConfig::self()->setAlarmsLastChecked( now.dateTime() );
   QList<KCal::Alarm *> alarms = m_manager->alarms( KDateTime( from,
 KDateTime::LocalZone ), now );
-  
+  if ( alarms.isEmpty() )
+      return;
+
   QStringList notes;
   QList<KCal::Alarm *>::ConstIterator it;
   for ( it = alarms.constBegin(); it != alarms.constEnd(); ++it ) {
     KCal::Incidence *incidence = ( *it )->parent();
     notes += incidence->summary();
   }
-  
+
   if ( !notes.isEmpty() ) {
     KMessageBox::informationList( 0,
                                   i18n( "The following notes triggered "
Index: knotes/knotes_manager.desktop
===================================================================
--- knotes/knotes_manager.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ knotes/knotes_manager.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -32,6 +32,7 @@
 Name[lv]=Piezīmes
 Name[mk]=Белешки
 Name[ms]=Nota
+Name[nb]=Notater
 Name[nds]=Notizen
 Name[ne]=टिपोट
 Name[nl]=Notities
Index: knotes/knote.h
===================================================================
--- knotes/knote.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ knotes/knote.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -53,7 +53,7 @@
 {
   Q_OBJECT
   public:
-    KNote( QDomDocument buildDoc, KCal::Journal *journal, QWidget *parent = 0 );
+    KNote( const QDomDocument& buildDoc, KCal::Journal *journal, QWidget *parent = 0 );
     ~KNote();
 
     void saveData();
@@ -69,10 +69,11 @@
     void find( KFind* kfind );
 
     bool isModified() const;
+    void blockEmitDataChanged( bool _b ) { m_blockEmitDataChanged = _b;}
 
   public slots:
     void slotKill( bool force = false );
-
+    void slotClose();
   signals:
     void sigRequestNewNote();
     void sigShowNextNote();
@@ -97,7 +98,6 @@
   private slots:
     void slotRename();
     void slotUpdateReadOnly();
-    void slotClose();
 
     void slotSend();
     void slotMail();
@@ -160,6 +160,7 @@
     KToggleAction *m_keepBelow;
 
     KSharedConfig::Ptr m_kwinConf;
+    bool m_blockEmitDataChanged;
 };
 
 #endif
Index: knotes/knoteedit.cpp
===================================================================
--- knotes/knoteedit.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ knotes/knoteedit.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -178,7 +178,7 @@
   pix.fill( Qt::black ); // just a dummy, gets updated before widget is shown
   m_textColor  = new KAction( i18n( "Text Color..." ), this );
   actions->addAction( "format_color", m_textColor );
-  ( ( QAction * )m_textColor )->setIcon( pix );
+  m_textColor->setIcon( pix );
   connect( m_textColor, SIGNAL( triggered( bool ) ), SLOT( slotTextColor() ) );
   
   m_textFont  = new KFontAction( i18n( "Text Font" ), this );
@@ -235,13 +235,6 @@
   setTextFormat( f );
 }
 
-void KNoteEdit::setTextColor( const QColor &color )
-{
-  QTextCharFormat f;
-  f.setForeground( QBrush( color ) );
-  setTextFormat( f );
-}
-
 void KNoteEdit::setTabStop( int tabs )
 {
   QFontMetrics fm( font() );
@@ -427,7 +420,9 @@
       }
       insertPlainText( ( *it ).prettyUrl() );
     }
-  } else { KTextEdit::dropEvent( e ); }
+  } else {
+      KTextEdit::dropEvent( e );
+  }
 }
 
 void KNoteEdit::keyPressEvent( QKeyEvent *e )
@@ -462,7 +457,7 @@
 {
   // font changes
   m_textFont->setFont( f.fontFamily() );
-  m_textSize->setFontSize( ( int ) f.fontPointSize() );
+  m_textSize->setFontSize( (f.fontPointSize()>0 ) ?  ( int ) f.fontPointSize() :10);
   
   m_textBold->setChecked( f.font().bold() );
   m_textItalic->setChecked( f.fontItalic() );
Index: akonadi/resources/localbookmarks/localbookmarksresource.desktop
===================================================================
--- akonadi/resources/localbookmarks/localbookmarksresource.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ akonadi/resources/localbookmarks/localbookmarksresource.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -14,6 +14,7 @@
 Name[km]=ចំណាំ​មូលដ្ឋាន
 Name[ko]=로컬 책갈피
 Name[lv]=Lokālās grāmatzīmes
+Name[nb]=Lokale bokmerker
 Name[nds]=Lokaalleestekens
 Name[nl]=Lokale bladwijzers
 Name[nn]=Lokalbokmerke
Index: MAINTAINERS
===================================================================
--- MAINTAINERS	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ MAINTAINERS	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -7,13 +7,11 @@
                   Lutz Rogowski <lutz@klaralvdalens-datakonsult.se>
 kfile-plugins     ?
 kioslave          ?
-kitchensync       Tobias Koenig <tokoe@kde.org>
 kjots             Stephen Kelly <steveire@gmail.com>
 kleopatra         Marc Mutz <mutz@kde.org>
                   Steffen Hansen <hansen@kde.org>
 kmail             Thomas McGuire <mcguire@kde.org>
 kmailcvt          Danny Kukawka <danny.kukawka@web.de>
-kmobiletools      Marco Gulino <marco.gulino@gmail.com>
 knode             Volker Krause <vkrause@kde.org>
 knotes            Guillermo Antonio Amaral Bastidas <me@guillermoamaral.com>
 kode              Cornelius Schumacher <schumacher@kde.org>
@@ -22,7 +20,6 @@
 kontactinterfaces Allen Winter <winter@kde.org>
 korganizer        Reinhold Kainhofer <reinhold@kainhofer.com>
                   Cornelius Schumacher <schumacher@kde.org>
-korn              Mart Kelder <mart.mailing@hccnet.nl>
 kpilot            Jason 'vanRijn' Kasper <vR@movingparts.net>
                   Adriaan de Groot <groot@kde.org>
 kresources        ?
Index: korganizer/koeditorgeneralevent.h
===================================================================
--- korganizer/koeditorgeneralevent.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeditorgeneralevent.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -70,7 +70,7 @@
     */
     void readEvent( Event *event, bool tmpl = false );
     /** Write event settings to event object */
-    void writeEvent( Event * );
+    void fillEvent( Event * );
 
     /** Check if the input is valid. */
     bool validateInput();
Index: korganizer/koattendeeeditor.cpp
===================================================================
--- korganizer/koattendeeeditor.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koattendeeeditor.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -304,7 +304,7 @@
   }
 }
 
-void KOAttendeeEditor::writeIncidence( KCal::Incidence *incidence )
+void KOAttendeeEditor::fillIncidence( KCal::Incidence *incidence )
 {
   if ( mOrganizerCombo ) {
     // TODO: Don't take a string and split it up... Is there a better way?
Index: korganizer/history.cpp
===================================================================
--- korganizer/history.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/history.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -105,7 +105,7 @@
 
 void History::addEntry( Entry *entry )
 {
-  if ( mCurrentMultiEntry ) {
+  if ( mCurrentMultiEntry && mCurrentMultiEntry != entry ) {
     mCurrentMultiEntry->appendEntry( entry );
   } else {
     truncate();
Index: korganizer/koeditorgeneraltodo.cpp
===================================================================
--- korganizer/koeditorgeneraltodo.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeditorgeneraltodo.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -304,6 +304,7 @@
     mDueDateEdit->setDate( QDate::currentDate() );
     mDueTimeEdit->setTime( QTime::currentTime() );
     mDueCheck->setChecked( false );
+    mTimeZoneComboDue->setEnabled( false );
   }
 
   if ( todo->hasStartDate() ) {
@@ -319,6 +320,7 @@
     mStartDateEdit->setDate( QDate::currentDate() );
     mStartTimeEdit->setTime( QTime::currentTime() );
     mStartCheck->setChecked( false );
+    mTimeZoneComboStart->setEnabled( false );
   }
 
   mTimeButton->setChecked( !todo->allDay() );
@@ -335,9 +337,9 @@
   mStartDateModified = false;
 }
 
-void KOEditorGeneralTodo::writeTodo( Todo *todo )
+void KOEditorGeneralTodo::fillTodo( Todo *todo )
 {
-  KOEditorGeneral::writeIncidence( todo );
+  KOEditorGeneral::fillIncidence( todo );
 
   // temp. until something better happens.
   QString tmpStr;
Index: korganizer/koeditorgeneral.cpp
===================================================================
--- korganizer/koeditorgeneral.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeditorgeneral.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -327,6 +327,8 @@
 {
   KPIM::CategorySelectDialog *categoryDialog =
     new KPIM::CategorySelectDialog( KOPrefs::instance(), mCategoriesButton );
+  categoryDialog->setHelp( "categories-view", "korganizer" );
+  categoryDialog->setButtons( KDialog::Ok | KDialog::Cancel | KDialog::Help );
   KOGlobals::fitDialogToScreen( categoryDialog );
   categoryDialog->setSelected( mCategories );
 
@@ -493,7 +495,7 @@
   }
 }
 
-void KOEditorGeneral::writeIncidence( Incidence *incidence )
+void KOEditorGeneral::fillIncidence( Incidence *incidence )
 {
   incidence->setSummary( mSummaryEdit->text() );
   incidence->setLocation( mLocationEdit->text() );
@@ -532,7 +534,7 @@
       incidence->addAlarm( al );
     }
   }
-  mAttachments->writeIncidence( incidence );
+  mAttachments->fillIncidence( incidence );
 }
 
 void KOEditorGeneral::setSummary( const QString &text )
Index: korganizer/koeventeditor.cpp
===================================================================
--- korganizer/koeventeditor.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeventeditor.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -66,6 +66,16 @@
   }
 }
 
+bool KOEventEditor::incidenceModified() {
+  Event *newEvent = 0;
+
+  if ( mEvent ) {
+    newEvent = mEvent->clone();
+    fillEvent( newEvent );
+  }
+  return mEvent && !( *newEvent == *mEvent );
+}
+
 void KOEventEditor::init()
 {
   setupGeneral();
@@ -288,7 +298,7 @@
     Event *oldEvent = mEvent->clone();
     Event *event = mEvent->clone();
 
-    writeEvent( event );
+    fillEvent( event );
 
     if ( *event == *mEvent ) {
       // Don't do anything
@@ -301,7 +311,7 @@
       }
     } else {
       //IncidenceChanger::assignIncidence( mEvent, event );
-      writeEvent( mEvent );
+      fillEvent( mEvent );
       if ( mIsCounter ) {
         KOGroupware::instance()->sendCounterProposal( mCalendar, oldEvent, mEvent );
         // add dummy event at the position of the counter proposal
@@ -320,7 +330,7 @@
     mEvent = new Event;
     mEvent->setOrganizer( Person( KOPrefs::instance()->fullName(),
                           KOPrefs::instance()->email() ) );
-    writeEvent( mEvent );
+    fillEvent( mEvent );
     if ( !mChanger->addIncidence( mEvent, this ) ) {
       delete mEvent;
       mEvent = 0;
@@ -373,16 +383,16 @@
   }
 }
 
-void KOEventEditor::writeEvent( Event *event )
+void KOEventEditor::fillEvent( Event *event )
 {
-  mGeneral->writeEvent( event );
+  mGeneral->fillEvent( event );
   if ( mFreeBusy ) {
-    mFreeBusy->writeIncidence( event );
+    mFreeBusy->fillIncidence( event );
   }
 
   cancelRemovedAttendees( event );
 
-  mRecurrence->writeIncidence( event );
+  mRecurrence->fillIncidence( event );
 
   writeDesignerFields( event );
 }
@@ -429,7 +439,7 @@
 void KOEventEditor::slotSaveTemplate( const QString &templateName )
 {
   Event *event = new Event;
-  writeEvent( event );
+  fillEvent( event );
   saveAsTemplate( event, templateName );
 }
 
@@ -441,7 +451,7 @@
 void KOEventEditor::updateRecurrenceSummary()
 {
   Event *ev =  new Event();
-  writeEvent( ev );
+  fillEvent( ev );
   mGeneral->updateRecurrenceSummary( IncidenceFormatter::recurrenceString( ev ) );
   delete ev;
 }
Index: korganizer/koeditorfreebusy.cpp
===================================================================
--- korganizer/koeditorfreebusy.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeditorfreebusy.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -760,7 +760,7 @@
   dialog.exec();
 }
 
-void KOEditorFreeBusy::writeIncidence( Incidence *incidence )
+void KOEditorFreeBusy::fillIncidence( Incidence *incidence )
 {
   incidence->clearAttendees();
   QVector<FreeBusyItem*> toBeDeleted;
@@ -804,7 +804,7 @@
     }
   }
 
-  KOAttendeeEditor::writeIncidence( incidence );
+  KOAttendeeEditor::fillIncidence( incidence );
 
   // cleanup
   qDeleteAll( toBeDeleted );
Index: korganizer/koattendeeeditor.h
===================================================================
--- korganizer/koattendeeeditor.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koattendeeeditor.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -56,7 +56,7 @@
     virtual void insertAttendee( KCal::Attendee *attendee, bool fetchFB = true ) = 0;
 
     virtual void readIncidence( KCal::Incidence *incidence );
-    virtual void writeIncidence( KCal::Incidence *incidence );
+    virtual void fillIncidence( KCal::Incidence *incidence );
 
     /** return a clone of the incidence with attendees to be canceld*/
     void cancelAttendeeIncidence( KCal::Incidence *incidence );
Index: korganizer/dbuscalendar.desktop
===================================================================
--- korganizer/dbuscalendar.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/dbuscalendar.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -35,6 +35,7 @@
 Comment[kk]=D-BUS интерфейсті Ұйымдастырғыш
 Comment[km]=កម្មវិធី​រៀបចំ​ដែល​មាន​ចំណុច​ប្រទាក់ D-BUS
 Comment[ko]=D-BUS 인터페이스를 사용하는 오거나이저
+Comment[lt]=Planuoklis su D-Bus sąsaja
 Comment[lv]=Organizators ar D-BUS saskarni
 Comment[nb]=Organizer med D-BUS-grensesnitt
 Comment[nds]=En Daagpleger mit en D-Bus-Koppelsteed
Index: korganizer/koeditorgeneral.h
===================================================================
--- korganizer/koeditorgeneral.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeditorgeneral.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -88,7 +88,7 @@
     void readIncidence( Incidence *incidence );
 
     /** Write event settings to event object */
-    void writeIncidence( Incidence * );
+    void fillIncidence( Incidence * );
 
     /** Check if the input is valid. */
     bool validateInput();
Index: korganizer/koeventeditor.h
===================================================================
--- korganizer/koeventeditor.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeventeditor.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -95,7 +95,7 @@
     /**
       Write event settings to event object
     */
-    void writeEvent( Event * );
+    void fillEvent( Event * );
 
     QObject *typeAheadReceiver() const;
 
@@ -126,6 +126,7 @@
     int msgItemDelete();
     void loadTemplate( CalendarLocal & );
     QStringList &templates() const;
+    bool incidenceModified();
 
   private:
     Event *mEvent;
Index: korganizer/koeditorgeneralevent.cpp
===================================================================
--- korganizer/koeditorgeneralevent.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeditorgeneralevent.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -432,9 +432,9 @@
   readIncidence( event );
 }
 
-void KOEditorGeneralEvent::writeEvent( Event *event )
+void KOEditorGeneralEvent::fillEvent( Event *event )
 {
-  writeIncidence( event );
+  fillIncidence( event );
 
   QDate tmpDate;
   QTime tmpTime;
Index: korganizer/koeditorattachments.h
===================================================================
--- korganizer/koeditorattachments.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeditorattachments.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -104,7 +104,7 @@
     /** Read event object and setup widgets accordingly */
     void readIncidence( KCal::Incidence * );
     /** Write event settings to event object */
-    void writeIncidence( KCal::Incidence * );
+    void fillIncidence( KCal::Incidence * );
 
     bool hasAttachments();
 
Index: korganizer/korgac/alarmdialog.cpp
===================================================================
--- korganizer/korgac/alarmdialog.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/korgac/alarmdialog.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -413,8 +413,17 @@
       // FIXME: Check whether this should be done for all multiple alarms
       if ( alarm->type() == Alarm::Procedure ) {
         // FIXME: Add a message box asking whether the procedure should really be executed
-      kDebug() << "Starting program: '" << alarm->programFile() << "'";
-      QProcess::startDetached( alarm->programFile() );
+        kDebug() << "Starting program: '" << alarm->programFile() << "'";
+
+        QString program = alarm->programFile();
+
+        // if the program name contains spaces escape it
+        if ( program.contains( " " )   &&
+             !( program.startsWith( "\"" ) && program.endsWith( "\"" ) ) ) {
+          program = "\"" + program + "\"";
+        }
+
+        QProcess::startDetached( program + " " + alarm->programArguments() );
       } else if ( alarm->type() == Alarm::Audio ) {
         beeped = true;
         Phonon::MediaObject *player =
Index: korganizer/interfaces/calendar/calendarplugin.desktop
===================================================================
--- korganizer/interfaces/calendar/calendarplugin.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/interfaces/calendar/calendarplugin.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -14,8 +14,9 @@
 Name[ja]=カレンダープラグインインターフェース
 Name[km]=ប្រតិទិន​កម្មវិធី​ជំនួយ​ប្រតិទិន
 Name[ko]=달력 플러그인 인터페이스
+Name[lt]=Kalendoriaus priedo sąsaja
 Name[lv]=Kalendāra spraudņa saskarne
-Name[nb]=Calendar-grensesnitt for programtillegg
+Name[nb]=Grensesnitt til kalender-programtillegg
 Name[nds]=Kalennermoduul-Koppelsteed
 Name[nl]=Agendapluginuiterlijk
 Name[nn]=Grensesnitt til kalender-programtillegg
@@ -67,7 +68,7 @@
 Comment[lv]=Kalendāra spraudnis
 Comment[mk]=Приклучок за календар
 Comment[ms]=Plugin Kalendar
-Comment[nb]=Calendar-programtillegg
+Comment[nb]=Kalender-programtillegg
 Comment[nds]=Kalenner-Moduul
 Comment[ne]=क्यालेन्डर प्लगइन
 Comment[nl]=Agendaplugin
Index: korganizer/interfaces/calendar/calendardecoration.desktop
===================================================================
--- korganizer/interfaces/calendar/calendardecoration.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/interfaces/calendar/calendardecoration.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -14,8 +14,9 @@
 Name[ja]=カレンダー装飾インターフェース
 Name[km]=ចំណុច​ប្រទាក់​តុបតែង​ប្រតិទិន
 Name[ko]=달력 장식 인터페이스
+Name[lt]=Kalendoriaus dekoracijų sąsaja
 Name[lv]=Kalendāra dekorāciju saskarne
-Name[nb]=Calendar dekorasjonsgrensesnitt
+Name[nb]=Grensesnitt til kalenderpynt
 Name[nds]=Kalennerdekoratschoon-Koppelsteed
 Name[nl]=Agendadecoratie-uiterlijk
 Name[nn]=Grensesnitt til kalenderpynt
@@ -67,7 +68,7 @@
 Comment[lv]=Kalendāra dekorāciju spraudnis
 Comment[mk]=Приклучок за декорација на календар
 Comment[ms]=Plugin Hiasan Kalendar
-Comment[nb]=Calendar dekorasjonsprogramtillegg
+Comment[nb]=Programtillegg for kalenderpynt
 Comment[nds]=Dekoratschoon för den Kalenner
 Comment[ne]=क्यालेन्डर सजावट प्लगइन
 Comment[nl]=Agendadecoratieplugin
Index: korganizer/kotodoeditor.cpp
===================================================================
--- korganizer/kotodoeditor.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/kotodoeditor.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -62,6 +62,16 @@
   emit dialogClose( mTodo );
 }
 
+bool KOTodoEditor::incidenceModified() {
+  Todo *newTodo = 0;
+
+  if ( mTodo ) {
+    newTodo = mTodo->clone();
+    fillTodo( newTodo );
+  }
+  return mTodo && !( *newTodo == *mTodo );
+}
+
 void KOTodoEditor::init()
 {
   setupGeneral();
@@ -75,6 +85,8 @@
 
   connect( mGeneral, SIGNAL(openCategoryDialog()),
            SIGNAL(editCategories()) );
+  connect( this, SIGNAL(updateCategoryConfig()),
+           mGeneral, SIGNAL(updateCategoryConfig()) );
 
   connect( mDetails, SIGNAL(updateAttendeeSummary(int)),
            mGeneral, SLOT(updateAttendeeSummary(int)) );
@@ -220,13 +232,13 @@
     Todo *oldTodo = mTodo->clone();
     Todo *todo = mTodo->clone();
 
-    writeTodo( todo );
+    fillTodo( todo );
 
     if( *mTodo == *todo ) {
       // Don't do anything
     } else {
       //IncidenceChanger::assignIncidence( mTodo, todo );
-      writeTodo( mTodo );
+      fillTodo( mTodo );
       mChanger->changeIncidence( oldTodo, mTodo );
     }
     delete todo;
@@ -237,7 +249,7 @@
     mTodo = new Todo;
     mTodo->setOrganizer( Person( KOPrefs::instance()->fullName(), KOPrefs::instance()->email() ) );
 
-    writeTodo( mTodo );
+    fillTodo( mTodo );
 
     if ( !mChanger->addIncidence( mTodo, this ) ) {
       delete mTodo;
@@ -298,13 +310,13 @@
   readDesignerFields( todo );
 }
 
-void KOTodoEditor::writeTodo( Todo *todo )
+void KOTodoEditor::fillTodo( Todo *todo )
 {
   Incidence *oldIncidence = todo->clone();
 
-  mGeneral->writeTodo( todo );
-  mDetails->writeIncidence( todo );
-  mRecurrence->writeIncidence( todo );
+  mGeneral->fillTodo( todo );
+  mDetails->fillIncidence( todo );
+  mRecurrence->fillIncidence( todo );
 
   if ( *( oldIncidence->recurrence() ) != *( todo->recurrence() ) ) {
     todo->setDtDue( todo->dtDue(), true );
@@ -367,7 +379,7 @@
 void KOTodoEditor::slotSaveTemplate( const QString &templateName )
 {
   Todo *todo = new Todo;
-  writeTodo( todo );
+  fillTodo( todo );
   saveAsTemplate( todo, templateName );
 }
 
Index: korganizer/koeditorgeneraljournal.cpp
===================================================================
--- korganizer/koeditorgeneraljournal.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeditorgeneraljournal.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -176,7 +176,7 @@
   setCategories( journal->categories() );
 }
 
-void KOEditorGeneralJournal::writeJournal( Journal *journal )
+void KOEditorGeneralJournal::fillJournal( Journal *journal )
 {
   journal->setSummary( mSummaryEdit->text() );
   if ( mRichDescription->isChecked() ) {
Index: korganizer/koeditordetails.cpp
===================================================================
--- korganizer/koeditordetails.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeditordetails.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -281,7 +281,7 @@
   emit updateAttendeeSummary( mListView->childCount() );
 }
 
-void KOEditorDetails::writeIncidence( Incidence *incidence )
+void KOEditorDetails::fillIncidence( Incidence *incidence )
 {
   incidence->clearAttendees();
   QVector<Q3ListViewItem*> toBeDeleted;
@@ -326,7 +326,7 @@
     }
   }
 
-  KOAttendeeEditor::writeIncidence( incidence );
+  KOAttendeeEditor::fillIncidence( incidence );
 
   // cleanup
   qDeleteAll( toBeDeleted );
Index: korganizer/koeditorfreebusy.h
===================================================================
--- korganizer/koeditorfreebusy.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeditorfreebusy.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -60,7 +60,7 @@
     void clearAttendees();
 
     void readIncidence( KCal::Incidence *incidence );
-    void writeIncidence( KCal::Incidence *incidence );
+    void fillIncidence( KCal::Incidence *incidence );
 
     void triggerReload();
     void cancelReload();
Index: korganizer/kodaymatrix.cpp
===================================================================
--- korganizer/kodaymatrix.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/kodaymatrix.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -289,8 +289,10 @@
          !( recurType == Recurrence::rWeekly && !KOPrefs::instance()->mWeeklyRecur ) ) {
 
       DateTimeList timeDateList;
+      bool isRecurrent = event->recurs();
+      int eventDuration = event->dtStart().daysTo( event->dtEnd() );
 
-      if ( event->recurs() ) {
+      if ( isRecurrent ) {
         //Its a recurring event, find out in which days it occurs
         timeDateList = event->recurrence()->timesInInterval(
           *new KDateTime( mDays[0], mCalendar->timeSpec() ),
@@ -310,6 +312,13 @@
         QDate d = t->date();
         int j   = 0;
 
+        QDate occurrenceEnd;
+        if ( isRecurrent ) {
+          occurrenceEnd = d.addDays( eventDuration );
+        } else {
+          occurrenceEnd = event->dtEnd().date();
+        }
+
         do {
 
           mEvents.append( d );
@@ -317,7 +326,7 @@
           ++j;
           d = d.addDays( 1 );
 
-        } while ( d <= event->dtEnd().date() && j < NUMDAYS );
+        } while ( d <= occurrenceEnd && j < NUMDAYS );
       }
     }
   }
Index: korganizer/koeditorrecurrence.cpp
===================================================================
--- korganizer/koeditorrecurrence.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeditorrecurrence.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -1407,7 +1407,7 @@
   mExceptions->setDates( incidence->recurrence()->exDates() );
 }
 
-void KOEditorRecurrence::writeIncidence( Incidence *incidence )
+void KOEditorRecurrence::fillIncidence( Incidence *incidence )
 {
   if ( !mEnabledCheck->isChecked() || !isEnabled() ) {
     if ( incidence->recurs() ) {
Index: korganizer/kotodoeditor.h
===================================================================
--- korganizer/kotodoeditor.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/kotodoeditor.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -82,7 +82,7 @@
     void readTodo( Todo *todo, bool tmpl = false );
 
     /** Write To-do settings to todo object */
-    void writeTodo( Todo *todo );
+    void fillTodo( Todo *todo );
 
     /** Check if the input is valid. */
     bool validateInput();
@@ -108,6 +108,7 @@
     void setupGeneral();
     void setupRecurrence();
     int msgItemDelete();
+    bool incidenceModified();
 
   private:
     Todo *mTodo;
Index: korganizer/filtereditdialog.cpp
===================================================================
--- korganizer/filtereditdialog.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/filtereditdialog.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -292,6 +292,8 @@
 
   if ( !mCategorySelectDialog ) {
     mCategorySelectDialog = new KPIM::CategorySelectDialog( KOPrefs::instance(), this );
+    mCategorySelectDialog->setHelp( "categories-view", "korganizer" );
+    mCategorySelectDialog->setButtons( KDialog::Ok | KDialog::Cancel | KDialog::Help );
     connect( mCategorySelectDialog, SIGNAL(categoriesSelected(const QStringList&)),
              SLOT(updateCategorySelection(const QStringList&)) );
     connect( mCategorySelectDialog, SIGNAL(editCategories()),
Index: korganizer/views/monthview/monthgraphicsitems.cpp
===================================================================
--- korganizer/views/monthview/monthgraphicsitems.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/views/monthview/monthgraphicsitems.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -164,7 +164,10 @@
 
 QPainterPath MonthGraphicsItem::shape() const
 {
-  return widgetPath( true );
+  // The returned shape must be a closed path,
+  // otherwise MonthScene:itemAt( pos ) can have
+  // problems detecting the item
+  return widgetPath( false );
 }
 
 // TODO: remove this method.
Index: korganizer/views/todoview/kotodomodel.cpp
===================================================================
--- korganizer/views/todoview/kotodomodel.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/views/todoview/kotodomodel.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -800,8 +800,10 @@
     if ( role == Qt::EditRole ) {
       switch ( index.column() ) {
         case SummaryColumn:
-          todo->setSummary( value.toString() );
-          modified = KOGlobals::SUMMARY_MODIFIED;
+          if ( !value.toString().isEmpty() ) {
+            todo->setSummary( value.toString() );
+            modified = KOGlobals::SUMMARY_MODIFIED;
+          }
           break;
         case PriorityColumn:
           todo->setPriority( value.toInt() );
Index: korganizer/views/todoview/kotodoview.cpp
===================================================================
--- korganizer/views/todoview/kotodoview.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/views/todoview/kotodoview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -233,6 +233,8 @@
   }
   connect( mPercentageCompletedPopupMenu, SIGNAL(triggered(QAction *)),
            SLOT(setNewPercentage(QAction *)) );
+
+  setMinimumHeight( 50 );
 }
 
 KOTodoView::~KOTodoView()
Index: korganizer/views/whatsnextview/kowhatsnextview.cpp
===================================================================
--- korganizer/views/whatsnextview/kowhatsnextview.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/views/whatsnextview/kowhatsnextview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -104,10 +104,10 @@
 
   Event::List events;
   KDateTime::Spec timeSpec = KOPrefs::instance()->timeSpec();
-  for ( QDate date = mStartDate; date <= mEndDate; date = date.addDays( 1 ) ) {
-    events += calendar()->events( date, timeSpec, EventSortStartDate, SortDirectionAscending );
-  }
 
+  events = calendar()->events( mStartDate, mEndDate, timeSpec, false );
+  calendar()->sortEvents( &events, EventSortStartDate, SortDirectionAscending );
+
   if ( events.count() > 0 ) {
     mText += "<p></p>";
     kil.loadIcon( "view-calendar-day", KIconLoader::NoGroup, 22,
Index: korganizer/views/timespentview/kotimespentview.cpp
===================================================================
--- korganizer/views/timespentview/kotimespentview.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/views/timespentview/kotimespentview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -79,16 +79,62 @@
       QMap<QString, int> secondsSpent;
 
       int total = 0;
+
       foreach ( Event *e, mEventList ) {
+
+        KDateTime selectedStart( mTimeSpentView->mStartDate,
+                                 QTime( 0, 0 ),
+                                 e->dtStart().timeSpec() );
+
+        KDateTime selectedEnd( mTimeSpentView->mEndDate.addDays( 1 ),
+                               QTime( 0, 0 ),
+                               e->dtEnd().timeSpec() );
+
+        KDateTime start;
+        KDateTime end;
+
+        // duration of all occurrences added
+        int totalDuration = 0;
+
+        if ( e->recurs() ) {
+          int eventDuration = e->dtStart().secsTo( e->dtEnd() );
+
+          // timesInInterval only return events that have their start inside the interval
+          // so we resize the interval by -eventDuration
+          DateTimeList times = e->recurrence()->timesInInterval( selectedStart.addSecs( -eventDuration ), selectedEnd );
+
+          foreach ( KDateTime kdt, times ) {
+            // either the event's start or the event's end must be in the view's interval
+            if ( kdt >= selectedStart ||
+                 kdt.addSecs( eventDuration ) >= selectedStart ) {
+
+              start = kdt > selectedStart ? kdt : selectedStart;
+              end   = kdt.addSecs( eventDuration ) < selectedEnd ? kdt.addSecs( eventDuration ) : selectedEnd;
+              totalDuration += start.secsTo( end );
+            }
+          }
+
+        } else {
+          // The event's start can be before the view's start date or end after the view's end
+          start  = e->dtStart() > selectedStart ? e->dtStart() : selectedStart;
+          end    = e->dtEnd()   < selectedEnd   ? e->dtEnd()   : selectedEnd;
+
+          totalDuration += start.secsTo( end );
+        }
+
+        if ( totalDuration == 0 ) {
+          continue;
+        }
+
         if ( e->categories().count() ) {
           foreach ( const QString &s, e->categories() ) {
-            secondsSpent[ s ] += e->dtStart().secsTo( e->dtEnd() );
+            secondsSpent[ s ] += totalDuration;
           }
         } else {
-          secondsSpent[ i18n( "No category" ) ] += e->dtStart().secsTo( e->dtEnd() );
+          secondsSpent[ i18n( "No category" ) ] += totalDuration;
         }
 
-        total += e->dtStart().secsTo( e->dtEnd() );
+        total += totalDuration;
       }
 
       QMapIterator<QString, int> i( secondsSpent );
@@ -201,14 +247,9 @@
   }
   text+="</h2>\n";
   */
-  Event::List events;
+
   KDateTime::Spec timeSpec = KOPrefs::instance()->timeSpec();
-  for ( QDate date = mStartDate; date <= mEndDate; date = date.addDays( 1 ) ) {
-    events += calendar()->events( date, timeSpec,
-                                  EventSortStartDate, SortDirectionAscending );
-  }
-
-  mView->mEventList = events;
+  mView->mEventList = calendar()->events( mStartDate, mEndDate, timeSpec );
   mView->repaint();
 }
 
Index: korganizer/views/agendaview/koagendaview.cpp
===================================================================
--- korganizer/views/agendaview/koagendaview.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/views/agendaview/koagendaview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -1244,8 +1244,15 @@
     }
     if ( todo ) {
       QTime t = todo->dtDue().toTimeSpec( KOPrefs::instance()->timeSpec() ).time();
-      endY = mAgenda->timeToY( t ) - 1;
-      startY = mAgenda->timeToY( t.addSecs( -1800 ) );
+
+      int halfHour = 1800;
+      if ( t.addSecs( -halfHour ) < t ) {
+        startY = mAgenda->timeToY( t.addSecs( -halfHour ) );
+        endY   = mAgenda->timeToY( t ) - 1;
+      } else {
+        startY = 0;
+        endY   = mAgenda->timeToY( t.addSecs( halfHour ) ) - 1;
+      }
     }
     if ( endY < startY ) {
       endY = startY;
@@ -1471,7 +1478,7 @@
 void KOAgendaView::updateEventIndicatorTop( int newY )
 {
   for ( int i = 0; i < mMinY.size(); ++i ) {
-    mEventIndicatorTop->enableColumn( i, newY >= mMinY[i] );
+    mEventIndicatorTop->enableColumn( i, newY > mMinY[i] );
   }
   mEventIndicatorTop->update();
 }
@@ -1544,8 +1551,12 @@
   KConfigGroup group = config->group( "Views" );
 
   QList<int> sizes = group.readEntry( "Separator AgendaView", QList<int>() );
-  mSplitterAgenda->setSizes( sizes );
 
+  // the size depends on the number of plugins used
+  if ( sizes.count() >= 2 ) {
+    mSplitterAgenda->setSizes( sizes );
+  }
+
   updateConfig();
 }
 
Index: korganizer/views/agendaview/koagendaitem.cpp
===================================================================
--- korganizer/views/agendaview/koagendaitem.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/views/agendaview/koagendaitem.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -879,16 +879,7 @@
   QColor textColor = getTextColor( bgColor );
   p.setPen( textColor );
 
-  p.setFont( KOPrefs::instance()->agendaCalendarItemsFont() );
-  if ( mIncidence ) {
-    if ( mIncidence->type() == "Event" ) {
-      p.setFont( KOPrefs::instance()->agendaCalendarItemsEventsFont() );
-    }
-    if ( mIncidence->type() == "Todo" ) {
-      p.setFont( KOPrefs::instance()->agendaCalendarItemsToDosFont() );
-    }
-  }
-
+  p.setFont( KOPrefs::instance()->agendaViewFont() );
   QFontMetrics fm = p.fontMetrics();
 
   int singleLineHeight = fm.boundingRect( mLabelText ).height();
Index: korganizer/kojournaleditor.h
===================================================================
--- korganizer/kojournaleditor.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/kojournaleditor.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -97,7 +97,7 @@
     void readJournal( Journal *journal, bool tmpl = false );
 
     /** Write Journal settings to journal object */
-    void writeJournal( Journal * );
+    void fillJournal( Journal * );
 
     int msgItemDelete();
 
@@ -123,6 +123,7 @@
     void setupGeneral();
     void loadTemplate( CalendarLocal & );
     QStringList &templates() const;
+    bool incidenceModified();
 
   private:
     Journal *mJournal;
Index: korganizer/koeditordetails.h
===================================================================
--- korganizer/koeditordetails.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeditordetails.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -95,7 +95,7 @@
     void readIncidence( Incidence * );
 
     /** Write settings to incidence */
-    void writeIncidence( Incidence * );
+    void fillIncidence( Incidence * );
 
     /** Check if the input is valid. */
     bool validateInput();
Index: korganizer/koeditorrecurrence.h
===================================================================
--- korganizer/koeditorrecurrence.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeditorrecurrence.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -314,7 +314,7 @@
     void readIncidence( Incidence * );
 
     /** Write event settings to event object */
-    void writeIncidence( Incidence * );
+    void fillIncidence( Incidence * );
 
     /** Check if the input is valid. */
     bool validateInput();
Index: korganizer/calendarview.cpp
===================================================================
--- korganizer/calendarview.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/calendarview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -145,8 +145,6 @@
   mDateNavigator->setObjectName( "CalendarView::DateNavigator" );
 
 //  mLeftSplitter->setResizeMode( mDateNavigator, QSplitter::Stretch );
-  mLeftSplitter->setCollapsible( mLeftSplitter->indexOf(mDateNavigator), true );
-
   mTodoList = new KOTodoView( CalendarNull::self(), mLeftSplitter );
   mTodoList->setObjectName( "todolist" );
 
@@ -1256,6 +1254,7 @@
   if ( alarms.isEmpty() ) {
     // Add an alarm if it didn't have one
     Alarm *alm = incidence->newAlarm();
+    alm->setType( Alarm::Display );
     alm->setEnabled( true );
   }
   mChanger->changeIncidence( oldincidence, incidence, KOGlobals::ALARM_MODIFIED );
@@ -2141,18 +2140,28 @@
           i18n( "KOrganizer Confirmation" ),
           KGuiItem( i18n( "Delete All" ) ) );
       } else {
-        km = KOMessageBox::fourBtnMsgBox(
-          this,
-          QMessageBox::Warning,
-          i18n( "The calendar item \"%1\" recurs over multiple dates. "
-                "Do you want to delete only the current one on %2, only all "
-                "future recurrences, or all its recurrences?",
-                incidence->summary(),
-                KGlobal::locale()->formatDate( itemDate ) ),
-          i18n( "KOrganizer Confirmation" ),
-          KGuiItem( i18n( "Delete C&urrent" ) ),
-          KGuiItem( i18n( "Delete &Future" ) ),
-          KGuiItem( i18n( "Delete &All" ) ) );
+        KDateTime itemDateTime( itemDate, KOPrefs::instance()->timeSpec() );
+        bool isFirst = !incidence->recurrence()->getPreviousDateTime( itemDateTime ).isValid();
+        bool isLast  = !incidence->recurrence()->getNextDateTime( itemDateTime ).isValid();
+        KGuiItem itemFuture( i18n( "Delete &Future" ) );
+        itemFuture.setEnabled( !isFirst && !isLast );
+
+        if ( !( isFirst && isLast ) ) {
+          km = KOMessageBox::fourBtnMsgBox(
+            this,
+            QMessageBox::Warning,
+            i18n( "The calendar item \"%1\" recurs over multiple dates. "
+                  "Do you want to delete only the current one on %2, only all "
+                  "future recurrences, or all its recurrences?",
+                  incidence->summary(),
+                  KGlobal::locale()->formatDate( itemDate ) ),
+            i18n( "KOrganizer Confirmation" ),
+            KGuiItem( i18n( "Delete C&urrent" ) ),
+            itemFuture,
+            KGuiItem( i18n( "Delete &All" ) ) );
+        } else {
+          km = msgItemDelete( incidence );
+        }
       }
     }
     switch( km ) {
Index: korganizer/koeditorgeneraltodo.h
===================================================================
--- korganizer/koeditorgeneraltodo.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeditorgeneraltodo.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -65,7 +65,7 @@
     void readTodo( Todo *todo, bool tmpl = false );
 
     /** Write todo settings to event object */
-    void writeTodo( Todo * );
+    void fillTodo( Todo * );
 
     /** Check if the input is valid. */
     bool validateInput();
Index: korganizer/kojournaleditor.cpp
===================================================================
--- korganizer/kojournaleditor.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/kojournaleditor.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -136,7 +136,7 @@
 
   if ( mJournal ) {
     Journal *oldJournal = mJournal->clone();
-    writeJournal( mJournal );
+    fillJournal( mJournal );
     mChanger->changeIncidence( oldJournal, mJournal );
     delete oldJournal;
   } else {
@@ -144,7 +144,7 @@
     mJournal->setOrganizer( Person( KOPrefs::instance()->fullName(),
                             KOPrefs::instance()->email() ) );
 
-    writeJournal( mJournal );
+    fillJournal( mJournal );
 
     if ( !mChanger->addIncidence( mJournal, this ) ) {
       delete mJournal;
@@ -176,6 +176,16 @@
   mGeneral->setTime( time );
 }
 
+bool KOJournalEditor::incidenceModified() {
+  Journal *newJournal = 0;
+
+  if ( mJournal ) {
+    newJournal = mJournal->clone();
+    fillJournal( newJournal );
+  }
+  return mJournal && !( *newJournal == *mJournal );
+}
+
 void KOJournalEditor::readJournal( Journal *journal, bool tmpl )
 {
   //TODO: just tmpl variable
@@ -189,10 +199,10 @@
   mDetails->readIncidence( journal );
 }
 
-void KOJournalEditor::writeJournal( Journal *journal )
+void KOJournalEditor::fillJournal( Journal *journal )
 {
-  mGeneral->writeJournal( journal );
-  mDetails->writeIncidence( journal );
+  mGeneral->fillJournal( journal );
+  mDetails->fillIncidence( journal );
 }
 
 bool KOJournalEditor::validateInput()
@@ -229,7 +239,7 @@
 void KOJournalEditor::slotSaveTemplate( const QString &templateName )
 {
   Journal *journal = new Journal;
-  writeJournal( journal );
+  fillJournal( journal );
   saveAsTemplate( journal, templateName );
 }
 
Index: korganizer/koeditorattachments.cpp
===================================================================
--- korganizer/koeditorattachments.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeditorattachments.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -775,7 +775,7 @@
   }
 }
 
-void KOEditorAttachments::writeIncidence( KCal::Incidence *i )
+void KOEditorAttachments::fillIncidence( KCal::Incidence *i )
 {
   i->clearAttachments();
 
Index: korganizer/koincidenceeditor.cpp
===================================================================
--- korganizer/koincidenceeditor.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koincidenceeditor.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -86,8 +86,13 @@
 {
 }
 
+bool KOIncidenceEditor::incidenceModified() {
+  return true;
+}
+
 void KOIncidenceEditor::slotButtonClicked( int button )
 {
+  bool dontQuit = false;
   switch( button ) {
   case KDialog::Ok:
   {
@@ -104,13 +109,16 @@
     processInput();
     break;
   case KDialog::Cancel:
-    if ( KMessageBox::questionYesNo(
-           this,
-           i18nc( "@info", "Do you really want to cancel?" ),
-           i18nc( "@title:window", "KOrganizer Confirmation" ) ) == KMessageBox::Yes ) {
-      processCancel();
-      KDialog::reject();
-    }
+    dontQuit = incidenceModified() &&
+               KMessageBox::questionYesNo(
+                 this,
+                 i18nc( "@info", "Do you really want to cancel?" ),
+                 i18nc( "@title:window", "KOrganizer Confirmation" ) ) == KMessageBox::No;
+
+    if ( !dontQuit ) {
+       processCancel();
+       KDialog::reject();
+     }
     break;
   default:
     KPageDialog::slotButtonClicked( button );
Index: korganizer/resourceview.cpp
===================================================================
--- korganizer/resourceview.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/resourceview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -308,6 +308,8 @@
   connect( mDeleteButton, SIGNAL( clicked() ), SLOT( removeResource() ) );
   connect( mEditButton, SIGNAL( clicked() ), SLOT( editResource() ) );
 
+  setMinimumHeight( 50 );
+
   updateView();
 }
 
Index: korganizer/koeventpopupmenu.cpp
===================================================================
--- korganizer/koeventpopupmenu.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeventpopupmenu.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -103,6 +103,7 @@
     }
     for ( it = mRecurrenceItems.begin(); it != mRecurrenceItems.end(); ++it ) {
       (*it)->setVisible( mCurrentIncidence->recurs() );
+      (*it)->setEnabled( !mCurrentIncidence->isReadOnly() );
     }
     popup( QCursor::pos() );
   } else {
Index: korganizer/koeventviewer.cpp
===================================================================
--- korganizer/koeventviewer.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeventviewer.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -46,6 +46,7 @@
 {
   mIncidence = 0;
   setNotifyClick( true );
+  setMinimumHeight( 1 );
 }
 
 KOEventViewer::~KOEventViewer()
Index: korganizer/kcmconfigs/korganizer_configtime.desktop
===================================================================
--- korganizer/kcmconfigs/korganizer_configtime.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/kcmconfigs/korganizer_configtime.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -29,6 +29,7 @@
 Name[ja]=日付と時間
 Name[km]=កាលបរិច្ឆេទ និង​ពេលវេលា
 Name[ko]=시간과 날짜
+Name[lt]=Laikas ir data
 Name[lv]=Laiks un datums
 Name[nb]=Dato og klokkeslett
 Name[nds]=Tiet un Datum
Index: korganizer/incidencechanger.cpp
===================================================================
--- korganizer/incidencechanger.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/incidencechanger.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -314,21 +314,22 @@
     //        for group cheduling. Each implementation could then just do what
     //        it wants with the event. If no groupware is used,use the null
     //        pattern...
-    bool revert = KOPrefs::instance()->mUseGroupwareCommunication;
-    if ( revert &&
-        KOGroupware::instance()->sendICalMessage( 0,
-                                                  KCal::iTIPRequest,
-                                                  newinc, false, statusChanged ) ) {
+    bool success = true;
+    if ( KOPrefs::instance()->mUseGroupwareCommunication ) {
+      success = KOGroupware::instance()->sendICalMessage( 0,
+                                                          KCal::iTIPRequest,
+                                                          newinc, false, statusChanged );
+    }
+
+    if ( success ) {
       // Accept the event changes
       if ( action < 0 ) {
         emit incidenceChanged( oldinc, newinc );
       } else {
         emit incidenceChanged( oldinc, newinc, action );
       }
-      revert = false;
-    }
-
-    if ( revert ) {
+    } else {
+      // revert changes
       assignIncidence( newinc, oldinc );
       return false;
     }
Index: korganizer/koeditorgeneraljournal.h
===================================================================
--- korganizer/koeditorgeneraljournal.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeditorgeneraljournal.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -69,7 +69,7 @@
     /** Read journal object and setup widgets accordingly */
     void readJournal( Journal *, bool tmpl = false );
     /** Write journal settings to event object */
-    void writeJournal( Journal * );
+    void fillJournal( Journal * );
 
     /** Check if the input is valid. */
     bool validateInput();
Index: korganizer/koeditoralarms.cpp
===================================================================
--- korganizer/koeditoralarms.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koeditoralarms.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -199,6 +199,7 @@
   connect( this, SIGNAL(okClicked()), SLOT(slotOk()) );
   connect( this, SIGNAL(applyClicked()), SLOT(slotApply()) );
   init();
+  mWidget.mTypeEmailRadio->hide();
 }
 
 KOEditorAlarms::~KOEditorAlarms()
@@ -282,7 +283,7 @@
   mWidget.mRepeats->setChecked( alarm->repeatCount() > 0 );
   if ( alarm->repeatCount() > 0 ) {
     mWidget.mRepeatCount->setValue( alarm->repeatCount() );
-    mWidget.mRepeatInterval->setValue( alarm->snoozeTime().asSeconds() / 60 );
+    mWidget.mRepeatInterval->setValue( alarm->snoozeTime().asSeconds() / 60 ); // show as minutes
   }
   int id = 0;
 
@@ -355,7 +356,7 @@
   // Repeating
   if ( mWidget.mRepeats->isChecked() ) {
     alarm->setRepeatCount( mWidget.mRepeatCount->value() );
-    alarm->setSnoozeTime( mWidget.mRepeatInterval->value() );
+    alarm->setSnoozeTime( mWidget.mRepeatInterval->value() * 60 ); // convert back to seconds
   } else {
     alarm->setRepeatCount( 0 );
   }
Index: korganizer/koincidenceeditor.h
===================================================================
--- korganizer/koincidenceeditor.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koincidenceeditor.h	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -133,6 +133,11 @@
     void readDesignerFields( Incidence *i );
     void writeDesignerFields( Incidence *i );
 
+    /**
+      Returns true if the user made any alteration
+    */
+    virtual bool incidenceModified();
+
     // Returns the page widget. To remove the tab, just delete that one.
     QWidget *addDesignerTab( const QString &uifile );
 
Index: korganizer/koprefsdialog.cpp
===================================================================
--- korganizer/koprefsdialog.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 940158)
+++ korganizer/koprefsdialog.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 940158)
@@ -220,8 +220,14 @@
       QGridLayout *regionalLayout = new QGridLayout( regionalPage );
       regionalLayout->setSpacing( KDialog::spacingHint() );
 
+      QGroupBox *datetimeGroupBox =
+        new QGroupBox( i18nc( "@title:group", "General Time and Date" ), regionalPage );
+      regionalLayout->addWidget( datetimeGroupBox, 0, 0 );
+
+      QGridLayout *datetimeLayout = new QGridLayout( datetimeGroupBox );
+
       KHBox *timeZoneBox = new KHBox( regionalPage );
-      regionalLayout->addWidget( timeZoneBox, 0, 0, 1, 2 );
+      datetimeLayout->addWidget( timeZoneBox, 0, 0, 1, 2 );
 
       QLabel *timeZoneLabel = new QLabel( i18nc( "@label", "Time zone:" ), timeZoneBox );
       QString whatsThis = i18nc( "@info:whatsthis",
@@ -265,9 +271,20 @@
       mTimeZoneCombo->setCurrentIndex( nCurrentlySet );
       mTimeZoneCombo->setWhatsThis( whatsThis );
 
+      KPrefsWidTime *dayBegins =
+        addWidTime( KOPrefs::instance()->dayBeginsItem(), regionalPage );
+      datetimeLayout->addWidget( dayBegins->label(), 1, 0 );
+      datetimeLayout->addWidget( dayBegins->timeEdit(), 1, 1 );
+
+      QGroupBox *holidaysGroupBox =
+        new QGroupBox( i18nc( "@title:group", "Holidays" ), regionalPage );
+      regionalLayout->addWidget( holidaysGroupBox, 1, 0 );
+
+      QGridLayout *holidaysLayout = new QGridLayout( holidaysGroupBox );
+
       // holiday region selection
       KHBox *holidayRegBox = new KHBox( regionalPage );
-      regionalLayout->addWidget( holidayRegBox, 1, 0, 1, 2 );
+      holidaysLayout->addWidget( holidayRegBox, 1, 0, 1, 2 );
 
       QLabel *holidayLabel = new QLabel(
         i18nc( "@label", "Use holiday region:" ), holidayRegBox );
@@ -316,14 +333,9 @@
         }
       }
 
-      KPrefsWidTime *dayBegins =
-        addWidTime( KOPrefs::instance()->dayBeginsItem(), regionalPage );
-      regionalLayout->addWidget( dayBegins->label(), 2, 0 );
-      regionalLayout->addWidget( dayBegins->timeEdit(), 2, 1 );
-
       QGroupBox *workingHoursGroupBox =
         new QGroupBox( i18nc( "@title:group", "Working Hours" ), regionalPage );
-      regionalLayout->addWidget( workingHoursGroupBox, 3, 0, 1, 2 );
+      regionalLayout->addWidget( workingHoursGroupBox, 2, 0 );
 
       QBoxLayout *workingHoursLayout = new QVBoxLayout( workingHoursGroupBox );
 
@@ -385,16 +397,28 @@
       QGridLayout *defaultLayout = new QGridLayout( defaultPage );
       defaultLayout->setSpacing( KDialog::spacingHint() );
 
+      QGroupBox *timesGroupBox =
+        new QGroupBox( i18nc( "@title:group", "Appointments" ), defaultPage );
+      defaultLayout->addWidget( timesGroupBox, 0, 0 );
+
+      QGridLayout *timesLayout = new QGridLayout( timesGroupBox );
+
       KPrefsWidTime *defaultTime =
         addWidTime( KOPrefs::instance()->startTimeItem(), defaultPage );
-      defaultLayout->addWidget( defaultTime->label(), 0, 0 );
-      defaultLayout->addWidget( defaultTime->timeEdit(), 0, 1 );
+      timesLayout->addWidget( defaultTime->label(), 0, 0 );
+      timesLayout->addWidget( defaultTime->timeEdit(), 0, 1 );
 
       KPrefsWidDuration *defaultDuration =
         addWidDuration( KOPrefs::instance()->defaultDurationItem(), defaultPage );
-      defaultLayout->addWidget( defaultDuration->label(), 1, 0 );
-      defaultLayout->addWidget( defaultDuration->timeEdit(), 1, 1 );
+      timesLayout->addWidget( defaultDuration->label(), 1, 0 );
+      timesLayout->addWidget( defaultDuration->timeEdit(), 1, 1 );
 
+      QGroupBox *remindersGroupBox =
+        new QGroupBox( i18nc( "@title:group", "Reminders" ), defaultPage );
+      defaultLayout->addWidget( remindersGroupBox, 1, 0 );
+
+      QGridLayout *remindersLayout = new QGridLayout( remindersGroupBox );
+
       QStringList alarmList;
       alarmList << i18nc( "@item:inlistbox", "1 minute" )
                 << i18nc( "@item:inlistbox", "5 minutes" )
@@ -402,13 +426,13 @@
                 << i18nc( "@item:inlistbox", "15 minutes" )
                 << i18nc( "@item:inlistbox", "30 minutes" );
       QLabel *alarmLabel = new QLabel( i18nc( "@label", "Default reminder time:" ), defaultPage );
-      defaultLayout->addWidget( alarmLabel, 2, 0 );
+      remindersLayout->addWidget( alarmLabel, 0, 0 );
       alarmLabel->setWhatsThis( KOPrefs::instance()->alarmTimeItem()->whatsThis() );
       mAlarmTimeCombo = new KComboBox( defaultPage );
       mAlarmTimeCombo->setWhatsThis( KOPrefs::instance()->alarmTimeItem()->whatsThis() );
       connect( mAlarmTimeCombo, SIGNAL(activated(int)), SLOT(slotWidChanged()) );
       mAlarmTimeCombo->addItems( alarmList );
-      defaultLayout->addWidget( mAlarmTimeCombo, 2, 1 );
+      remindersLayout->addWidget( mAlarmTimeCombo, 0, 1 );
 
       defaultLayout->setRowStretch( 3, 1 );
       load();

Zmiany atrybutów dla: .
___________________________________________________________________
Dodane: svn:externals
   + 


