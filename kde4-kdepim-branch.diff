Index: akregator/Messages.sh
===================================================================
--- akregator/Messages.sh	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ akregator/Messages.sh	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -1,3 +1,3 @@
 #! /bin/sh
 $EXTRACTRC `find . -name "*.rc" -o -name "*.ui" -o -name "*.kcfg"` >> rc.cpp || exit 11
-$XGETTEXT $(find -name "*.cpp" ) -o $podir/akregator.pot
+$XGETTEXT $(find . -name "*.cpp" -o -name "*.h") -o $podir/akregator.pot
Index: akregator/src/subscriptionlistmodel.cpp
===================================================================
--- akregator/src/subscriptionlistmodel.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ akregator/src/subscriptionlistmodel.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -447,6 +447,9 @@
     {
         const TreeNode* const droppedOnNode = qobject_cast<const TreeNode*>( nodeForIndex( parent, m_feedList ) );
 
+        if ( !droppedOnNode )
+            return false;
+
         const Folder* const destFolder = droppedOnNode->isGroup() ? qobject_cast<const Folder*>( droppedOnNode ) : droppedOnNode->parent();
         if ( !destFolder )
             return false;
Index: akregator/configuration/akregator_config_advanced.desktop
===================================================================
--- akregator/configuration/akregator_config_advanced.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ akregator/configuration/akregator_config_advanced.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -21,6 +21,7 @@
 Name[fr]=Avancé
 Name[ga]=Ardsocruithe
 Name[gl]=Avanzado
+Name[is]=Nánari stillingar
 Name[it]=Avanzate
 Name[ja]=詳細
 Name[km]=កម្រិត​ខ្ពស់
Index: libkleo/libkleopatrarc.desktop
===================================================================
--- libkleo/libkleopatrarc.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ libkleo/libkleopatrarc.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -288,6 +288,7 @@
 Name[it]=Chiavi per le firme qualificate
 Name[ja]=適格電子署名用の鍵
 Name[km]=សោ​សម្រាប់​ហត្ថលេខា​ដែល​មាន​​គុណភាព
+Name[lt]=Raktai kvalifikuotiems parašams
 Name[lv]=Derīgo parakstu atslēgas
 Name[nb]=Nøkler for kvalifiserte signaturer
 Name[nds]=Slötels för pröövt Ünnerschriften
Index: kode/kwsdl/kwsdl_compiler.desktop
===================================================================
--- kode/kwsdl/kwsdl_compiler.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kode/kwsdl/kwsdl_compiler.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -14,6 +14,7 @@
 Name[kk]=KWSDL компиляторы
 Name[km]=កម្មវិធី​ចងក្រង KWSDL
 Name[ko]=KWSDL 컴파일러
+Name[lt]=KWSDL kompiliatorius
 Name[lv]=KWSDL kompilators
 Name[nb]=KWSDL-kompilator
 Name[nds]=KWSDL-Kompilerer
Index: kode/kxforms/kxforms.desktop
===================================================================
--- kode/kxforms/kxforms.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kode/kxforms/kxforms.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -23,6 +23,7 @@
 GenericName[kk]=XML пішін өңдегіші
 GenericName[km]=កម្មវិធី​និពន្ធ​សំណុំ​បែបបទ​របស់ XML
 GenericName[ko]=XML 폼 편집기
+GenericName[lt]=XML formų rengyklė
 GenericName[lv]=XML formu redaktors
 GenericName[nb]=XML skjemaredigerer
 GenericName[nds]=XML-Kiekwarkeditor
Index: kleopatra/kwatchgnupg/kwatchgnupgmainwin.cpp
===================================================================
--- kleopatra/kwatchgnupg/kwatchgnupgmainwin.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kleopatra/kwatchgnupg/kwatchgnupgmainwin.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -105,7 +105,7 @@
 
 void KWatchGnuPGMainWindow::createActions()
 {
-  QAction *action = actionCollection()->addAction( "clear_log" );
+  KAction *action = actionCollection()->addAction( "clear_log" );
   action->setIcon( KIcon("edit-clear-history") );
   action->setText( i18n("C&lear History") );
   connect(action, SIGNAL(triggered()), SLOT( slotClear() ));
Index: kleopatra/kleopatra_import.desktop
===================================================================
--- kleopatra/kleopatra_import.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kleopatra/kleopatra_import.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -16,7 +16,7 @@
 Comment[ca]=Gestor de certificats i IGU criptogràfica unificada
 Comment[cs]=Správce certifikátů a rozhraní pro šifrování
 Comment[da]=Certifikathåndtering og forenet krypterings-GUI
-Comment[de]=Zertifikatsverwaltung und Kryptographie-Oberfläche
+Comment[de]=Zertifikatsverwaltung und Kryptografie-Oberfläche
 Comment[el]=Διαχειριστής πιστοποιητικών και GUI ενοποιημένης κρυπτογράφησης
 Comment[es]=Gestor de certificados e interfaz gráfica unificada de criptografía
 Comment[et]=Sertifikaadihaldur ja ühendatud krüptimise graafiline kasutajaliides
Index: kleopatra/libkleopatraclient/CMakeLists.txt
===================================================================
--- kleopatra/libkleopatraclient/CMakeLists.txt	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kleopatra/libkleopatraclient/CMakeLists.txt	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -1,5 +1,5 @@
-set( libkleopatraclient_soversion 0.2.1 )
-set( libkleopatraclient_version ${libkleopatraclient_soversion} )
+set( libkleopatraclient_version "0.2.1" )
+set( libkleopatraclient_soversion "0" )
 
 add_subdirectory( core )
 add_subdirectory( gui )
Index: kresources/scalix/kabc/scalix.desktop
===================================================================
--- kresources/scalix/kabc/scalix.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kresources/scalix/kabc/scalix.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -44,6 +44,7 @@
 Comment[it]=Consente l'accesso ai contatti memorizzati su un server Scalix che usa IMAP tramite KMail o Kontact
 Comment[ja]=KMail または Kontact 経由で IMAP を使って、Scalix サーバに保存されている連絡先へのアクセスを提供します
 Comment[km]=ផ្ដល់​សិទ្ធិ​ចូល​ដំណើរការ​ទៅកាន់​ទំនាក់ទំនង​ដែល​បាន​រក្សាទុក​នៅ​លើ​ម៉ាស៊ីន​បម្រើ Scalix ដោយប្រើ IMAP តាមរយៈ KMail ឬ Kontact
+Comment[lt]=Suteikia prieigą prie kontaktų, saugomų Scalix serveryje, naudojant KMail (Kontact) programos IMAP protokolą
 Comment[lv]=Nodrošina piekļuvi kontaktiem, kas glabājas Scalix severī, izmantojot IMAP caur KMail vai Kontact
 Comment[nb]=Gir tilgang til en kalender lagret på en Scalix-tjener som bruker IMAP, via KMail eller Kontact
 Comment[nds]=Stellt mit KMail oder Kontact över IMAP Topgriep op Kontakten op en Scalix-Server praat
Index: kresources/slox/kabc_ox.desktop
===================================================================
--- kresources/slox/kabc_ox.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kresources/slox/kabc_ox.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -57,6 +57,7 @@
 Comment[it]=Consente l'accesso ai contatti memorizzati su un server Open-Xchange
 Comment[ja]=Open-Xchange サーバに保存されている連絡先へのアクセスを提供します
 Comment[km]=ផ្ដល់​សិទ្ធិ​ចូល​ដំណើរការ​ទៅកាន់​ទំនាក់ទំនង​ដែល​បាន​រក្សាទុក​នៅ​លើ​ម៉ាស៊ីន​បម្រើ Open-Xchange
+Comment[lt]=Suteikia prieigą prie kontaktų, saugomų Open-Xchange serveryje
 Comment[lv]=Nodrošina piekļuvi kontaktiem, kas glabājas Open-Xchange serverī.
 Comment[nb]=Gir tilgang til kontakter lagret på en Open-Xchange-tjener
 Comment[nds]=Stellt Togriep op de op en Open-Xchange-Server wohrten Kontakten praat
Index: kresources/kolab/shared/kmailconnection.h
===================================================================
--- kresources/kolab/shared/kmailconnection.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kresources/kolab/shared/kmailconnection.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -142,6 +142,11 @@
 private:
   ResourceKolabBase* mResource;
   OrgKdeKmailGroupwareInterface* mKmailGroupwareInterface;
+
+  /// The current name of the D-Bus service we're connected to. This is used to remember the old
+  /// service name if KMail gets disconnected, so that we can find out when KMail is started again
+  /// by looking for a newly appeared service with that name.
+  QString mOldServiceName;
 };
 
 }
Index: kresources/kolab/shared/kmailconnection.cpp
===================================================================
--- kresources/kolab/shared/kmailconnection.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kresources/kolab/shared/kmailconnection.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -78,6 +78,7 @@
     }
     mKmailGroupwareInterface = new OrgKdeKmailGroupwareInterface( dbusService, KMAIL_DBUS_GROUPWARE_PATH,
                                                                   QDBusConnection::sessionBus() );
+    mOldServiceName = mKmailGroupwareInterface->service();
 
     connect( mKmailGroupwareInterface, SIGNAL(incidenceAdded(QString,QString,uint,int,QString)),
              SLOT(fromKMailAddIncidence(QString,QString,uint,int,QString)) );
@@ -280,12 +281,19 @@
 
 void KMailConnection::dbusServiceOwnerChanged(const QString & service, const QString&, const QString&)
 {
-  if (mKmailGroupwareInterface && mKmailGroupwareInterface->service() == service)
-  {
-    // Delete the stub so that the next time we need to talk to kmail,
-    // we'll know that we need to start a new one.
-    delete mKmailGroupwareInterface;
-    mKmailGroupwareInterface = 0;
+  // The owner of the D-Bus service we're interested in changed, so either connect or disconnect.
+  if ( mOldServiceName == service && !service.isEmpty() ) {
+    if ( mKmailGroupwareInterface )
+    {
+      // Delete the stub so that the next time we need to talk to kmail,
+      // we'll know that we need to start a new one.
+      delete mKmailGroupwareInterface;
+      mKmailGroupwareInterface = 0;
+    }
+    else {
+      if ( !connectToKMail() )
+        kWarning(5650) << "Could not connect to KMail, even though the D-Bus service just became available!";
+    }
   }
 }
 
Index: kresources/akonadi/kabc/akonadi.desktop
===================================================================
--- kresources/akonadi/kabc/akonadi.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kresources/akonadi/kabc/akonadi.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -13,6 +13,7 @@
 Name[it]=Rubrica indirizzi di Akonadi
 Name[ja]=Akonadi アドレス帳
 Name[km]=សៀវភៅ​អាសយដ្ឋាន Akonadi
+Name[lt]=Akonadi adresų knygelės
 Name[lv]=Akonadi adrešu grāmatas
 Name[nb]=Akonadi adressebøker
 Name[nds]=Akonadi-Adressbook instellen
Index: kresources/featureplan/kcal_resourcefeatureplan.desktop
===================================================================
--- kresources/featureplan/kcal_resourcefeatureplan.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kresources/featureplan/kcal_resourcefeatureplan.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -23,6 +23,7 @@
 Name[lt]=XML bruožų planas
 Name[lv]=XML iespēju plāns
 Name[ms]=Pelan Cirian XML 
+Name[nb]=XML-funksjonsplan
 Name[nds]=XML-Funkschonenplaan
 Name[ne]=एक्सएमएल विशेषता योजना
 Name[nl]=Functionaliteitsplanning in XML
Index: kmail/templateparser.cpp
===================================================================
--- kmail/templateparser.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/templateparser.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -27,6 +27,8 @@
 #include "customtemplates_kfg.h"
 #include "globalsettings_base.h"
 #include "kmkernel.h"
+#include "partNode.h"
+#include "attachmentcollector.h"
 
 #include <mimelib/bodypart.h>
 
@@ -851,37 +853,72 @@
     }
   }
 
-  // kDebug(5006) << "Message body:" << body;
+  addProcessedBodyToMessage( body );
+}
 
+
+void TemplateParser::addProcessedBodyToMessage( const QString &body )
+{
   if ( mAppend ) {
+
+    // ### What happens here if the body is multipart or in some way encoded?
     QByteArray msg_body = mMsg->body();
     msg_body.append( body.toUtf8() );
     mMsg->setBody( msg_body );
-  } else {
+  }
+  else {
 
-    // FIXME: We set the processed template to the first plain text part fo the
-    //        message. This will probably break in the following cases:
-    //        1. HTML-only message with attachment (simple multipart/mixed)
-    //        2. Messages with multiple text/plain parts. We only replace the
-    //           first part with the processed templates, the other parts stay
-    //           the same.
-    //           The composer then uses an ObjectTreeParser to get the plain text
-    //           of the complete message, which will likely include the other
-    //           parts twice.
-    //           Possible solution: Set a dummy zero length body for all other
-    //           plaintext parts.
-    DwEntity *entityToChange = 0;
-    if ( mMsg->typeStr().toLower() == "multipart" ) {
-      entityToChange = mMsg->findDwBodyPart( "text", "plain" );
-      if ( !entityToChange )
-        kWarning() << "No text/plain part found in this multipart message, "
-                      "template parser can not set the text!";
+    // Get the attachments of the original mail
+    partNode *root = partNode::fromMessage( mMsg );
+    KMail::AttachmentCollector ac;
+    ac.setDiveIntoEncryptions( true );
+    ac.setDiveIntoSignatures( true );
+    ac.setDiveIntoMessages( false );
+    ac.collectAttachmentsFrom( root );
+
+    // Now, delete the old content and set the new content, which
+    // is either only the new text or the new text with some attachments.
+    mMsg->deleteBodyParts();
+
+    // If we have no attachment, simply create a text/plain part and
+    // set the processed template text as the body
+    if ( ac.attachments().empty() ) {
+      mMsg->headers().ContentType().FromString( DwString() ); // to get rid of old boundary
+      mMsg->headers().ContentType().Parse();
+      mMsg->headers().ContentType().SetType( DwMime::kTypeText );
+      mMsg->headers().ContentType().SetSubtype( DwMime::kSubtypePlain );
+      mMsg->headers().Assemble();
+      mMsg->setBodyFromUnicode( body );
+      mMsg->assembleIfNeeded();
     }
 
-    mMsg->setBodyFromUnicode( body, entityToChange );
+    // If we have some attachments, create a multipart/mixed mail and
+    // add the normal body as well as the attachments
+    else
+    {
+      mMsg->headers().ContentType().SetType( DwMime::kTypeMultipart );
+      mMsg->headers().ContentType().SetSubtype( DwMime::kSubtypeMixed );
+      mMsg->headers().ContentType().CreateBoundary( 0 );
+
+      KMMessagePart textPart;
+      textPart.setBodyFromUnicode( body );
+      mMsg->addDwBodyPart( mMsg->createDWBodyPart( &textPart ) );
+      mMsg->assembleIfNeeded();
+
+      foreach( const partNode *attachment, ac.attachments() ) {
+
+        // When adding this body part, make sure to _not_ add the next bodypart
+        // as well, which mimelib would do, therefore creating a mail with many
+        // duplicate attachments (so many that KMail runs out of memory, in fact).
+        // Body::AddBodyPart is very misleading here...
+        attachment->dwPart()->SetNext( 0 );
+
+        mMsg->addDwBodyPart( attachment->dwPart() );
+        mMsg->assembleIfNeeded();
+      }
+    }
   }
 }
-
 QString TemplateParser::findCustomTemplate( const QString &tmplName )
 {
   CTemplates t( tmplName );
Index: kmail/dbusmail.desktop
===================================================================
--- kmail/dbusmail.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/dbusmail.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -20,6 +20,7 @@
 Comment[kk]=DBUS интерфейсті пошта бағдарламасы
 Comment[km]=កម្មវិធី​សំបុត្រ​ដែល​មាន​ចំណុច​ប្រទាក់ DBUS
 Comment[ko]=DBUS 인터페이스를 사용하는 전자 우편 프로그램
+Comment[lt]=Pašto programa su D-Bus sąsaja
 Comment[lv]=Pasta programma ar DBUS saskarni
 Comment[nb]=E-postprogram med DBUS-grensesnitt
 Comment[nds]=Nettpostprogramm mit en D-Bus-Koppelsteed
Index: kmail/messagelistview/pane.cpp
===================================================================
--- kmail/messagelistview/pane.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/messagelistview/pane.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -685,6 +685,7 @@
   if ( !w )
     return;
 
+  w->view()->setAllGroupsExpanded( true );
   w->view()->selectAll();
 }
 
Index: kmail/messagelistview/widget.cpp
===================================================================
--- kmail/messagelistview/widget.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/messagelistview/widget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -577,7 +577,7 @@
     Q_ASSERT( mb );
 
     selectedSernums.append( mb->getMsgSerNum() );
-    if ( view()->isCurrentlyViewable( ( *it ) ) )
+    if ( view()->isDisplayedWithParentsExpanded( ( *it ) ) )
       selectedVisibleSernums.append( mb->getMsgSerNum() );
 
     if ( topmost == 0 )
Index: kmail/messagelistview/storagemodel.cpp
===================================================================
--- kmail/messagelistview/storagemodel.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/messagelistview/storagemodel.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -87,6 +87,9 @@
   connect( mFolder, SIGNAL( msgHeaderChanged( KMFolder * , int ) ),
            SLOT( slotMessageHeaderChanged( KMFolder *, int ) ) );
 
+  connect( mFolder, SIGNAL( viewConfigChanged() ),
+           SLOT( slotViewConfigChanged() ) );
+
 #if 0
   // FIXME: Do we need to handle these remaining signals ?
 
@@ -109,8 +112,6 @@
   /** Emitted when a folder was removed */
   void removed(KMFolder*, bool);
 
-  /** Emitted when the variables for the config of the view have changed */
-  void viewConfigChanged();
 #endif
 
   mMessageCount = mFolder->count();
@@ -179,6 +180,12 @@
       this, SLOT( slotMessageHeaderChanged( KMFolder *, int ) )
     );
 
+  disconnect(
+      mFolder, SIGNAL( viewConfigChanged() ),
+      this, SLOT( slotViewConfigChanged() )
+    );
+
+
   //mFolder->markNewAsUnread(); <-- do we REALLY need to do this ?.. couldn't we use a timed-expire instead ?
   if ( mFolder->dirty() )
     mFolder->writeIndex(); // this is straight from KMHeaders...
@@ -596,6 +603,11 @@
   reset();
 }
 
+void StorageModel::slotViewConfigChanged()
+{
+  reset();
+}
+
 void StorageModel::slotFolderExpunged()
 {
   slotFolderClosed();
Index: kmail/messagelistview/core/model.cpp
===================================================================
--- kmail/messagelistview/core/model.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/messagelistview/core/model.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -472,7 +472,7 @@
 
   if ( mStorageModel && column->isSenderOrReceiver() )
   {
-    if ( mStorageModel->containsOutboundMessages() )
+    if ( mStorageModelContainsOutboundMessages )
       return QVariant( i18n( "Receiver" ) );
     return QVariant( i18n( "Sender" ) );
   }
@@ -648,6 +648,7 @@
 
   mPreSelectionMode = preSelectionMode;
   mUniqueIdOfLastSelectedMessageInFolder = Manager::instance()->preSelectedMessageForStorageModel( mStorageModel );
+  mStorageModelContainsOutboundMessages = mStorageModel->containsOutboundMessages();
 
   connect( mStorageModel, SIGNAL( rowsInserted( const QModelIndex &, int, int ) ),
            this, SLOT( slotStorageModelRowsInserted( const QModelIndex &, int, int ) ) );
@@ -808,6 +809,37 @@
   viewItemJobStep();
 }
 
+void Model::checkIfDateChanged()
+{
+  // This function is called by MessageListView::Core::Manager once in a while (every 1 minute or sth).
+  // It is used to check if the current date has changed (with respect to mTodayDate).
+  //
+  // Our message items cache the formatted dates (as formatting them
+  // on the fly would be too expensive). We also cache the labels of the groups which often display dates.
+  // When the date changes we would need to fix all these strings.
+  //
+  // A dedicated algorithm to refresh the labels of the items would be either too complex
+  // or would block on large trees. Fixing the labels of the groups is also quite hard...
+  //
+  // So to keep the things simple we just reload the view.
+
+  if ( !mStorageModel )
+    return; // nothing to do
+
+  if ( mLoading )
+    return; // not now
+
+  if ( !mViewItemJobs->isEmpty() )
+    return; // not now
+
+  if ( mTodayDate.day() == QDate::currentDate().day() )
+    return; // date not changed
+
+  // date changed, reload the view (and try to preserve the current selection)
+  setStorageModel( mStorageModel, PreSelectLastSelected );
+}
+
+
 void Model::abortMessagePreSelection()
 {
   // This is used to abort a message pre-selection before we actually could apply it.
@@ -1535,6 +1567,49 @@
 
 // Subject threading cache stuff
 
+#if 0
+// Debug helpers
+void dump_iterator_and_list( QList< MessageItem * >::Iterator &iter, QList< MessageItem * > *list )
+{
+  kDebug() << "Threading cache part dump" << endl;
+  if ( iter == list->end() )
+    kDebug() << "Iterator pointing to end of the list" << endl;
+  else
+    kDebug() << "Iterator pointing to " << *iter << " subject [" << (*iter)->subject() << "] date [" << (*iter)->date() << "]" << endl;
+
+  for ( QList< MessageItem * >::Iterator it = list->begin(); it != list->end(); ++it )
+  {
+    kDebug() << "List element " << *it << " subject [" << (*it)->subject() << "] date [" << (*it)->date() << "]" << endl;
+  }
+
+  kDebug() << "End of threading cache part dump" << endl;
+}
+
+void dump_list( QList< MessageItem * > *list )
+{
+  kDebug() << "Threading cache part dump" << endl;
+
+  for ( QList< MessageItem * >::Iterator it = list->begin(); it != list->end(); ++it )
+  {
+    kDebug() << "List element " << *it << " subject [" << (*it)->subject() << "] date [" << (*it)->date() << "]" << endl;
+  }
+
+  kDebug() << "End of threading cache part dump" << endl;
+}
+#endif // debug helpers
+
+// a helper class used in a qLowerBound() call below
+class MessageLessThanByDate
+{
+public:
+  inline bool operator()( const MessageItem * mi1, const MessageItem * mi2 ) const
+  {
+    if ( mi1->date() == mi2->date() )
+      return mi1 < mi2;
+    return mi1->date() < mi2->date();
+  }
+};
+
 void Model::addMessageToSubjectBasedThreadingCache( MessageItem * mi )
 {
   // Unfortunately the entries in the cache can't be sorted by date. This is
@@ -1554,35 +1629,16 @@
   Q_ASSERT( !messagesWithTheSameStrippedSubject->contains( mi ) );
 
   // Binary search based insertion
-  QList< MessageItem * >::Iterator it = qLowerBound( messagesWithTheSameStrippedSubject->begin(), messagesWithTheSameStrippedSubject->end(), mi );
+  QList< MessageItem * >::Iterator it = qLowerBound( messagesWithTheSameStrippedSubject->begin(), messagesWithTheSameStrippedSubject->end(), mi, MessageLessThanByDate() );
   messagesWithTheSameStrippedSubject->insert( it, mi );
 }
 
-#if 0
-// Debug helper
-void dump_iterator_and_list( QList< MessageItem * >::Iterator &iter, QList< MessageItem * > *list )
-{
-  kDebug() << "Threading cache part dump" << endl;
-  if ( iter == list->end() )
-    kDebug() << "Iterator pointing to end of the list" << endl;
-  else
-    kDebug() << "Iterator pointing to " << *iter << " subject [" << (*iter)->subject() << "] date [" << (*iter)->date() << "]" << endl;
-
-  for ( QList< MessageItem * >::Iterator it = list->begin(); it != list->end(); ++it )
-  {
-    kDebug() << "List element " << *it << " subject [" << (*it)->subject() << "] date [" << (*it)->date() << "]" << endl;
-  }
-
-  kDebug() << "End of threading cache part dump" << endl;
-}
-#endif
-
 void Model::removeMessageFromSubjectBasedThreadingCache( MessageItem * mi )
 {
   QList< MessageItem * > * messagesWithTheSameStrippedSubject = mThreadingCacheMessageSubjectMD5ToMessageItem->value( mi->strippedSubjectMD5(), 0 );
   Q_ASSERT( messagesWithTheSameStrippedSubject );
 
-  QList< MessageItem * >::Iterator it = qLowerBound( messagesWithTheSameStrippedSubject->begin(), messagesWithTheSameStrippedSubject->end(), mi );
+  QList< MessageItem * >::Iterator it = qLowerBound( messagesWithTheSameStrippedSubject->begin(), messagesWithTheSameStrippedSubject->end(), mi, MessageLessThanByDate() );
   Q_ASSERT( it != messagesWithTheSameStrippedSubject->end() );
   Q_ASSERT( *it == mi );
 
@@ -2216,7 +2272,7 @@
       if ( applyFilterToSubtree( mi, index( pParent, 0 ) ) )
       {
         // mi matched, expand parents (unconditionally)
-        mView->ensureCurrentlyViewable( mi );
+        mView->ensureDisplayedWithParentsExpanded( mi );
       }
     }
   }
@@ -2619,7 +2675,7 @@
   int elapsed;
 
   // Should we use the receiver or the sender field for sorting ?
-  bool bUseReceiver = ( mStorageModel->containsOutboundMessages() );
+  bool bUseReceiver = mStorageModelContainsOutboundMessages;
 
   // The begin storage index of our work
   int curIndex = job->currentIndex();
@@ -2926,9 +2982,9 @@
       // Handle saving the current selection: if this item was the current before the step
       // then zero it out. We have killed it and it's OK for the current item to change.
 
-      if ( dyingMessage->isViewable() &&
-           dyingMessage == mCurrentItemToRestoreAfterViewItemJobStep )
+      if ( dyingMessage == mCurrentItemToRestoreAfterViewItemJobStep )
       {
+        Q_ASSERT( dyingMessage->isViewable() );
         // Try to select the item below the removed one as it helps in doing a "readon" of emails:
         // you read a message, decide to delete it and then go to the next.
         // Qt tends to select the message above the removed one instead (this is a hardcoded logic in
@@ -3028,12 +3084,21 @@
       // Parent is gone
       childMessage->setThreadingStatus( MessageItem::ParentMissing );
 
-      // If the child is going to be selected, we must immediately
-      // reattach it to a temporary group in order for the selection
-      // to be preserved across multiple steps. Otherwise we could end
+      // If the child (or any message in its subtree) is going to be selected,
+      // then we must immediately reattach it to a temporary group in order for the
+      // selection to be preserved across multiple steps. Otherwise we could end
       // with the child-to-be-selected being non viewable at the end
       // of the view job step. Attach to a temporary group.
-      if ( childMessage == mCurrentItemToRestoreAfterViewItemJobStep )
+      if (
+           // child is going to be re-selected
+           ( childMessage == mCurrentItemToRestoreAfterViewItemJobStep ) ||
+           (
+             // there is a message that is going to be re-selected
+             mCurrentItemToRestoreAfterViewItemJobStep && 
+             // that message is in the childMessage subtree
+             mCurrentItemToRestoreAfterViewItemJobStep->hasAncestor( childMessage )
+           )
+         )
       {
         attachMessageToGroupHeader( childMessage );
 
Index: kmail/messagelistview/core/view.cpp
===================================================================
--- kmail/messagelistview/core/view.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/messagelistview/core/view.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -230,6 +230,9 @@
   if ( !mTheme )
     return;
 
+  kDebug() << "Apply theme columns";
+
+
   const QList< Theme::Column * > & columns = mTheme->columns();
 
   if ( columns.count() < 1 )
@@ -278,12 +281,15 @@
   {
     if ( ( *it )->currentlyVisible() || ( idx == 0 ) )
     {
+      kDebug() << "Column " << idx << " will be visible";
       // Column visible
       int savedWidth = ( *it )->currentWidth();
       int hintWidth = mDelegate->sizeHintForItemTypeAndColumn( Item::Message, idx ).width();
       totalVisibleWidthHint += savedWidth > 0 ? savedWidth : hintWidth;
       lColumnSizeHints.append( hintWidth );
+      kDebug() << "Column " << idx << " size hint is " << hintWidth;
     } else {
+      kDebug() << "Column " << idx << " will be not visible";
       // The column is not visible
       lColumnSizeHints.append( -1 ); // dummy
     }
@@ -422,9 +428,12 @@
 
   idx = 0;
 
+  kDebug() << "Entering colum show/hide loop";
+
   for ( it = columns.begin(); it != columns.end(); ++it )
   {
     bool visible = ( idx == 0 ) || ( *it )->currentlyVisible();
+    kDebug() << "Column " << idx << " visible " << visible;
     ( *it )->setCurrentlyVisible( visible );
     header()->setSectionHidden( idx, !visible );
     idx++;
@@ -441,7 +450,7 @@
   {
     if ( ( *it )->currentlyVisible() )
     {
-      // kDebug() << "Resize section " << idx << " to " << lColumnWidths[ idx ];
+      kDebug() << "Resize section " << idx << " to " << lColumnWidths[ idx ];
       ( *it )->setCurrentWidth( lColumnWidths[ idx ] );
       header()->resizeSection( idx, lColumnWidths[ idx ] );
       totalVisibleWidth += lColumnWidths[ idx ];
@@ -501,6 +510,11 @@
   if ( !mTheme )
     return;
 
+  if ( mNeedToApplyThemeColumns )
+    return; // don't save the state if it hasn't been applied at all
+
+  kDebug() << "Save theme column state";
+
   const QList< Theme::Column * > & columns = mTheme->columns();
 
   if ( columns.count() < 1 )
@@ -513,9 +527,11 @@
   {
     if ( header()->isSectionHidden( idx ) )
     {
+      kDebug() << "Section " << idx << " is hidden";
       ( *it )->setCurrentlyVisible( false );
       ( *it )->setCurrentWidth( -1 ); // reset (hmmm... we could use the "don't touch" policy here too...)
     } else {
+      kDebug() << "Section " << idx << " is visible and has size " << header()->sectionSize( idx );
       ( *it )->setCurrentlyVisible( true );
       ( *it )->setCurrentWidth( header()->sectionSize( idx ) );
     }
@@ -872,9 +888,51 @@
 
 void View::setAllThreadsExpanded( bool expand )
 {
-  setChildrenExpanded( mModel->rootItem(), expand );
+  if ( mAggregation->grouping() == Aggregation::NoGrouping )
+  {
+    // we have no groups so threads start under the root item: just expand/unexpand all
+    setChildrenExpanded( mModel->rootItem(), expand );
+    return;
+  }
+
+  // grouping is in effect: must expand/unexpand one level lower
+
+  QList< Item * > * childList = mModel->rootItem()->childItems();
+  if ( !childList )
+    return;
+
+  foreach ( Item * item, *childList )
+    setChildrenExpanded( item, expand );
 }
 
+void View::setAllGroupsExpanded( bool expand )
+{
+  if ( mAggregation->grouping() == Aggregation::NoGrouping )
+    return; // no grouping in effect
+
+  Item * item = mModel->rootItem();
+
+  QList< Item * > * childList = item->childItems();
+  if ( !childList )
+    return;
+
+  foreach ( Item * item, *childList )
+  {
+    Q_ASSERT( item->type() == Item::GroupHeader );
+    QModelIndex idx = mModel->index( item, 0 );
+    Q_ASSERT( idx.isValid() );
+    Q_ASSERT( static_cast< Item * >( idx.internalPointer() ) == item );
+    if ( expand )
+    {
+      if ( !isExpanded( idx ) )
+        setExpanded( idx, true );
+    } else {
+      if ( isExpanded( idx ) )
+        setExpanded( idx, false );
+    }
+  }
+}
+
 void View::selectMessageItems( const QList< MessageItem * > &list )
 {
   QItemSelection selection;
@@ -886,7 +944,7 @@
     Q_ASSERT( static_cast< MessageItem * >( idx.internalPointer() ) == ( *it ) );
     if ( !selectionModel()->isSelected( idx ) )
       selection.append( QItemSelectionRange( idx ) );
-    ensureCurrentlyViewable( *it );
+    ensureDisplayedWithParentsExpanded( *it );
   }
   if ( !selection.isEmpty() )
     selectionModel()->select( selection, QItemSelectionModel::Select | QItemSelectionModel::Rows );
@@ -1105,7 +1163,7 @@
             // !expand items
             ( messageTypeFilter == MessageTypeAny ) &&
             // has unexpanded parents or is itself hidden
-            ( ! isCurrentlyViewable( above ) )
+            ( ! isDisplayedWithParentsExpanded( above ) )
           ) ||
           // is hidden
           isRowHidden( above->parent()->indexOfChildItem( above ), mModel->index( above->parent(), 0 ) )
@@ -1246,7 +1304,7 @@
   setFocus();
 
   if ( it->parent() != mModel->rootItem() )
-    ensureCurrentlyViewable( it );
+    ensureDisplayedWithParentsExpanded( it );
 
   QModelIndex idx = mModel->index( it, 0 );
 
@@ -1288,7 +1346,7 @@
   setFocus();
 
   if ( it->parent() != mModel->rootItem() )
-    ensureCurrentlyViewable( it );
+    ensureDisplayedWithParentsExpanded( it );
 
   QModelIndex idx = mModel->index( it, 0 );
 
@@ -1325,7 +1383,7 @@
   setFocus();
 
   if ( it->parent() != mModel->rootItem() )
-    ensureCurrentlyViewable( it );
+    ensureDisplayedWithParentsExpanded( it );
 
   QModelIndex idx = mModel->index( it, 0 );
 
@@ -1348,7 +1406,7 @@
   setFocus();
 
   if ( it->parent() != mModel->rootItem() )
-    ensureCurrentlyViewable( it );
+    ensureDisplayedWithParentsExpanded( it );
 
   QModelIndex idx = mModel->index( it, 0 );
 
@@ -1397,7 +1455,7 @@
   Q_ASSERT( it != mModel->rootItem() ); // must never happen (obviously)
 
   setFocus();
-  ensureCurrentlyViewable( it );
+  ensureDisplayedWithParentsExpanded( it );
 
   QModelIndex idx = mModel->index( it, 0 );
 
@@ -1458,7 +1516,7 @@
   viewport()->update();
 }
 
-void View::ensureCurrentlyViewable( Item * it )
+void View::ensureDisplayedWithParentsExpanded( Item * it )
 {
   Q_ASSERT( it );
   Q_ASSERT( it->parent() );
@@ -1486,29 +1544,45 @@
   }
 }
 
-bool View::isCurrentlyViewable( Item * it ) const
+bool View::isDisplayedWithParentsExpanded( Item * it ) const
 {
-  Q_ASSERT( it );
-  Q_ASSERT( it->parent() );
+  // An item is currently viewable iff
+  //  - it is marked as viewable in the item structure (that is, qt knows about its existence)
+  //      (and this means that all of its parents are marked as viewable)
+  //  - it is not explicitly hidden
+  //  - all of its parents are expanded
 
+  if ( !it )
+    return false; // be nice and allow the caller not to care
+
   if ( !it->isViewable() )
-    return false;
+    return false; // item not viewable (not attacched to the viewable root or qt not yet aware of it)
+
+  // the item and all the parents are marked as viewable.
+
   if ( isRowHidden( it->parent()->indexOfChildItem( it ), mModel->index( it->parent(), 0 ) ) )
-    return false;
+    return false; // item qt rappresentation explicitly hidden
 
+  // the item (and theoretically all the parents) are not explicitly hidden
+
+  // check the parent chain
+
   it = it->parent();
 
-  if ( it == mModel->rootItem() )
-    return true;
-
   while ( it )
   {
-    if ( it->parent() == mModel->rootItem() )
-      return true;
+    if ( it == mModel->rootItem() )
+      return true; // parent is root item: ok
+
+    // parent is not root item
+
     if ( !isExpanded( mModel->index( it, 0 ) ) )
-      return false;
-    it = it->parent();
+      return false; // parent is not expanded (so child not actually visible)
+
+    it = it->parent(); // climb up
   }
+
+  // parent hierarchy interrupted somewhere
   return false;
 }
 
@@ -2252,46 +2326,12 @@
 
 void View::slotCollapseAllGroups()
 {
-  if ( mAggregation->grouping() == Aggregation::NoGrouping )
-    return;
-
-  Item * item = mModel->rootItem();
-
-  QList< Item * > * childList = item->childItems();
-  if ( !childList )
-    return;
-
-  for ( QList< Item * >::Iterator it = childList->begin(); it != childList->end(); ++it )
-  {
-    Q_ASSERT( ( *it )->type() == Item::GroupHeader );
-    QModelIndex idx = mModel->index( *it, 0 );
-    Q_ASSERT( idx.isValid() );
-    Q_ASSERT( static_cast< Item * >( idx.internalPointer() ) == ( *it ) );
-    if ( isExpanded( idx ) )
-      setExpanded( idx, false );
-  }
+  setAllGroupsExpanded( false );
 }
 
 void View::slotExpandAllGroups()
 {
-  if ( mAggregation->grouping() == Aggregation::NoGrouping )
-    return;
-
-  Item * item = mModel->rootItem();
-
-  QList< Item * > * childList = item->childItems();
-  if ( !childList )
-    return;
-
-  for ( QList< Item * >::Iterator it = childList->begin(); it != childList->end(); ++it )
-  {
-    Q_ASSERT( ( *it )->type() == Item::GroupHeader );
-    QModelIndex idx = mModel->index( *it, 0 );
-    Q_ASSERT( idx.isValid() );
-    Q_ASSERT( static_cast< Item * >( idx.internalPointer() ) == ( *it ) );
-    if ( !isExpanded( idx ) )
-      setExpanded( idx, true );
-  }
+  setAllGroupsExpanded( true );
 }
 
 } // namespace Core
Index: kmail/messagelistview/core/manager.h
===================================================================
--- kmail/messagelistview/core/manager.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/messagelistview/core/manager.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -24,8 +24,10 @@
 #include "messagelistview/core/sortorder.h"
 #include <QList>
 #include <QHash>
+#include <QObject>
 
 class QPixmap;
+class QTimer;
 
 namespace KMime
 {
@@ -63,20 +65,22 @@
  * before the first MessageListView::Widget and destroyed after the last MessageListView::Widget.
  * But in KMail this is always the case :)
  */
-class Manager
+class Manager : public QObject
 {
+  Q_OBJECT
 protected:
   Manager();
   ~Manager();
 
 private:
-  static Manager *mInstance;
+  static Manager * mInstance;
   QList< Widget * > mWidgetList;
   QHash< QString, Aggregation * > mAggregations;
   QHash< QString, Theme * > mThemes;
   KMime::DateFormatter * mDateFormatter;
   bool mDisplayMessageToolTips;
   QString mCachedLocalizedUnknownText;
+  QTimer * mHeartBeatTimer;
 
   // pixmaps, never null
 
@@ -258,6 +262,15 @@
    */
   void reloadAllWidgets();
 
+protected slots:
+  /**
+   * This slot is connected to a very slow timer (1 minute).
+   * It actually sweeps through the registered models calling
+   * checkIfDateChanged() in order to fix date displays.
+   * Later we could find other uses for the heartbeat.
+   */
+  void slotHeartBeat();
+
 private:
   // internal configuration stuff
   void loadConfiguration();
Index: kmail/messagelistview/core/model.h
===================================================================
--- kmail/messagelistview/core/model.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/messagelistview/core/model.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -51,6 +51,7 @@
 class Filter;
 class GroupHeaderItem;
 class Item;
+class Manager;
 class MessageItem;
 class Theme;
 class StorageModel;
@@ -76,6 +77,7 @@
 class Model : public QAbstractItemModel
 {
   friend class Item;
+  friend class Manager;
 
   Q_OBJECT
 public:
@@ -183,7 +185,7 @@
 
   /**
    * Owned invisible root item, useful to implement algorithms that not need
-   * to handle the special case of parentless items
+   * to handle the special case of parentless items. This is never 0.
    */
   Item *mRootItem;
 
@@ -339,6 +341,13 @@
    */
   Model * mModelForItemFunctions;
 
+  /**
+   * The cached result of StorageModel::containsOutboundMessages().
+   * We access this property at each incoming message and StorageModel::containsOutboundMessages() is
+   * virtual (so it's always an indirect function call). Caching makes sense.
+   */
+  bool mStorageModelContainsOutboundMessages;
+
 public:
 
   /**
@@ -389,6 +398,7 @@
 
   /**
    * Returns the hidden root item that all the messages are (or will be) attached to.
+   * The returned value is never 0.
    */
   Item * rootItem() const
     { return mRootItem; };
@@ -466,8 +476,16 @@
   void deletePersistentSet( MessageItemSetReference ref );
 
 protected:
+
   void fillView();
 
+  /**
+   * This is called by MessageListView::Manager once in a while.
+   * It is a good place to check if the date has changed and
+   * trigger a view reload.
+   */
+  void checkIfDateChanged();
+
 protected slots:
   void viewItemJobStep();
 
Index: kmail/messagelistview/core/manager.cpp
===================================================================
--- kmail/messagelistview/core/manager.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/messagelistview/core/manager.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -27,8 +27,10 @@
 #include "messagelistview/core/configurethemesdialog.h"
 #include "messagelistview/core/widgetbase.h"
 #include "messagelistview/core/storagemodelbase.h"
+#include "messagelistview/core/model.h"
 
 #include <QPixmap>
+#include <QTimer>
 
 #include <kmime/kmime_dateformatter.h> // kdepimlibs
 
@@ -53,6 +55,7 @@
 Manager * Manager::mInstance = 0;
 
 Manager::Manager()
+  : QObject()
 {
   mInstance = this;
 
@@ -96,14 +99,26 @@
 
   mCachedLocalizedUnknownText = i18nc( "Unknown date", "Unknown" ) ;
 
+  mHeartBeatTimer = new QTimer(this);
+  QObject::connect(
+      mHeartBeatTimer,SIGNAL(timeout()),
+      this,SLOT(slotHeartBeat())
+    );
+
+  mHeartBeatTimer->start(60000); // 1 minute
+
   loadConfiguration();
 }
 
 Manager::~Manager()
 {
+  mHeartBeatTimer->stop();
+
   saveConfiguration();
   removeAllAggregations();
 
+  delete mHeartBeatTimer;
+
   delete mPixmapMessageNew;
   delete mPixmapMessageUnread;
   delete mPixmapMessageRead;
@@ -138,10 +153,22 @@
   ConfigureAggregationsDialog::cleanup(); // make sure it's dead
   ConfigureThemesDialog::cleanup(); // make sure it's dead
 
-
   mInstance = 0;
 }
 
+void Manager::slotHeartBeat()
+{
+  // sweep through all the models asking them to check their dates
+  for( QList< Widget * >::Iterator it = mWidgetList.begin(); it != mWidgetList.end(); ++it )
+  {
+    if ( !( *it )->view() )
+      continue;
+    if ( !( *it )->view()->model() )
+      continue;
+    ( *it )->view()->model()->checkIfDateChanged();
+  }
+}
+
 void Manager::showConfigureAggregationsDialog( Widget *requester, const QString &preselectAggregationId )
 {
   ConfigureAggregationsDialog::display( requester ? requester->window() : 0, preselectAggregationId );
Index: kmail/messagelistview/core/view.h
===================================================================
--- kmail/messagelistview/core/view.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/messagelistview/core/view.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -159,16 +159,17 @@
   void setCurrentMessageItem( MessageItem * it );
 
   /**
-   * Returns true if the specified item is currently viewable.
-   * For 'viewable' here we mean not hidden and with parents expanded.
+   * Returns true if the specified item is currently displayed in the tree
+   * and has all the parents expanded. This means that the user can
+   * see the message (by eventually scrolling the view).
    */
-  bool isCurrentlyViewable( Item * it ) const;
+  bool isDisplayedWithParentsExpanded( Item * it ) const;
 
   /**
-   * Makes sure that the specified is currently viewable.
-   * For 'viewable' here we mean not hidden and with parents expanded.
+   * Makes sure that the specified is currently viewable by the user.
+   * This means that the user can see the message (by eventually scrolling the view).
    */
-  void ensureCurrentlyViewable( Item * it );
+  void ensureDisplayedWithParentsExpanded( Item * it );
 
   /**
    * Returns the currently selected MessageItems (bound to current StorageModel).
@@ -260,6 +261,14 @@
   void setAllThreadsExpanded( bool expand );
 
   /**
+   * If expand is true then it expands all the groups (only the toplevel
+   * group item: inner threads are NOT expanded). If expand is false
+   * then it collapses all the groups. If no grouping is in effect
+   * then this function does nothing.
+   */
+  void setAllGroupsExpanded( bool expand );
+
+  /**
    * Selects the next message item in the view.
    *
    * messageTypeFilter can be used to limit the selection to
Index: kmail/messagelistview/core/themedelegate.cpp
===================================================================
--- kmail/messagelistview/core/themedelegate.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/messagelistview/core/themedelegate.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -65,6 +65,10 @@
 void ThemeDelegate::setTheme( const Theme * theme )
 {
   mTheme = theme;
+
+  if ( !mTheme )
+    return; // hum
+
   // yep..we're violating const here
   // But most of the QStyledItemDelegate virtual methods are const and expect
   // const behaviour. So we need the const pointer to avoid compiler complains
Index: kmail/messagelistview/storagemodel.h
===================================================================
--- kmail/messagelistview/storagemodel.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/messagelistview/storagemodel.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -227,6 +227,11 @@
   /**
    * Internal handler of KMFolder signal.
    */
+  void slotViewConfigChanged();
+
+  /**
+   * Internal handler of KMFolder signal.
+   */
   void slotMessageHeaderChanged( KMFolder *folder, int idx );
 
 };
Index: kmail/kleo_util.h
===================================================================
--- kmail/kleo_util.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/kleo_util.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -77,5 +77,12 @@
   return f == Kleo::InlineOpenPGPFormat || f == Kleo::OpenPGPMIMEFormat ;
 }
 
+static inline bool containsSMIME( unsigned int f ) {
+  return f & (Kleo::SMIMEFormat|Kleo::SMIMEOpaqueFormat) ;
+}
 
+static inline bool containsOpenPGP( unsigned int f ) {
+  return f & (Kleo::OpenPGPMIMEFormat|Kleo::InlineOpenPGPFormat) ;
+}
+
 #endif // __KDEPIM_KMAIL_KLEO_UTIL_H__
Index: kmail/mainfolderview.cpp
===================================================================
--- kmail/mainfolderview.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/mainfolderview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -174,6 +174,7 @@
 
       popup->setObjectName( "subMenu" );
       popup->setTitle( label );
+      popup->setIcon( KIcon( fvi->normalIcon() ) );
 
       folderToPopupMenuInternal( action, target, popup, fvi );
 
@@ -199,12 +200,13 @@
 
       if ( subMenu )
       {
+        popup->addSeparator();
+
         QAction* act;
         if ( action == MoveMessage || action == MoveFolder )
           act = popup->addAction( i18n("Move to This Folder") );
         else
           act = popup->addAction( i18n("Copy to This Folder") );
-        popup->addSeparator();
 
         act->setData( QVariant::fromValue<void *>( (void *)( fvi->folder() ) ) );
       }
@@ -214,7 +216,7 @@
     } else {
 
       // insert an item
-      QAction* act = menu->addAction( label );
+      QAction* act = menu->addAction( KIcon( fvi->normalIcon() ), label );
       if ( fvi->folder() )
         act->setData( QVariant::fromValue<void *>( (void *)( fvi->folder() ) ) );
       bool enabled = (fvi->folder() ? true : false);
Index: kmail/identitylistview.cpp
===================================================================
--- kmail/identitylistview.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/identitylistview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -113,7 +113,8 @@
     header()->setMovable( false );
     setAllColumnsShowFocus( true );
     setAlternatingRowColors( true );
-    setSortingEnabled( false ); // disabled
+    setSortingEnabled( true );
+    sortByColumn( 0, Qt::AscendingOrder );
     setSelectionMode( SingleSelection ); // ### Extended would be nicer...
     setColumnWidth( 0, 175 );
 
Index: kmail/kmmessage.h
===================================================================
--- kmail/kmmessage.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/kmmessage.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -488,6 +488,12 @@
   void setNeedsAssembly();
 
   /**
+   * Assemble the internal message. This is done automatically in most
+   * cases, but sometimes still necessary to call this manually.
+   */
+  void assembleIfNeeded();
+
+  /**
    * Get or set the 'Content-Transfer-Encoding' header field
    * The member functions that involve enumerated types (ints)
    * will work only for well-known encodings.
@@ -880,6 +886,21 @@
   /** Delete this message as soon as it no longer in use. */
   void deleteWhenUnused();
 
+#ifndef NDEBUG
+
+  /**
+   * Dump the internal mimelib message structure to kDebug().
+   * This is useful if there are inconsistencies because of a missing
+   * Parse() or Assemble().
+   *
+   * This function is recursive, pass 0 as level when calling this with
+   * the root entity.
+   *
+   * If entity is 0, the root will be dumped.
+   */
+  void dump( DwEntity *entity = 0, int level = 0 );
+#endif
+
 private:
 
   /** Initialization shared by the ctors. */
@@ -890,7 +911,7 @@
   QString mDrafts;
   QString mTemplates;
   mutable DwMessage* mMsg;
-  mutable bool       mNeedsAssembly :1;
+  mutable bool mNeedsAssembly :1;
   bool mDecodeHTML :1;
   bool mReadyToShow :1;
   bool mComplete :1;
Index: kmail/kmail_config_composer.desktop
===================================================================
--- kmail/kmail_config_composer.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/kmail_config_composer.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -80,6 +80,7 @@
 Comment[ja]=メール作成の設定
 Comment[km]=ការ​កំណត់​កម្មវិធី​តែង​សារ
 Comment[ko]=메시지 작성기 설정
+Comment[lt]=Laiškų rengyklės nustatymai
 Comment[lv]=Vēstuļu rastītāja iestatījumi
 Comment[nb]=Innstillinger for meldingskomposer
 Comment[nds]=Narichteneditor instellen
Index: kmail/kmreaderwin.cpp
===================================================================
--- kmail/kmreaderwin.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/kmreaderwin.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -699,7 +699,7 @@
   connect( mCopyURLAction, SIGNAL(triggered(bool)), SLOT(slotUrlCopy()) );
 
   // open URL
-  mUrlOpenAction = new KAction( i18n( "Open URL" ), this );
+  mUrlOpenAction = new KAction( KIcon( "document-open" ), i18n( "Open URL" ), this );
   ac->addAction( "open_url", mUrlOpenAction );
   connect( mUrlOpenAction, SIGNAL(triggered(bool)), SLOT(slotUrlOpen()) );
 
Index: kmail/kmmessage.cpp
===================================================================
--- kmail/kmmessage.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/kmmessage.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -1145,7 +1145,6 @@
 KMMessage* KMMessage::createForward( const QString &tmpl /* = QString() */ )
 {
   KMMessage* msg = new KMMessage();
-  QString id;
 
   // If this is a multipart mail or if the main part is only the text part,
   // Make an identical copy of the mail, minus headers, so attachments are
@@ -1156,8 +1155,7 @@
     msg->fromDwString( this->asDwString() );
     // remember the type and subtype, initFromMessage sets the contents type to
     // text/plain, via initHeader, for unclear reasons
-    const int type = msg->type();
-    const int subtype = msg->subtype();
+    DwMediaType oldContentType = msg->mMsg->Headers().ContentType();
 
     msg->sanitizeHeaders();
 
@@ -1174,12 +1172,14 @@
       }
     }
     msg->mMsg->Assemble();
+    msg->initFromMessage( this );
 
-    msg->initFromMessage( this );
     //restore type
-    msg->setType( type );
-    msg->setSubtype( subtype );
-  } else if( type() == DwMime::kTypeText && subtype() == DwMime::kSubtypeHtml ) {
+    msg->mMsg->Headers().ContentType().FromString( oldContentType.AsString() );
+    msg->mMsg->Headers().ContentType().Parse();
+    msg->mMsg->Assemble();
+  }
+  else if( type() == DwMime::kTypeText && subtype() == DwMime::kSubtypeHtml ) {
     // This is non-multipart html mail. Let`s make it text/plain and allow
     // template parser do the hard job.
     msg->initFromMessage( this );
@@ -1187,7 +1187,8 @@
     msg->setSubtype( DwMime::kSubtypeHtml );
     msg->mNeedsAssembly = true;
     msg->cleanupHeader();
-  } else {
+  }
+  else {
     // This is a non-multipart, non-text mail (e.g. text/calendar). Construct
     // a multipart/mixed mail and add the original body as an attachment.
     msg->initFromMessage( this );
@@ -2495,7 +2496,17 @@
   mNeedsAssembly = true;
 }
 
+//-----------------------------------------------------------------------------
+void KMMessage::assembleIfNeeded()
+{
+  Q_ASSERT( mMsg );
 
+  if ( mNeedsAssembly ) {
+    mMsg->Assemble();
+    mNeedsAssembly = false;
+  }
+}
+
 //-----------------------------------------------------------------------------
 QByteArray KMMessage::body() const
 {
@@ -2653,6 +2664,8 @@
   }
 
   entity->Body().FromString( dwResult );
+  entity->Body().Parse();
+
   mNeedsAssembly = true;
 }
 
@@ -4262,3 +4275,26 @@
 {
   s->pendingDeletes << this;
 }
+
+#ifndef NDEBUG
+void KMMessage::dump( DwEntity *entity, int level )
+{
+  if ( !entity )
+    entity = mMsg;
+
+  QString spaces;
+  for ( int i = 1; i <= level; i++ )
+    spaces += "  ";
+
+  kDebug() << QString( spaces + "Headers of entity " + entity->partId() + ":" );
+  kDebug() << QString( spaces + entity->Headers().AsString().c_str() );
+  kDebug() << QString( spaces + "Body of entity " + entity->partId() + ":" );
+  kDebug() << QString( spaces + entity->Body().AsString().c_str() );
+
+  DwBodyPart *current = entity->Body().FirstBodyPart();
+  while ( current ) {
+    dump( current, level + 1 );
+    current = current->Next();
+  }
+}
+#endif
Index: kmail/dbusimap.desktop
===================================================================
--- kmail/dbusimap.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/dbusimap.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -20,6 +20,7 @@
 Comment[kk]=DBUS интерфейсті пошта бағдарламасы
 Comment[km]=កម្មវិធី​សំបុត្រ​ដែល​មាន​ចំណុច​ប្រទាក់ DBUS
 Comment[ko]=DBUS 인터페이스를 사용하는 전자 우편 프로그램
+Comment[lt]=Pašto programa su D-Bus sąsaja
 Comment[lv]=Pasta programma ar DBUS saskarni
 Comment[nb]=E-postprogram med DBUS-grensesnitt
 Comment[nds]=Nettpostprogramm mit en D-Bus-Koppelsteed
Index: kmail/templateparser.h
===================================================================
--- kmail/templateparser.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/templateparser.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -47,10 +47,11 @@
                     bool aSmartQuote, bool aallowDecryption,
                     bool aselectionIsBody );
 
-    virtual void process( KMMessage *aorig_msg, KMFolder *afolder = NULL, bool append = false );
+    virtual void process( KMMessage *aorig_msg, KMFolder *afolder = 0, bool append = false );
     virtual void process( const QString &tmplName, KMMessage *aorig_msg,
-                          KMFolder *afolder = NULL, bool append = false );
+                          KMFolder *afolder = 0, bool append = false );
     virtual void processWithTemplate( const QString &tmpl );
+
     virtual QString findTemplate();
     virtual QString findCustomTemplate( const QString &tmpl );
     virtual QString pipe( const QString &cmd, const QString &buf );
@@ -72,6 +73,17 @@
     QString mQuoteString;
     bool mAppend;
 
+    /**
+     * Called by processWithTemplate(). This adds the completely processed body to
+     * the message.
+     *
+     * In append mode, this will simply append the text to the body.
+     *
+     * Otherwise, the content of the old message is deleted and replaced with @p body.
+     * Attachments of the original message are also added back to the new message. 
+     */
+    void addProcessedBodyToMessage( const QString &body );
+
     int parseQuotes( const QString &prefix, const QString &str,
                      QString &quote ) const;
 };
Index: kmail/kmcommands.cpp
===================================================================
--- kmail/kmcommands.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/kmcommands.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -2937,7 +2937,7 @@
 
   KTemporaryFile *linkFile = new KTemporaryFile();
   linkFile->setPrefix(atmFileInfo.fileName() +"_[");
-  linkFile->setSuffix("]."+ atmFileInfo.suffix());
+  linkFile->setSuffix( "]." + KMimeType::extractKnownExtension( atmFileInfo.fileName() ) );
   linkFile->open();
   QString linkName = linkFile->fileName();
   delete linkFile;
Index: kmail/kmfoldercachedimap.cpp
===================================================================
--- kmail/kmfoldercachedimap.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/kmfoldercachedimap.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -202,7 +202,8 @@
     /*mHoldSyncs( false ),*/
     mFolderRemoved( false ),
     mRecurse( true ),
-    mStatusChangedLocally( false ), mAnnotationFolderTypeChanged( false ),
+    mStatusChangedLocally( false ),
+    mAnnotationFolderTypeChanged( false ),
     mIncidencesForChanged( false ), mPersonalNamespacesCheckDone( true ),
     mQuotaInfo(), mAlarmsBlocked( false ),
     mRescueCommandCount( 0 ),
@@ -303,18 +304,22 @@
   KMFolderMaildir::readConfig();
 
   mStatusChangedLocally = group.readEntry( "StatusChangedLocally", false );
+  QStringList uidsChanged = group.readEntry( "UIDStatusChangedLocally", QStringList() );
+  foreach( const QString &uid, uidsChanged ) {
+    mUIDsOfLocallyChangedStatuses.append( uid.toUInt() );
+  }
   mAnnotationFolderTypeChanged = group.readEntry( "AnnotationFolderTypeChanged", false );
   mIncidencesForChanged = group.readEntry( "IncidencesForChanged", false );
   if ( mImapPath.isEmpty() ) {
     mImapPathCreation = group.readEntry("ImapPathCreation");
   }
 
-  QStringList uids = group.readEntry( "UIDSDeletedSinceLastSync", QStringList() );
+  QStringList delUids = group.readEntry( "UIDSDeletedSinceLastSync" , QStringList() );
 #if MAIL_LOSS_DEBUGGING
   kDebug( 5006 ) << "READING IN UIDSDeletedSinceLastSync: " << folder()->prettyUrl() << endl << uids;
 #endif
-  for ( QStringList::iterator it = uids.begin(); it != uids.end(); ++it ) {
-      mDeletedUIDsSinceLastSync.insert( (*it).toULong(), 0);
+  for ( QStringList::iterator it = delUids.begin(); it != delUids.end(); it++ ) {
+    mDeletedUIDsSinceLastSync.insert( (*it).toULong(), 0);
   }
 }
 
@@ -331,7 +336,14 @@
   configGroup.writeEntry( "NoContent", mNoContent );
   configGroup.writeEntry( "ReadOnly", mReadOnly );
   configGroup.writeEntry( "FolderAttributes", mFolderAttributes );
-  configGroup.writeEntry( "StatusChangedLocally", mStatusChangedLocally );
+
+  // StatusChangedLocally is always false, as we use UIDStatusChangedLocally now
+  configGroup.writeEntry( "StatusChangedLocally", false );
+  QStringList uidsToWrite;
+  foreach( const ulong uid, mUIDsOfLocallyChangedStatuses ) {
+    uidsToWrite.append( QString::number( uid ) );
+  }
+  configGroup.writeEntry( "UIDStatusChangedLocally", uidsToWrite );
   if ( !mImapPathCreation.isEmpty() ) {
     if ( mImapPath.isEmpty() ) {
       configGroup.writeEntry( "ImapPathCreation", mImapPathCreation );
@@ -953,12 +965,13 @@
       // Upload flags, unless we know from the ACL that we're not allowed
       // to do that or they did not change locally
       if ( mUserRights <= 0 || ( mUserRights & KMail::ACLJobs::WriteFlags ) ) {
-        if ( mStatusChangedLocally ) {
+        if ( !mUIDsOfLocallyChangedStatuses.isEmpty() || mStatusChangedLocally ) {
           uploadFlags();
           break;
         }
-      } else if ( mUserRights & KMail::ACLJobs::WriteSeenFlag ) {
-        if ( mStatusChangedLocally ) {
+      }
+      else if ( mUserRights & KMail::ACLJobs::WriteSeenFlag ) {
+        if ( !mUIDsOfLocallyChangedStatuses.isEmpty() || mStatusChangedLocally ) {
           uploadSeenFlags();
           break;
         }
@@ -1425,6 +1438,10 @@
         // Either not a valid message or not one that is on the server yet
         continue;
       }
+      if ( mUIDsOfLocallyChangedStatuses.indexOf( msg->UID() ) < 0 && !mStatusChangedLocally ) {
+        // This message has not had its status changed locally
+        continue;
+      }
 
       QString flags = KMFolderImap::statusToFlags( msg->status(), mPermanentFlags );
       // Collect uids for each typem of flags.
@@ -1468,6 +1485,11 @@
         // Either not a valid message or not one that is on the server yet
         continue;
 
+      if ( mUIDsOfLocallyChangedStatuses.indexOf( msg->UID() ) < 0 && !mStatusChangedLocally ) {
+        // This message has not had its status changed locally
+        continue;
+      }
+
       if ( msg->status().isOld() || msg->status().isRead() )
         seenUids.append( msg->UID() );
       else
@@ -1525,13 +1547,21 @@
 void KMFolderCachedImap::setStatus( int idx, const MessageStatus &status, bool toggle )
 {
   KMFolderMaildir::setStatus( idx, status, toggle );
-  mStatusChangedLocally = true;
+  const KMMsgBase *msg = getMsgBase( idx );
+  Q_ASSERT( msg );
+  if ( msg )
+    mUIDsOfLocallyChangedStatuses.append( msg->UID() );
 }
 
 void KMFolderCachedImap::setStatus( QList<int> &ids, const MessageStatus &status, bool toggle )
 {
   KMFolderMaildir::setStatus( ids, status, toggle );
-  mStatusChangedLocally = true;
+  foreach( const int id, ids ) {
+    const KMMsgBase *msg = getMsgBase( id );
+    Q_ASSERT( msg );
+    if ( msg )
+      mUIDsOfLocallyChangedStatuses.append( msg->UID() );
+  }
 }
 
 /* Upload new folders to server */
@@ -1888,7 +1918,8 @@
   } else {
     if ( lastSet ) { // always true here (this comes from online-imap...)
       mContentState = imapFinished;
-      mStatusChangedLocally = false; // we are up to date again
+      mUIDsOfLocallyChangedStatuses.clear(); // we are up to date again
+      mStatusChangedLocally = false;
     }
   }
   serverSyncInternal();
Index: kmail/kmfoldercachedimap.h
===================================================================
--- kmail/kmfoldercachedimap.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/kmfoldercachedimap.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -627,12 +627,18 @@
     bool mFolderRemoved;
     bool mRecurse;
 
+   /**
+    * UIDs added by setStatus. Indicates that the client has changed
+    * the status of those mails. The mail flags for changed mails will be
+    * uploaded to the server, overwriting the server's notion of the status
+    * of the mails in this folder.
+    */
+    QList<ulong> mUIDsOfLocallyChangedStatuses;
+
     /**
-      Set to true by setStatus. Indicates that the client has changed
-      the status of at least one mail. The mail flags will therefore be
-      uploaded to the server, overwriting the server's notion of the status
-      of the mails in this folder.
-    */
+     * Same as above, but uploads the flags of all mails, even if not all changed.
+     * Only still here for config compatibility.
+     */
     bool mStatusChangedLocally;
 
     /**
Index: kmail/kmmainwidget.cpp
===================================================================
--- kmail/kmmainwidget.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/kmmainwidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -1277,6 +1277,7 @@
   KMFolderDialog props( folder, folder->parent(), mMainFolderView,
                         i18n("Properties of Folder %1", folder->label() ) );
   props.exec();
+
   updateFolderMenu();
 }
 
Index: kmail/kmfilteraction.cpp
===================================================================
--- kmail/kmfilteraction.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/kmfilteraction.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -1467,91 +1467,30 @@
 {
 }
 
-KMFilterAction::ReturnCode KMFilterActionForward::process( KMMessage *aMsg ) const
+KMFilterAction::ReturnCode KMFilterActionForward::process( KMMessage *msg ) const
 {
   if ( mParameter.isEmpty() )
     return ErrorButGoOn;
 
   // avoid endless loops when this action is used in a filter
   // which applies to sent messages
-  if ( KMMessage::addressIsInAddressList( mParameter, QStringList( aMsg->to() ) ) )
+  if ( KMMessage::addressIsInAddressList( mParameter, QStringList( msg->to() ) ) ) {
+    kWarning() << "Attempt to forward to receipient of original message, ignoring.";
     return ErrorButGoOn;
+  }
 
-  // Create the forwarded message by hand to make forwarding of messages with
-  // attachments work.
-  // Note: This duplicates a lot of code from KMMessage::createForward() and
-  //       KMComposeWin::applyChanges().
-  // ### FIXME: Remove the code duplication again.
+  KMMessage *fwdMsg = msg->createForward();
+  fwdMsg->setTo( mParameter );
 
-  KMMessage* msg = new KMMessage;
-
-  msg->initFromMessage( aMsg );
-
-  TemplateParser parser( msg, TemplateParser::Forward,
-                         aMsg->body(), false, false, false);
-  parser.process( aMsg );
-
-  QByteArray
-    encoding = KMMsgBase::autoDetectCharset( aMsg->charset(),
-                                             KMMessage::preferredCharsets(),
-                                             msg->body() );
-  if( encoding.isEmpty() )
-    encoding = "utf-8";
-  QByteArray str = KMMsgBase::codecForName( encoding )->fromUnicode( msg->body() );
-
-  msg->setCharset( encoding );
-  msg->setTo( mParameter );
-  msg->setSubject( "Fwd: " + aMsg->subject() );
-
-  bool isQP = kmkernel->msgSender()->sendQuotedPrintable();
-
-  if( aMsg->numBodyParts() == 0 )
-  {
-    msg->setAutomaticFields( true );
-    msg->setHeaderField( "Content-Type", "text/plain" );
-    // msg->setCteStr( isQP ? "quoted-printable": "8bit" );
-    QList<int> dummy;
-    msg->setBodyAndGuessCte(str, dummy, !isQP);
-    msg->setCharset( encoding );
-    if( isQP )
-      msg->setBodyEncoded( str );
-    else
-      msg->setBody( str );
+  if ( !kmkernel->msgSender()->send( fwdMsg, KMail::MessageSender::SendLater ) ) {
+    kWarning() << "KMFilterAction: could not forward message (sending failed)";
+    return ErrorButGoOn; // error: couldn't send
   }
   else
-  {
-    KMMessagePart bodyPart, msgPart;
+    sendMDN( msg, KMime::MDN::Dispatched );
 
-    msg->removeHeaderField( "Content-Type" );
-    msg->removeHeaderField( "Content-Transfer-Encoding" );
-    msg->setAutomaticFields( true );
-    msg->setBody( "This message is in MIME format.\n\n" );
+  // (the msgSender takes ownership of the message, so don't delete it here)
 
-    bodyPart.setTypeStr( "text" );
-    bodyPart.setSubtypeStr( "plain" );
-    // bodyPart.setCteStr( isQP ? "quoted-printable": "8bit" );
-    QList<int> dummy;
-    bodyPart.setBodyAndGuessCte(str, dummy, !isQP);
-    bodyPart.setCharset( encoding );
-    bodyPart.setBodyEncoded( str );
-    msg->addBodyPart( &bodyPart );
-
-    for( int i = 0; i < aMsg->numBodyParts(); i++ )
-    {
-      aMsg->bodyPart( i, &msgPart );
-      if( i > 0 || qstricmp( msgPart.typeStr(), "text" ) != 0 )
-        msg->addBodyPart( &msgPart );
-    }
-  }
-  msg->cleanupHeader();
-  msg->link( aMsg, MessageStatus::statusForwarded() );
-
-  sendMDN( aMsg, KMime::MDN::Dispatched );
-
-  if ( !kmkernel->msgSender()->send( msg, KMail::MessageSender::SendLater ) ) {
-    kDebug(5006) <<"KMFilterAction: could not forward message (sending failed)";
-    return ErrorButGoOn; // error: couldn't send
-  }
   return GoOn;
 }
 
Index: kmail/kmail_view.desktop
===================================================================
--- kmail/kmail_view.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/kmail_view.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -13,6 +13,7 @@
 Name[ja]=KMail ビュー
 Name[km]=ទិដ្ឋភាព KMail
 Name[ko]=KMail 보기
+Name[lt]=KMail peržiūra
 Name[lv]=KMail skats
 Name[nb]=KMail-visning
 Name[nds]=KMail-Ansicht
Index: kmail/configuredialog.cpp
===================================================================
--- kmail/configuredialog.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/configuredialog.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -2036,14 +2036,16 @@
            this, SLOT( slotEmitChanged() ) );
 
   // "Show expand/collaps quote marks" check box;
-  QHBoxLayout *hlay= new QHBoxLayout(); // inherits spacing
-  vlay->addLayout( hlay );
   populateCheckBox( mShowExpandQuotesMark= new QCheckBox( this ), showExpandQuotesMark);
-  hlay->addWidget( mShowExpandQuotesMark);
+  vlay->addWidget( mShowExpandQuotesMark);
   connect( mShowExpandQuotesMark, SIGNAL ( stateChanged( int ) ),
            this, SLOT( slotEmitChanged() ) );
 
-  hlay->addStretch( 1 );
+  //New HBoxLayout to show the collapseQuoteLevel spin+label one line down
+  QHBoxLayout * hlay = new QHBoxLayout();
+  vlay->addLayout( hlay );
+  hlay->addSpacing( 40 );
+
   mCollapseQuoteLevelSpin = new KIntSpinBox( 0/*min*/,10/*max*/,1/*step*/,
       3/*init*/,this );
 
@@ -2061,6 +2063,8 @@
   connect( mShowExpandQuotesMark, SIGNAL( toggled( bool ) ),
       mCollapseQuoteLevelSpin, SLOT( setEnabled( bool ) ) );
 
+  hlay->addStretch();
+
   // Fallback Character Encoding
   hlay = new QHBoxLayout(); // inherits spacing
   vlay->addLayout( hlay );
Index: kmail/accountmanager.cpp
===================================================================
--- kmail/accountmanager.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/accountmanager.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -94,6 +94,32 @@
     uint id = group.readEntry( "Id", 0 );
     KAccount::Type acctType = KAccount::typeForName( group.readEntry( "Type" ) );
     QString accountName = group.readEntry( "Name" );
+
+    // Fixes for config compatibilty: We do have an update script, but that is not reliable, because
+    // sometimes the scripts don't run (or already run in KDE3, but don't actually change anything)
+    // This is a big problem, since incorrect account type values make you loose your account settings,
+    // which in case of disconnected IMAP means you'll loose your cache.
+    // So for extra saftey, convert the account type values here as well.
+    // See also kmail-4.0-misc.pl
+    if ( acctType == -1 ) {
+      kWarning() << "Config upgrade failed! Danger! Trying to convert old account type for account" << accountName;
+      const QString accountTypeName = group.readEntry( "Type" );
+      if ( accountTypeName == "cachedimap" )
+        acctType = KAccount::DImap;
+      if ( accountTypeName == "pop" )
+        acctType = KAccount::Pop;
+      if ( accountTypeName == "local" )
+        acctType = KAccount::Local;
+      if ( accountTypeName == "maildir" )
+        acctType = KAccount::Maildir;
+      if ( accountTypeName == "imap" )
+        acctType = KAccount::Imap;
+      if ( acctType == -1 )
+        kWarning() << "Unrecognized account type. Your account settings are now lost, sorry.";
+      else
+        kDebug() << "Account type upgraded.";
+    }
+
     if ( accountName.isEmpty() )
       accountName = i18n( "Account %1", accountNum++ );
     KMAccount *account = create( acctType, accountName, id );
Index: kmail/keyresolver.cpp
===================================================================
--- kmail/keyresolver.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/keyresolver.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -121,7 +121,7 @@
         return false;
   const std::vector<GpgME::UserID> uids = key.userIDs();
   for ( std::vector<GpgME::UserID>::const_iterator it = uids.begin() ; it != uids.end() ; ++it ) {
-    if ( !it->isRevoked() && it->validity() > GpgME::UserID::Marginal )
+    if ( !it->isRevoked() && it->validity() >= GpgME::UserID::Marginal )
       return true;
 #if 0
     else
@@ -1392,9 +1392,14 @@
 
 
 std::vector<GpgME::Key> Kleo::KeyResolver::selectKeys( const QString & person, const QString & msg, const std::vector<GpgME::Key> & selectedKeys ) const {
+  const bool opgp = containsOpenPGP( mCryptoMessageFormats );
+  const bool x509 = containsSMIME( mCryptoMessageFormats );
+
   Kleo::KeySelectionDialog dlg( i18n("Encryption Key Selection"),
 				msg, selectedKeys,
-				Kleo::KeySelectionDialog::ValidEncryptionKeys,
+                                Kleo::KeySelectionDialog::ValidEncryptionKeys
+                                & ~(opgp ? 0 : Kleo::KeySelectionDialog::OpenPGPKeys)
+                                & ~(x509 ? 0 : Kleo::KeySelectionDialog::SMIMEKeys),
 				true, true ); // multi-selection and "remember choice" box
 
   if ( dlg.exec() != QDialog::Accepted )
Index: kmail/accountwizard.cpp
===================================================================
--- kmail/accountwizard.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/accountwizard.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -420,11 +420,11 @@
 
 QLabel *AccountWizard::createInfoLabel( const QString &msg )
 {
-  QLabel *label = new QLabel( msg, this );
+  QLabel *label = new QLabel( msg, this, Qt::Window | Qt::FramelessWindowHint );
   label->setFrameStyle( QFrame::Panel | QFrame::Raised );
   label->setLineWidth( 3 );
   label->resize( fontMetrics().width( msg ) + 20, label->height() * 2 );
-  label->move( width() / 2 - label->width() / 2, height() / 2 - label->height() / 2 );
+  label->move( x() + width() / 2 - label->width() / 2, y() + height() / 2 - label->height() / 2 );
   label->setAutoFillBackground( true );
   label->show();
 
Index: kmail/objecttreeparser.cpp
===================================================================
--- kmail/objecttreeparser.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kmail/objecttreeparser.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -243,6 +243,12 @@
       node->setProcessed( false, true );
     }
 
+    // Make sure the whole content is relative, so that nothing is painted over the header
+    // if a malicious message uses absolute positioning.
+    bool isRoot = ( node->parentNode() == 0 );
+    if ( isRoot && mReader )
+      htmlWriter()->queue( "<div style=\"position: relative\">\n" );
+
     for ( ; node ; node = node->nextSibling() ) {
       if ( node->processed() )
         continue;
@@ -290,6 +296,9 @@
       if ( showOnlyOneMimePart() )
         break;
     }
+
+    if ( isRoot && mReader )
+      htmlWriter()->queue( "</div>\n" );
   }
 
   void ObjectTreeParser::defaultHandling( partNode * node, ProcessResult & result ) {
@@ -424,7 +433,7 @@
     }
 
     std::vector<GpgME::Signature> signatures;
-    if ( doCheck )
+    if ( !doCheck )
       signatures = paramSignatures;
 
     PartMetaData messagePart;
@@ -2099,12 +2108,16 @@
   if ( auditLog.isEmpty() )
     return i18n("No Audit Log available");
 
-  KUrl url;
-  url.setProtocol( "kmail" );
-  url.setPath( "showAuditLog" );
-  url.addQueryItem( "log", auditLog );
+  if ( !auditLog.isEmpty() ) {
+    KUrl url;
+    url.setProtocol( "kmail" );
+    url.setPath( "showAuditLog" );
+    url.addQueryItem( "log", auditLog );
 
-  return "<a href=\"" + url.url() + "\">" + i18nc("The Audit Log is a detailed error log from the gnupg backend", "Show Audit Log") + "</a>";
+    return "<a href=\"" + url.url() + "\">" + i18nc("The Audit Log is a detailed error log from the gnupg backend", "Show Audit Log") + "</a>";
+  }
+
+  return QString();
 }
 
 static QString endVerboseSigstatHeader( const PartMetaData & pmd )
Index: knode/knode.kcfg
===================================================================
--- knode/knode.kcfg	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ knode/knode.kcfg	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -353,6 +353,7 @@
     </entry>
     <entry name="composerFont" type="Font">
       <label>Composer</label>
+      <default code="true">KGlobalSettings::fixedFont()</default>
     </entry>
     <entry name="groupListFont" type="Font">
       <label>Group List</label>
Index: knode/kncomposer.h
===================================================================
--- knode/kncomposer.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ knode/kncomposer.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -113,12 +113,17 @@
     composerResult r_esult;
     KNLocalArticle *a_rticle;
     QString s_ignature, u_nwraped;
-    QByteArray c_harset;
     MessageMode m_ode;
     bool n_eeds8Bit,    // false: fall back to us-ascii
          v_alidated,    // hasValidData was run and found no problems, n_eeds8Bit is valid
          a_uthorDislikesMailCopies;
 
+    /**
+      Sets the character set to used to encode this message.
+      This also enforces some sanity check.
+    */
+    void setCharset( const QString &charset );
+
     //edit
     bool e_xternalEdited;
     KProcess *e_xternalEditor;
@@ -215,11 +220,17 @@
   private:
     bool mFirstEdit;
     /**
-    * Temporary hack for bug 169411 stolen from KMail (kmmsgbase.{h,cpp})
-    * Fixes an encoding received by a KDE function and returns the proper,
-    * MIME-compilant encoding name instead.
+      Character set used to encode the out-going message.
+
+      This is going to end in the mime header of the message
+      so it should be a valid encoding as per
+      @link http://www.iana.org/assignments/character-sets IANA character-set encoding @endlink
+      and not be empty; both issue are taken care of by setCharset().
+      See bug #169411, #163524
+
+      As a consequence this can not used directly as input of methods from KCharset.
     */
-    QByteArray fixEncoding( const QByteArray &encoding );
+    QString mCharset;
 };
 
 #if 0
Index: knode/knarticle.cpp
===================================================================
--- knode/knarticle.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ knode/knarticle.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -70,8 +70,10 @@
 {
   // filter out internal headers
   for ( Headers::Base::List::Iterator it = h_eaders.begin(); it != h_eaders.end(); ) {
-    if ( (*it)->isXHeader() && ( strncasecmp( (*it)->type(), "X-KNode", 7 ) == 0 ) )
+    if ( (*it)->isXHeader() && ( strncasecmp( (*it)->type(), "X-KNode", 7 ) == 0 ) ) {
+      delete *it;
       it = h_eaders.erase( it );
+    }
     else
       ++it;
   }
Index: knode/kncomposer.cpp
===================================================================
--- knode/kncomposer.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ knode/kncomposer.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -719,7 +719,7 @@
     firstLine = false;
   }
 
-  if (n_eeds8Bit && (c_harset.toLower()=="us-ascii")) {
+  if (n_eeds8Bit && ( mCharset.toLower()=="us-ascii" )) {
     KMessageBox::sorry(this, i18n("Your message contains characters which are not included\nin the \"us-ascii\" character set; please choose\na suitable character set from the \"Options\" menu."));
     return false;
   }
@@ -806,7 +806,7 @@
   a_rticle->date()->setDateTime( KDateTime::currentLocalDateTime() );    //set current date+time
 
   //Subject
-  a_rticle->subject()->fromUnicodeString(v_iew->s_ubject->text(), c_harset);
+  a_rticle->subject()->fromUnicodeString( v_iew->s_ubject->text(), mCharset.toLatin1() );
 
   //Newsgroups
   if (m_ode != mail) {
@@ -817,7 +817,7 @@
 
   //To
   if (m_ode != news) {
-    a_rticle->to()->fromUnicodeString(v_iew->t_o->text(), c_harset);
+    a_rticle->to()->fromUnicodeString( v_iew->t_o->text(), mCharset.toLatin1() );
     a_rticle->setDoMail(true);
   } else
     a_rticle->setDoMail(false);
@@ -862,22 +862,24 @@
   //set text
   if (v_alidated) {
     if (n_eeds8Bit) {
-      text->contentType()->setCharset(c_harset);
+      text->contentType()->setCharset( mCharset.toLatin1() );
       if ( knGlobals.settings()->allow8BitBody() )
         text->contentTransferEncoding()->setEncoding(KMime::Headers::CE8Bit);
       else
         text->contentTransferEncoding()->setEncoding(KMime::Headers::CEquPr);
     } else {
-      text->contentType()->setCharset("us-ascii");   // fall back to us-ascii
+      setCharset( "us-ascii" ); // fall back to us-ascii
+      text->contentType()->setCharset( mCharset.toLatin1() );
       text->contentTransferEncoding()->setEncoding(KMime::Headers::CE7Bit);
     }
   } else {             // save as draft
-    text->contentType()->setCharset(c_harset);
-    if (c_harset.toLower()=="us-ascii")
+    text->contentType()->setCharset( mCharset.toLatin1() );
+    if ( mCharset.toLower()=="us-ascii" ) {
       text->contentTransferEncoding()->setEncoding(KMime::Headers::CE7Bit);
-    else
+    } else {
       text->contentTransferEncoding()->setEncoding( knGlobals.settings()->allow8BitBody()
           ? KMime::Headers::CE8Bit : KMime::Headers::CEquPr );
+    }
   }
 
   QString tmp = v_iew->e_dit->toWrappedPlainText();
@@ -902,7 +904,7 @@
           QString tmpText = tmp;
           Kpgp::Block block;
           bool ok=true;
-          QTextCodec *codec=KGlobal::charsets()->codecForName(c_harset, ok);
+          QTextCodec *codec=KGlobal::charsets()->codecForName( mCharset, ok);
           if(!ok) // no suitable codec found => try local settings and hope the best ;-)
               codec=KGlobal::locale()->codecForEncoding();
 
@@ -927,16 +929,25 @@
   return true;
 }
 
-QByteArray KNComposer::fixEncoding( const QByteArray &encoding )
+void KNComposer::setCharset( const QString &charset )
 {
-  QString returnEncoding = encoding;
   // According to http://www.iana.org/assignments/character-sets, uppercase is
   // preferred in MIME headers
-  if ( returnEncoding.toUpper().contains( "ISO " ) ) {
-    returnEncoding = returnEncoding.toUpper();
-    returnEncoding.replace( "ISO ", "ISO-" );
+  mCharset = charset.toUpper();
+
+  // For bug 163524 (Knode sending empty charset)
+  // Placed first so that the logic below also applies to the charset from settings.
+  if ( mCharset.isEmpty() ) {
+    mCharset = knGlobals.settings()->charset();
+    if ( mCharset.isEmpty() ) {
+      mCharset = "UTF-8";
+    }
   }
-  return returnEncoding.toLatin1();
+
+  // hack for bug 169411 stolen from KMail (kmmsgbase.{h,cpp})
+  if ( mCharset.contains( "ISO " ) ) {
+    mCharset = mCharset.replace( "ISO ", "ISO-" );
+  }
 }
 
 
@@ -1001,15 +1012,14 @@
   v_iew->e_dit->setText(s);
 
   // initialize the charset select action
-  if(textContent)
-    c_harset=textContent->contentType()->charset();
-  else
-    c_harset = knGlobals.settings()->charset().toLatin1();
+  if(textContent) {
+    setCharset( textContent->contentType()->charset() );
+  } else {
+    setCharset( knGlobals.settings()->charset() );
+  }
 
-  c_harset = fixEncoding(c_harset); // workaround previous wrong configuration
+  a_ctSetCharset->setCurrentItem( a_ctSetCharset->items().indexOf( mCharset ) );
 
-  a_ctSetCharset->setCurrentItem( a_ctSetCharset->items().indexOf( c_harset ) );
-
   // initialize the message type select action
   if (a_rticle->doPost() && a_rticle->doMail())
     m_ode = news_mail;
@@ -1036,7 +1046,7 @@
 {
   QString temp;
   bool ok=true;
-  QTextCodec *codec=KGlobal::charsets()->codecForName(c_harset, ok);
+  QTextCodec *codec=KGlobal::charsets()->codecForName( mCharset, ok);
   QTextStream ts(file);
   ts.setCodec(codec);
 
@@ -1278,7 +1288,8 @@
   if(s.isEmpty())
     return;
 
-  c_harset = fixEncoding(s.toLatin1());
+  setCharset( s );
+
   setConfig(true); //adjust fonts
 }
 
@@ -1340,7 +1351,7 @@
   }
 
   bool ok=true;
-  QTextCodec *codec=KGlobal::charsets()->codecForName(c_harset, ok);
+  QTextCodec *codec=KGlobal::charsets()->codecForName( mCharset, ok );
 
   QString tmp = v_iew->e_dit->toWrappedPlainText();
 
@@ -1403,7 +1414,7 @@
     overwriteDesc = i18n(" INS ");
 
   statusBar()->changeItem(i18n(" Type: %1 ", typeDesc), 1);
-  statusBar()->changeItem(i18n(" Charset: %1 ", QString( c_harset ) ), 2);
+  statusBar()->changeItem(i18n(" Charset: %1 ", mCharset ), 2);
   statusBar()->changeItem(overwriteDesc, 3);
   statusBar()->changeItem(i18n(" Column: %1 ", v_iew->e_dit->columnNumber () + 1), 4);
   statusBar()->changeItem(i18n(" Line: %1 ", v_iew->e_dit->linePosition() + 1), 5);
Index: dependency-graph.dot
===================================================================
--- dependency-graph.dot	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ dependency-graph.dot	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -48,7 +48,6 @@
         "konsolekalendar"[style=filled, fillcolor=lightcyan, URL="konsolekalendar/html/index.html"];
         "kontact"[style=filled, fillcolor=lightcyan, URL="kontact/html/index.html"];
         "korganizer"[style=filled, fillcolor=lightcyan, URL="korganizer/html/index.html"];
-        "korn"[style=filled, fillcolor=lightcyan];
         "kresources"[style=filled, fillcolor=palegreen];
         "libakonadi"[style=filled, fillcolor=lightyellow, URL="akonadi/libakonadi/html/index.html"];
         "libkdepim"[style=filled, fillcolor=lightyellow, URL="libkdepim/html/index.html"];
Index: doc/kleopatra/index.docbook
===================================================================
--- doc/kleopatra/index.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ doc/kleopatra/index.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -13,48 +13,6 @@
 
   <!ENTITY dn "<acronym>DN</acronym>">
   <!ENTITY ca "<acronym>CA</acronym>">
-
-  <!-- Expanded all entities to make them translatable - lueck
-    FILE menu 
-  <!ENTITY file-new-key-pair "<menuchoice><guimenu>File</guimenu><guimenuitem>New Key Pair...</guimenuitem></menuchoice>">
-  <!ENTITY file-export-certificates "<menuchoice><guimenu>File</guimenu><guimenuitem>Export Certificates...</guimenuitem></menuchoice>">
-  <!ENTITY file-export-secret-key "<menuchoice><guimenu>File</guimenu><guimenuitem>Export Secret key...</guimenuitem></menuchoice>">
-  <!ENTITY file-import-certificates "<menuchoice><guimenu>File</guimenu><guimenuitem>Import Certificates...</guimenuitem></menuchoice>">
-  <!ENTITY file-import-crls "<menuchoice><guimenu>File</guimenu><guimenuitem>Import CRLs...</guimenuitem></menuchoice>">
-  <!ENTITY file-quit "<menuchoice><shortcut><keycombo action="simul">&Ctrl;<keycap>Q</keycap></keycombo></shortcut><guimenu>File</guimenu><guimenuitem>Quit</guimenuitem></menuchoice>">
-
-   VIEW menu
-  <!ENTITY view-redisplay "<menuchoice><shortcut><keycombo action="simul"><keycap>F5</keycap></keycombo></shortcut><guimenu>View</guimenu><guimenuitem>Redisplay</guimenuitem></menuchoice>">
-  <!ENTITY view-stop-operation "<menuchoice><shortcut><keycombo action="simul"><keycap>Esc</keycap></keycombo></shortcut><guimenu>View</guimenu><guimenuitem>Stop Operation</guimenuitem></menuchoice>">
-  <!ENTITY view-certificate-details "<menuchoice><guimenu>View</guimenu><guimenuitem>Certificate Details</guimenuitem></menuchoice>">
-  <!ENTITY view-hierarchical-key-list "<menuchoice><guimenu>View</guimenu><guimenuitem>Hierarchical Key List</guimenuitem></menuchoice>">
-  <!ENTITY view-expand-all "<menuchoice><shortcut><keycombo action="simul">&Ctrl;<keycap>.</keycap></keycombo></shortcut><guimenu>View</guimenu><guimenuitem>Expand All</guimenuitem></menuchoice>">
-  <!ENTITY view-collapse-all "<menuchoice><shortcut><keycombo action="simul">&Ctrl;<keycap>,</keycap></keycombo></shortcut><guimenu>View</guimenu><guimenuitem>Collapse All</guimenuitem></menuchoice>">
-
-   CERTIFICATES menu 
- <!ENTITY certificates-validate "<menuchoice><shortcut><keycombo action="simul">&Shift;<keycap>F5</keycap></keycombo></shortcut><guimenu>Certificates</guimenu><guimenuitem>Validate</guimenuitem></menuchoice>">
-  <!ENTITY certificates-refresh-crls "<menuchoice><guimenu>Certificates</guimenu><guimenuitem>Refresh CRLs</guimenuitem></menuchoice>">
-  <!ENTITY certificates-delete "<menuchoice><shortcut><keycombo action="simul"><keycap>Delete</keycap></keycombo></shortcut><guimenu>Certificates</guimenu><guimenuitem>Delete</guimenuitem></menuchoice>">
-  <!ENTITY certificates-download "<menuchoice><guimenu>Certificates</guimenu><guimenuitem>Download</guimenuitem></menuchoice>">
-
-   CRLS menu
-  <!ENTITY crls-clear-crl-cache "<menuchoice><guimenu>CRLs</guimenu><guimenuitem>Clear CRL Cache</guimenuitem></menuchoice>">
-  <!ENTITY crls-dump-crl-cache "<menuchoice><guimenu>CRLs</guimenu><guimenuitem>Dump CRL Cache</guimenuitem></menuchoice>">
-
-   TOOLS menu 
-  <!ENTITY tools-gnupg-log-viewer "<menuchoice><guimenu>Tools</guimenu><guimenuitem>GnuPG Log Viewer...</guimenuitem></menuchoice>">
-
-   SETTINGS menu 
-  <!ENTITY settings-show-statusbar "<menuchoice><guimenu>Settings</guimenu><guimenuitem>Show Statusbar</guimenuitem></menuchoice>">
-  <!ENTITY settings-configure-shortcuts "<menuchoice><guimenu>Settings</guimenu><guimenuitem>Configure Shortcuts...</guimenuitem></menuchoice>">
-  <!ENTITY settings-configure-kleopatra "<menuchoice><guimenu>Settings</guimenu><guimenuitem>Configure &kleopatra;...</guimenuitem></menuchoice>">
-  <!ENTITY settings-configure-gpgme-backend "<menuchoice><guimenu>Settings</guimenu><guimenuitem>Configure GpgME Backend...</guimenuitem></menuchoice>">
-   -->
-
-  <!-- Command line options -->
-  <!ENTITY commandline-option-external "<option>--external</option>">
-  <!ENTITY commandline-option-query "<option>--query</option>">
-  <!ENTITY commandline-option-import-certificate "<option>--import-certificate</option>">
 ]>
 
 <book lang="&language;">
@@ -114,12 +72,12 @@
 
 <legalnotice>&GPLNotice;</legalnotice>
 
-<date>2007-12-19</date>
-<releaseinfo>1.9.0</releaseinfo>
+<date>2009-02-19</date>
+<releaseinfo>2.0.5</releaseinfo>
 
 <abstract>
 <para>
-&kleopatra; is a tool for managing X.509 certificates.
+&kleopatra; is a tool for managing X.509 and OpenPGP certificates.
 </para>
 </abstract>
 
@@ -137,11 +95,12 @@
 
 <chapter id="introduction"> <title>Introduction</title> 
 
-<para>&kleopatra; is the &kde; tool for managing X.509 certificates in
+<para>&kleopatra; is the &kde; tool for managing X.509 and OpenPGP certificates in
 the &gpgsm; keybox and for retrieving certificates from
 <acronym>LDAP</acronym> servers.</para>
 
-<para>&kleopatra; can be started from &kmail;'s <guimenu>Tools</guimenu>
+<para>&kleopatra; can be started from &kmail;'s <menuchoice><guimenu>Tools</guimenu>
+<guimenuitem>Certificate Manager</guimenuitem></menuchoice>
 menu, as well as from the command line. The &kleopatra; executable is
 named <userinput><command>kleopatra</command></userinput>.</para>
 
@@ -166,7 +125,7 @@
 of the local keybox, which is similar to &gpg;'s concept of keyrings,
 albeit one should not stretch this analogy too much.</para>
 
-<para>The main window is divided into the large key listing area, the
+<para>The main window is divided into the large key listing area consisting of several tabs, the
 menubar and the <link linkend="functions-search">search bar</link> on
 top, and a status bar at the bottom.</para>
 
@@ -181,8 +140,7 @@
 certificates, but usually the terms <quote>certificate</quote> and
 <quote>(public) key</quote> are used interchangeably, and we will not
 distinguish between them in this manual either, except when explicitly
-noted. The name of the &ca; which issued the certificate (its &dn;)
-is shown in the <guilabel>Issuer &dn;</guilabel> column.</para>
+noted.</para>
 
 <para>&ca;s must in turn be signed by other &ca;s to be valid. Of
 course, this must end somewhere, so the top-level &ca; (root-&ca;)
@@ -193,11 +151,10 @@
 the vendor of a product using certificates, but can be done by the
 user via &gpgsm;'s command line interface.</para>
 
-<para>To see which of the certificates are root certificates, you can
-either compare <guilabel>Subject &dn;</guilabel> and <guilabel>Issuer
-&dn;</guilabel>, or you switch to hierarchical keylist mode with <link
+<para>To see which of the certificates are root certificates, you
+switch to the hierarchical keylist mode with <link
 linkend="view-hierarchical-key-list"><menuchoice><guimenu>View</guimenu>
-<guimenuitem>Hierarchical Key List</guimenuitem></menuchoice></link>.</para>
+<guimenuitem>Hierarchical Certificate List</guimenuitem></menuchoice></link>.</para>
 
 <para>You can see the details of any certificate by double-clicking it
 or using <link linkend="view-certificate-details"><menuchoice><guimenu>View</guimenu>
@@ -213,17 +170,18 @@
 <keycap>F5</keycap></keycombo></shortcut><guimenu>View</guimenu>
 <guimenuitem>Redisplay</guimenuitem></menuchoice></link>.</para>
 
-<para>Since validating a key may take some time (&eg; CRLs might need
+<!-- no longer in kde 4
+para>Since validating a key may take some time (&eg; CRLs might need
 to be fetched), the normal keylisting does not attempt to check the
 validity of keys. For this, <link linkend="certificates-validate">
 <menuchoice><shortcut><keycombo action="simul">&Shift;<keycap>F5</keycap></keycombo>
-</shortcut><guimenu>Certificates</guimenu><guimenuitem>Validate</guimenuitem></menuchoice></link>, a
-special variant of <link
+</shortcut><guimenu>Certificates</guimenu><guimenuitem>Validate</guimenuitem></menuchoice></link>,
+a special variant of <link
 linkend="view-redisplay"><menuchoice><shortcut><keycombo action="simul">
 <keycap>F5</keycap></keycombo></shortcut><guimenu>View</guimenu>
 <guimenuitem>Redisplay</guimenuitem></menuchoice></link>, is provided. It
 either checks the selected certificates, or all keys if none are
-selected.</para>
+selected.</para-->
 
 </sect1>
 
@@ -233,30 +191,31 @@
 signatures in emails, since certificates are embedded in the
 signatures made using them most of the time. However, if you need to
 send a mail to someone you have not yet had contact with, you need to
-fetch the certificate from an LDAP directory (although &gpgsm; can do
+fetch the certificate from an LDAP folder (although &gpgsm; can do
 this automatically), or from a file. You also need to import your own
 certificate after receiving the &ca; answer to your certification
 request.</para>
 
-<para>To search for a certificate in an LDAP directory, switch the
-dropdown menu of the search bar from <guilabel>in Local
-Certificates</guilabel> to <guilabel>in External
-Certificates</guilabel>, enter some text (&eg; the name of the person
-you want the certificate for) into the line edit, and click on the
-<guilabel>Find</guilabel> icon. The results will be displayed in the
+<para>To search for a certificate in an LDAP directory, select 
+<menuchoice><guimenu>File</guimenu><guimenuitem>Lookup Certificates on Server</guimenuitem></menuchoice>
+and enter some text (&eg; the name of the person
+you want the certificate for) into the line edit of the <guilabel>Keyserver 
+Certificate Lookup</guilabel> dialog, then click on the
+<guilabel>Search</guilabel> button. The results will be displayed in the
 key list below the search bar, where you can select certificates to
-either look at them with <link linkend="view-certificate-details">
-<menuchoice><guimenu>View</guimenu><guimenuitem>Certificate Details</guimenuitem></menuchoice></link> or
-download them with <link linkend="certificates-download">
-<menuchoice><guimenu>Certificates</guimenu><guimenuitem>Download</guimenuitem></menuchoice></link> into the
-local keybox. Note that you can also download the certificate from the
+look at them by clicking the <guibutton>Details</guibutton> button
+or download them with <guibutton>Import</guibutton> into the
+local keybox.</para>
+<!--
+Note that you can also download the certificate from the
 details dialog, using the <guilabel>Import to Local</guilabel>
 button.</para>
+not found in 4.2
+-->
 
 <para>You can configure the list of LDAP servers to search in the
 <link linkend="configuration-directory-services"><guilabel>Directory
-Services</guilabel></link> page of &kleopatra;'s <link
-linkend="configuration">configure dialog</link>.</para>
+Services</guilabel></link> page of &kleopatra;'s configure dialog.</para>
 
 <para>If you received the certificate as a file, try <link
 linkend="file-import-certificates"><menuchoice><guimenu>File</guimenu>
@@ -269,7 +228,7 @@
 public key (as well as the secret key) from the PKCS#12 file you got from
 the &ca;. You can do this on the command line with <link
 linkend="commandline-option-import-certificate"><userinput><command>kleopatra
-&commandline-option-import-certificate;
+<option>--import-certificate</option>
 <filename>filename</filename></command></userinput></link> or from
 within &kleopatra; with <link
 linkend="file-import-certificates"><menuchoice><guimenu>File</guimenu>
@@ -281,49 +240,71 @@
 <sect1 id="functions-newkey"><title>Creating New Key Pairs</title>
 
 <para>The menu item <link linkend="file-new-key-pair"><menuchoice>
-<guimenu>File</guimenu><guimenuitem>New Key Pair...</guimenuitem></menuchoice></link> starts the
-certificate-request-creating wizard which will guide you through a
-number of steps to create a certificate request; this request can, on the 
-last page of the wizard, either be sent to a certificate authority (&ca;)
-to be signed or saved to a file (for example to a floppy, so it can be
-shipped to the &ca;).</para> <para>Whenever you are done with a step in
+<guimenu>File</guimenu><guimenuitem>New Certificate...</guimenuitem></menuchoice></link> starts the
+<guilabel>Certificate Creation Wizard</guilabel> which will guide you through a
+number of steps to create a certificate request.</para> 
+<para>Whenever you are done with a step in
 the wizard, press <guibutton>Next</guibutton> to go to the next step
 (or <guibutton>Back</guibutton> to review steps that are already
 completed). The certificate request creation can be canceled at any
 time by pressing the <guibutton>Cancel</guibutton> button.
 </para>
-<para>The first step in the wizard is to type in your personal data
+<para>On the first page of the wizard choose which type of certificate you want to create:</para>
+
+<variablelist>
+
+<varlistentry>
+<term><guilabel>Create a personal OpenPGP key pair</guilabel></term>
+<listitem><para>OpenPGP key pairs are created locally, and certified by your friends and 
+acquaintances. There is no central certification authority; instead, every 
+individual creates a personal Web Of Trust by certifying other user's key 
+pairs with his own certificate.</para>
+<para>You have to enter a <guilabel>Name</guilabel>, <guilabel>EMail</guilabel> and 
+optional a <guilabel>Comment</guilabel>.</para>
+</listitem>
+</varlistentry>
+<varlistentry>
+<term><guilabel>Create a personal X.509 key pair and certification request</guilabel></term>
+<listitem>
+<para>X.509 key pairs are created locally, but certified centrally by a 
+certification authority (&ca;). CAs can certify other CAs, creating a central, 
+hierarchical chain of trust.</para>
+<para>The next step in the wizard is to type in your personal data
 for the certificate. The fields to fill out are:
 <itemizedlist>
 <listitem>
-<para><guilabel>Name:</guilabel> Your name;</para>
+<para><guilabel>Common Name (CN): </guilabel>Your name;</para>
 </listitem>
 <listitem>
-<para><guilabel>Location:</guilabel>The town or city in which you live;</para>
+<para><guilabel>Email address (EMAIL): </guilabel>Your email address; be sure
+to type this in correctly&mdash;this will be the address people will be
+sending mail to when they use your certificate.</para>
 </listitem>
 <listitem>
-<para><guilabel>Organization:</guilabel>The organization you represent
-(for example, the company you work for);</para>
+<para><guilabel>Location (L): </guilabel>The town or city in which you live;</para>
 </listitem>
 <listitem>
-<para><guilabel>Department:</guilabel>The organizational unit you are
+<para><guilabel>Organizational unit (OU): </guilabel>The organizational unit you are
 in (for example, "Logistics");</para> 
 </listitem>
 <listitem>
-<para><guilabel>Country code:</guilabel>The two letter code for the
-country in which you are living (for example, "US");</para>
+<para><guilabel>Organization (O): </guilabel>The organization you represent
+(for example, the company you work for);</para>
 </listitem>
 <listitem>
-<para><guilabel>Email address:</guilabel>Your email address; be sure
-to type this in correctly&mdash;this will be the address people will be
-sending mail to when they use your certificate.</para>
+<para><guilabel>Country code (C): </guilabel>The two letter code for the
+country in which you are living (for example, "US");</para>
 </listitem>
 </itemizedlist>
 </para><para>
 The next step in the wizard is to select whether to store the
 certificate in a file or send it directly to a &ca;. You will have to
 specify the filename or email address to send the certificate request to.
-</para></sect1>
+</para>
+</listitem>
+</varlistentry>
+</variablelist>
+</sect1>
 
 
 <sect1 id="functions-keybox-management"><title>Keybox Management</title>
@@ -337,13 +318,13 @@
 
 <para>These functions include deleting certificates from the local
 keybox with <link linkend="certificates-delete"><menuchoice><shortcut>
-<keycombo action="simul"><keycap>Delete</keycap></keycombo></shortcut>
+<keycombo action="simul"><keycap>Del</keycap></keycombo></shortcut>
 <guimenu>Certificates</guimenu><guimenuitem>Delete</guimenuitem></menuchoice></link>, as well 
 as manual handling of CRLs (<link linkend="certificates-refresh-crls">
-<menuchoice><guimenu>Certificates</guimenu><guimenuitem>Refresh CRLs</guimenuitem>
-</menuchoice></link>, <link linkend="crls-clear-crl-cache"><menuchoice><guimenu>CRLs</guimenu>
+<menuchoice><guimenu>Tools</guimenu><guimenuitem>Refresh Certificates</guimenuitem> <!--???-->
+</menuchoice></link>, <link linkend="crls-clear-crl-cache"><menuchoice><guimenu>Tools</guimenu>
 <guimenuitem>Clear CRL Cache</guimenuitem></menuchoice></link>, <link
-linkend="crls-dump-crl-cache"><menuchoice><guimenu>CRLs</guimenu>
+linkend="crls-dump-crl-cache"><menuchoice><guimenu>Tools</guimenu>
 <guimenuitem>Dump CRL Cache</guimenuitem></menuchoice></link>).</para>
 
 </sect1>
@@ -357,7 +338,8 @@
 <variablelist>
 
 <varlistentry id="file-new-key-pair">
-<term><menuchoice><guimenu>File</guimenu><guimenuitem>New Key Pair...</guimenuitem></menuchoice></term>
+<term><menuchoice><shortcut><keycombo action="simul">&Ctrl;<keycap>N</keycap></keycombo></shortcut>
+<guimenu>File</guimenu><guimenuitem>New Certificate...</guimenuitem></menuchoice></term>
 
 <listitem>
 <para><action>Creates a new key pair (public and private)</action> and
@@ -375,17 +357,39 @@
 <guimenuitem>Import Certificates...</guimenuitem></menuchoice>.</para>
 </listitem>
 </varlistentry>
+<!-- missing menu item
+<varlistentry>
+<term><menuchoice><shortcut><keycombo action="simul">&Ctrl;&Shift;<keycap>I</keycap></keycombo></shortcut>
+<guimenu>File</guimenu><guimenuitem>Lookup Certificates on Server</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
+</varlistentry>
+-->
+<varlistentry id="file-import-certificates">
+<term><menuchoice><shortcut><keycombo action="simul">&Ctrl;<keycap>I</keycap></keycombo></shortcut>
+<guimenu>File</guimenu><guimenuitem>Import Certificates...</guimenuitem></menuchoice></term>
 
+<listitem>
+<para><action>Imports certificates and/or secret keys from files into
+the local keybox.</action></para>
 
+<para>The format of the certificate file must be supported by
+&gpgsm;. Please refer to the &gpgsm; manual for a list of supported
+formats.</para>
+</listitem>
+</varlistentry>
+
 <varlistentry id="file-export-certificates">
-<term><menuchoice><guimenu>File</guimenu><guimenuitem>Export Certificates...</guimenuitem></menuchoice></term>
+<term><menuchoice><shortcut><keycombo action="simul">&Ctrl;<keycap>E</keycap></keycombo></shortcut>
+<guimenu>File</guimenu><guimenuitem>Export Certificates...</guimenuitem></menuchoice></term>
 
 <listitem>
 <para><action>Exports the selected certificates</action> into a file.</para>
 
 <note><para>This exports only the public keys, even if the
 secret key is available. Use <menuchoice><guimenu>File</guimenu><guimenuitem>Export 
-Secret key...</guimenuitem></menuchoice> to export both
+Secret Key...</guimenuitem></menuchoice> to export both
 public and secret keys into a file, but note that this is almost
 always a bad idea.</para></note>
 </listitem>
@@ -393,7 +397,7 @@
 
 
 <varlistentry id="file-export-secret-key">
-<term><menuchoice><guimenu>File</guimenu><guimenuitem>Export Secret key...</guimenuitem></menuchoice></term>
+<term><menuchoice><guimenu>File</guimenu><guimenuitem>Export Secret Key...</guimenuitem></menuchoice></term>
 
 <listitem>
 <para><action>Exports both the public and the secret key to a
@@ -406,22 +410,38 @@
 among other things.</para></warning>
 </listitem>
 </varlistentry>
+<!--missing menu items
+<varlistentry>
+<term><menuchoice><shortcut><keycombo action="simul">&Ctrl;&Shift;<keycap>E</keycap></keycombo></shortcut>
+<guimenu>File</guimenu><guimenuitem>Export Certificates to Server...</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
+</varlistentry>
 
-
-<varlistentry id="file-import-certificates">
-<term><menuchoice><guimenu>File</guimenu><guimenuitem>Import Certificates...</guimenuitem></menuchoice></term>
-
+<varlistentry>
+<term><menuchoice>
+<guimenu>File</guimenu><guimenuitem>Decrypt/Verify Files...</guimenuitem></menuchoice></term>
 <listitem>
-<para><action>Imports certificates and/or secret keys from files into
-the local keybox.</action></para>
-
-<para>The format of the certificate file must be supported by
-&gpgsm;. Please refer to the &gpgsm; manual for a list of supported
-formats.</para>
+<para>???</para>
 </listitem>
 </varlistentry>
-
-
+<varlistentry>
+<term><menuchoice>
+<guimenu>File</guimenu><guimenuitem>Sign/Encrypt Files...</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
+</varlistentry>
+<varlistentry>
+<term><menuchoice><shortcut><keycombo action="simul">&Ctrl;<keycap>W</keycap></keycombo></shortcut>
+<guimenu>File</guimenu><guimenuitem>Close...</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
+</varlistentry>
+-->
+<!--not in 4.2
 <varlistentry id="file-import-crls">
 <term><menuchoice><guimenu>File</guimenu><guimenuitem>Import CRLs...</guimenuitem></menuchoice></term>
 
@@ -447,8 +467,8 @@
 </para>
 </listitem>
 </varlistentry>
+-->
 
-
 <varlistentry id="file-quit">
 <term><menuchoice><shortcut><keycombo action="simul">&Ctrl;<keycap>Q</keycap></keycombo></shortcut>
 <guimenu>File</guimenu><guimenuitem>Quit</guimenuitem></menuchoice></term>
@@ -525,7 +545,7 @@
 
 
 <varlistentry id="view-hierarchical-key-list">
-<term><menuchoice><guimenu>View</guimenu><guimenuitem>Hierarchical Key List</guimenuitem></menuchoice></term>
+<term><menuchoice><guimenu>View</guimenu><guimenuitem>Hierarchical Certificate List</guimenuitem></menuchoice></term>
 
 <listitem>
 <para><action> Toggles between hierarchical and flat keylist mode.
@@ -552,7 +572,7 @@
 <listitem>
 <para>(This function is only available when <link
 linkend="view-hierarchical-key-list"><menuchoice><guimenu>View</guimenu>
-<guimenuitem>Hierarchical Key List</guimenuitem></menuchoice></link> is on.)</para>
+<guimenuitem>Hierarchical Certificate List</guimenuitem></menuchoice></link> is on.)</para>
 
 <para><action>Expands all list items in the certificate list
 view,</action> &ie; makes all items visible.</para>
@@ -565,8 +585,6 @@
 </listitem>
 </varlistentry>
 
-
-
 <varlistentry id="view-collapse-all">
 <term><menuchoice><shortcut><keycombo action="simul">&Ctrl;<keycap>,</keycap>
 </keycombo></shortcut><guimenu>View</guimenu><guimenuitem>Collapse All</guimenuitem></menuchoice></term>
@@ -574,7 +592,7 @@
 <listitem>
 <para>(This function is only available when <link
 linkend="view-hierarchical-key-list"><menuchoice><guimenu>View</guimenu>
-<guimenuitem>Hierarchical Key List</guimenuitem></menuchoice></link> is on.)</para>
+<guimenuitem>Hierarchical Certificate List</guimenuitem></menuchoice></link> is on.)</para>
 
 <para><action>Collapses all list items in the certificate list
 view,</action> &ie; hides all but the top-level items.</para>
@@ -591,14 +609,14 @@
 <sect1 id="menucertificates"><title><guimenu>Certificates</guimenu> Menu</title>
 
 <variablelist>
-
-<varlistentry id="certificates-validate">
-<term><menuchoice><shortcut><keycombo action="simul">&Shift;<keycap>F5</keycap></keycombo>
-</shortcut><guimenu>Certificates</guimenu><guimenuitem>Validate</guimenuitem></menuchoice></term>
-
+<!-- missing menu item
+<varlistentry id="certificates-certify">
+<term><menuchoice>
+<guimenu>Certificates</guimenu><guimenuitem>Certify Certificate...</guimenuitem></menuchoice></term>
 <listitem>
-<para><action>Validates selected (or all) keys.</action></para>
+<para><action>???</action></para>
 
+no longer in kde4
 <para>This is similar to <link
 linkend="view-redisplay"><menuchoice><shortcut><keycombo action="simul">
 <keycap>F5</keycap></keycombo></shortcut><guimenu>View</guimenu>
@@ -619,10 +637,9 @@
 decryption).</para></warning>
 </listitem>
 </varlistentry>
-
-
-
-<varlistentry id="certificates-refresh-crls">
+-->
+<!--not in 4.2
+varlistentry id="certificates-refresh-crls">
 <term><menuchoice><guimenu>Certificates</guimenu><guimenuitem>Refresh CRLs</guimenuitem></menuchoice></term>
 
 <listitem>
@@ -646,12 +663,42 @@
 
 <para>Use this function scarcely.</para></warning>
 </listitem>
+</varlistentry-->
+<!-- missing menu items
+<varlistentry>
+<term><menuchoice>
+<guimenu>Certificates</guimenu><guimenuitem>Change Ownertrust...</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
 </varlistentry>
 
+<varlistentry>
+<term><menuchoice>
+<guimenu>Certificates</guimenu><guimenuitem>Expire Date...</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
+</varlistentry>
 
+<varlistentry>
+<term><menuchoice>
+<guimenu>Certificates</guimenu><guimenuitem>Change Passphrase...</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
+</varlistentry>
 
+<varlistentry>
+<term><menuchoice>
+<guimenu>Certificates</guimenu><guimenuitem>Add User-ID...</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
+</varlistentry>
+-->
 <varlistentry id="certificates-delete">
-<term><menuchoice><shortcut><keycombo action="simul"><keycap>Delete</keycap></keycombo></shortcut>
+<term><menuchoice><shortcut><keycombo action="simul"><keycap>Del</keycap></keycombo></shortcut>
 <guimenu>Certificates</guimenu><guimenuitem>Delete</guimenuitem></menuchoice></term>
 
 <listitem>
@@ -669,40 +716,65 @@
 </listitem>
 </varlistentry>
 
+<varlistentry>
+<term><menuchoice><guimenu>Certificates</guimenu><guimenuitem>Dump Certificate</guimenuitem></menuchoice></term>
+<listitem>
+<para>Shows the detailed contents of the &gpgsm; CRL cache.</para>
+</listitem>
+</varlistentry>
 
-
-<varlistentry id="certificates-download">
+<!--not in 4.2
+varlistentry id="certificates-download">
 <term><menuchoice><guimenu>Certificates</guimenu><guimenuitem>Download</guimenuitem></menuchoice></term>
 
 <listitem>
 <para><action>Downloads the selected certificate(s) from the LDAP to the local keybox.</action></para>
 </listitem>
-</varlistentry>
+</varlistentry-->
 
 </variablelist>
 
 </sect1>
 
+<sect1 id="menutools"><title><guimenu>Tools</guimenu> Menu</title>
 
+<variablelist>
 
-<sect1 id="menucrls"><title><guimenu>CRLs</guimenu> Menu</title>
+<varlistentry id="tools-gnupg-log-viewer">
+<term><menuchoice><guimenu>Tools</guimenu><guimenuitem>GnuPG Log Viewer...</guimenuitem></menuchoice></term>
 
-<variablelist>
+<listitem>
+<para><action>Starts <ulink url="help:/kwatchgnupg/index.html">&kwatchgnupg;</ulink></action>, a tool to present the debug output of GnuPG application. If signing, encryption, or verification mysteriously stop working, you might find out why by looking at the log.</para>
+</listitem>
+</varlistentry>
 
+<varlistentry id="certificates-refresh-crls">
+<term><menuchoice><guimenu>Tools</guimenu><guimenuitem>Refresh X.509 or OpenPGP Certificates</guimenuitem></menuchoice></term>
+
+<listitem>
+<para>Refreshing X.509 or OpenPGP certificates implies downloading all certificates
+and CRLs, to check if any of them have been revoked in the meantime.</para>
+<para>This can put a severe strain on your own as well as other
+people's network connections, and can take up to an hour or more to
+complete, depending on your network connection, and the number of
+certificates to check.</para>
+</listitem>
+</varlistentry>
+
 <varlistentry id="crls-clear-crl-cache">
-<term><menuchoice><guimenu>CRLs</guimenu><guimenuitem>Clear CRL Cache</guimenuitem></menuchoice></term>
+<term><menuchoice><guimenu>Tools</guimenu><guimenuitem>Clear CRL Cache</guimenuitem></menuchoice></term>
 
 <listitem>
 <para><action>Clears the &gpgsm; CRL cache.</action></para>
 
 <para>You probably never need this. You can force a refresh of the CRL
 cache by selecting all certificates and using <link linkend="certificates-refresh-crls"><menuchoice>
-<guimenu>Certificates</guimenu><guimenuitem>Refresh CRLs</guimenuitem></menuchoice></link> instead.</para>
+<guimenu>Tools</guimenu><guimenuitem>Refresh Certificates</guimenuitem></menuchoice></link> instead.</para>
 </listitem>
 </varlistentry>
 
 <varlistentry id="crls-dump-crl-cache">
-<term><menuchoice><guimenu>CRLs</guimenu><guimenuitem>Dump CRL Cache</guimenuitem></menuchoice></term>
+<term><menuchoice><guimenu>Tools</guimenu><guimenuitem>Dump CRL Cache</guimenuitem></menuchoice></term>
 
 <listitem>
 <para><action>Shows the detailed contents of the &gpgsm; CRL
@@ -710,22 +782,20 @@
 </listitem>
 </varlistentry>
 
-</variablelist>
+<varlistentry id="settings-configure-gpgme-backend">
+<term><menuchoice><guimenu>Tools</guimenu><guimenuitem>Configure GnuPG Backend...</guimenuitem></menuchoice></term>
 
-</sect1>
+<listitem>
+<para><action>Opens a dialog that allows you to configure every aspect of
+&gpgsm; and other backend modules.</action></para>
 
-<sect1 id="menutools"><title><guimenu>Tools</guimenu> Menu</title>
-
-<variablelist>
-
-<varlistentry id="tools-gnupg-log-viewer">
-<term><menuchoice><guimenu>Tools</guimenu><guimenuitem>GnuPG Log Viewer...</guimenuitem></menuchoice></term>
-
-<listitem>
-<para><action>Starts <ulink url="help:/kwatchgnupg/index.html">&kwatchgnupg;</ulink></action></para>
+<para>This dialog is dynamically built from the output of the
+&gpgconf; utility and may thus change when backend modules are
+updated.</para>
 </listitem>
 </varlistentry>
 
+
 </variablelist>
 
 </sect1>
@@ -733,20 +803,23 @@
 <sect1 id="menusettings"><title><guimenu>Settings</guimenu> Menu</title>
 
 <variablelist>
+<!-- missing items
+<varlistentry>
+<term><menuchoice>
+<guimenu>Settings</guimenu><guimenuitem>Perform Selftest</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
+</varlistentry>
 
-<varlistentry id="settings-configure-gpgme-backend">
-<term><menuchoice><guimenu>Settings</guimenu><guimenuitem>Configure GpgME Backend...</guimenuitem></menuchoice></term>
-
+<varlistentry>
+<term><menuchoice>
+<guimenu>Settings</guimenu><guisubmenu>Toolbars</guisubmenu></menuchoice></term>
 <listitem>
-<para><action>Opens a dialog that allows you to configure every aspect of
-&gpgsm; and other backend modules.</action></para>
-
-<para>This dialog is dynamically built from the output of the
-&gpgconf; utility and may thus change when backend modules are
-updated.</para>
+<para>???</para>
 </listitem>
 </varlistentry>
-
+-->
 <varlistentry id="settings-show-statusbar">
 <term><menuchoice><guimenu>Settings</guimenu><guimenuitem>Show Statusbar</guimenuitem></menuchoice></term>
 
@@ -754,7 +827,14 @@
 <para><action>Toggles the visibility of the bottom status bar.</action></para>
 </listitem>
 </varlistentry>
-
+<!-- missing item
+<varlistentry>
+<term><menuchoice><guimenu>Settings</guimenu><guimenuitem>Configure Toolbars...</guimenuitem></menuchoice></term>
+<listitem>
+<para>???</para>
+</listitem>
+</varlistentry>
+-->
 <varlistentry id="settings-configure-shortcuts">
 <term><menuchoice><guimenu>Settings</guimenu><guimenuitem>Configure Shortcuts...</guimenuitem></menuchoice></term>
 
@@ -779,9 +859,15 @@
 
 </sect1>
 
+<sect1 id="menuwindow"><title><guimenu>Window</guimenu> Menu</title>
+<para>The <guimenu>Window</guimenu> menu allows you to manage the tabs.
+Using the items in this menu you can rename a tab, add a new tab, duplicate the current tab, close the current tab, and move the current tab to the left or right.</para>
+
+<para>By clicking with the &RMB; click on a tab you open a context menu, where you can also select the same actions.</para>
+</sect1>
+
 <sect1 id="menuhelp"><title><guimenu>Help</guimenu> Menu</title>
 
-
 <para>The <guimenu>Help</guimenu> menu contains the standard &kde;
 help menu.</para>
 
@@ -800,28 +886,29 @@
 
 <variablelist>
 
-<varlistentry id="commandline-option-external">
-<term>&commandline-option-external;</term>
+<varlistentry>
+<term><option>--external</option></term>
+<listitem>
+<para>Run UI server only, hide main window</para>
+</listitem>
+</varlistentry>
 
+<varlistentry>
+<term><option>-p</option> <option>--openpgp</option></term>
 <listitem>
-<para><action>Specifies that &commandline-option-query; shall search
-remotely instead of in the local keybox.</action></para>
+<para>Use OpenPGP for the following operation</para>
 </listitem>
 </varlistentry>
 
-<varlistentry id="commandline-option-query">
-<term>&commandline-option-query;</term>
-
+<varlistentry>
+<term><option>-c</option> <option>--cms</option></term>
 <listitem>
-<para><action>Specifies that &kleopatra; shall start with the given
-query string instead of listing the complete local
-keybox.</action></para>
+<para>Use CMS (X.509, S/MIME) for the following operation</para>
 </listitem>
 </varlistentry>
 
 <varlistentry id="commandline-option-import-certificate">
-<term>&commandline-option-import-certificate;</term>
-
+<term><option>-i</option> <option>--import-certificate</option></term>
 <listitem>
 <para><action>Specifies a file or &URL; from which to import
 certificates (or secret keys) from.</action></para>
@@ -832,6 +919,48 @@
 </listitem>
 </varlistentry>
 
+<varlistentry>
+<term><option>-e</option> <option>--encrypt</option></term>
+<listitem>
+<para>Encrypt file(s)</para>
+</listitem>
+</varlistentry>
+
+<varlistentry>
+<term><option>-s</option> <option>--sign</option></term>
+<listitem>
+<para>Sign file(s)</para>
+</listitem>
+</varlistentry>
+
+<varlistentry>
+<term><option>-E</option> <option>--encrypt-sign</option></term>
+<listitem>
+<para>Encrypt and/or sign file(s)</para>
+</listitem>
+</varlistentry>
+
+<varlistentry>
+<term><option>-d</option> <option>--decrypt</option></term>
+<listitem>
+<para>Decrypt file(s)</para>
+</listitem>
+</varlistentry>
+
+<varlistentry>
+<term><option>-V</option> <option>--verify</option></term>
+<listitem>
+<para>Verify file/signature</para>
+</listitem>
+</varlistentry>
+
+<varlistentry>
+<term><option>-D</option> <option>--decrypt-verify</option></term>
+<listitem>
+<para>Decrypt and/or verify file(s)</para>
+</listitem>
+</varlistentry>
+
 </variablelist>
 
 </chapter>
@@ -850,30 +979,29 @@
 certificate searches. You can also configure their order, as well as
 some selected LDAP-related settings from the dynamic backend
 configuration dialog, available via <link
-linkend="settings-configure-gpgme-backend"><menuchoice><guimenu>Settings</guimenu>
-<guimenuitem>Configure GpgME Backend...</guimenuitem></menuchoice></link>.</para>
+linkend="settings-configure-gpgme-backend"><menuchoice><guimenu>Tools</guimenu>
+<guimenuitem>Configure GnuPG Backend...</guimenuitem></menuchoice></link>.</para>
 
-<para>To add a new server, click on the <guilabel>Add
-Service...</guilabel> button. In the dialog that appears, you can set
-the <guilabel>Server name</guilabel>, the <guilabel>Port</guilabel>
+<para>To add a new server, click on the <guilabel>New</guilabel> button. 
+Then you can set
+the <guilabel>Server Name</guilabel>, the <guilabel>Server Port</guilabel>
 (preset to the default LDAP port), the <guilabel>Base &dn;</guilabel>
 (sometimes referred to as the search root or search base), and the
-usual <guilabel>User name</guilabel> and
+usual <guilabel>User Name</guilabel> and
 <guilabel>Password</guilabel>, both of which are only needed if the
-server requires authentication. Clicking <guilabel>OK</guilabel> adds
-the server details to the list of servers, while
-<guilabel>Cancel</guilabel> dismisses the input.</para>
+server requires authentication.</para>
 
 <para>To remove a server from the search list, select it in the list,
-then press the <guilabel>Remove Service</guilabel> button.</para>
+then press the <guilabel>Delete</guilabel> button.</para>
 
+<!-- not in 4.2
 <para>To change the relative search order of servers, select one of
 them and move it up or down with the arrow buttons right next to the
 list.</para>
-
+-->
 <para>To set the LDAP timeout, &ie; the maximum time the backend will
 wait for a server to respond, simply use the corresponding input field
-labelled <guilabel>LDAP timeout</guilabel>.</para>
+labeled <guilabel>LDAP timeout (minutes:seconds)</guilabel>.</para>
 
 <para>If one of your servers has a large database, so that even
 reasonable searches like <userinput>Smith</userinput> hit the
@@ -938,7 +1066,7 @@
 
 </sect1>
 
-<sect1 id="configuration-dn-order"><title>Configuring the <guilabel>&dn;Attribute Order</guilabel></title>
+<sect1 id="configuration-dn-order"><title>Configuring the <guilabel>&dn; Attribute Order</guilabel></title>
 
 <para>Although &dn;s are hierarchical, the order of the individual
 components (called relative &dn;s (RDNs), or &dn; attributes) is not
@@ -1097,7 +1225,7 @@
 	linkend="configuration-appearance">visual appearance</link> of
 	keys based on a concept called <guilabel>Key
 	Categories</guilabel>. <guilabel>Key Categories</guilabel> are
-	also used to filter the list of certificates.This section
+	also used to filter the list of certificates. This section
 	describes how you can edit the available categories and add
 	new ones.
       </para>
@@ -1303,9 +1431,7 @@
 	      <entry><varname>was-validated</varname></entry>
 	      <entry>boolean</entry>
 	      <entry>
-		the key has been validated (see <link
-		linkend="certificates-validate"><menuchoice><shortcut><keycombo action="simul">&Shift;<keycap>F5</keycap></keycombo></shortcut>
-		<guimenu>Certificates</guimenu><guimenuitem>Validate</guimenuitem></menuchoice></link>).
+		the key has been validated.
 	      </entry>
 	    </row>
 	    <row>
@@ -1403,7 +1529,7 @@
         by an exclamation point (<literal>!</literal>), indicating negation. The tokens act
         in order on an internal list of contexts, which starts out
         empty. This is best explained by an example: <literal>any
-        !apperance</literal> is the same as
+        !appearance</literal> is the same as
         <literal>filtering</literal>, and <literal>appearance
         !appearance</literal> is producing the empty set, as is
         <literal>!any</literal>. However, the last two will be
@@ -1424,7 +1550,7 @@
         wins over less specific ones. If two filters have the same
         specificity, the one that comes first in the config file
         wins. A filter's specificity is proportional to the number of
-        critera it contains.
+        criteria it contains.
       </para>
 
       <example>
Index: doc/ktimetracker/index.docbook
===================================================================
--- doc/ktimetracker/index.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ doc/ktimetracker/index.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -99,12 +99,13 @@
 <sect1 id="starting">
 <title>Starting &karm;</title>
 
-<para>Type <command>karm</command> at a command prompt or select
-<guimenuitem>Personal Time Tracker</guimenuitem> from the
-<guisubmenu>Utilities</guisubmenu> group in the <guimenu>KDE start
+<para>Type <command>ktimetracker</command> at a command prompt or select
+<guimenuitem>Personal Time Tracker</guimenuitem> from the <menuchoice>
+<guimenu>Applications</guimenu><guisubmenu>Utilities</guisubmenu> 
+</menuchoice> group in the <guimenu>KDE start
 menu</guimenu>. The standard &Qt; and &kde; command options are
 available, and can be listed by entering
-<userinput><command>karm</command> <option>--help</option></userinput>
+<userinput><command>ktimetracker</command> <option>--help</option></userinput>
 at the command line.</para>
 
 <para>&karm; provides an additional command option that allows you to enter
@@ -921,7 +922,7 @@
 <term>
 <menuchoice>
 <guimenu>Settings</guimenu>
-<guimenuitem>Configure KArm</guimenuitem>
+<guimenuitem>Configure &karm;</guimenuitem>
 </menuchoice>
 </term>
 <listitem><para><action>Opens</action> a dialog to allow the user to
@@ -997,7 +998,7 @@
 
 <para>Contributors (in alphabetical order)</para>
 <itemizedlist>
-<listitem><para>Allen Winter <email>winterz@verizon.net</email></para></listitem>
+<listitem><para>Allen Winter <email>winter@kde.org</email></para></listitem>
 <listitem><para>&David.Faure; &David.Faure.mail;</para></listitem>
 <listitem><para>&Espen.Sand; <email>espen@kde.org</email></para></listitem>
 <listitem><para>Gioele Barabucci <email>gioele@gioelebarabucci.com</email></para></listitem>
Index: doc/kjots/index.docbook
===================================================================
--- doc/kjots/index.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ doc/kjots/index.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -155,12 +155,12 @@
 <guimenuitem>Delete Page</guimenuitem></menuchoice>.</para>
 
 <tip><para>If you need to insert the current date and time while you are 
-writing a note, you can use  <keycombo action="simul">&Ctrl;<keycap>I
+writing a note, you can use  <keycombo action="simul">&Ctrl;&Shift;<keycap>I
 </keycap></keycombo>.</para></tip>
 
 <para>So that you can get to the page you want to see, pages can (and
 should) be given a name. This can be done in the way you are used to: 
-select the page you want to rename, wait a second and click it once more. 
+double click the page you want to rename.
 You are then able to rename the page. Of course there is also a keyboard 
 shortcut, you can use that at any time while writing a note. The shortcut 
 is: <keycombo action="simul">&Ctrl;<keycap>M</keycap></keycombo>.</para>
Index: doc/knode/using-morefeatures.docbook
===================================================================
--- doc/knode/using-morefeatures.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ doc/knode/using-morefeatures.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -644,7 +644,7 @@
 the rules which are shown &mdash; you have the choice whether to show all
 rules or only the rules for a specific <glossterm>newsgroup</glossterm>.</para> 
 
-<para>If you chose a rule-name in the list you the rule will be displayed
+<para>If you choose a rule-name in the list the rule will be displayed
 on the right-hand side; now you can edit the rule. At the top you can change
 the name of the rule and set the newsgroups to which this rule applies.
 You can choose one or
@@ -725,7 +725,7 @@
 raise or lower the score, by the configured value, for articles to which
 this rule applies.  &knode; can also show you a little message when finding
 such an article or colorize the header in the article list; for example, you could make
-interesting articles scraeming pink so you would notice them very
+interesting articles screaming pink so you would notice them very
 quickly.</para> 
 
 <para>When leaving the editor, or when the 
Index: doc/knode/using-firststart.docbook
===================================================================
--- doc/knode/using-firststart.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ doc/knode/using-firststart.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -246,7 +246,7 @@
 <para>If this option is activated, the signature file is not handled
 as a text file, but as a program. The signature file will be started
 as a program and the output will be used as a signature. Through that
-you'll be able to chose a signature by accident or to use fortune to
+you'll be able to choose a signature by accident or to use fortune to
 generate a cool slogan every time.</para>
 
 </sect3>
@@ -825,7 +825,7 @@
 it as read.</para>
 
 <para>If <guilabel>Go to next unread thread</guilabel> is
-checked, &knode; automatically shows the next thread if you mark the
+checked, &knode; automatically shows the next thread if you mark
 the previous thread as read.</para>
 
 </sect3>
@@ -942,7 +942,7 @@
 
 <para>The <guibutton>Down</guibutton> button does the opposite
 action: select the filter you just shifted one up and
-press<guibutton>Down</guibutton> until it reaches its old
+press <guibutton>Down</guibutton> until it reaches its old
 position.</para>
 
 <para>With the two buttons <guibutton>Add Separator</guibutton> and
Index: doc/knode/using-subscribing.docbook
===================================================================
--- doc/knode/using-subscribing.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ doc/knode/using-subscribing.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -184,7 +184,7 @@
 </tip> 
 
 <para>Unfortunately there is no guarantee that your newsserver is
-providing all available newsgroups: many newsserver refuse groups
+providing all available newsgroups: many newsservers refuse groups
 publishing binary attachments; other groups are only available from
 special servers. &knode; provides you the possibility to use more than
 one news-server if you want to access alternative servers providing
@@ -446,7 +446,7 @@
 <varlistentry> 
 <term><guilabel>From</guilabel></term> 
 <listitem> 
-<para>The <guilabel>From</guilabel> column shows the author, or their
+<para>The <guilabel>From</guilabel> column shows the author, or his
 e-mail address if the author didn't give a name. You can configure
 your settings in
 <menuchoice><guimenu>Settings</guimenu><guimenuitem>Configure
@@ -578,7 +578,7 @@
 <para>You can navigate in articles, display an article and open or
 close threads with your mouse or keyboard.</para> 
 
-<para>When you select an article with your mouse its entry in the the
+<para>When you select an article with your mouse its entry in the
 article view gets colored; at the same time the header and body of
 this article appear in in the article window. If you want to read
 another article you can use the mouse to select it, or you can use
Index: doc/kpilot/conduit-sysinfo.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/wizard-connection.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/setup-viewer.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/address-app.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/db-app.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/conduit-knotes.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/conduit-mal.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/wizard-conduits.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/toolbar_backup.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/conduit-popmail-kmail.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/toolbar_hotsync.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/wizard-general.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/memo-app.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/conduit-palmdoc.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/todo-app.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/file-app.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/usage.docbook
===================================================================
--- doc/kpilot/usage.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ doc/kpilot/usage.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -1,12 +1,10 @@
 <chapter id="using-kpilot">
-<title>Using &kpilot; Data Viewers and Main Window Interface</title>
+<title>Using &kpilot; Main Window Interface</title>
 
 <para>
-This chapter describes the usage of &kpilot;'s main window; as a viewer
-application for data on the &handheld;, and  its menu structure.
-The main window of &kpilot; also contains
-the &HotSync;-log, which can be useful when
-debugging problems.
+This chapter describes the usage of &kpilot;'s main window and its menu
+structure.  The main window of &kpilot; also contains the &HotSync;-log, which
+can be useful when debugging problems.
 </para>
 
 <para>
@@ -31,7 +29,7 @@
 </para>
 
 <para>
-The <guimenu>file</guimenu> menu contains the synchronization menu items. Note
+The <guimenu>File</guimenu> menu contains the synchronization menu items. Note
 that these items do not start the sync process, they only select what the new
 sync will be. To really start it, you must press the HotSync button on your
 &PalmPilot;'s cradle (or on the &handheld; itself, when there is no cradle).
@@ -70,23 +68,6 @@
 <term>
 <menuchoice>
 <guimenu>File</guimenu>
-<guimenuitem>FastSync</guimenuitem>
-</menuchoice>
-</term>
-<listitem>
-<para>
-(not available with all installations)
-Make the next sync a FastSync. For more information, please check the
-<link linkend="sync-s">Syncing your &handheld; data</link> section of this
-handbook.
-</para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term>
-<menuchoice>
-<guimenu>File</guimenu>
 <guimenuitem>FullSync</guimenuitem>
 </menuchoice>
 </term>
@@ -104,56 +85,6 @@
 <term>
 <menuchoice>
 <guimenu>File</guimenu>
-<guimenuitem>Backup</guimenuitem>
-</menuchoice>
-</term>
-<listitem>
-<para>
-Make the next sync a full backup of your &PalmPilot; data. This action can take
-several minutes. For more information, please check the
-<link linkend="backup"> Backing up your &handheld; data</link> section of this
-handbook.
-</para>
-<tip>
-<para>
-The first thing you should do after starting &kpilot; for
-the first time is make a full backup.
-</para>
-</tip>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term>
-<menuchoice>
-<guimenu>File</guimenu>
-<guimenuitem>Restore</guimenuitem>
-</menuchoice>
-</term>
-<listitem>
-<para>
-This copies all the data from a previous backup on your
-<acronym>PC</acronym> to your &PalmPilot;,
-replacing whatever data was there.
-Use this if your &PalmPilot; suffers some from software or hardware failure
-(or is replaced by a new one). For more information, please check the
-<link linkend="restore"> Restoring your &handheld; data</link> section of this
-handbook.
-</para>
-<warning>
-<para>
-Doing a restore will erase all data on the &PalmPilot;
-before restoring the information from your
-<acronym>PC</acronym>!</para>
-</warning>
-</listitem>
-</varlistentry>
-
-
-<varlistentry>
-<term>
-<menuchoice>
-<guimenu>File</guimenu>
 <guimenuitem>Copy Handheld to PC</guimenuitem>
 </menuchoice>
 </term>
@@ -182,28 +113,10 @@
 </listitem>
 </varlistentry>
 
-
-<!--
 <varlistentry>
 <term>
 <menuchoice>
 <guimenu>File</guimenu>
-<guimenuitem>List Only</guimenuitem>
-</menuchoice>
-</term>
-<listitem>
-<para>
-The next sync will only list the databases on your &handheld;, no exchange of
-data will be performed.
-</para>
-</listitem>
-</varlistentry>
--->
-
-<varlistentry>
-<term>
-<menuchoice>
-<guimenu>File</guimenu>
 <guimenuitem>Quit</guimenuitem>
 </menuchoice>
 </term>
@@ -268,7 +181,7 @@
 Displays &kpilot;'s shortcut configuration dialog, allowing you change or create
 key bindings, which are associations between actions (for example, opening
 &kpilot;'s configuration dialog) and keys or key combinations (for instance,
-Ctrl + Shift + a).
+<keycombo action="simul">&Ctrl;&Shift;<keycap>A</keycap></keycombo>).
 </para>
 </listitem>
 </varlistentry>
@@ -302,36 +215,15 @@
 <listitem>
 <para>
 Displays &kpilot;'s configuration dialog, allowing you to match your hardware
-with the configuration, so that &kpilot; can talk with your &handheld;, to
-configure the way &kpilot; synchronizes your &PalmPilot; with your
-desktop applications (through conduits) and the way it shows the data from your &PalmPilot; in the
-<link linkend="builtin">built-in viewers</link>. The <link linkend="configure">
-Configuring &kpilot;</link> chapter of this handbook offers detailed information
-about these configuration options.
+with the configuration, so that &kpilot; can talk with your &handheld;, and to
+configure the way &kpilot; synchronizes your &PalmPilot; with your desktop
+applications (through conduits). The <link linkend="configure"> Configuring
+&kpilot;</link> chapter of this handbook offers detailed information about these
+configuration options.
 </para>
 </listitem>
 </varlistentry>
 
-<varlistentry>
-<term>
-<menuchoice>
-<guimenu>Settings</guimenu>
-<guimenuitem>Configuration Wizard...</guimenuitem>
-</menuchoice>
-</term>
-<listitem>
-<para>
-Displays &kpilot;'s configuration wizard dialog. The
-<link linkend="configwizard">configuration wizard</link> helps you to set up
-&kpilot; to communicate with the &PalmPilot; and to configure the conduits as
-a group. It's a great start for new users, and you can always fine-tune your
-preferences later, using the <link linkend="configure">configure
-dialog</link>.
-</para>
-</listitem>
-</varlistentry>
-
-
 </variablelist>
 
 
@@ -360,245 +252,10 @@
 <para>
 Selecting one of the built-in applications
 will cause that application to appear in &kpilot;'s main
-window.
-You may use the viewer applications to edit the information, by enabling
-this option in the <link linkend="page-viewers">database viewer's
-configuration dialog</link>. The ability to view and edit private records is
-configurable too.</para>
+window.</para>
 
-<para>
-Any changes you make to the &PalmPilot; databases with
-the built-in applications (such as deleting a memo)
-do not take effect on the &PalmPilot; until the next HotSync.
-</para>
 
-<important><para>
-If the <guilabel>Make internal viewers editable</guilabel> option is
-not enabled, the changes in the viewers are not synchronized with your
-&handheld;, and will be lost. In recent versions of &kpilot; it is not possible
-enable this option, and therefore, to edit the databases with the viewers.
-</para></important>
 
-<sect2 id="todo-app">
-
-<title>The Todo Viewer</title>
-
-<para>
-The todo application allows you to view the tasks from your &PalmPilot;,
-add new tasks and edit or delete existing ones. The changes you made
-are applied to the &handheld; the next time you &HotSync;.
-</para>
-
-<screenshot>
-<screeninfo>Todo Viewer Application</screeninfo>
-<mediaobject>
-<imageobject><imagedata fileref="todo-app.png" format="PNG"/></imageobject>
-<textobject><phrase>The Todo Viewer Application</phrase></textobject>
-<caption><para>The Todo Viewer Application</para></caption>
-</mediaobject>
-</screenshot>
-
-<para>
-The todo application has a drop down box
-for the memo categories defined in the &PalmPilot;.
-In the screenshot, category <quote>All</quote> is selected.
-Underneath the drop down box is a list of todo entries, with a check box
-indicating if they are completed or not. You can click the check box to toggle
-the todo item between completed and not completed status. Clicking on one of the
-todo items in the list will display its details in the text box labelled
-<guilabel>Todo info:</guilabel> to the right.
-</para>
-
-<para>
-If you have the <guilabel>Make internal viewers editable</guilabel> option
-enabled in the <link linkend="page-viewers">viewers configuration page</link> you
-can use the buttons <guibutton>Edit Record...</guibutton>,
-<guibutton>New Record...</guibutton> and <guibutton>Delete Record</guibutton>
-to edit the todo data from your &handheld;, and sync the data in the next
-&HotSync;.</para>
-
-<!--
-<note><para>
-If you create new todo and decide that
-you do not want to have it on the &PalmPilot;
-you must perform a &HotSync; (copying the todo
-to the &PalmPilot;) and then delete the todo record
-from the &PalmPilot; or the viewer, and &HotSync; again. It is not possible to
-delete newly-added records from the built-in applications.
-</para></note>
--->
-
-<para>
-The <guibutton>Edit Record...</guibutton> button opens a dialog where you can 
-edit the details of the currently selected todo item, including description,
-priority and end date. Click the <guibutton>New Record...</guibutton> button to
-open the same dialog, but instead of editing the current selected record, a new
-todo will be added to the list. And finally, click the
-<guibutton>Delete Record</guibutton> button to remove the selected todo record
-from the list.
-</para>
-
-</sect2>
-
-<sect2 id="address-app">
-<title>The Address Viewer</title>
-<para>
-The address viewer lets you view, create, delete and edit addresses
-from the &PalmPilot;, and synchronize changes back. The addresses can be 
-sorted and viewed in the <guilabel>"Last, first"</guilabel> or <guilabel>"Company,
-last"</guilabel> format, depending on your
-<link linkend="page-viewers">viewers configuration.</link>
-</para>
-
-<screenshot>
-<screeninfo>The Address Viewer Application</screeninfo>
-<mediaobject>
-<imageobject><imagedata fileref="address-app.png" format="PNG"/></imageobject>
-<textobject><phrase>The Address Viewer Application</phrase></textobject>
-<caption><para>The Address Viewer Application</para></caption>
-</mediaobject>
-</screenshot>
-
-
-<para>
-The address application resembles the todo application;
-the drop down box, buttons, list and text area function exactly
-the same, allowing you to select, view and edit an address
-as on the &PalmPilot;.
-</para>
-
-<para>
-The <guibutton>Edit Record...</guibutton> dialog allows you to edit the
-<guilabel>Last Name</guilabel>, <guilabel>First Name</guilabel>,
-<guilabel>Company</guilabel>, &etc; fields, just as if you where using your
-&handheld;.  Click the <guibutton>New Record...</guibutton> button to
-open the same dialog, but instead of editing the current selected record, a new
-address will be added to the list. Click the
-<guibutton>Delete Record</guibutton> button to remove the selected address
-from the list.
-
-<!--
-<note><para>
-If you create new address and decide that
-you do not want to have it on the &PalmPilot;
-you must perform a &HotSync; (copying the address
-to the &PalmPilot;) and then delete the address record
-from the &PalmPilot; or the viewer, and &HotSync; again. It is not possible to
-delete newly-added records from the built-in applications.
-</para></note>
--->
-
-</para>
-</sect2>
-
-
-<sect2 id="memo-app">
-
-<title>The Memo Viewer</title>
-
-<para>
-The memo application allows you to view the memos on your &PalmPilot;,
-export them to text files, import new ones to be installed the next
-time you &HotSync;, or edit existing ones.
-</para>
-
-<screenshot>
-<screeninfo>Memo Viewer Application</screeninfo>
-<mediaobject>
-<imageobject><imagedata fileref="memo-app.png" format="PNG"/></imageobject>
-<textobject><phrase>The Memo Viewer Application</phrase></textobject>
-<caption><para>The Memo Viewer Application</para></caption>
-</mediaobject>
-</screenshot>
-
-<para>
-The memo application has a drop down box
-for the memo categories defined in the &PalmPilot;.
-Here category <quote>All</quote> is selected.
-Underneath the drop down box is a list of memo titles.
-These are the first lines of the memos, just like
-in the &PalmPilot; memo application.
-Clicking on one of the memo titles in the list
-box will display it in the text box labelled
-<guilabel>Memo Text:</guilabel> to the right.
-</para>
-
-<para>
-When a memo is selected, you can use the buttons
-<guibutton>Export Memo...</guibutton> and
-<guibutton>Delete Memo</guibutton>
-to export the selected memo to a file
-or to delete the selected memo.
-Exporting a memo requires
-you to give a filename; the memo
-is written to that file.
-Take care not to overwrite existing files with this action.
-Deleting a memo does not affect the &PalmPilot;
-until the next &HotSync;.
-</para>
-
-<para>
-The
-<guibutton>Import Memo...</guibutton>
-button allows you to read a text file and
-add it &mdash; as a memo &mdash; to the &PalmPilot;.
-Importing a memo does not take effect until
-the next &HotSync;.
-
-<!--
-<note><para>
-If you import a memo and decide that
-you do not want to have it on the &PalmPilot;
-you must perform a &HotSync; (copying the memo
-to the &PalmPilot;) and then delete the memo record
-from the &PalmPilot; or the viewer, and &HotSync; again. It is not possible to
-delete newly-added records from the built-in applications.
-</para></note>
--->
-
-</para>
-
-
-</sect2>
-
-<sect2 id="db-app">
-<title>The Generic DB Viewer</title>
-
-<para>
-In short, databases are all files stored in your &handheld;. A database
-can be either a record database, which stores dynamic information created by the
-user (for instance, the addresses or the todo information), or a resource
-database, which tend to be static (for instance the applications).
-</para>
-
-<para>
-The Generic DB Viewer is a tool to view and analyze databases stored on
-your handheld, especially record databases. It helps a lot creating new conduits
-and to debug existing ones.
-
-<warning><para>
-While it is possible use the database viewer to edit, add and delete records, you
-should really know what you are doing, otherwise you may damage your data. Use
-the viewer applications or conduits to edit your &handheld; data instead, in a
-normal usage scenario.
-</para></warning>
-
-</para>
-
-
-
-<screenshot>
-<screeninfo>The Generic DB Viewer</screeninfo>
-<mediaobject>
-<imageobject><imagedata fileref="db-app.png" format="PNG"/></imageobject>
-<textobject><phrase>The Generic DB Viewer</phrase></textobject>
-<caption><para>The Generic DB Viewer</para></caption>
-</mediaobject>
-</screenshot>
-
-</sect2>
-
-
 <sect2 id="installer-app">
 <title>The File Installer</title>
 <para>
@@ -616,11 +273,9 @@
 </para>
 
 <para>
-If you are using the &HotSync; Daemon you may drag and
-drop files or &URL;s
-onto the docked icon on the toolbar. The file installer application also
-supports dragging and dropping into the <guilabel>Files to Install:</guilabel>area.
-Provided <guilabel>Sync Files</guilabel> is checked in the
+The file installer application supports dragging and dropping into
+the <guilabel>Files to Install:</guilabel>area.  Provided <guilabel>Sync
+Files</guilabel> is checked in the
 <link linkend="page-general">settings dialog</link> they
 will be installed the next time you HotSync.
 </para>
Index: doc/kpilot/conduit-memofile.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream

Zmiany atrybutów dla: doc/kpilot/conduit-memofile.png
___________________________________________________________________
Dodane: svn:mime-type
   + application/octet-stream

Index: doc/kpilot/kpilot.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream

Zmiany atrybutów dla: doc/kpilot/kpilot.png
___________________________________________________________________
Dodane: svn:mime-type
   + application/octet-stream

Index: doc/kpilot/main-app.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/configuration.docbook
===================================================================
--- doc/kpilot/configuration.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ doc/kpilot/configuration.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -9,9 +9,7 @@
 need to be configured as well.
 After that you can use &kpilot;
 to synchronize your &PalmPilot; with
-your &kde; desktop or view
-data from your &PalmPilot; with the
-<link linkend="builtin">built-in viewers</link>.
+your &kde; desktop.
 </para>
 
 <para>
@@ -57,103 +55,9 @@
 (<link linkend="general-setup">general</link>
 and <link linkend="config-conduits">conduits</link>)
 will be discussed separately.
-We will begin, however, by taking a look at the
-<link linkend="configwizard">configuration wizard</link>, which should make most
-of the
-general group of configuration options superfluous.
 </para>
 
-<sect1 id="configwizard">
-<title>Using the Wizard</title>
 
-<para>
-The configuration wizard helps you to set up &kpilot; to communicate
-with the &PalmPilot; and to configure the conduits as a group. It's a great
-start for new users, and you can always fine-tune your preferences later.
-</para>
-
-<para>
-In the <guilabel>Pilot Info</guilabel> dialog, type your <guilabel>User
-Name</guilabel>. It
-should match the one from the &PalmPilot;. Next, type the file name of
-the <guilabel>Device</guilabel> you will use to connect the &PalmPilot; (The
-connection can be through a serial port, USB port, infrared, Bluetooth, network
-or the generic <filename class="devicefile">/dev/pilot</filename> device.)
-Alternatively, click the
-<guibutton>Automatically detect handheld and user name...</guibutton>
-button and press the &HotSync; button on your &handheld;. The Wizard will try
-to find the correct <guilabel>Device</guilabel> and
-<guilabel>User Name</guilabel>.
-</para>
-
-<important><para>
-If the
-<guilabel>Device</guilabel> does not have the right permissions, the wizard will
-not be able to find it. Normal users must be able to read/write the correct
-device. To resolve this issue, please refer to <link
-linkend="faq-connection"><quote>&kpilot; says <errorname>Can't connect to
-pilot</errorname></quote>
-&FAQ; entry</link>, or contact your system administrator.
-</para></important>
-
-
-<screenshot>
-<screeninfo>The First Configuring Wizard Dialog</screeninfo>
-<mediaobject>
-<imageobject><imagedata fileref="wizard-general.png"
-format="PNG"/></imageobject>
-<textobject><phrase>Configuring Wizard: The Pilot Info
-Dialog</phrase></textobject>
-<caption><para>Configuring Wizard: The Pilot Info Dialog</para></caption>
-</mediaobject>
-</screenshot>
-
-<para>
-Press the &HotSync; button of your &handheld; to probe for the
-correct <guilabel>Device</guilabel> and <guilabel>User Name</guilabel>.
-</para>
-
-
-<screenshot>
-<screeninfo>The Second Configuring Wizard Dialog</screeninfo>
-<mediaobject>
-<imageobject><imagedata fileref="wizard-connection.png"
-format="PNG"/></imageobject>
-<textobject><phrase>Configuring Wizard: The Autodetection
-Dialog</phrase></textobject>
-<caption><para>Configuring Wizard: The Autodetection Dialog</para></caption>
-</mediaobject>
-</screenshot>
-
-<para>
-&kpilot; has the ability to sync the data on your &handheld; with
-applications or files on your <acronym>PC</acronym>. The programs that
-perform these actions are called conduits. The sync dialog configures
-all applicable &kpilot; conduits to sync with widely used
-<acronym>PIM</acronym> suites. You can fine-tune these settings later, from the
-<menuchoice>
-<guimenu>Settings</guimenu>
-<guimenuitem>Configure &kpilot;</guimenuitem>
-</menuchoice>
-menu. Please check the <link linkend="config-conduits">conduits
-configuration</link>
-section of this document for more information.
-</para>
-
-<screenshot>
-<screeninfo>The Third Configuring Wizard Dialog</screeninfo>
-<mediaobject>
-<imageobject><imagedata fileref="wizard-conduits.png"
-format="PNG"/></imageobject>
-<textobject><phrase>Configuring Wizard: The Sync Dialog</phrase></textobject>
-<caption><para>Configuring Wizard: The Sync Dialog</para></caption>
-</mediaobject>
-</screenshot>
-
-
-</sect1>
-
-
 <sect1 id="general-setup">
 <title>General Setup</title>
 
@@ -164,7 +68,7 @@
 you can select a non-standard hardware device,
 set special encodings for foreign-language &handheld;s,
 and control how &kpilot; displays your data. There
-are five items under the <guilabel>General Setup</guilabel>
+are four items under the <guilabel>General Setup</guilabel>
 heading. You may need to expand the <guilabel>General Setup</guilabel>
 heading to see them.
 </para>
@@ -321,7 +225,7 @@
 </para>
 
 <para>
-&kpilot; interfaces with your &handheld; in two ways: using the
+&kpilot; interfaces with your &handheld; in two ways: using
 the conduits and the internal viewers. Conduits are plug-in programs which
 extend the synchronization capabilities of &kpilot;. &kpilot; stores separate copies of
 the databases and records for conduits, while the internal viewers and backup
@@ -372,17 +276,6 @@
 
 <listitem>
 <para>
-<guilabel>FastSync</guilabel>: Only synchronize those
-databases that have conduits, and perform no backup of the data
-on the &PalmPilot;, reducing greatly the time required for the sync
-operation. This also means that if something goes wrong with your &PalmPilot;,
-you may not be able to recover the databases. This is a classic
-trade-off between speed and safety.
-</para>
-</listitem>
-
-<listitem>
-<para>
 <guilabel>FullSync</guilabel>: run all selected conduits, and sync all
 databases, reading all records, and performing a full backup. It is the safest
 option, but takes the longest time to complete, as it will merge all the records
@@ -407,13 +300,6 @@
 handheld data to the PC. <emphasis>Use with care, as this option erases the
 changes you made in your PC since the last sync</emphasis>.
 </para>
-<warning>
-<para>
-Remember, when &kpilot; does a &HotSync; and runs the conduits,
-the databases in the internal viewers are <emphasis>not</emphasis>
-updated. To update the internal viewers, use the FullSync or backup actions.
-</para>
-</warning>
 
 </listitem>
 
@@ -424,7 +310,7 @@
 
 
 <varlistentry>
-<term><guilabel>Do full backup when changing PCs</guilabel></term>
+<term><guilabel>Do full sync when changing PCs</guilabel></term>
 <listitem>
 <para>
 If you &HotSync; your &handheld; with multiple <acronym>PC</acronym>s, the flag
@@ -435,9 +321,9 @@
 </para>
 </listitem>
 </varlistentry>
-<!--
+
 <varlistentry>
-<term><guilabel>Do not sync when screen saver is active</guilabel></term>
+<term><guilabel>Do not sync when screensaver is active</guilabel></term>
 <listitem>
 <para>
 This is a security feature that prevents the &handheld; from synchronization
@@ -448,7 +334,7 @@
 </para>
 </listitem>
 </varlistentry>
--->
+
 <varlistentry>
 <term><guilabel>Conflict Resolution</guilabel></term>
 <listitem>
@@ -479,14 +365,14 @@
 copy the values from the <acronym>PC</acronym> to the &handheld;,
 discarding changes on the &handheld;.
 </para></listitem>
-<listitem><para><guilabel>Values From Last Sync (if possible)</guilabel>:
+<listitem><para><guilabel>Values From Last Sync (Not Supported)</guilabel>:
 &kpilot; stores a backup copy of the information on your &handheld; depending on
 the synchronization method you selected. If this information is available, use
 neither
 the values from the &handheld; nor the PC, but the values from
 the last sync.
 </para></listitem>
-<listitem><para><guilabel>Use Both Entries</guilabel>:
+<listitem><para><guilabel>Use Both Entries (Not Supported)</guilabel>:
 Create duplicate entries of the conflicting records on both the
 <acronym>PC</acronym> and
 &handheld;, one with the value from the <acronym>PC</acronym>, the other with
@@ -513,7 +399,7 @@
 
 <para>In short, databases are all files stored in your &handheld;. A database
 can be either a record database, which stores dynamic information created by the
-user (for instance, the addresses or the todo information), or a resource
+user (for instance, the addresses or the To-Do information), or a resource
 database, which tend to be static (for instance the applications).</para>
 
 <screenshot>
@@ -606,91 +492,11 @@
 
 </sect2>
 
-
-<sect2 id="page-viewers">
-<title>Internal Viewers Setup</title>
-<para>
-&kpilot; contains <quote>viewers</quote> for
-presenting information from the &PalmPilot;.
-These viewers present the databases available on
-the &PalmPilot; in much the same way that the device
-itself does. Not all databases have an application-specific
-viewer, though you can use the generic database viewer for those.
-The viewers page contains settings for the internal viewers in
-&kpilot;.
-These settings change the way in which the data is shown.
-</para>
-
-<screenshot>
-<screeninfo>Viewers Page</screeninfo>
-<mediaobject>
-<imageobject><imagedata fileref="setup-viewer.png" format="PNG"/></imageobject>
-<textobject><phrase>The Viewers Setup Page</phrase></textobject>
-<caption><para>The Viewers Setup Page</para></caption>
-</mediaobject>
-</screenshot>
-
-<variablelist>
-<varlistentry>
-<term><guilabel>Make internal viewers editable</guilabel></term>
-<listitem><para>
-The internal viewers can be read only or editable. The editable mode allows you
-to add new records, delete or edit the existing records and sync your
-modifications back to the &handheld;. Check
-this box to set the internal viewers to editable mode, uncheck to set them to
-read
-only mode.</para>
-<warning><para>
-On some &kpilot; versions, it is not possible check this box, and therefore to
-use the internal viewers as editors.
-</para></warning>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Show private records</guilabel></term>
-<listitem><para>
-In your &PalmPilot; you can mark some records as <quote>private</quote>. By
-default, &kpilot; does not display these records on the screen. Check this box
-if you want to see them.
-</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Address Viewer</guilabel></term>
-<listitem><para>
-Set there the options for the address internal viewer.
-
-<itemizedlist>
-<listitem><para>
-<guilabel>Show as "Last, first"</guilabel> or
-<guilabel>Show as "Company, last"</guilabel>: the order and display of the
-address records in the address internal viewer can be set to match the
-&handheld;. Select the option that suits better your personal preferences.
-</para></listitem>
-
-<listitem><para>
-<guilabel>Use key field</guilabel> Check this box to combine entries with the
-same last name.
-</para></listitem>
-
-</itemizedlist>
-
-</para></listitem>
-</varlistentry>
-
-
-</variablelist>
-
-</sect2>
-
-
-
 <sect2 id="page-startup-exit">
 <title>Startup and Exit Behavior Setup</title>
 
 <para>
-This pages present options related to the startup and exit of &kpilot; and
+This page presents options related to the startup and exit of &kpilot; and
 &kpilot; daemon.
 </para>
 
@@ -701,7 +507,7 @@
 be able to sync your &handheld; at anytime, it is important to start the daemon
 at login, or the opposite, if you want to be able to sync only when &kpilot; is
 running, you have to stop the daemon on exit. The last option is especially
-usefull if you have other applications that use the same port as &kpilot;.
+useful if you have other applications that use the same port as &kpilot;.
 </para>
 
 
@@ -727,7 +533,7 @@
 <itemizedlist>
 <listitem>
 <para>
-<guilabel>Start daemon at login</guilabel>:
+<guilabel>Start KPilot at login</guilabel>:
 By checking this, a link to
 the daemon is placed in your autostart folder
 and will be started automatically.  Note that this is not normally
@@ -738,7 +544,7 @@
 
 <listitem>
 <para>
-<guilabel>Show daemon in panel</guilabel>:
+<guilabel>Show KPilot in system tray</guilabel>:
 Check this box to instruct the daemon to place a &kpilot; icon
 <guiicon>
 <inlinemediaobject>
@@ -780,10 +586,8 @@
 <listitem>
 <para>
 <anchor id="stopdaemononexit"/>
-<guilabel>Stop daemon on exit</guilabel>: Setting this option will cause the
-daemon to exit when you quit &kpilot;, leaving the device port free for other
-&PalmPilot;-synchronization tools such as <application>malsync</application>
-</para>
+<guilabel>Stop KPilot's system tray application on exit</guilabel>: Setting this option will cause the
+daemon to exit when you quit &kpilot;.</para>
 </listitem>
 </itemizedlist>
 </para>
@@ -831,229 +635,81 @@
 <variablelist>
 
 <varlistentry>
-<term><guilabel>KNotes / Memos</guilabel></term>
+<term><guilabel>Install Files</guilabel></term>
 <listitem>
 <para>
-Synchronizes the Memo Pad application with &knotes;.
+Allows &kpilot; to install files and databases onto your &PalmPilot;.
 </para>
 </listitem>
 </varlistentry>
 
 <varlistentry>
-<term><guilabel>Notepad</guilabel></term>
+<term><guilabel>Calendar</guilabel></term>
 <listitem>
 <para>
-Exports the free hand notes  of the &handheld;'s Notepad application as pictures
-to the PC.
+Synchronizes the Datebook application with &korganizer;.
 </para>
 </listitem>
 </varlistentry>
 
-
 <varlistentry>
-<term><guilabel>Time Synchronization</guilabel></term>
+<term><guilabel>To-Do</guilabel></term>
 <listitem>
 <para>
-Sets the &handheld;'s time to that of the desktop machine.
-Useful for keeping the clock of the &handheld; accurate.
+Synchronizes the To-Do list application with &korganizer;.
 </para>
 </listitem>
 </varlistentry>
 
 <varlistentry>
-<term><guilabel>Calendar (KOrganizer)</guilabel></term>
+<term><guilabel>Contacts</guilabel></term>
 <listitem>
 <para>
-Synchronizes the Datebook application with &korganizer; or with an
-iCalendar file of
-your choice.
+Synchronizes the Addressbook application with &kaddressbook;.
 </para>
 </listitem>
 </varlistentry>
 
 <varlistentry>
-<term><guilabel>Palm DOC</guilabel></term>
+<term><guilabel>Time Synchronization</guilabel></term>
 <listitem>
 <para>
-Automatically converts and installs text files in the &PalmPilot;
-DOC format, so you can read the text files with most DOC-capable
-applications on the &handheld;.
+Sets the &handheld;'s time to that of the desktop machine.
+Useful for keeping the clock of the &handheld; accurate.
 </para>
 </listitem>
 </varlistentry>
 
 <varlistentry>
-<term><guilabel>Addressbook</guilabel></term>
+<term><guilabel>Memo File</guilabel></term>
 <listitem>
 <para>
-Synchronizes the Address application with &kaddressbook; or with a vCard file of
-your choice.
+Synchronizes the Memo Pad application with a directory and files on your computer.
 </para>
 </listitem>
 </varlistentry>
 
-<varlistentry>
-<term><guilabel>System Information</guilabel></term>
-<listitem>
-<para>
-Writes information about your &handheld;, (such as OS version,
-RAM available, and the list of databases) to a file. Useful mostly for
-debugging purposes.
-</para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>ToDo's (KOrganizer)</guilabel></term>
-<listitem>
-<para>
-Synchronizes the Todo list application with &korganizer; or with a iCalendar
-file of
-your choice.
-</para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>MAL (AvantGo) Conduit</guilabel></term>
-<listitem>
-<para>
-Synchronizes your &handheld; with the &AvantGo; server. The &AvantGo; server
-offers general content (news, guides, stock quotes, &etc;) in a format that is
-suitable for reading in a &handheld;. To use this conduit, you need to register,
-subscribe
-the channels you select and install the &AvantGo; software on your &handheld;.
-</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Mail</guilabel></term>
-<listitem>
-<para>
-Sends mail written on the &handheld; through &kmail;.
-There is no provision for receiving mail, however.
-</para>
-</listitem>
-</varlistentry>
-
 </variablelist>
 
+<sect2 id="install-cond">
+<title>Install Files Conduit Setup</title>
 
-<sect2 id="conduit-knotes">
-<title>&knotes; Conduit Setup</title>
-
 <para>
-The &knotes; Conduit is a partial replacement for the built-in <link
-linkend="builtin">memo application</link>.  It keeps the notes you write
-with &knotes; synchronized with the memos you write on your &PalmPilot;.
+The Install Files Conduit installs any &PalmPilot; database that has been added
+to &kpilot;'s File Install window onto the &handheld;. No additional
+configuration is required for this conduit.
 </para>
 
-<para>
-Setting up the &knotes; conduit is very simple.
-</para>
-
-<screenshot>
-<screeninfo>&knotes; Conduit Setup</screeninfo>
-<mediaobject>
-<imageobject>
-<imagedata fileref="conduit-knotes.png" format="PNG"/>
-</imageobject>
-<textobject>
-<phrase>&knotes; Conduit Setup</phrase>
-</textobject>
-<caption>
-<para>&knotes; Conduit Setup</para>
-</caption>
-</mediaobject>
-</screenshot>
-
-<para>
-In the <guilabel>General</guilabel> Tab there are two configuration options:
-
-<variablelist>
-
-<varlistentry>
-<term><guilabel>Delete KNote when Pilot memo is deleted</guilabel></term>
-<listitem>
-<para>
-Uncheck this box if you wish to maintain the note on &knotes; even if the
-correspondent memo was deleted on the &handheld; memo application.
-</para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Suppress delete-confirmation in KNotes</guilabel></term>
-<listitem>
-<para>
-If the <guilabel>Delete KNote when Pilot memo is deleted</guilabel> box is
-checked, you may check this box to automatically delete the notes that
-correspond to a deleted memo, without confirmation.
-</para>
-</listitem>
-</varlistentry>
-
-</variablelist>
-
-<note>
-<para>
-By default, the options <quote>delete knote</quote> and <quote>suppress
-delete-confirmation</quote> are turned <emphasis>off</emphasis>, so that notes
-will accumulate on your PC.
-</para>
-</note>
-
-</para>
 </sect2>
 
-<sect2 id="notepad-cond">
-<title>Notepad Conduit Setup</title>
-
-<para>
-The Notepad Conduit exports the free hand notes of the &handheld;'s Notepad
-application  as pictures to the desktop. To set the folder to which the pictures
-should be exported, either enter it in the <guilabel>Output</guilabel> edit
-box or select it clicking the file picker button.
-</para>
-
-</sect2>
-
-<sect2 id="time-cond">
-<title>Time Synchronization Conduit Setup</title>
-
-<para>
-The Time Synchronization Conduit syncs the &handheld;'s time to that of the
-desktop
-machine. It is useful for keeping the clock of the &handheld; accurate. There
-are really no configuration options other that enabling and disabling the
-conduit, as currently only one direction for the synchronization is enabled,
-you can only <guilabel>Set the handheld time from the time on the PC</guilabel>,
-and not <guilabel>Set the PC time from the time on the handheld</guilabel>.
-</para>
-
-
-<note>
-<para>
-&PalmOS; Version 3.25 and 3.3 do not support setting the &handheld; system time.
-For these systems, the conduit will be simply skipped.
-</para>
-</note>
-
-</sect2>
-
 <sect2 id="vcal-cond">
 <title>Calendar Conduit Setup</title>
 
 <para>
-This conduit will synchronize your &PalmPilot; with &korganizer; and &kontact;
-or to an iCalendar file of your choice. In the latter case, the conduit will
-need the filename of the calendar file (this will usually be a file that ends in
-<literal role="extension">.ics</literal>) to sync with, of if it uses the
-standard &korganizer; iCalendar file, it will be under the <filename
-class="directory">$KDEHOME/share/apps/korganizer/</filename> folder, where the
-<filename class="directory">$KDEHOME</filename> environment variable (typically
-<filename class="directory">/home/user/.kde/</filename>) points to the folder
-that contains your configuration and data for the &kde; applications.
+This conduit will synchronize your &PalmPilot; calendar application with &korganizer; and &kontact;
+by using Akonadi. Before you can use this conduit, you must configure Akonadi to
+have a resource for the calendar that you wish to synchronize with. Once you've
+done that, you can select that resource for synchronization use here.
 </para>
 
 <screenshot>
@@ -1071,350 +727,47 @@
 </mediaobject>
 </screenshot>
 
-<para>
-In the <guilabel>General</guilabel> page, you can set the calendar options.
-</para>
-
-<variablelist>
-
-<varlistentry>
-<term><guilabel>Calendar Destination</guilabel></term>
-<listitem>
-<para>
-Choose between synchronizing with the <guilabel>Standard Calendar</guilabel>,
-or in other words, the &korganizer; standard calendar or with a
-<guilabel>Calendar file</guilabel> of your choice, that you must either
-write in the <guilabel>Calendar file</guilabel> edit box or select using the
-file picker.
-</para>
-
-<warning>
-<para>
-You can use the calendar conduit with any application that accepts a file in
-the iCalendar format as a resource. However, some applications, like Evolution,
-do not handle the synchronization gracefully while they are open. As a rule of
-thumb, quit these applications before synchronizing, otherwise you will lose
-data. There is no need to take these precautions when syncing with &korganizer;
-or &kontact;.
-</para>
-</warning>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Store archived records in the KDE calendar</guilabel></term>
-<listitem>
-<para>
-Check this box to save a copy of the archived records from your
-&handheld; on the <acronym>PC</acronym>, in order to keep a history of
-past appointments in you &kde; desktop as well.
-</para>
-</listitem>
-</varlistentry>
-
-</variablelist>
-
-<para>
-In the <guilabel>Conflicts</guilabel> page, you can set the calendar options,
-overriding &kpilot;'s general settings for conflict resolution when you are
-using this conduit. For a detailed description of the different conflict
-resolution possibilities available, please refer to the <link
-linkend="page-hotsync">HotSync Setup section</link> of this handbook.
-</para>
-
 </sect2>
 
+<sect2 id="todo-cond">
+<title>To-Do Conduit Setup</title>
 
-<sect2 id="conduit-palmdoc">
-<title>Palm DOC Conduit Setup</title>
-
 <para>
-The Palm DOC conduit converts text files in your <acronym>PC</acronym> from and
-to
-databases in Palm DOC format in the &PalmPilot;. You can use any Palm DOC reader
-to view these files on your &PalmPilot;.
+This conduit will synchronize your &PalmPilot; To Do List application with
+&korganizer; and &kontact;, through Akonadi.  Before you can use this conduit,
+you must configure Akonadi to have a resource for the To-Do file that you wish
+to synchronize with. Once you've done that, you can select that resource for
+synchronization use here.
 </para>
 
 <screenshot>
-<screeninfo>Palm DOC Conduit Setup</screeninfo>
+<screeninfo>The To-Do Conduit Setup Dialog</screeninfo>
 <mediaobject>
-<imageobject><imagedata fileref="conduit-palmdoc.png"
-format="PNG"/></imageobject>
-<textobject><phrase>Palm DOC Conduit Setup</phrase></textobject>
-<caption><para>Palm DOC Conduit Setup</para></caption>
+<imageobject><imagedata fileref="conduit-todo.png" format="PNG"/></imageobject>
+<textobject><phrase>To-Do Conduit Setup</phrase></textobject>
+<caption><para>To-Do Conduit Setup</para></caption>
 </mediaobject>
 </screenshot>
 
-<important><para>
-After changing the Palm DOC conduit configuration, you have to restart &kpilot;
-to let the changes you made take effect.
-</para></important>
-
-<para>
-In the <guilabel>General</guilabel> page, you can set the location of the text
-documents in your computer and the direction of the synchronization.
-</para>
-
-<variablelist>
-
-<varlistentry>
-<term><guilabel>Text files:</guilabel></term>
-<listitem><para>
-Type on the text box or use the file picker to select the location of the folder
-that the Palm DOC conduit uses as the place for the text files it will sync
-with the &handheld;. There, you may place the text documents you want install or
-synchronize to the <acronym>PDA</acronym>, and find the text documents created
-from Palm DOC
-databases in your &handheld;.
-<important><para>
-The file name has to end in <literal role="extension">.txt</literal> for the
-conduit to recognize it as text. If the file is not recognized as text, it will
-be ignored by the conduit. Also, the text has to be in an encoding that is
-compatible with your &handheld; encoding. Therefore, if the text file has
-characters that are not being correctly recognized by the Palm DOC reader in
-your &handheld;, try opening the file a text editor, like &kwrite;, and saving
-it in an compatible text encoding using the <guilabel>Save As..</guilabel>
-dialog, or set the encoding in the <guilabel>PC -> Handheld</guilabel> tab.
-</para></important>
-</para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Local copy:</guilabel></term>
-<listitem><para>
-If you want to save a copy of the Palm DOC databases from your &handheld; in
-your computer, check the <guilabel>Local copy:</guilabel> box and
-type on the text box or use the file picker to select the location of the folder
-where these databases will be saved.
-</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Synchronization Mode</guilabel></term>
-<listitem><para>
-The Palm DOC conduit has the ability to sync from and to the &handheld;,
-automatically converting the text files to Palm DOC databases and vice versa.
-The <guilabel>Sync only PC to PDA</guilabel> option will convert all text files
-located in the folder you selected above to Palm DOC databases and install them
-in your &handheld;.
-The <guilabel>Sync only PDA to PC</guilabel> option will convert all Palm DOC
-databases from your &handheld; to files and install them in the
-folder you selected above. Finally, The <guilabel>Sync all</guilabel> option
-allows the synchronization to work in both directions.
-
-<note><para>
-When both the text file and the Palm DOC database are modified, you cannot merge
-the modifications, you have to choose one of the versions, losing the changes
-in one of them.
-</para></note>
-</para></listitem>
-</varlistentry>
-
-</variablelist>
-
-<para>
-In the <guilabel>PC -> Handheld</guilabel> page, you can configure the Palm DOC
-compression and bookmarks settings to use when converting from text files to
-Palm DOC databases.
-</para>
-
-<variablelist>
-
-<varlistentry>
-<term><guilabel>Compress</guilabel></term>
-<listitem><para>
-Palm DOC documents can be compressed, saving considerable amounts
-of available memory in your &handheld;. Most Palm DOC readers support
-compressed documents, but if you use a reader or editor that is not compatible
-with compression (for instance, the Sied editor), you will not be able to read
-or edit the compressed Palm DOC documents created by this conduit.
-Therefore, check this box to save &handheld; memory, but uncheck it if you have
-compatibility problems with compressed Palm DOC in your favorite editor or
-reader.
-</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Convert bookmarks</guilabel></term>
-<listitem><para>
-The Palm DOC format has a provision for bookmark records. Bookmarks allow you to
-easily jump to selected parts of the document, making browsing long documents
-easier. Check this box to allow the Palm DOC conduit to create bookmark records.
-To create them, the conduit has to know the location in the text and the name of
-the bookmark. There are three supported ways to let the conduit know the
-location and name of the bookmark: from inline tags in the text, from tags at
-the end of the text and from a <literal role="extension">.bmk</literal> bookmark
-file. To make the creation of bookmarks effective, you have to check at least
-one of these boxes below.
-</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Inline tags in text</guilabel></term>
-<listitem><para>
-Convert tags in the format &lt;* <replaceable>BookmarkName</replaceable> *&gt;
-located inside the text to Palm DOC bookmarks, where the location of the
-tag in the text will be converted to the bookmark location and the
-<replaceable>BookmarkName</replaceable> text inside the tag will be converted to
-the name of the bookmark in the Palm DOC format. The tag will be removed from
-the resulting Palm DOC document, leaving the text clean.
-This is a very easy and intuitive way to create bookmarks
-in your Palm DOC documents.
-</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Tags at end of text</guilabel></term>
-<listitem><para>
-Convert tags in the format &lt;<replaceable>BookmarkName</replaceable>&gt;
-located in the end of the text to Palm DOC bookmarks. Whenever the
-<replaceable>BookmarkName</replaceable> text appears in the text, the conduit
-will generate a the bookmark in the resulting Palm DOC document pointing to it.
-The tag will then be removed from the resulting Palm DOC document, leaving the
-text clean. This is a simple way to create repetitive bookmarks, like one for
-each <quote>Chapter</quote> in your Palm DOC documents.
-</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Regular expressions in .bmk file</guilabel></term>
-<listitem><para>
-This is the most complex but the most powerful way to create bookmarks.
-The method involves using regular expressions (QRegExp) in a file
-<filename>TextName.bmk</filename>, where <filename>TextName.txt</filename> is
-the filename of the text, to search the text for bookmarks. See the
-<ulink
-url="http://reinhold.kainhofer.com/Linux/KPilot/bmkSpecification.txt">
-documentation</ulink>
-for an in-depth description of the bmk file format.
-</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Encoding</guilabel></term>
-<listitem><para>
-Set here the encoding of your &handheld;. &kpilot; will convert the text
-document to this encoding when exporting the file to the &handheld;.
-</para></listitem>
-</varlistentry>
-
-</variablelist>
-
-<para>
-In the <guilabel>Handheld -> PC</guilabel> page, you can configure bookmarks
-settings to use when converting from Palm DOC databases to text files.
-</para>
-
-<variablelist>
-
-<varlistentry>
-<term><guilabel>Convert Bookmarks</guilabel></term>
-<listitem>
-<para>
-The Palm DOC format has a provision for bookmark records. Bookmarks allow you to
-easily jump to selected parts of the document, making browsing long documents
-easier. The Palm DOC conduit can convert Palm DOC
-bookmark records to a format that is readable in your computer, either as
-a separate file or as tags in the middle of the text file. Select
-<guilabel>Do not convert bookmarks</guilabel> if you want to ignore the Palm DOC
-bookmarks, resulting in a text that is clean from bookmark tags.</para>
-
-<para>
-The <guilabel>Convert into .bm file</guilabel> options also result in a clean
-text file, as the bookmarks are converted to a separate file in the bmk format,
-as described <ulink
-url="http://reinhold.kainhofer.com/Linux/KPilot/bmkSpecification.txt">here</ulink>. The file is saved with a <literal role="extension">.bm</literal>
-extension to avoid conflicts with <literal role="extension">.bmk</literal> files
-created previously.</para>
-
-<para>Finally, the <guilabel>Convert as inline tags</guilabel> option creates
-inline tags inside the resulting text file form &lt;*
-<replaceable>BookmarkName</replaceable> *&gt; placing each tag in the place that
-was previously referenced by the bookmark, and using the bookmark name as the
-<replaceable>BookmarkName</replaceable> text inside the tag. Now you You can
-edit the bookmark name, move it or delete it and convert back to Palm DOC, as
-you wish.
-</para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Do not convert, if text unchanged (only
-bookmarks)</guilabel></term>
-<listitem>
-<para>
-If you check this box, only changes in the text will trigger conversions from
-Palm DOC to text files. In other words, changes in the bookmarks only will not
-result in updates for the text files in your computer.
-</para>
-</listitem>
-</varlistentry>
-
-</variablelist>
-
-<para>
-In the <guilabel>Conflicts</guilabel> page, you can configure how the conduit
-deals with files that changed both in the computer and the &handheld;.
-</para>
-
-<variablelist>
-
-<varlistentry>
-<term><guilabel>Conflict Resolution</guilabel></term>
-<listitem><para>
-The Palm DOC conduit does not feature merging the modifications when a text is
-changed both in the &handheld; and in the computer. Therefore, the choice is
-between working with the files out of sync, or discarding the changes in one of
-them. The <guilabel>No resolution</guilabel> option will avoid synchronizing
-texts with conflicts, the <guilabel>PDA overrides</guilabel> option will
-overwrite the computer text file version in case of conflict,
-the <guilabel>PC overrides</guilabel> will do the same, but the other way
-around,
-and the <guilabel>Ask the user</guilabel> option will bring a dialog to let the
-user decide on a file by file, case by case basis.
-</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Always show resolution dialog, even when there are no
-conflicts</guilabel></term>
-<listitem><para>
-This option will always bring the conflict resolution dialog, even if there is
-no conflicts to solve. The advantage is that you can keep track of all the files
-that are being covered by the conduit.
-</para></listitem>
-</varlistentry>
-
-</variablelist>
-
-
 </sect2>
 
 
 <sect2 id="conduit-kaddressbook">
-<title>&kaddressbook; Conduit Setup</title>
+<title>Contacs Conduit Setup</title>
 
 <para>
-This conduit will synchronize your &PalmPilot; with the &kde; address book or to
-a vCard file of your choice. In the latter case, the conduit will need the
-filename of the
-vCard file (this will usually be a file that ends in <literal
-role="extension">.vcf</literal>) to sync with, of if it uses the standard
-&kde; address book file, it will be under the
-<filename class="directory">$KDEHOME/share/apps/kabc/</filename>
-folder, where the <filename class="directory">$KDEHOME</filename> environment
-variable (typically <filename class="directory">/home/Login Name/.kde/</filename>)
-points to the folder that contains your configuration and data for the &kde;
-applications.
+This conduit will synchronize your &PalmPilot; with the &kde; address book
+through Akonadi. Before you can use this conduit, you must configure Akonadi to
+have a resource for the address book file that you wish to synchronize with. Once
+you've done that, you can select that resource for synchronization use here.
 </para>
 
 <screenshot>
-<screeninfo>The &kaddressbook; Conduit Setup Dialog</screeninfo>
+<screeninfo>The Contacts Conduit Setup Dialog</screeninfo>
 <mediaobject>
 <imageobject><imagedata fileref="setup-address.png" format="PNG"/></imageobject>
-<textobject><phrase>&kaddressbook; Conduit Setup</phrase></textobject>
-<caption><para>&kaddressbook; Conduit Setup</para></caption>
+<textobject><phrase>Contacts Conduit Setup</phrase></textobject>
+<caption><para>Contacts Conduit Setup</para></caption>
 </mediaobject>
 </screenshot>
 
@@ -1423,40 +776,6 @@
 options.
 </para>
 
-<variablelist>
-
-<varlistentry>
-<term><guilabel>Sync Destination</guilabel></term>
-<listitem><para>
-Choose between synchronizing with the <guilabel>Standard address book</guilabel>,
-or in other words, the &kde; standard address book or with a
-<guilabel>vCard file</guilabel> of your choice, that you must either
-write in the <guilabel>vCard file</guilabel> edit box or select using the
-file picker.
-</para>
-<warning><para>
-You can use the address book conduit with any application that accepts a file in
-the vCard format as a resource. However, some applications may not handle
-the synchronization gracefully while they are open. As a rule of thumb,
-quit these applications before synchronizing, otherwise you may lose data.
-There is no need to take these precautions when syncing with the  &kde; address
-book.
-</para></warning>
-</listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Store archived records in the KDE address book</guilabel></term>
-<listitem><para>
-The &handheld; offers an option to archive deleted addresses in your desktop.
-If that option is selected, check this box to keep the deleted addresses from
-your &handheld; in your <acronym>PC</acronym> address book. These addresses will
-be no longer synchronized with your handheld.
-</para></listitem>
-</varlistentry>
-
-</variablelist>
-
 <para>
 In the <guilabel>Conflicts</guilabel> page, you can set the address book conduit
 options, overriding &kpilot;'s general settings for conflict resolution when
@@ -1525,7 +844,7 @@
 other &kde; address book fields, you can set them as you like. You can use them
 to store a <guilabel>URL</guilabel>, a <guilabel>IM Address</guilabel>,
 the <guilabel>Birthdate</guilabel> of your contact or the obvious:
-<guilabel>Store as Costume Field</guilabel>.
+<guilabel>Store as Custom Field</guilabel>.
 </para>
 
 <para>
@@ -1541,243 +860,57 @@
 
 </sect2>
 
-<sect2 id="sysinfo-cond">
-<title>System Information Conduit Setup</title>
 
-<para>
-This conduit generates a page with your &handheld; information. Some info about
-your &kde;, &kpilot; and Pilot-Link version is included as well. The available
-output formats are &HTML;, text or custom template. The conduit
-output and in special, the debug output section of the output may help the
-developers track down bugs.
-</para>
 
+<sect2 id="time-cond">
+<title>Time Synchronization Conduit Setup</title>
 
-<screenshot>
-<screeninfo>The System Information Conduit Setup Dialog</screeninfo>
-<mediaobject>
-<imageobject><imagedata fileref="conduit-sysinfo.png"
-format="PNG"/></imageobject>
-<textobject><phrase>System Information Conduit Setup</phrase></textobject>
-<caption><para>System Information Conduit Setup</para></caption>
-</mediaobject>
-</screenshot>
-
 <para>
-In the <guilabel>General</guilabel> page, you can set the output location and
-format.
+The Time Synchronization Conduit syncs the &handheld;'s time to that of the
+desktop
+machine. It is useful for keeping the clock of the &handheld; accurate. There
+are really no configuration options other that enabling and disabling the
+conduit, as currently only one direction for the synchronization is enabled,
+you can only <guilabel>Set the handheld time from the time on the PC</guilabel>,
+and not <guilabel>Set the PC time from the time on the handheld</guilabel>.
 </para>
 
-<variablelist>
 
-<varlistentry>
-<term><guilabel>Output File</guilabel></term>
-<listitem><para>
-Write  in the edit box or use the file picker to select the location and file
-name of the output file where the &handheld; system information will be written.
-</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Type of Output</guilabel></term>
-<listitem><para>
-Choose between <guilabel>HTML</guilabel>, <guilabel>Text file</guilabel> (plain
-text),
-or a selectable <guilabel>Custom template</guilabel>. To create a custom
-template, you can
-use the default template as a reference.
-</para></listitem>
-</varlistentry>
-
-</variablelist>
-
+<note>
 <para>
-In the <guilabel>Parts Included</guilabel> page, you can set which parts will be
-included in the output, one by one, by checking or unchecking them in the
-<guilabel>Output Type</guilabel> list.
+&PalmOS; Version 3.25 and 3.3 do not support setting the &handheld; system time.
+For these systems, the conduit will be simply skipped.
 </para>
+</note>
 
 </sect2>
 
+<sect2 id="memofile-cond">
+<title>Memo File Conduit Setup</title>
 
-<sect2 id="todo-cond">
-<title>Todo Conduit Setup</title>
-
 <para>
-This conduit will synchronize your &PalmPilot; To Do List application with
-&korganizer; and &kontact;, or to an iCalendar file of your choice.
-The configuration dialog looks and behaves exactly the same as the configuration
-dialog for the <link linkend="vcal-cond">Calendar Conduit</link>. The only
-difference is that instead of synchronizing the Calendar, you will be  syncing
-the To Do List.
+This conduit will synchronize your &PalmPilot; Memo Pad application with a
+directory and files on your computer. This conduit will create a directory for
+each category that your &PalmPilot; Memos uses, and within each of those
+directories will be the plain text files that contain the contents of your
+memos.  To set the top level folder to which your Memos will be synchronized
+with, either enter it in the <guilabel>Memos directory</guilabel> edit box or
+select it clicking the directory picker button.
 </para>
 
 <screenshot>
-<screeninfo>The Calendar Conduit Setup Dialog</screeninfo>
+<screeninfo>The Memo File Conduit Setup Dialog</screeninfo>
 <mediaobject>
-<imageobject><imagedata fileref="conduit-vcal.png" format="PNG"/></imageobject>
-<textobject><phrase>Calendar Conduit Setup</phrase></textobject>
-<caption><para>Calendar Conduit Setup</para></caption>
+<imageobject><imagedata fileref="conduit-memofile.png" format="PNG"/></imageobject>
+<textobject><phrase>Memo File Conduit Setup</phrase></textobject>
+<caption><para>Memo File Conduit Setup</para></caption>
 </mediaobject>
 </screenshot>
 
-</sect2>
 
-<sect2 id="mal-cond">
-<title>MAL (AvantGo) Conduit Setup</title>
-
-<para>
-The MAL (&AvantGo;) Conduit synchronizes your &handheld; with the &AvantGo;
-server.
-This conduit is based on
-<ulink url="http://jasonday.home.att.net/code/libmal/libmal.html">Jason Day's
-libmal</ulink>.
-The &AvantGo; server offers general content (news, guides, stock quotes, &etc;)
-in a format that is suitable for reading in a &handheld;. To use this conduit,
-you need to register to a service provider, for instance,
-<ulink url="http://www.avantgo.com">AvantGo.com</ulink>, subscribe
-the channels you select and install the &AvantGo; software on your &handheld;,
-and configure the software on your handheld to find the MAL server.
-</para>
-
-<para>
-The installation software for the &handheld; client is usually only available
-for &Microsoft; &Windows;, if you
-do not have access to a windows computer, you can try installing the databases
-available in the <ulink url="http://www.tomw.org/malsync/">MalSync
-Homepage</ulink>,
-with different versions, one for <trademark>PalmOS</trademark> 5 and other for
-older <trademark>PalmOS</trademark>s.
-</para>
-
-<para>
-To configure the software on your handheld to find the MAL server, open the
-AGConnect application in your &handheld;, click <guilabel>Settings...</guilabel>
-and enter your MAL server address, the <guilabel>User Name</guilabel> and
-<guilabel>Password</guilabel> you got while registering. The
-&AvantGo; server address is
-<userinput>sync.avantgo.com</userinput>, and its port is
-<userinput>80</userinput>. On some installations, you should use the MobileLink
-instead of the AGConnect application on your &handheld;.
-</para>
-
-<screenshot>
-<screeninfo>The MAL (AvantGo) Conduit Setup Dialog</screeninfo>
-<mediaobject>
-<imageobject><imagedata fileref="conduit-mal.png" format="PNG"/></imageobject>
-<textobject><phrase>MAL (AvantGo) Conduit Setup</phrase></textobject>
-<caption><para>MAL (AvantGo) Conduit Setup</para></caption>
-</mediaobject>
-</screenshot>
-
-<para>
-In the <guilabel>General</guilabel> page, you can set the synchronization
-frequency options. It can be  set for <guilabel>Every Sync</guilabel>,
-<guilabel>Once per Hour</guilabel>, <guilabel>Once a Day</guilabel>,
-<guilabel>Once a Week</guilabel> or <guilabel>Once a Month</guilabel>.
-The conduit only runs when you hit &HotSync; on your &handheld;, so
-<guilabel>Once per Hour</guilabel>, for instance, really means that
-&kpilot; will only try to synchronize with the MAL servers if it is more than an
-hour since the last MAL sync.
-</para>
-
-<para>
-The MAL conduit can work through a proxy server. In the
-<guilabel>Proxy</guilabel>
-page, you can set the proxy settings.
-</para>
-
-<variablelist>
-
-<varlistentry>
-<term><guilabel>Proxy Type</guilabel></term>
-<listitem><para>
-If you connect the Internet directly, select <guilabel>No proxy</guilabel>,
-requiring no further configuration. But if you use a <guilabel>HTTP
-proxy</guilabel>
-or a <guilabel>SOCKS proxy</guilabel>, select it, to enable the rest of the
-dialog and to make the conduit use it to connect the MAL server.
-</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Server Information</guilabel></term>
-<listitem><para>
-Write in the <guilabel>Server Name</guilabel> dropdown box the address of the
-proxy server to use, in the form <userinput>foo.bar.com</userinput>, not
-<userinput>http://foo.bar.com</userinput> or
-<userinput>http://foo.bar.com:8080</userinput>.
-</para>
-<para>
-Check the box <guilabel>Custom port:</guilabel> if your proxy uses a non
-standard
-port, and enter the correct port number.
-</para>
-<para>
-In the <guilabel>No proxy for</guilabel> edit box, you may enter the list of MAL
-servers that do not need the use of a proxy, separated by commas. For instance,
-<userinput>localhost,lan</userinput>.
-</para>
-<para>
-If your proxy require authentication, enter your <guilabel>User name</guilabel>
-and <guilabel>Password</guilabel> in the respective edit boxes.
-</para>
-</listitem>
-</varlistentry>
-
-</variablelist>
-
-<para>In the <guilabel>MAL Server</guilabel> page, you can set the MAL server
-address and settings. Currently, you can only configure this settings using
-the &handheld; MobileLink or AGConnect applications, so this page is
-disabled.</para>
-
 </sect2>
 
-<sect2 id="popmail-cond">
-<title>Mail Conduit Setup</title>
 
-<para>
-This conduit allows you to send mail using a transport.
-The configuration of the Mail Conduit is fairly simple.
-</para>
-<screenshot>
-<screeninfo>Setting up the Mail Conduit</screeninfo>
-<mediaobject>
-<imageobject><imagedata fileref="conduit-popmail-kmail.png"
-format="PNG"/></imageobject>
-<textobject><phrase>The Mail Conduit Setup Dialog</phrase></textobject>
-<caption><para>The Mail Conduit Conduit Setup Dialog</para></caption>
-</mediaobject>
-</screenshot>
-<para>
-There are two tabs in the setup dialog for the Mail Conduit,
-one for Sending mail and one for the credits of the mail conduit.
-</para>
-
-<para>
-Depending on which send method you choose,
-different fields will be activated in the remainder of the
-tab, allowing you to enter the necessary information.
-Currently, the only method available is <guilabel>Using KMail</guilabel>,
-which has a very simple configuration.
-</para>
-
-<para>
-Your email address can be entered in the <guilabel>Email
-Address:</guilabel> field.  This is the email address that goes in the
-<quote>From:</quote> line in outgoing mail.  If you enter a file name in
-the <guilabel>Signature File</guilabel> field then that file will be
-appended to each outgoing mail as a signature.
-</para>
-
-<para>
-When sending mail through &kmail;, &kpilot; automatically places it in
-your &kmail; outbox.  &kmail; saves mail in the outbox until you request
-that those pieces of mail are <emphasis>really</emphasis> sent.
-</para>
-
-</sect2>
 </sect1>
 
 </chapter>
Index: doc/kpilot/faq.docbook
===================================================================
--- doc/kpilot/faq.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ doc/kpilot/faq.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -334,53 +334,5 @@
 </sect1>
 
 
-<sect1>
-<title>&kpilot;'s &DCOP; interface</title>
 
-<qandaset>
-
-<qandaentry>
-<question>
-<para>What does &kpilot; use &DCOP; for?</para>
-</question>
-<answer><para>
-The daemon and &kpilot; communicate using &DCOP;
-for several purposes: logging messages, changing the &HotSync;
-type, and exchanging configuration information.
-</para></answer>
-</qandaentry>
-
-<qandaentry><question>
-<para>Which &DCOP; interfaces are there?</para></question>
-
-<answer><para>
-The daemon has two important interfaces:
-<interface>LogIface</interface>
-and
-<interface>KPilotDaemonIface
-</interface>.
-The <interface>LogIface</interface>
-interface is used to record messages in the sync log
-on the &handheld;, and is rarely used.
-The <interface>KPilotDaemonIface</interface>
-is the more important &DCOP; interface,
-and is used to control the kind of &HotSync; that
-&kpilot; will do.
-</para></answer>
-</qandaentry>
-
-<qandaentry><question><para>
-How can I tell the daemon to perform a specific kind of &HotSync;?</para></question>
-<answer><para>
-There are three &DCOP; functions that control what kind
-of &HotSync;
-the daemon will do next:
-<function></function>
-<function></function>
-</para></answer>
-</qandaentry>
-</qandaset>
-
-</sect1>
-
 </chapter>
Index: doc/kpilot/index.docbook
===================================================================
--- doc/kpilot/index.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ doc/kpilot/index.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -2,7 +2,7 @@
 <!DOCTYPE book PUBLIC "-//KDE//DTD DocBook XML V4.2-Based Variant V1.1//EN"
  "dtd/kdex.dtd" [
 <!ENTITY kappname "&kpilot;">
-<!ENTITY kpilotver "4.4.6">
+<!ENTITY kpilotver "5.2.1">
 <!ENTITY package "kdepim">
 <!ENTITY USB "<acronym>USB</acronym>">
 <!ENTITY PalmOS '<trademark class="registered">Palm OS</trademark>'>
@@ -10,7 +10,6 @@
 <!ENTITY Sony '<trademark class="registered">Sony</trademark>'>
 <!ENTITY Clie "<productname><trademark>Clie</trademark></productname>">
 <!ENTITY FreeBSD '<trademark class="registered">FreeBSD</trademark>'>
-<!ENTITY AvantGo '<trademark class="registered">AvantGo</trademark>'>
 <!ENTITY handheld "handheld">
 <!ENTITY configuring-kpilot SYSTEM "configuration.docbook">
 <!ENTITY using-kpilot SYSTEM "usage.docbook">
@@ -22,7 +21,7 @@
 
 <!--
     From LW: http://www.palm.com/about/trademark.html According to this,
-	we have have overspecified some of the tradmarks... feel free to
+	we have have overspecified some of the trademarks... feel free to
 	adjust if you think this is the case.
 -->
 
@@ -74,7 +73,7 @@
 
 <legalnotice>&FDLNotice;</legalnotice>
 
-<date>2004-06-27</date>
+<date>2009-03-14</date>
 <releaseinfo>&kpilotver;</releaseinfo>
 
 <abstract>
@@ -160,13 +159,11 @@
 your &handheld;.
 Configuration settings are described at length in
 the <link linkend="configure">section on configuring &kpilot;</link>.
-For the impatient, the <link linkend="configwizard">configuration wizard</link>
-can set up most things for you.
 </para>
 
 <para>
-Once &kpilot; is configured, you should make a <link
-linkend="backup">backup</link> of your &handheld; first. That is to be on the
+Once &kpilot; is configured, you should make a 
+backup of your &handheld; first. That is to be on the
 safe side. Once that is done, you can just leave the &kpilot; daemon running in
 the system tray, and all you need to do is press the &HotSync; button, and
 changes in the &handheld; data and the &kde; applications will be <link
@@ -175,14 +172,6 @@
 </para>
 
 <para>
-If you want to <link linkend="page-viewers">examine</link> the
-data stored on your &handheld;, the built in <link
-linkend="page-viewers">viewers</link> can be used. This allows you to view
-memos, addresses, &etc;. There is a generic hexadecimal database viewer for
-advanced use.
-</para>
-
-<para>
 Finally, &kpilot; can be used to <link linkend="installer-app">install</link>
 new programs and databases on your &handheld;.
 </para>
Index: doc/kpilot/setup-conduit.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/daemon-menu.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/setup-startup-exit.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/sync.docbook
===================================================================
--- doc/kpilot/sync.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ doc/kpilot/sync.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -2,16 +2,14 @@
 <title>Syncing your &handheld; with a PC</title>
 
 <para>
-This chapter describes the synchronization process
-that &kpilot; uses, focusing on the &kpilot; daemon functionality.
-You may sync your &handheld; using the <link linkend="builtin">internal
-viewers</link> and / or <link linkend="conduits">conduits</link>, depending
-on your personal preferences. Conduits allow external applications to interface
-with the data on your &handheld;.
+This chapter describes the synchronization process that &kpilot; uses, focusing
+on the &kpilot; daemon functionality.  You may sync your &handheld; using
+the <link linkend="conduits">conduits</link>. Conduits allow external
+applications to interface with the data on your &handheld;.
 </para>
 
 <para>
-It is a good idea to make a <link linkend="backup">backup</link>
+It is a good idea to make a backup
 of your &handheld; regularly. Other than making backups, it should rarely be
 necessary to do anything other than drop your &handheld; on the cradle and press
 the &HotSync; button. The &kpilot; daemon icon in the system tray will flash
@@ -30,7 +28,7 @@
 
 
 <para>
-To which type of sync &kpilot; will perform next, you can use the main
+To set which type of sync &kpilot; will perform next, you can use the main
 application
 <link linkend="menu-file">
 <menuchoice>
@@ -64,31 +62,10 @@
 </para></listitem>
 
 <listitem><para>
-<guilabel>FastSync (once)</guilabel>: only sync those
-databases that have conduits.
-</para></listitem>
-
-<listitem><para>
 <guilabel>FullSync (once)</guilabel>: the safest option, but
 takes the longest time to complete.
 </para></listitem>
 
-<listitem><para>
-<guilabel>Backup (once)</guilabel>: copy all the data from the &handheld; to the
-<acronym>PC</acronym>.
-</para></listitem>
-
-<listitem><para>
-<guilabel>Restore from Backup (once)</guilabel>: copy the data from a previous backup from the PC to the
-&handheld;, erasing the data previously held there.
-
-<warning><para>
-Use the restore functionality with care, as you can lose all the new
-data entered on the &handheld; since the last backup.
-</para></warning>
-</para>
-</listitem>
-
 <listitem>
 <para>
 <guilabel>Copy Handheld to PC (once)</guilabel>: run all conduits and
@@ -128,83 +105,17 @@
 
 </para>
 
-<sect1 id="backup">
-<title>Backing up your &handheld; data</title>
 
-<para>
-On every backup, &kpilot; stores a copy of all your &handheld; data under the
-<filename class="directory">$KDEHOME/share/apps/kpilot/DBBackup/User Name/</filename>
-folder, allowing you to restore that copy later, if needed. The
-<filename class="directory">$KDEHOME</filename> environment variable
-(typically <filename class="directory">/home/Login Name/.kde/</filename>)
-points to the folder that contains your configuration and data for the &kde;
-applications.</para>
-
-<para>
-It is a good idea to backup your data often. To perform a backup, you can click
-the
-<menuchoice>
-<guisubmenu>Next Sync</guisubmenu>
-<guimenuitem>Backup</guimenuitem>
-</menuchoice>
-on the &kpilot; daemon icon popup menu or the
-<menuchoice>
-<guimenu>File</guimenu>
-<guimenuitem>Backup</guimenuitem>
-</menuchoice>
-menu item on the main &kpilot; application menu in order
-to make the next sync a backup. Then, just press the &HotSync; button.
-</para>
-
-</sect1>
-
-<sect1 id="restore">
-<title>Restoring Your &handheld; Data</title>
-
-<para>
-The restore operation consist of transferring all the data previously saved on
-the <acronym>PC</acronym> to the &handheld;, effectively erasing all the new
-data held by the device by returning it to a previous state.
-<warning><para>
-Use the restore functionality with care, as you can lose all the new
-data entered on the &handheld; since the last backup.
-</para></warning>
-</para>
-
-<para>
-The data saved on the last backup is located on the <filename class="directory">$KDEHOME/share/apps/kpilot/DBBackup/User Name/</filename>
-folder. The <filename class="directory">$KDEHOME</filename> environment variable
-(typically <filename class="directory">/home/Login Name/.kde/</filename>)
-points to the folder that contains your configuration and data for the &kde;
-applications.</para>
-
-<para>
-The most common use for the restore functionality is to recover from a hardware
-or software failure on the device.
-The restore function can be accessed from the
-main &kpilot; application, and from the &kpilot; daemon. be careful, as
-restoring the data is not a common operation. In order
-to restore the data at the next sync, click the
-<menuchoice>
-<guimenu>File</guimenu>
-<guimenuitem>Restore</guimenuitem>
-</menuchoice>
-menu item, then press the &HotSync; button.
-</para>
-
-</sect1>
-
-
 <sect1 id="sync-s">
 <title>Selecting the Synchronization Type</title>
 
 <para>
-There are three ways to sync your &handheld;, <guilabel>HotSync</guilabel>,
-<guilabel>FastSync</guilabel> or <guilabel>FullSync</guilabel>.
+There are two ways to sync your &handheld;, <guilabel>HotSync</guilabel>,
+or <guilabel>FullSync</guilabel>.
 </para>
 
 <para>
-When you press the &HotSync; button on your &handheld;, &kpilot;'s will run the
+When you press the &HotSync; button on your &handheld;, &kpilot; will run the
 default sync operation (usually a <guilabel>HotSync</guilabel>). You can select
 the default sync operation in the <link linkend="page-hotsync">&HotSync;
 configure dialog</link>. Alternatively, you can click one of the sync options on
@@ -279,150 +190,6 @@
 </mediaobject>
 </screenshot>
 
-<para>
-The <guilabel>Conduits</guilabel> tree in the configuration dialog
-collects all the installed conduits available.
-The conduits can be enabled and disabled
-by clicking on the check box to the left of the conduit's name.
-Conduits can have an extensive configuration of
-their own, and may be supplied by third parties.
-Most of the conduits require some initial configuration, so it is strongly
-recommended to check the
-<link linkend="config-conduits">section detailing the default conduits
-configuration</link> before using them.
-</para>
-
-
-<para>
-The default conduits are the following:
-</para>
-
-
-<variablelist>
-
-<varlistentry>
-<term><guilabel>KNotes / Memos</guilabel></term>
-<listitem><para>
-Synchronizes the Memo Pad application with &knotes;.
-
-<important><para>
-The conduit only synchronizes the Memo Pad data if &knotes; is running. If you
-want to enable this functionality, please remember to start &knotes; first, or
-check if it is already running (tip: look for the &knotes; icon in the system tray).
-</para></important>
-
-</para></listitem>
-</varlistentry>
-
-
-<varlistentry>
-<term><guilabel>Notepad</guilabel></term>
-<listitem>
-<para>
-Exports the free hand notes  of the &handheld;'s Notepad application as pictures
-to the PC.
-</para>
-</listitem>
-</varlistentry>
-
-
-<varlistentry>
-<term><guilabel>Time Synchronization</guilabel></term>
-<listitem><para>
-Sets the &handheld;'s time to that of the desktop machine.
-Useful for keeping the clock of the &handheld; accurate.
-</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Calendar (KOrganizer)</guilabel></term>
-<listitem><para>
-Synchronizes the Datebook application with &korganizer; or with a iCalendar file of
-your choice.
-</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Palm DOC</guilabel></term>
-<listitem><para>
-Automatically converts, installs and sync text files in the &PalmPilot;
-DOC format, so you can read the text files with most DOC-capable
-applications on the &handheld;. There are many free or open source Palm
-DOC readers, and some Palm DOC editors for your handheld.</para>
-<para>
-Any plain text file can be easily converted. For instance, you can download and
-convert the public domain books provided by the <ulink url="http://www.gutenberg.net">
-Gutenberg Project</ulink> and read them in your &handheld;.
-</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Addressbook</guilabel></term>
-<listitem><para>
-Synchronizes the Address application with &kaddressbook; or with a vCard file of
-your choice.
-</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>System Information</guilabel></term>
-<listitem><para>
-Writes information about your &handheld;, (such as OS version,
-RAM available, and the list of databases) to a file. Useful mostly for
-debugging purposes.
-</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>ToDo's (KOrganizer)</guilabel></term>
-<listitem><para>
-Synchronizes the Todo list application with &korganizer; or with a iCalendar file of
-your choice.
-</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>MAL (AvantGo) Conduit</guilabel></term>
-<listitem><para>
-Synchronizes your &handheld; with the &AvantGo; server. The &AvantGo; server
-offers general content (news, guides, stock quotes, &etc;) in a format that is
-suitable for reading in a &handheld;. To use this conduit, you need to register, subscribe
-the channels you select and install the &AvantGo; software on your &handheld;.
-</para></listitem>
-</varlistentry>
-
-
-<varlistentry>
-<term><guilabel>Mail</guilabel></term>
-<listitem><para>
-Sends mail written on the &handheld; through &kmail;.
-There is no provision for receiving mail, however.
-</para></listitem>
-</varlistentry>
-
-<varlistentry>
-<term><guilabel>Perl</guilabel></term>
-<term><guilabel>Python</guilabel></term>
-<term><guilabel>NULL</guilabel></term>
-<listitem><para>
-These conduits are intended as a programming demonstration,
-and serve no practical purpose during a &HotSync;.
-They are not normally listed, but you may see them on some systems.
-</para></listitem>
-</varlistentry>
-
-</variablelist>
-
-<screenshot>
-<screeninfo>The Conduit Setup Dialog</screeninfo>
-<mediaobject>
-<imageobject><imagedata fileref="setup-conduit.png" format="PNG"/></imageobject>
-<textobject><phrase>The Conduit Setup Dialog</phrase></textobject>
-<caption><para>The Conduit Setup Dialog</para></caption>
-</mediaobject>
-</screenshot>
-
-
 </sect1>
 
 <sect1 id="conflicts">
@@ -431,7 +198,7 @@
 <para>
 Data records can be changed both on the &handheld; and
 on the <acronym>PC</acronym>. If one record has incompatible changes
-in both the &handheld; and the <acronym>PC</acronym>, (such as
+in both the &handheld; and the <acronym>PC</acronym> (such as
 changing a phone number in different ways on both sides),
 the conflicting change needs to be resolved so
 that both the &handheld; and the <acronym>PC</acronym> are in sync again.
Index: doc/kpilot/conduit-todo.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream

Zmiany atrybutów dla: doc/kpilot/conduit-todo.png
___________________________________________________________________
Dodane: svn:mime-type
   + application/octet-stream

Index: doc/kpilot/sidebar.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/setup-general.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/setup-items.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/setup-address.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/setup-dbspecial.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/setup-hotsync.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/setup-tabs.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kpilot/conduit-vcal.png
===================================================================
Nie można wyświetlić: plik binarny.
svn:mime-type = application/octet-stream
Index: doc/kalarm/index.docbook
===================================================================
--- doc/kalarm/index.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ doc/kalarm/index.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -261,20 +261,10 @@
 </listitem>
 
 <listitem>
-<para>Click the <mousebutton>Middle</mousebutton> mouse button on the
-system tray icon.</para>
-</listitem>
-
-<listitem>
 <para><mousebutton>Right</mousebutton> click in the alarm list and
 choose <menuchoice><guimenuitem>New</guimenuitem></menuchoice> from
 the context menu.</para>
 </listitem>
-
-<listitem>
-<para>Double click on empty space below the last entry in the alarm
-list.</para>
-</listitem>
 </itemizedlist>
 
 <para>Alternatively, you can create new alarms preconfigured from
@@ -423,32 +413,6 @@
 </sect2>
 
 <sect2>
-<title>Viewing an Alarm</title>
-
-<para>To view an existing alarm without the ability to modify it, do
-one of the following:</para>
-
-<itemizedlist>
-<listitem>
-<para>Select it by clicking on its entry in the alarm list. Then choose
-<menuchoice>
-<guimenu>Actions</guimenu><guimenuitem>View</guimenuitem>
-</menuchoice>.</para>
-</listitem>
-<listitem>
-<para><mousebutton>Right</mousebutton> click on its entry in the alarm
-list and choose
-<menuchoice><guimenuitem>View</guimenuitem></menuchoice>
-from the context menu.</para>
-</listitem>
-</itemizedlist>
-
-<para>This displays the <link linkend="alarm-edit-dlg">Alarm Edit
-dialog</link> in read-only mode.</para>
-
-</sect2>
-
-<sect2>
 <title>Acknowledging an Alarm</title>
 
 <para>See <link linkend="message-window">Alarm Message Window</link>
@@ -1745,7 +1709,7 @@
 when the message is to be redisplayed, or select <guilabel>Defer for
 time interval</guilabel> to enter how long after now (in hours and
 minutes) the message should be redisplayed. Then click
-<guibutton>Defer</guibutton> to defer the alarm message and close its
+<guibutton>OK</guibutton> to defer the alarm message and close its
 window.</para>
 
 <note><para>The time the alarm is deferred to must be earlier than its
@@ -1848,8 +1812,7 @@
 <variablelist>
 <varlistentry>
 <term><menuchoice><guimenuitem>Enable Alarms</guimenuitem></menuchoice></term>
-<listitem><para><action>Enables monitoring of alarms. This option
-only appears if alarms are currently disabled.</action></para>
+<listitem><para><action>Enables or disables monitoring of alarms.</action></para>
 <para>See
 <link linkend="enable-disable">Enabling and Disabling Alarms</link>
 for details.</para>
@@ -1857,16 +1820,6 @@
 </varlistentry>
 
 <varlistentry>
-<term><menuchoice><guimenuitem>Disable Alarms</guimenuitem></menuchoice></term>
-<listitem><para><action>Disables monitoring of alarms. This option
-only appears if alarms are currently enabled.</action></para>
-<para>See
-<link linkend="enable-disable">Enabling and Disabling Alarms</link>
-for details.</para>
-</listitem>
-</varlistentry>
-
-<varlistentry>
 <term><menuchoice><guimenuitem>New Alarm</guimenuitem></menuchoice></term>
 <listitem><para><action>After you select the alarm type from the list
 which appears, opens the Alarm Edit dialog to create a new
@@ -2029,14 +1982,14 @@
 
 <itemizedlist>
 <listitem>
-<para>Select <menuchoice><guimenu>Actions</guimenu>
-<guimenuitem>Disable Alarms</guimenuitem></menuchoice>.</para>
+<para>Unselect <menuchoice><guimenu>Actions</guimenu>
+<guimenuitem>Enable Alarms</guimenuitem></menuchoice>.</para>
 </listitem>
 
 <listitem>
 <para><mousebutton>Right</mousebutton> click on the system tray icon
-and choose
-<menuchoice><guimenuitem>Disable Alarms</guimenuitem></menuchoice>
+and uncheck
+<menuchoice><guimenuitem>Enable Alarms</guimenuitem></menuchoice>
 from the context menu.</para>
 </listitem>
 
Index: doc/kaddressbook/index.docbook
===================================================================
--- doc/kaddressbook/index.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ doc/kaddressbook/index.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -544,8 +544,8 @@
 <para>The Photo will be shown in the contact preview and in the Icon view mode. However the Logo picture will only be shown in Icon view and only if there's no photo available.</para>
 <para>To reset a photo or logo simply click on it with the &RMB; and select <guilabel>Reset</guilabel>.</para>
 </sect3>
-<sect3 id="managing-contacts-misc-free-busy-informations">
-<title>Location of Free/Busy informations</title>
+<sect3 id="managing-contacts-misc-free-busy-information">
+<title>Location of Free/Busy information</title>
 <para>Here you can select a path to a contact's Free/Busy information, which are used when you add him to an event in &korganizer; or &kontact;'s calendar view.</para>
 </sect3>
 </sect2>
@@ -813,7 +813,7 @@
 <varlistentry>
 <term><guilabel>CSV List</guilabel></term>
 <listitem><para>CSV (comma separated value) is a format that is used
-by many (address book) applications, it stores the contact informations in a plaintext field separated by commas. This makes CSV very flexible and good for interaction with scripts.</para></listitem>
+by many (address book) applications, it stores the contact information in a plaintext field separated by commas. This makes CSV very flexible and good for interaction with scripts.</para></listitem>
 </varlistentry>
 
 <varlistentry>
Index: doc/korganizer/index.docbook
===================================================================
--- doc/korganizer/index.docbook	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ doc/korganizer/index.docbook	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -454,7 +454,7 @@
 </procedure>
 
 <para>Alternatively, you can configure the &korganizer; resources (plus all
-other &kde; resources), in the &kcontrolcenter;, using the <guilabel>&kde;
+other &kde; resources), in the &systemsettings;, using the <guilabel>&kde;
 Resources</guilabel> configuration module.</para>
 
 <para>Among the existing resources, you can find:</para>
@@ -512,7 +512,7 @@
 <listitem><para>
 If you have access to a server that supports the
 <ulink url="http://www.groupdav.org">GroupDav protocol</ulink>, add this
-resource in order to be able to to save (and load) events<!--, journals, free/busy information?--> and to-dos
+resource in order to be able to save (and load) events<!--, journals, free/busy information?--> and to-dos
 to the server. To add the resource, you will need to know the server &URL;, your
 user name and your password. The GroupDav protocol supports the storage of 
 contacts, so you may want to add and configure the &kaddressbook;
@@ -530,7 +530,7 @@
 <listitem><para>
 If you have access to a
 <ulink url="http://www.novell.com/products/groupwise">Novell GroupWise Server</ulink>
-(version 6.5 or later), add this resource in order to be able to to save (and load)
+(version 6.5 or later), add this resource in order to be able to save (and load)
 events, free/busy information <!--,journals ?-->and to-dos to the server. To add the resource, you will
 need to know the server &URL;, your user name and your password. There is
 support for storage of contacts, so you may want to configure &kaddressbook;
@@ -550,7 +550,7 @@
 <term><guilabel>Calendar on IMAP Server via &kmail;</guilabel></term>
 <listitem><para>
 If you have access to a server that shares calendar data via IMAP, add this
-resource in order to be able to to save (and load) events, to-dos, free/busy
+resource in order to be able to save (and load) events, to-dos, free/busy
 information and journal entries to the IMAP server. To enable IMAP access, you
 will need to configure &kmail; first, then add the &korganizer; resource.
 Also, since you are using &kmail; to contact the server, &korganizer; will
@@ -615,7 +615,7 @@
 <listitem><para>
 If you have access to a
 <ulink url="http://www.microsoft.com/exchange">Exchange 2000 Server</ulink>,
-add this resource in order to be able to to save (and load)
+add this resource in order to be able to save (and load)
 events FIXME:,journals, free/busy information and to-dos? to the server. To add the resource, you will
 need to know the server &URL;, FIXME:port? your user name and your password. There
 is support for (read only) contacts, so you may want to configure &kaddressbook;
@@ -704,13 +704,13 @@
 <term><guilabel>SUSE &Linux; OpenExchange Server</guilabel></term>
 <listitem><para>
 If you have access to a
-<ulink url="http://www.novell.com/products/groupwise">SUSE &Linux; OpenExchange
-Server</ulink>, version 4.1, add this resource in order to be able to to save
+<ulink url="http://www.novell.com/coolsolutions/openexchange/">SUSE &Linux; OpenExchange
+Server</ulink>, version 4.1, add this resource in order to be able to save
 (and load) events, free/busy information <!--,journals ?-->and to-dos to the server. To add the
 resource, you will need to know the server &URL;, your user name and your
 password. There is support for storage of contacts, so you may want to configure
 &kaddressbook; resource.</para>
-<para>The most practical way to configure the access to a GroupWise server is
+<para>The most practical way to configure the access to an OpenExchange server is
 to use the <application>sloxwizard</application> wizard. You can start it
 from the command line prompt:
 
@@ -728,7 +728,7 @@
 <listitem><para>
 If you have access to a
 <ulink url="http://www.egroupware.org">eGroupware
-Server</ulink>, version 1.0, add this resource in order to be able to to save
+Server</ulink>, version 1.0, add this resource in order to be able to save
 (and load) events, free/busy information <!--,journals ?-->and to-dos to the server. To add the
 resource, you will need to know the server &URL;, your user name and your
 password. There is support for storage of contacts, so you may want to configure
@@ -1060,7 +1060,7 @@
 times. Hovering the mouse over an calendar item will bring up a tooltip
 with the item detailed information. To make &korganizer; show a red line
 marking the current-time on the current day (the Marcus Bains line),
-check the <guilabel>Show current-time (Marcus Bains Line)</guilabel> box in the
+check the <guilabel>Show current-time (Marcus Bains) line</guilabel> box in the
 <link linkend="config-main-views">&korganizer; view
 configuration</link>.</para>
 
@@ -1334,7 +1334,7 @@
 <para>The <menuchoice><guimenu>View</guimenu>
 <guisubmenu>Filter</guisubmenu></menuchoice> submenu and the filter toolbar drop
 down offer access to all available filters  created using
-the <link linkend="menu-settings-edit-filters"><guilabel>Edit
+the <link linkend="menu-settings-edit-filters"><guilabel>Edit Calendar 
 Filters</guilabel></link> dialog. To toggle the display of the filters toolbar
 on and off, choose the <menuchoice><guimenu>Settings</guimenu>
 <guisubmenu>Toolbars</guisubmenu><guimenuitem>Filter toolbar</guimenuitem></menuchoice>.
@@ -1429,7 +1429,7 @@
 
 <para>This is a thorough description of the individual event window fields and
 widgets. Not all fields have to be filled in; some can be left empty. Read the
-<link linkend="entering-data-required-fields">Required fields section</link>
+<link linkend="entering-data-required-fields">Required fields</link> section 
 for detailed information. And if you prefer to learn by example, there's one
 in the <link linkend="examples-entering-event">Entering event</link> section.
 </para>
@@ -1491,7 +1491,7 @@
 reminded, or click the <guibutton>Advanced</guibutton> button to open the
 <guilabel>Edit Reminders</guilabel> dialog. Using this dialog, you can set
 repeating intervals for your reminders, and create special reminders that play
-sounds, run programs, or send emails.</para>
+sounds, or run programs.</para>
 
 <!--Click the musical <guiicon>Note</guiicon> symbol to choose the
 alarm sound. Click the <guiicon>Gear</guiicon> icon to browse for a
@@ -1502,7 +1502,7 @@
 <term><guilabel>Show Time As:</guilabel></term>
 <listitem><para>The duration of the event may be shown as Busy or Free in your
 schedule. Choose it from the <guilabel>Show Time As</guilabel>
-menu.</para></listitem>
+drop down box.</para></listitem>
 </varlistentry>
 
 <varlistentry>
@@ -1520,7 +1520,7 @@
 <term><guilabel>Select Categories</guilabel></term>
 <listitem><para>You can assign several
 <link linkend="categories-view">categories</link> to a calendar item. Click the
-<guilabel>Select Categories</guilabel> button to open the
+<guilabel>Select</guilabel> button to open the
 <guilabel>Select Categories</guilabel> dialog. Check the category boxes to
 assign suitable categories to the event. You can also add a new category, modify
 a category or delete a category by pressing the button
@@ -1552,7 +1552,7 @@
 
 </variablelist>
 
-<para>When you want to confirm, call off or revert the entered data, choose
+<para>When you want to confirm, apply or call off the entered data, choose
 among the <link linkend="reference-action-buttons">Action Buttons</link>,
 <guibutton>OK</guibutton>, <guibutton>Apply</guibutton> and
 <guibutton>Cancel</guibutton>.</para>
@@ -1629,7 +1629,7 @@
 <para>This is similar to Monthly.  You need to choose whether or not you
 are indicating a calendar day of the year (&eg;, the 250th day of the
 year) - <guilabel>Recur on day <replaceable>#</replaceable> of the
-year</guilabel>, in in a specific week on a specific day of the week of a month
+year</guilabel>, in a specific week on a specific day of the week of a month
 (&eg;, the 2nd Tuesday of March), or the day of the month in a
 particular month of the year - <guilabel>Recur on day <replaceable>#</replaceable>
 of the <replaceable>month</replaceable></guilabel>.  By default, &korganizer;
@@ -1695,9 +1695,9 @@
 identity can be set in the <guilabel>Personal</guilabel> section of the
 &korganizer; configuration, other identities in the <guilabel>Security &amp;
 Privacy</guilabel>-&gt;<guilabel>Password &amp; User Account</guilabel> section
-of the &kcontrolcenter;. In addition, identities are gathered from your &kmail;
+of the &systemsettings;. In addition, identities are gathered from your &kmail;
 settings and from your address book. If you choose to set it globally for &kde;
-in the &kcontrolcenter;, be sure to check the <guilabel>Use email settings from
+in the &systemsettings;, be sure to check the <guilabel>Use email settings from
 Control Center</guilabel>' box in the <guilabel>Personal</guilabel> section of
 the &korganizer; configuration.</para></listitem>
 </varlistentry>
@@ -1953,7 +1953,7 @@
 <varlistentry>
 <term><guilabel>Priority</guilabel></term>
 <listitem><para>Assign a priority to your to-do.  This drop down menu offers
-priorities from one to five, one being the highest.  Initially to-dos are set
+priorities from one to nine, one being the highest.  Initially to-dos are set
 to priority five (medium).</para></listitem>
 </varlistentry>
 
@@ -1969,7 +1969,7 @@
 reminded, or click the <guibutton>Advanced</guibutton> button to open the
 <guilabel>Edit Reminders</guilabel> dialog. Using this dialog, you can set
 repeating intervals for your reminders, and create special reminders that play
-sounds, run programs, or send emails.</para>
+sounds, or run programs.</para>
 
 <!--Click the musical <guiicon>Note</guiicon> symbol to choose the
 alarm sound. Click the <guiicon>Gear</guiicon> icon to browse for a
@@ -2469,13 +2469,13 @@
 &korganizer; window.</para>
 
 <para>Localization information like date and time formats can be
-configured from &kcontrolcenter; within the <menuchoice>
+configured from &systemsettings; within the <menuchoice>
 <guisubmenu>Regional &amp; Accessibility</guisubmenu> <guimenuitem>Country/Region &amp;
 Language</guimenuitem> </menuchoice> module.  This control module can be
 accessed from within &korganizer;: just choose the <menuchoice><guimenu>
 Settings</guimenu><guimenuitem>Configure Date &amp;
 Time...</guimenuitem></menuchoice> menu item.  &korganizer; has to be restarted
-for changes done in &kcontrolcenter; to take effect.</para>
+for changes done in &systemsettings; to take effect.</para>
 
 <para>To configure where &korganizer; stores and retrieves calendar events,
 journal entries and to-dos, (in local files, groupware servers, journal entries as blogs,
@@ -2499,7 +2499,7 @@
 <varlistentry>
 <term><guilabel>Use email settings from control center</guilabel></term>
 <listitem><para>Check this box to use your name and email address as set in
-&kcontrolcenter; (<menuchoice><guimenuitem>Security &amp; Privacy</guimenuitem>
+&systemsettings; (<menuchoice><guimenuitem>Security &amp; Privacy</guimenuitem>
 <guimenuitem>Password &amp; User Account</guimenuitem></menuchoice>).</para>
 </listitem>
 </varlistentry>
@@ -2509,7 +2509,7 @@
 <listitem><para><guilabel>Full name</guilabel> is initially set to
 <quote>Anonymous</quote> with an email address of
 <quote>nobody@nowhere</quote>. You can change your name by directly
-entering it here or you can use your Email Settings from &kcontrolcenter; (see
+entering it here or you can use your Email Settings from &systemsettings; (see
 above).  This name will be displayed by default as
 <guilabel>Organizer</guilabel> in to-dos and Events.</para></listitem> 
 </varlistentry>
@@ -2649,10 +2649,10 @@
 <variablelist>
 
 <varlistentry>
-<term><guilabel>Enable tooltips displaying summary of events</guilabel></term>
+<term><guilabel>Enable tooltips for displaying summaries</guilabel></term>
 <listitem><para>If your summary for an event is longer than would fit in the
-current View, the remaining characters are not displayed. Check <guilabel>Enable
-tooltips displaying summary of events</guilabel> if you want the full summary
+current View, the remaining characters are not displayed. Check <guilabel>Enable 
+tooltips for dispaying summaries</guilabel> if you want the full summary
 displayed when the hovering the mouse pointer over the appointment for a few
 seconds.</para></listitem>
 </varlistentry>
@@ -2884,7 +2884,7 @@
 <varlistentry>
 <term><guilabel>Working hours color</guilabel></term>
 <listitem><para>This button opens the <guilabel>Select Color</guilabel> dialog,
-allowing you to select the agenda view.</para></listitem>
+allowing you to select color of the working hours background in the agenda view.</para></listitem>
 </varlistentry>
 
 <varlistentry>
@@ -3029,7 +3029,7 @@
 <variablelist>
 
 <varlistentry>
-<term><guilabel>Publish free/busy information</guilabel></term>
+<term><guilabel>Publish free/busy information automatically</guilabel></term>
 <listitem><para>Enable this option if you wish your Free/Busy information to be
 uploaded automatically. Note that you may skip this option and choose to mail or
 upload your Free/Busy information via the <guilabel>Schedule</guilabel> menu of
@@ -3043,7 +3043,7 @@
 </varlistentry>
 
 <varlistentry>
-<term><guilabel>Minimum time between uploads in minutes</guilabel></term>
+<term><guilabel>Minimum time between uploads (in minutes)</guilabel></term>
 <listitem><para>In case you choose to publish your information automatically,
 you may configure the interval of time in minutes between each upload.</para>
 </listitem>
@@ -3205,7 +3205,7 @@
 <itemizedlist>
 <listitem><para>The tool set is configured in the <menuchoice><guimenu>
 Settings</guimenu><guimenuitem>Configure
-Toolbars....</guimenuitem></menuchoice> menu item.
+Toolbars...</guimenuitem></menuchoice> menu item.
 </para></listitem>
 <listitem><para>The graphic style (icon size, text position, &etc;) is
 adjusted through the <guimenu>Toolbar Context Menu</guimenu>. Right click the
@@ -4001,7 +4001,7 @@
 <guimenuitem>New Sub-to-do...</guimenuitem>
 </menuchoice></term>
 <listitem><para>Choose <guilabel>New Sub-to-do...</guilabel> to <action>start
-writing a new sub-to-do. The currently selected to-do will be the the
+writing a new sub-to-do. The currently selected to-do will be the
 sub-to-do parent.</action>. Initially the to-do has no due date, but you can
 specify one.</para>
 <para>You can get a detailed description of the to-do window in <link
Index: kalarm/kalarm.h
===================================================================
--- kalarm/kalarm.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kalarm/kalarm.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -23,7 +23,7 @@
 
 #undef QT3_SUPPORT
 
-#define KALARM_VERSION "2.1.5"
+#define KALARM_VERSION "2.1.6"
 #define KALARM_NAME "KAlarm"
 #define KALARM_DBUS_SERVICE  "org.kde.kalarm"  // D-Bus service name of KAlarm application
 
Index: kalarm/mainwindow.cpp
===================================================================
--- kalarm/mainwindow.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kalarm/mainwindow.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -51,6 +51,7 @@
 #include <QDropEvent>
 #include <QResizeEvent>
 #include <QCloseEvent>
+#include <QTimer>
 
 #include <kmenubar.h>
 #include <ktoolbar.h>
@@ -167,7 +168,7 @@
 	connect(resources, SIGNAL(signalErrorMessage(const QString&)), SLOT(showErrorMessage(const QString&)));
 
 	// Create the alarm list widget
-	mListFilterModel = new AlarmListFilterModel(EventListModel::alarms());
+	mListFilterModel = new AlarmListFilterModel(EventListModel::alarms(), this);
 	mListFilterModel->setStatusFilter(mShowArchived ? static_cast<KCalEvent::Status>(KCalEvent::ACTIVE | KCalEvent::ARCHIVED) : KCalEvent::ACTIVE);
 	mListView = new AlarmListView(WINDOW_NAME, mSplitter);
 	mListView->setModel(mListFilterModel);
@@ -518,7 +519,10 @@
 	mActionFindPrev = KStandardAction::findPrev(mListView, SLOT(slotFindPrev()), actions);
 	KStandardAction::selectAll(mListView, SLOT(selectAll()), actions);
 	KStandardAction::deselect(mListView, SLOT(clearSelection()), actions);
-	KStandardAction::quit(this, SLOT(slotQuit()), actions);
+	// Quit only once the event loop is called; otherwise, the parent window will
+	// be deleted while still processing the action, resulting in a crash.
+	KAction* act = KStandardAction::quit(0, 0, actions);
+	connect(act, SIGNAL(triggered(bool)), SLOT(slotQuit()), Qt::QueuedConnection);
 	KStandardAction::keyBindings(this, SLOT(slotConfigureKeys()), actions);
 	KStandardAction::configureToolbars(this, SLOT(slotConfigureToolbar()), actions);
 	KStandardAction::preferences(this, SLOT(slotPreferences()), actions);
@@ -1069,7 +1073,10 @@
 }
 
 /******************************************************************************
-*  Called when the Quit menu item is selected.
+* Called when the Quit menu item is selected.
+* Note that this must be called by the event loop, not directly from the menu
+* item, since otherwise the window will be deleted while still processing the
+* menu, resulting in a crash.
 */
 void MainWindow::slotQuit()
 {
@@ -1097,7 +1104,9 @@
 		{
 			// There is no system tray icon, and this is the last main
 			// window, so closing it will quit the application.
-			theApp()->doQuit(this);
+			// Quit once the close event has been processed. Deleting the
+			// window while still processing the event handler can cause a crash.
+			QTimer::singleShot(0, this, SLOT(slotDoQuit()));
 			ce->ignore();
 			return;
 		}
Index: kalarm/Changelog
===================================================================
--- kalarm/Changelog	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kalarm/Changelog	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -1,6 +1,9 @@
 KAlarm Change Log
 
-=== Version 2.1.5 --- 7 February 2009 ===
+=== Version 2.1.6 --- 4 March 2009 ===
+Fix crash when KAlarm quits.
+
+=== Version 2.1.5 (KDE 4.2.1) --- 7 February 2009 ===
 - Disable inapplicable alarm types in alarm edit dialogue Load Template list.
 - Prevent multiple identical error messages being displayed for the same alarm.
 - Fix possible crash on alarm refresh, or removal or disabling of a resource.
Index: kalarm/kalarmapp.cpp
===================================================================
--- kalarm/kalarmapp.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kalarm/kalarmapp.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -1021,7 +1021,6 @@
 void KAlarmApp::removeWindow(TrayWindow*)
 {
 	mTrayWindow = 0;
-	quitIf();
 }
 
 /******************************************************************************
Index: kalarm/lib/spinbox2.cpp
===================================================================
--- kalarm/lib/spinbox2.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kalarm/lib/spinbox2.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -1,7 +1,7 @@
 /*
  *  spinbox2.cpp  -  spin box with extra pair of spin buttons (for Qt 3)
  *  Program:  kalarm
- *  Copyright © 2001-2008 by David Jarvie <djarvie@kde.org>
+ *  Copyright © 2001-2009 by David Jarvie <djarvie@kde.org>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -527,12 +527,13 @@
 =============================================================================*/
 
 SpinMirror::SpinMirror(ExtraSpinBox* spinbox, SpinBox* mainspin, QWidget* parent)
-	: QGraphicsView(new QGraphicsScene, parent),
+	: QGraphicsView(parent),
 	  mSpinbox(spinbox),
 	  mMainSpinbox(mainspin),
 	  mReadOnly(false),
 	  mMirrored(false)
 {
+	setScene(new QGraphicsScene(this));
 	setAttribute(Qt::WA_Hover);
 	setHorizontalScrollBarPolicy(Qt::ScrollBarAlwaysOff);
 	setVerticalScrollBarPolicy(Qt::ScrollBarAlwaysOff);
Index: kalarm/resources/resourcelocaldir.cpp
===================================================================
--- kalarm/resources/resourcelocaldir.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kalarm/resources/resourcelocaldir.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -1,8 +1,8 @@
 /*
  *  resourcelocaldir.cpp  -  KAlarm local directory calendar resource
  *  Program:  kalarm
- *  Copyright © 2006-2008 by David Jarvie <djarvie@kde.org>
- *  Based on resourcelocaldir.cpp in libkcal (updated to rev 779953),
+ *  Copyright © 2006-2009 by David Jarvie <djarvie@kde.org>
+ *  Based on resourcelocaldir.cpp in libkcal (updated to rev 779953,938673,938806),
  *  Copyright (c) 2003 Cornelius Schumacher <schumacher@kde.org>
  *
  *  This program is free software; you can redistribute it and/or modify
@@ -149,6 +149,9 @@
 #ifdef __GNUC__
 #warning Only reload the individual file which has changed
 #endif
+	if (filepath.contains(QRegExp("(~|\\.new|\\.tmp)$"))
+	||  filepath.startsWith(mURL.path() + "/qt_temp."))
+		return;   // ignore backup or temporary file
 	doLoad(false);
 }
 /******************************************************************************
@@ -203,8 +206,9 @@
 		{
 			// Check the next file in the directory
 			QString id = entries[i];
-			if (id.endsWith('~'))   // backup file, ignore it
-				continue;
+			if (id.contains(QRegExp("(~|\\.new|\\.tmp)$"))
+			||  id.startsWith("qt_temp."))
+				continue;   // ignore backup or temporary file
 			QString fileName = dirName + '/' + id;
 			foundFile = true;
 
@@ -218,7 +222,6 @@
 				Event* ev = calendar()->event(id);
 				if (ev  &&  changes.indexOf(ev) < 0)
 				{
-kDebug(KARES_DEBUG) << "Loading" << id;
 					ModifiedMap::ConstIterator mit = oldLastModified.constFind(id);
 					if (mit != oldLastModified.constEnd()  &&  mit.value() == readLastModified(fileName))
 					{
@@ -367,6 +370,12 @@
 
 bool KAResourceLocalDir::doSave(bool, Incidence* incidence)
 {
+	if (mDeletedIncidences.contains(incidence))
+	{
+		mDeletedIncidences.removeAll(incidence);
+		return true;
+	}
+
 	QString id = incidence->uid();
 	QString fileName = mURL.path() + '/' + id;
 	kDebug(KARES_DEBUG) << fileName;
@@ -404,6 +413,8 @@
 	clearChange(event);
 	disableChangeNotification();    // don't record this deletion as pending
 	bool success = calendar()->deleteEvent(event);
+	if (success)
+		mDeletedIncidences.append(event);
 	enableChangeNotification();
 	return success;
 }
Index: kalarm/resources/resourcelocalwidget.cpp
===================================================================
--- kalarm/resources/resourcelocalwidget.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kalarm/resources/resourcelocalwidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -40,6 +40,7 @@
 	QLabel* label = new QLabel(i18nc("@label:textbox", "Location:"), this);
 	layout->addWidget(label, 1, 0);
 	mURL = new KUrlRequester(this);
+	mURL->setFilter(QString::fromLatin1("*.vcs *.ics|%1").arg(i18nc("@info/plain", "Calendar Files")));
 	layout->addWidget(mURL, 1, 1);
 }
 
Index: kalarm/resources/resourcelocaldir.h
===================================================================
--- kalarm/resources/resourcelocaldir.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kalarm/resources/resourcelocaldir.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -1,7 +1,7 @@
 /*
  *  resourcelocaldir.h  -  KAlarm local directory alarm calendar resource
  *  Program:  kalarm
- *  Copyright © 2006-2008 by David Jarvie <djarvie@kde.org>
+ *  Copyright © 2006-2009 by David Jarvie <djarvie@kde.org>
  *  Based on resourcelocaldir.h in libkcal,
  *  Copyright (c) 2003 Cornelius Schumacher <schumacher@kde.org>
  *
@@ -25,12 +25,13 @@
 
 /* @file resourcelocaldir.h - KAlarm local directory alarm calendar resource */
 
-#include <QMap>
+#include "alarmresource.h"
+
 #include <kurl.h>
 #include <kdirwatch.h>
+#include <QMap>
+#include <QList>
 
-#include "alarmresource.h"
-
 namespace KCal {
     class Incidence;
 }
@@ -94,6 +95,7 @@
 		KDirWatch   mDirWatch;
 		typedef QMap<QString, QDateTime> ModifiedMap;
 		ModifiedMap mLastModified;
+		QList<KCal::Incidence*> mDeletedIncidences;
 		bool        mDirReadOnly;  // directory is read-only
 };
 
Index: kalarm/resources/alarmresources.cpp
===================================================================
--- kalarm/resources/alarmresources.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kalarm/resources/alarmresources.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -458,9 +458,13 @@
 
 void AlarmResources::remap(AlarmResource* resource)
 {
-	for (ResourceMap::Iterator it = mResourceMap.begin();  it != mResourceMap.end();  ++it)
+	for (ResourceMap::Iterator it = mResourceMap.begin();  it != mResourceMap.end();  )
+	{
 		if (it.value() == resource)
-			mResourceMap.erase(it);
+			it = mResourceMap.erase(it);
+		else
+			++it;
+	}
 	Event::List events = resource->rawEvents();
 	for (int i = 0, end = events.count();  i < end;  ++i)
 		mResourceMap[events[i]] = resource;
Index: kalarm/resources/kalarm_manager.desktop
===================================================================
--- kalarm/resources/kalarm_manager.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kalarm/resources/kalarm_manager.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -18,6 +18,7 @@
 Name[kk]=Ескертулер
 Name[km]=ជូន​ដំណឹង
 Name[ko]=알람
+Name[lt]=Priminimai
 Name[lv]=Atgādinājumi
 Name[nb]=Varslinger
 Name[ne]=संसूचक
Index: kalarm/editdlg.cpp
===================================================================
--- kalarm/editdlg.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kalarm/editdlg.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -150,6 +150,7 @@
 	  mTemplate(Template),
 	  mDesiredReadOnly(false),
 	  mReadOnly(false),
+	  mShowingMore(true),
 	  mSavedEvent(0)
 {
 	init(0, getResource);
@@ -172,6 +173,7 @@
 	  mTemplate(Template),
 	  mDesiredReadOnly(readOnly),
 	  mReadOnly(readOnly),
+	  mShowingMore(true),
 	  mSavedEvent(0)
 {
 	init(event, getResource);
Index: kalarm/traywindow.h
===================================================================
--- kalarm/traywindow.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kalarm/traywindow.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -1,7 +1,7 @@
 /*
  *  traywindow.h  -  the KDE system tray applet
  *  Program:  kalarm
- *  Copyright © 2002-2008 by David Jarvie <djarvie@kde.org>
+ *  Copyright © 2002-2009 by David Jarvie <djarvie@kde.org>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -45,9 +45,6 @@
 		MainWindow*  assocMainWindow() const               { return mAssocMainWindow; }
 		void         setAssocMainWindow(MainWindow* win)   { mAssocMainWindow = win; }
 
-	public slots:
-		void         slotQuit();
-
 	signals:
 		void         deleted();
 
@@ -63,6 +60,7 @@
 		void         slotPreferences();
 		void         setEnabledStatus(bool status);
 		void         slotResourceStatusChanged();
+		void         slotQuit();
 
 	private:
 		QString      tooltipAlarmText() const;
Index: kalarm/traywindow.cpp
===================================================================
--- kalarm/traywindow.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kalarm/traywindow.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -39,6 +39,7 @@
 #include <QToolTip>
 #include <QMouseEvent>
 #include <QList>
+#include <QTimer>
 
 #include <kactioncollection.h>
 #include <ktoggleaction.h>
@@ -108,7 +109,10 @@
 	// Replace the default handler for the Quit context menu item
 	const char* quitName = KStandardAction::name(KStandardAction::Quit);
 	delete actions->action(quitName);
-	KStandardAction::quit(this, SLOT(slotQuit()), actions);
+	// Quit only once the event loop is called; otherwise, the parent tray icon
+	// will be deleted while still processing the action, resulting in a crash.
+	a = KStandardAction::quit(0, 0, actions);
+	connect(a, SIGNAL(triggered(bool)), SLOT(slotQuit()), Qt::QueuedConnection);
 
 	// Set icon to correspond with the alarms enabled menu status
 	setEnabledStatus(theApp()->alarmsEnabled());
@@ -163,6 +167,9 @@
 
 /******************************************************************************
 * Called when the Quit context menu item is selected.
+* Note that this must be called by the event loop, not directly from the menu
+* item, since otherwise the tray icon will be deleted while still processing
+* the menu, resulting in a crash.
 */
 void TrayWindow::slotQuit()
 {
Index: Mainpage.dox
===================================================================
--- Mainpage.dox	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ Mainpage.dox	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -30,8 +30,6 @@
         * - <a href="kmail/html/index.html"><b>kmail</b></a>
         *   (<a href="kmail/html/classes.html">classes</a>)\n
         *   <i>A fully-featured email client.</i>
-        * - <a href="kmobiletools/html/index.html"><b>kmobiletools</b></a>
-        *   (<a href="kmobiletools/html/classes.html">classes</a>)\n
         *   <i>An application specially designed to manage mobile phones.</i>
         * - <a href="knode/html/index.html"><b>knode</b></a>
         *   (<a href="knode/html/classes.html">classes</a>)\n
Index: kaddressbook/printing/kabentrypainter.cpp
===================================================================
--- kaddressbook/printing/kabentrypainter.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kaddressbook/printing/kabentrypainter.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -220,8 +220,10 @@
   y += fmBody.lineSpacing() / 2;
 
   painter->setPen( mForegroundColor );
-  if ( !addr.prefix().isEmpty() ) {
-    line1 = addr.prefix().trimmed();
+  // This used to be addr.prefix(), but that makes no sense, it's part of the formattedName already.
+  // The role, OTOH, can be useful. E.g. formattedName="Dr Foo Bar", role="Dentist"                 
+  if ( !addr.role().isEmpty() ) {                                                                   
+    const QString line1 = addr.role().trimmed();                                                    
 
     if ( fake ) {
       rect = painter->boundingRect( Ruler1, y, Width-Ruler1, Height,
Index: kaddressbook/printing/detailledstyle.cpp
===================================================================
--- kaddressbook/printing/detailledstyle.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kaddressbook/printing/detailledstyle.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -215,7 +215,6 @@
 
   QPrinter *printer = wizard()->printer();
 
-  QPainter painter;
   progress->addMessage( i18n( "Setting up margins and spacing" ) );
   int marginTop = 0,
       marginLeft = 64, // to allow stapling, need refinement with two-side prints
@@ -224,15 +223,14 @@
 
   register int left, top, width, height;
 
-  painter.begin( printer );
-  printer->setFullPage( true ); // use whole page
+  QPainter painter( printer );
 
-
-  left = qMax( printer->paperRect().left() - printer->pageRect().left(), marginLeft );
-  top = qMax( printer->paperRect().top() - printer->pageRect().top(), marginTop );
+  left = qMax( printer->pageRect().left() - printer->paperRect().left(), marginLeft );
+  top = qMax( printer->pageRect().top() - printer->paperRect().top(), marginTop );
   width = printer->width() - left - qMax( printer->paperRect().right() - printer->pageRect().right(), marginRight );
   height = printer->height() - top - qMax( printer->paperRect().bottom() - printer->pageRect().bottom(), marginBottom );
 
+  printer->setFullPage( true ); // use whole page
   painter.setViewport( left, top, width, height );
   progress->addMessage( i18n( "Printing" ) );
 
@@ -240,7 +238,6 @@
                 QRect( 0, 0, printer->width(), printer->height() ) );
 
   progress->addMessage( i18n( "Done" ) );
-  painter.end();
 
   config.sync();
 }
Index: kaddressbook/xxport/vcard_xxport.desktop
===================================================================
--- kaddressbook/xxport/vcard_xxport.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kaddressbook/xxport/vcard_xxport.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -30,7 +30,7 @@
 Name[lt]=KAB vCard XXPort priedas
 Name[lv]=KAB vCard XXPort spraudnis
 Name[ms]=Plugin KAB vCard XXPort 
-Name[nb]=KAB-programtillegg for vCard
+Name[nb]=KAB-programtillegg for vCard XXPort
 Name[nds]=vCard-Im-/Exportmoduul för KAdressbook
 Name[ne]=KAB भीकार्ड XXPort प्लगइन
 Name[nl]=KAB vCard XXPort-plugin
Index: kaddressbook/xxport/pab_xxport.desktop
===================================================================
--- kaddressbook/xxport/pab_xxport.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kaddressbook/xxport/pab_xxport.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -27,7 +27,7 @@
 Name[lt]=KAB MS Exchange asmeninės adresų knygelės XXPort priedas
 Name[lv]=KAB MS Exchange personīgo adrešu grāmatu XXPort spraudnis
 Name[ms]=Plugin Buku Alamat Peribadi KAB MS Exchange  XXPort Plugin
-Name[nb]=KAB-programtillegg for import fra MS Exchange
+Name[nb]=KAB-programtillegg for import fra MS Exchange XXPort personlig adressebok
 Name[nds]=MSExchange-Importmoduul för KAdressbook
 Name[ne]=KAB MS विनिमय व्यक्तिगत ठेगाना पुस्तिका XXPort प्लगइन
 Name[nl]=KAB MS Exchange Personal Addressbook XXPort-plugin
Index: kaddressbook/editors/cryptosettings.desktop
===================================================================
--- kaddressbook/editors/cryptosettings.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kaddressbook/editors/cryptosettings.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -7,7 +7,7 @@
 Name[ca]=Preferències de criptografia
 Name[cs]=Nastavení šifrování
 Name[da]=Krypto-indstillinger
-Name[de]=Kryptographie-Einstellungen
+Name[de]=Kryptografie-Einstellungen
 Name[el]=Προτιμήσεις κρυπτογραφίας
 Name[eo]=Agordoj pri Ĉifrado
 Name[es]=Preferencias de cifrado
Index: CMakeLists.txt
===================================================================
--- CMakeLists.txt	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ CMakeLists.txt	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -89,15 +89,6 @@
     macro_log_feature(X11_Xscreensaver_FOUND "X11 screensaver extension" "X Window Screen Saver Development Library" "http://xorg.freedesktop.org" FALSE "" "Required for building the KTimeTracker Program")
   endif(X11_FOUND)
 
-# uncomment the following block for 4.3 in order to enable kitchensync
-#  if (NOT WIN32)
-#     set(OPENSYNC_MIN_VERSION 0.38)
-#     macro_optional_find_package(OpenSync)
-#     macro_log_feature(OPENSYNC_FOUND "opensync" "OpenSync Development Libraries" "http://www.opensync.org" FALSE "0.38 or greater" "Needed to provide syncing functionality in KDE PIM applications. Necessary to compile kitchensync.")
-#     macro_optional_find_package(GLIB2)
-#     macro_log_feature(GLIB2_FOUND "glib2" "Low-level core library for data structure handling, portability wrappers, etc." "http://www.gtk.org" FALSE "2.x" "Needed to provide synching applications from KDE PIM applications. Necessary to compile kitchensync and other PIM applications.")
-#  endif (NOT WIN32)
-
   macro_optional_find_package(GNOKII)
   macro_bool_to_01(GNOKII_FOUND HAVE_GNOKII_H)
   macro_log_feature(GNOKII_FOUND "gnokii" "Gnokii Development Libraries" "http://www.gnokii.org" FALSE "" "Needed to provide the ability to import and export KDE addressbook entries to/from mobile phones that are accessible via gnokii")
@@ -219,43 +210,15 @@
   endif(KMAIL_SUPPORTED)
 
   if(NOT WIN32)
-#enable kmobiletools 4.3 if there is interest
-#     set(KMOBILETOOLS_SUPPORTED TRUE)
-#     add_definitions(-DKMOBILETOOLS_SUPPORTED)
-#     message(STATUS "KMobileTools support enabled.")
-#     macro_optional_add_subdirectory(kmobiletools)
-      set(KMOBILETOOLS_SUPPORTED FALSE)
-
      set(KPILOT_SUPPORTED TRUE)
      add_definitions(-DKPILOT_SUPPORTED)
      message(STATUS "KPilot support enabled.")
      macro_optional_add_subdirectory(kpilot)
-
-     if(OPENSYNC_FOUND AND GLIB2_FOUND)
-       set(KITCHENSYNC_SUPPORTED TRUE)
-       add_definitions(-DKITCHENSYNC_SUPPORTED)
-       message(STATUS "KitchenSync support enabled.")
-       macro_optional_add_subdirectory(kitchensync)
-     else(OPENSYNC_FOUND AND GLIB2_FOUND)
-       set(KITCHENSYNC_SUPPORTED FALSE)
-       if(NOT OPENSYNC_FOUND)
-         message(STATUS "KitchenSync support disabled (OpenSync not found).")
-       endif(NOT OPENSYNC_FOUND)
-       if(NOT GLIB2_FOUND)
-         message(STATUS "KitchenSync support disabled (GLIB not found).")
-       endif(NOT GLIB2_FOUND)
-     endif(OPENSYNC_FOUND AND GLIB2_FOUND)
   else(NOT WIN32)
-     set(KMOBILETOOLS_SUPPORTED FALSE)
-     message(STATUS "KMobileTools support DISABLED (Windows target).")
      set(KPILOT_SUPPORTED FALSE)
      message(STATUS "KPilot support DISABLED (Windows target).")
-     set(KITCHENSYNC_SUPPORTED FALSE)
-     message(STATUS "KitchenSync support DISABLED (Windows target).")
   endif(NOT WIN32)
 
-#enable korn in 4.3 if there is interest
-# macro_optional_add_subdirectory(korn)
   add_subdirectory(kresources)
   macro_optional_add_subdirectory(kontact)
 
Index: libkholidays/holidays/holiday_se
===================================================================
--- libkholidays/holidays/holiday_se	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ libkholidays/holidays/holiday_se	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -23,8 +23,8 @@
 :Before 2005
 :black "Nationaldagen" black on 6.6
 weekend "Nationaldagen" weekend on 6.6
-black "Midsommarafton" black on friday before 26.6
-weekend "Midsommardagen" weekend on saturday before 27.6
+black "Midsommarafton" black on friday before 25.6
+weekend "Midsommardagen" weekend on saturday before 26.6
 blue "Vintertid" on last sunday in october
 weekend "Alla helgons dag" weekend on first sunday in november minus 1
 black "1. Advent" on sunday before 24.12 minus 21 days
Index: ktimetracker/timetrackerwidget.cpp
===================================================================
--- ktimetracker/timetrackerwidget.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ ktimetracker/timetrackerwidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -692,6 +692,7 @@
   dialog->addPage( storagePage, i18n( "Storage" ), "system-file-manager" );
 
   dialog->exec();
+  delete dialog;
   showSearchBar( !KTimeTrackerSettings::configPDA() );
   reconfigureFiles();
 }
Index: ktimetracker/kcmconfigs/ktimetrackerconfig.desktop
===================================================================
--- ktimetracker/kcmconfigs/ktimetrackerconfig.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ ktimetracker/kcmconfigs/ktimetrackerconfig.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -35,7 +35,7 @@
 Comment[ko]=KTimeTracker 설정
 Comment[lt]=Konfigūruoti ktimetracker
 Comment[lv]=Konfigurēt ktimetracker
-Comment[nb]=Oppsett for ktimettracker
+Comment[nb]=Oppsett for ktimetracker
 Comment[nds]=Tietlogbook instellen
 Comment[nl]=KTimeTracker instellen
 Comment[nn]=Set opp KTidtakar
Index: kjots/Kjots.desktop
===================================================================
--- kjots/Kjots.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kjots/Kjots.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -20,7 +20,7 @@
 GenericName[ja]=メモ帳
 GenericName[km]=កម្មវិធី​ទទួល​ចំណាំ
 GenericName[ko]=메모장
-GenericName[lt]=Pastabų gavėjas
+GenericName[lt]=Konspektavimo įrankis
 GenericName[lv]=Piezīmju blociņš
 GenericName[nb]=Notisblokk
 GenericName[nds]=Notizenprogramm
Index: kjots/kjotspart.desktop
===================================================================
--- kjots/kjotspart.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kjots/kjotspart.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -1,5 +1,6 @@
 [Desktop Entry]
 Name=KJotsPart
+Name[lt]=KJots dalis
 Name[nn]=KJots-del
 Name[pa]=ਕੇਜੋਟਸਪਾਰਟ
 Name[pl]=Moduł Notatek
Index: README
===================================================================
--- README	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ README	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -22,7 +22,6 @@
 * kaddressbook: The KDE addressbook application.
 * kmail: the KDE mail client
 * kmailcvt: tool for importing mail related data from other programs
-* kmobiletools: an application specially designed to manage mobile phones
 * knode: UseNet client
 * korganizer: a calendar-of-events, todo-list manager, journal 
 * kalarm: gui for setting up personal alarm messages, emails and commands
@@ -33,7 +32,6 @@
 * kfile-plugins: vCard KFIleItem plugin.
 * knotes: yellow notes application
 * konsolekalendar: Command line tool for accessing calendar files.
-* korn: mail checker
 * akregator: Feed reader
 * kjots: manager for several "books" with a subject and notes
 
Index: libkdepim/utils.cpp
===================================================================
--- libkdepim/utils.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ libkdepim/utils.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -57,7 +57,7 @@
 
 static PPERF_INSTANCE_DEFINITION NextInstance( PPERF_INSTANCE_DEFINITION PerfInst )
 {
-  PPERF_COUNTER_BLOCK PerfCntrBlk 
+  PPERF_COUNTER_BLOCK PerfCntrBlk
     = (PPERF_COUNTER_BLOCK)((PBYTE)PerfInst + PerfInst->ByteLength);
   return (PPERF_INSTANCE_DEFINITION)((PBYTE)PerfCntrBlk + PerfCntrBlk->ByteLength);
 }
@@ -110,6 +110,7 @@
 
   // Get the first object type.
   perfObject = FirstObject( perfData );
+  if ( !perfObject ) return;
 
   // Process all objects.
   for( uint i = 0; i < perfData->NumObjectTypes; i++ ) {
@@ -124,7 +125,7 @@
     qDebug() << "INSTANCES: " << perfObject->NumInstances;
     for( int instance = 0; instance < perfObject->NumInstances; instance++ ) {
       curCounter = perfCounter;
-      const QString foundProcessName( 
+      const QString foundProcessName(
         fromWChar( (wchar_t *)( (PBYTE)perfInstance + perfInstance->NameOffset ) ) );
       qDebug() << "foundProcessName: " << foundProcessName;
       if ( foundProcessName == processName ) {
Index: kpilot/Messages.sh
===================================================================
--- kpilot/Messages.sh	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kpilot/Messages.sh	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -1,2 +1,3 @@
 #! /usr/bin/env bash
+$EXTRACTRC `find . -name \*.rc -o -name \*.ui -o -name \*.kcfg` >> rc.cpp
 $XGETTEXT `find . -name \*.cc -o -name \*.cpp -o -name \*.h` -o $podir/kpilot.pot
Index: kpilot/conduits/notepadconduit/notepad-conduit.desktop
===================================================================
--- kpilot/conduits/notepadconduit/notepad-conduit.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kpilot/conduits/notepadconduit/notepad-conduit.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -47,7 +47,7 @@
 Comment[lt]=Šis kanalas padaro NotePad piešinių atsargines kopijas į vietinį aplanką.
 Comment[lv]=Šī ķēde saglabā piezīmju zīmējumu rezerves kopijas datora mapē.
 Comment[ms]=Saluran ini menyandarkan lukisan NotePad ke folder setempat.
-Comment[nb]=Denne kanalen tar sikkerhetskopi av NotePad tegninger til en lokal mappe.
+Comment[nb]=Denne koblingen tar sikkerhetskopi av NotePad tegninger til en lokal mappe.
 Comment[nds]=Sekert NotePad-Teken binnen en lokaal Orner.
 Comment[ne]=यो कन्ड्युटले स्थानीय फाइलमा नोटप्याड रेखाचित्र ब्याकअप गर्छ ।
 Comment[nl]=Dit conduit maakt een backup van de notitie-aantekeningen naar een lokale map.
Index: kpilot/conduits/sysinfoconduit/sysinfo_conduit.desktop
===================================================================
--- kpilot/conduits/sysinfoconduit/sysinfo_conduit.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kpilot/conduits/sysinfoconduit/sysinfo_conduit.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -26,7 +26,7 @@
 Comment[lt]=Šis kanalas įrašo informaciją apie Jūsų delninuką ir sinchronizavimą į failą.
 Comment[lv]=Šī ķēde ieraksta failā informācijau par jūsu pārnēsājamo ierīci un tās sinhronizāciju.
 Comment[ms]=Saluran ini menulis maklumat tentang komputer telapak dan segerakan ke fail.
-Comment[nb]=Denne kanalen skriver informasjon om hånddatoren og synkroniseringen til en fil.
+Comment[nb]=Denne koblingen skriver informasjon om hånddatoren og synkroniseringen til en fil.
 Comment[nds]=De Kanaal schrifft Informatschonen över den Handreekner un de Synkroniseren na en Datei.
 Comment[ne]=यो कन्ड्युटले ह्यान्डहेल्ड बारेमा सूचना लेख्दछ र फाइलमा समक्रमण गर्दछ ।
 Comment[nl]=Dit conduit slaat informatie over uw handheld en de synchronisatie op in een bestand.
Index: kpilot/conduits/memofileconduit/memofile-conduit.desktop
===================================================================
--- kpilot/conduits/memofileconduit/memofile-conduit.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kpilot/conduits/memofileconduit/memofile-conduit.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -5,7 +5,7 @@
 Name[ca]=Fitxer de notes
 Name[cs]=Soubor s poznámkou
 Name[da]=Memo-fil
-Name[de]=Memo Datei
+Name[de]=Notizdatei
 Name[el]=Αρχείο υπομνήματος
 Name[eo]=Memo-dosiero
 Name[es]=Archivo Memo
@@ -53,7 +53,7 @@
 Comment[ca]=Aquest conducte sincronitza les notes de l'agenda electrònica amb un directori local.
 Comment[cs]=Toto propojení synchronizuje vaše poznámky v PDA s lokálním adresářem.
 Comment[da]=Denne kanal synkroniserer dine håndholdte memoer med en lokal mappe.
-Comment[de]=Abgleich der Memos von Taschencomputer und einem lokalen Ordner
+Comment[de]=Abgleich der Notizen von Taschencomputer und einem lokalen Ordner
 Comment[el]=Αυτός ο σύνδεσμος συγχρονίζει τα υπομνήματα του υπολογιστή παλάμης σας με έναν τοπικό κατάλογο.
 Comment[eo]=Tiu kanalo sinkronigas viajn poŝkomputil-memoojn kun loka dosierujo.
 Comment[es]=Este conducto sincroniza las memos de la agenda electrónica con un directorio local.
@@ -74,7 +74,7 @@
 Comment[lt]=Šis kanalas sinchronizuoja Jūsų užrašus su vietiniu aplanku.
 Comment[lv]=Šī ķēde sinhronizē jūsu rokas datora piezīmes ar mapi datorā.
 Comment[ms]=Saluran ini mensegerakkan memo komputer telapak anda dengan direktori setempat.
-Comment[nb]=Denne kanalen synkroniserer hånddatorens notater med en lokal mappe.
+Comment[nb]=Denne koblingen synkroniserer hånddatorens notater med en lokal mappe.
 Comment[nds]=Synkroniseert de Notizen op den Handreekner mit en lokaal Orner.
 Comment[ne]=यो कन्ड्युटले स्थानीय डाइरेक्टरीमा तपाईँका ह्यान्डहेल्ड मेमो समक्रमण गर्दछ ।
 Comment[nl]=Dit conduit synchroniseert de memo's van uw handheld met een lokale map.
Index: kpilot/conduits/timeconduit/time_conduit.desktop
===================================================================
--- kpilot/conduits/timeconduit/time_conduit.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kpilot/conduits/timeconduit/time_conduit.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -29,7 +29,7 @@
 Comment[lv]=Šī ķēde uzstāda jūsu rokas datora pulksteni, izmantojot datora pulksteni.
 Comment[mk]=Овој канал го поставува времето на рачниот уред според времето на компјутерот.
 Comment[ms]=Saluran ini mengeset waktu pada komputer telapak anda dari jam PC.
-Comment[nb]=Denne kanalen stiller klokka på hånddatoren fra PC-klokka.
+Comment[nb]=Denne koblingen stiller klokka på hånddatoren fra PC-klokka.
 Comment[nds]=Synkroniseert stellt Handreekner-Klock na de PC-Klock.
 Comment[ne]=यो कन्ड्युटले पीसी घडीबाट ह्यान्डहेल्डमा समय सेट गर्दछ ।
 Comment[nl]=Dit conduit stelt de tijd van uw handheld in aan de hand van de pc-klok.
Index: kpilot/conduits/memofile/kpilot-conduit-memofile.desktop
===================================================================
--- kpilot/conduits/memofile/kpilot-conduit-memofile.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kpilot/conduits/memofile/kpilot-conduit-memofile.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -5,7 +5,7 @@
 Name[ca]=Fitxer de notes
 Name[cs]=Soubor s poznámkou
 Name[da]=Memo-fil
-Name[de]=Memo Datei
+Name[de]=Notizdatei
 Name[el]=Αρχείο υπομνήματος
 Name[eo]=Memo-dosiero
 Name[es]=Archivo Memo
@@ -53,7 +53,7 @@
 Comment[ca]=Aquest conducte sincronitza les notes de l'agenda electrònica amb un directori local.
 Comment[cs]=Toto propojení synchronizuje vaše poznámky v PDA s lokálním adresářem.
 Comment[da]=Denne kanal synkroniserer dine håndholdte memoer med en lokal mappe.
-Comment[de]=Abgleich der Memos von Taschencomputer und einem lokalen Ordner
+Comment[de]=Abgleich der Notizen von Taschencomputer und einem lokalen Ordner
 Comment[el]=Αυτός ο σύνδεσμος συγχρονίζει τα υπομνήματα του υπολογιστή παλάμης σας με έναν τοπικό κατάλογο.
 Comment[eo]=Tiu kanalo sinkronigas viajn poŝkomputil-memoojn kun loka dosierujo.
 Comment[es]=Este conducto sincroniza las memos de la agenda electrónica con un directorio local.
@@ -74,7 +74,7 @@
 Comment[lt]=Šis kanalas sinchronizuoja Jūsų užrašus su vietiniu aplanku.
 Comment[lv]=Šī ķēde sinhronizē jūsu rokas datora piezīmes ar mapi datorā.
 Comment[ms]=Saluran ini mensegerakkan memo komputer telapak anda dengan direktori setempat.
-Comment[nb]=Denne kanalen synkroniserer hånddatorens notater med en lokal mappe.
+Comment[nb]=Denne koblingen synkroniserer hånddatorens notater med en lokal mappe.
 Comment[nds]=Synkroniseert de Notizen op den Handreekner mit en lokaal Orner.
 Comment[ne]=यो कन्ड्युटले स्थानीय डाइरेक्टरीमा तपाईँका ह्यान्डहेल्ड मेमो समक्रमण गर्दछ ।
 Comment[nl]=Dit conduit synchroniseert de memo's van uw handheld met een lokale map.
Index: kpilot/conduits/keyringconduit/kpilot-conduit-keyring.desktop
===================================================================
--- kpilot/conduits/keyringconduit/kpilot-conduit-keyring.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kpilot/conduits/keyringconduit/kpilot-conduit-keyring.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -15,7 +15,7 @@
 Comment[km]=conduit syncs នេះ​មូលដ្ឋាន​ទិន្នន័យ keyring របស់​ឧបករណ៍​យួរដៃ​ជា​មួយ​មូលដ្ឋាន​ទិន្នន័យ​ដែល​បាន​ផ្ទុក​នៅ​ក្នុង​កុំព្យូទ័រ ។
 Comment[lt]=Šis kanalas sinchronizuoja delninuko raktų rato duomenų bazę su duomenų baze, esančia pc.
 Comment[lv]=Šī ķēde sinhronizē jūsu rokas datora un datora atslēgu saišķi.
-Comment[nb]=Denne kanalen synkroniserer hånddatorens nøkkelring-database med en database lagret på maskinen.
+Comment[nb]=Denne koblingen synkroniserer hånddatorens nøkkelring-database med en database lagret på maskinen.
 Comment[nds]=Disse Kanaal synkroniseert dat Slötelbund op den Handreekner mit een op den Reekner.
 Comment[nl]=Dit conduit synchroniseert de sleuteldatabase op de handheld met de database op uw PC.
 Comment[nn]=Denne koplinga synkroniserer den handhaldne nøkkelringdatabasen med ein database lagra på maskina.
Index: kpilot/conduits/todo/kpilot-conduit-todo.desktop
===================================================================
--- kpilot/conduits/todo/kpilot-conduit-todo.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kpilot/conduits/todo/kpilot-conduit-todo.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -13,7 +13,7 @@
 Comment[ja]=このコンジットはハンドヘルドの To-Do データベースを Akonadi の To-Do コレクションと同期させます。
 Comment[km]=conduit syncs នេះ​ជា​មូលដ្ឋាន​ទិន្នន័យ​ការងារ​ត្រូវ​ធ្វើ​ជា​មួយ​នឹង​ការ​ប្រមូលផ្ដុំ​ការងារ​ត្រូវ​ធ្វើ​របស់ Akonadi ។
 Comment[lv]=Šī ķēde sinhronizē jūsu rokas datora darāmo darbu sarakstu ar Akonadi darbu kolekciju.
-Comment[nb]=Denne kanalen synkroniserer hånddatorens  gjøremål-database med en Akonadi gjøremålssamling.
+Comment[nb]=Denne koblingen synkroniserer hånddatorens  gjøremål-database med en Akonadi gjøremålssamling.
 Comment[nds]=Disse Kanaal synkroniseert de Handreekner-Opgavenlist mit en Akonadi-Opgavenlist.
 Comment[nl]=Dit conduit synchroniseert de takendatabase op de handheld met een Akonadi-takenverzameling.
 Comment[nn]=Denne koplinga synkroniserer den handhaldne hugselistedatabasen med ei Akonadi-hugselistesamling.
@@ -42,6 +42,7 @@
 Name[ja]=To-Do
 Name[km]=​ការងារ​ត្រូវ​ធ្វើ
 Name[ko]=할 일
+Name[lt]=Darbas
 Name[lv]=Darbi
 Name[nb]=Gjøremål
 Name[nds]=Opgaav
Index: kpilot/conduits/calendar/calendarconduit.cc
===================================================================
--- kpilot/conduits/calendar/calendarconduit.cc	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kpilot/conduits/calendar/calendarconduit.cc	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -205,6 +205,11 @@
 			}
 			else
 			{
+				// Events that end at midnight cause problems
+				// (http://bugs.kde.org/show_bug.cgi?id=183631); however, events with
+				// no time associated with them are stored as beginning and ending
+				// at midnight on the same day, and these are OK.  Other events that end at
+				// midnight will need to be adjusted.
 				QDateTime hhDtEnd = hhEntry.dtEnd();
 				QDateTime hhDtStart = hhEntry.dtStart();
 				QDateTime pcDtEnd = pcEvent->dtEnd().dateTime().toLocalTime();
Index: kpilot/conduits/null/null-conduit.desktop
===================================================================
--- kpilot/conduits/null/null-conduit.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kpilot/conduits/null/null-conduit.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -43,7 +43,7 @@
 Comment[lv]=Šī ķēde nedara neko.
 Comment[mk]=Овој канал не прави ништо.
 Comment[ms]=Saluran ini tidak berbuat apa-apa.
-Comment[nb]=Denne kanalen gjør ingenting.
+Comment[nb]=Denne koblingen gjør ingenting.
 Comment[nds]=Disse Kanaal deit gor nix.
 Comment[ne]=यो कन्ड्युटले केही पनि गर्दैन ।
 Comment[nl]=Dit conduit doet niets.
Index: kpilot/conduits/contacts/kpilot-conduit-contacts.desktop
===================================================================
--- kpilot/conduits/contacts/kpilot-conduit-contacts.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kpilot/conduits/contacts/kpilot-conduit-contacts.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -14,7 +14,7 @@
 Comment[ja]=このコンジットはハンドヘルドのアドレス帳データベースを Akonadi のコレクションと同期させます。
 Comment[km]=conduit syncs នេះ​ជា​មូលដ្ឋាន​​សៀវភៅ​អាសយដ្ឋាន​ឧបករណ៍​​​យួរដៃ​ដែល​មាន​បណ្ដុំ Akonadi ។
 Comment[lv]=Šī ķēde sinhronizē jūsu rokas datora adrešu grāmatu ar Akonadi kolekciju.
-Comment[nb]=Denne kanalen synkroniserer hånddatorens adressebok-database med en Akonadi-samling.
+Comment[nb]=Denne koblingen synkroniserer hånddatorens adressebok-database med en Akonadi-samling.
 Comment[nds]=Disse Kanaal synkroniseert dat Handreekner-Adressbook mit en Akonadi-Sammeln.
 Comment[nl]=Dit conduit synchroniseert de adresboekdatabase op de handheld met eenAkonadi-verzameling.
 Comment[nn]=Denne koplinga synkroniserer den handhaldne adressedatabasen med ei Akonadi-samling.
Index: kpilot/kpilot/kpilotconduit.desktop
===================================================================
--- kpilot/kpilot/kpilotconduit.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kpilot/kpilot/kpilotconduit.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -31,7 +31,7 @@
 Comment[lv]=KPilot ķēde
 Comment[mk]=Канал за КПилот
 Comment[ms]=Saluran KPilot 
-Comment[nb]=KPilot-kanal
+Comment[nb]=KPilot-kobling
 Comment[nds]=KPilot-Kanaal (Synkroniseren)
 Comment[ne]=केडीई पाइलट कन्ड्युट
 Comment[nn]=KPilot-kopling
Index: kpilot/kpilot/config_dialog.cc
===================================================================
--- kpilot/kpilot/config_dialog.cc	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kpilot/kpilot/config_dialog.cc	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -452,7 +452,7 @@
 			return;
 		}
 
-        WARNINGKPILOT << "library: " << libraryName << " version: " << loader.pluginVersion();
+        DEBUGKPILOT << "library: " << libraryName << " version: " << loader.pluginVersion();
 		if (Pilot::PLUGIN_API > loader.pluginVersion())
 		{
 			WARNINGKPILOT << "Old conduit library found.";
Index: kpilot/Documentation/base-conduit-template/kpilot-conduit-contacts.desktop
===================================================================
--- kpilot/Documentation/base-conduit-template/kpilot-conduit-contacts.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kpilot/Documentation/base-conduit-template/kpilot-conduit-contacts.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -15,7 +15,7 @@
 Comment[km]=conduit syncs នេះ​មូលដ្ឋាន​ទិន្នន័យ keyring របស់​ឧបករណ៍​យួរដៃ​ជា​មួយ​មូលដ្ឋាន​ទិន្នន័យ​ដែល​បាន​ផ្ទុក​នៅ​ក្នុង​កុំព្យូទ័រ ។
 Comment[lt]=Šis kanalas sinchronizuoja delninuko raktų rato duomenų bazę su duomenų baze, esančia pc.
 Comment[lv]=Šī ķēde sinhronizē jūsu rokas datora un datora atslēgu saišķi.
-Comment[nb]=Denne kanalen synkroniserer hånddatorens nøkkelring-database med en database lagret på maskinen.
+Comment[nb]=Denne koblingen synkroniserer hånddatorens nøkkelring-database med en database lagret på maskinen.
 Comment[nds]=Disse Kanaal synkroniseert dat Slötelbund op den Handreekner mit een op den Reekner.
 Comment[nl]=Dit conduit synchroniseert de sleuteldatabase op de handheld met de database op uw PC.
 Comment[nn]=Denne koplinga synkroniserer den handhaldne nøkkelringdatabasen med ein database lagra på maskina.
Index: kpilot/Documentation/base-conduit-template/contacts-conduit.desktop
===================================================================
--- kpilot/Documentation/base-conduit-template/contacts-conduit.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kpilot/Documentation/base-conduit-template/contacts-conduit.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -14,7 +14,7 @@
 Comment[ja]=このコンジットはハンドヘルドのアドレス帳を PC のデータベースと同期させます。
 Comment[km]=conduit syncs នេះ​ជា​សៀវភៅ​អាសយដ្ឋាន​ដែល​មាន​ទិន្នន័យ​បាន​ផ្ទុក​នៅ​ក្នុង​កុំព្យូទ័រ ។
 Comment[lv]=Šī ķēde sinhronizē jūsu rokas datora un datora adrešu grāmatu.
-Comment[nb]=Denne kanalen synkroniserer hånddatorens adressebok med en database lagret på PC-en.
+Comment[nb]=Denne koblingen synkroniserer hånddatorens adressebok med en database lagret på PC-en.
 Comment[nds]=Disse Kanaal synkroniseert dat Adressbook op den Handreekner mit een op den Reekner.
 Comment[nl]=Dit conduit synchroniseert het adresboek op de handheld met de database op uw PC.
 Comment[nn]=Denne koplinga synkroniserer den handhaldne adresseboka med ein database lagra på maskina.
Index: kontact/plugins/akregator/akregator.setdlg
===================================================================
--- kontact/plugins/akregator/akregator.setdlg	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/akregator/akregator.setdlg	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -66,6 +66,7 @@
 Comment[ja]=フィードリーダー
 Comment[km]=កម្មវិធី​អាន​មតិព័ត៌មាន
 Comment[ko]=피드 리더
+Comment[lt]=Kanalų skaitytuvė
 Comment[lv]=Ziņu lasītājs
 Comment[nb]=Kildeleser
 Comment[nds]=Mellenstroom-Kieker
Index: kontact/plugins/planner/planner.setdlg
===================================================================
--- kontact/plugins/planner/planner.setdlg	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/planner/planner.setdlg	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -12,6 +12,7 @@
 Name[ja]=スケジュール帳
 Name[km]=កម្មវិធីធ្វើ​គម្រោង
 Name[ko]=플래너
+Name[lt]=Planuoklis
 Name[lv]=Plānotājs
 Name[nb]=Planlegger
 Name[nn]=Planleggjar
@@ -41,6 +42,7 @@
 Comment[ja]=スケジュール帳の要約
 Comment[km]=សេចក្ដី​សង្ខេប​របស់​កម្មវិធីធ្វើ​គម្រោង
 Comment[ko]=플래너 요약
+Comment[lt]=Planuoklio santrauka
 Comment[lv]=Plānotāja kopsavilkums
 Comment[nb]=Planlegger-aammendrag
 Comment[nds]=Planer-Översicht
Index: kontact/plugins/planner/kcmplanner.desktop
===================================================================
--- kontact/plugins/planner/kcmplanner.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/planner/kcmplanner.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -24,6 +24,7 @@
 Name[ja]=スケジュール帳
 Name[km]=កម្មវិធីធ្វើ​គម្រោង
 Name[ko]=플래너
+Name[lt]=Planuoklis
 Name[lv]=Plānotājs
 Name[nb]=Planlegger
 Name[nn]=Planleggjar
@@ -53,6 +54,7 @@
 Comment[ja]=スケジュール帳の設定
 Comment[km]=កា​ររៀបចំ​កម្មវិធី​ធ្វើ​គម្រោង
 Comment[ko]=플래너 설정
+Comment[lt]=Planuoklio nustatymai
 Comment[lv]=Plānotāja iestatījumi
 Comment[nb]=Planlegger-oppsett
 Comment[nds]=Planner inrichten
Index: kontact/plugins/planner/plannerplugin.desktop
===================================================================
--- kontact/plugins/planner/plannerplugin.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/planner/plannerplugin.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -26,6 +26,7 @@
 Name[ja]=スケジュール帳
 Name[km]=កម្មវិធីធ្វើ​គម្រោង
 Name[ko]=플래너
+Name[lt]=Planuoklis
 Name[lv]=Plānotājs
 Name[nb]=Planlegger
 Name[nn]=Planleggjar
@@ -55,6 +56,7 @@
 Comment[ja]=スケジュール帳プラグイン
 Comment[km]=កម្មវិធី​ជំនួយ​​របស់​កម្មវិធី​ធ្វើ​គម្រោង
 Comment[ko]=플래너 플러그인
+Comment[lt]=Planuoklio priedas
 Comment[lv]=Plānotāja spraudnis
 Comment[nb]=Planlegger-programtillegg
 Comment[nds]=Planner-Moduul
Index: kontact/plugins/knode/knode.setdlg
===================================================================
--- kontact/plugins/knode/knode.setdlg	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/knode/knode.setdlg	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -24,6 +24,7 @@
 Comment[kk]=Пошта компоненті
 Comment[km]=មាសភាគ​របស់ Usenet
 Comment[ko]=유즈넷 구성 요소
+Comment[lt]=Usenet komponentas
 Comment[lv]=Usenet komponente
 Comment[nb]=Usenet-komponent
 Comment[nds]=Usenet-Komponent
Index: kontact/plugins/specialdates/kcmsdsummary.desktop
===================================================================
--- kontact/plugins/specialdates/kcmsdsummary.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/specialdates/kcmsdsummary.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -30,6 +30,7 @@
 Name[kk]=Болашақ ерекше күндер
 Name[km]=កាលបរិច្ឆេទ​ពិសេស​ដែលនឹង​កើត​ឡើង
 Name[ko]=다가오는 기념일
+Name[lt]=Artėjančios ypatingos datos
 Name[lv]=Gaidāmie īpašie datumi
 Name[nb]=Kommende spesielle datoer
 Name[nds]=Anstahn besünner Daag
@@ -68,6 +69,7 @@
 Comment[kk]=Болашақ ерекше күндер тұжырымының баптау
 Comment[km]=ការ​រៀបចំ​សេចក្ដី​សង្ខេប​កាលបរិច្ឆេទ​ពិសេស​ដែល​នឹង​កើតឡើង
 Comment[ko]=다가오는 기념일 요약 설정
+Comment[lt]=Artėjančių ypatingų datų santraukos sąranka
 Comment[lv]=Gaidāmo īpašo datumu kopsavilkuma iestatījumi
 Comment[nb]=Sammendragsoppsett for kommende spesielle datoer
 Comment[nds]=De Översicht för anstahn besünner Daten instellen
Index: kontact/plugins/kmobiletools/kmobiletools.setdlg
===================================================================
--- kontact/plugins/kmobiletools/kmobiletools.setdlg	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/kmobiletools/kmobiletools.setdlg	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -16,6 +16,7 @@
 Name[ja]=携帯電話
 Name[km]=ទូរស័ព្ទ​ចល័ត
 Name[ko]=휴대폰
+Name[lt]=Mobilieji telefonai
 Name[lv]=Mobilie telefoni
 Name[nb]=Mobiltelefoner
 Name[nds]=Mobiltelefonen
@@ -50,6 +51,7 @@
 Comment[ja]=携帯電話コンポーネント
 Comment[km]=សមាសភាគ​ទូរស័ព្ទ​ចល័ត
 Comment[ko]=휴대폰 구성 요소
+Comment[lt]=Mobilaus telefono komponentas
 Comment[lv]=Mobilo telefonu komponente
 Comment[nb]=Mobiltelefonkomponent
 Comment[nds]=Mobiltelefoon-Komponent
Index: kontact/plugins/kmobiletools/kmobiletools.desktop
===================================================================
--- kontact/plugins/kmobiletools/kmobiletools.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/kmobiletools/kmobiletools.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -27,6 +27,7 @@
 Comment[ja]=KMobileTools プラグイン
 Comment[km]=កម្មវិធី​ជំនួយ​របស់ KMmobileTools
 Comment[ko]=KMobileTools 플러그인
+Comment[lt]=KMobileTools priedas
 Comment[lv]=KMobileTools spraudnis
 Comment[nb]=KMobileTools programtillegg
 Comment[nds]=KMobileTools-Moduul
@@ -60,6 +61,7 @@
 Name[ja]=携帯電話
 Name[km]=ទូរស័ព្ទ​ចល័ត
 Name[ko]=휴대폰
+Name[lt]=Mobilieji telefonai
 Name[lv]=Mobilie telefoni
 Name[nb]=Mobiltelefoner
 Name[nds]=Mobiltelefonen
Index: kontact/plugins/knotes/knotes_part.h
===================================================================
--- kontact/plugins/knotes/knotes_part.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/knotes/knotes_part.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -92,6 +92,7 @@
 
     KNotesResourceManager *mManager;
     Q3Dict<KNotesIconViewItem> mNoteList;
+    QString mOldName;
 };
 
 #endif
Index: kontact/plugins/knotes/knotes.setdlg
===================================================================
--- kontact/plugins/knotes/knotes.setdlg	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/knotes/knotes.setdlg	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -14,6 +14,7 @@
 Name[ja]=ポップアップメモ
 Name[km]=ចំណាំ​លេច​ឡើង
 Name[ko]=팝업 노트
+Name[lt]=Lipnūs lapeliai
 Name[lv]=Piezīmju lapiņas
 Name[nb]=Sprettopp-notater
 Name[nds]=Opduk-Notizen
@@ -48,6 +49,7 @@
 Comment[ja]=ポップアップメモコンポーネント
 Comment[km]=សមាសភាគ​ចំណាំលេចឡើង​
 Comment[ko]=팝업 노트 구성 요소
+Comment[lt]=Lipnių lapelių komponentas
 Comment[lv]=Piezīmju lapiņu komponente
 Comment[nb]=Komponent for sprettoppnotater
 Comment[nds]=Opduknotiz-Komponent
Index: kontact/plugins/knotes/knotes_part.cpp
===================================================================
--- kontact/plugins/knotes/knotes_part.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/knotes/knotes_part.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -382,12 +382,14 @@
 
 void KNotesPart::renameNote()
 {
+  mOldName = mNotesView->currentItem()->text();
   mNotesView->currentItem()->rename();
 }
 
 void KNotesPart::renamedNote( Q3IconViewItem * )
 {
-  mManager->save();
+  if ( mOldName != mNotesView->currentItem()->text() )
+    mManager->save();
 }
 
 void KNotesPart::slotOnCurrentChanged( Q3IconViewItem * )
Index: kontact/plugins/knotes/knotesplugin.desktop
===================================================================
--- kontact/plugins/knotes/knotesplugin.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/knotes/knotesplugin.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -84,6 +84,7 @@
 Name[ja]=ポップアップメモ
 Name[km]=ចំណាំ​លេច​ឡើង
 Name[ko]=팝업 노트
+Name[lt]=Lipnūs lapeliai
 Name[lv]=Piezīmju lapiņas
 Name[nb]=Sprettopp-notater
 Name[nds]=Opduk-Notizen
Index: kontact/plugins/knotes/knotes_part_p.h
===================================================================
--- kontact/plugins/knotes/knotes_part_p.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/knotes/knotes_part_p.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -155,7 +155,7 @@
       hbl->addWidget( mTitleEdit, 1, Qt::AlignVCenter );
 
       mNoteEdit = new KNoteEdit( actionCollection(), page );
-      ( (KTextEdit*)mNoteEdit )->setTextFormat( Qt::RichText );
+      ( (KTextEdit*)mNoteEdit )->setAcceptRichText( true );
       mNoteEdit->setFocus();
 
       KXMLGUIBuilder builder( page );
@@ -163,7 +163,8 @@
       factory.addClient( this );
 
       mTool = static_cast<KToolBar *>( factory.container( "note_tool", this ) );
-
+      mNoteEdit->setContextMenu( dynamic_cast<KMenu *>(
+                                   factory.container( "note_edit", this ) ) );
       layout->addWidget( mTool );
       layout->addWidget( mNoteEdit );
 
Index: kontact/plugins/knotes/knotetip.cpp
===================================================================
--- kontact/plugins/knotes/knotetip.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/knotes/knotetip.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -31,6 +31,7 @@
 */
 
 #include "knotetip.h"
+#include <kdebug.h>
 #include "knotes_part_p.h"
 
 #include <kglobalsettings.h>
@@ -89,11 +90,7 @@
     }
   } else {
     KCal::Journal *journal = item->journal();
-    if ( journal->customProperty( "KNotes", "RichText" ) == "true" ) {
-      mPreview->setTextFormat( Qt::RichText );
-    } else {
-      mPreview->setTextFormat( Qt::PlainText );
-    }
+    mPreview->setAcceptRichText( journal->customProperty( "KNotes", "RichText" ) == "true" );
 
     QColor fg( journal->customProperty( "KNotes", "FgColor" ) );
     QColor bg( journal->customProperty( "KNotes", "BgColor" ) );
@@ -103,12 +100,12 @@
     //mPreview->zoomTo( 8 );
     mPreview->sync();
 
-    int w = 400;
-    int h = mPreview->heightForWidth( w );
+    mPreview->document()->adjustSize ();
+    int w = mPreview->document () ->size().width();
+    int h = mPreview->document () ->size().height();
     while ( w > 60 && h == mPreview->heightForWidth( w - 20 ) ) {
       w -= 20;
     }
-
     QRect desk = KGlobalSettings::desktopGeometry( mNoteIVI->rect().center() );
     resize( w, qMin( h, desk.height() / 2 - 20 ) );
 
Index: kontact/plugins/ktimetracker/ktimetracker.setdlg
===================================================================
--- kontact/plugins/ktimetracker/ktimetracker.setdlg	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/ktimetracker/ktimetracker.setdlg	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -14,6 +14,7 @@
 Name[ja]=タイムトラッカー
 Name[km]=កម្មវិធី​តាមដាន​ពេលវេលា
 Name[ko]=시간 추적기
+Name[lt]=Laiko sekiklis
 Name[lv]=Patērētā laika uzskatītājs
 Name[nb]=TimeTracker
 Name[nds]=Tietlogbook
@@ -45,6 +46,7 @@
 Comment[ja]=タイムトラッカーコンポーネント
 Comment[km]=សមាសភាគ​កម្មវិធី​តាមដាន​ពេលវេលា
 Comment[ko]=시간 추적기 구성 요소
+Comment[lt]=Laiko sekiklio komponentas
 Comment[lv]=Laika uzskaitītāja komponente
 Comment[nb]=Time Traacker-komponent
 Comment[nds]=Tietlogbook-Komponent
Index: kontact/plugins/ktimetracker/ktimetracker_plugin.desktop
===================================================================
--- kontact/plugins/ktimetracker/ktimetracker_plugin.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/ktimetracker/ktimetracker_plugin.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -29,6 +29,7 @@
 Comment[ja]=タイムトラッカープラグイン
 Comment[km]=កម្មវិធី​ជំនួយ TimeTracker
 Comment[ko]=시간 추적기 플러그인
+Comment[lt]=Laiko sekiklio priedas
 Comment[lv]=KTimeTracker spraudnis
 Comment[nb]=TimeTracker programtillegg
 Comment[nds]=Tietlogbook-Moduul
@@ -61,6 +62,7 @@
 Name[ja]=タイムトラッカー
 Name[km]=កម្មវិធី​តាមដាន​ពេលវេលា
 Name[ko]=시간 추적기
+Name[lt]=Laiko sekiklis
 Name[lv]=Patērētā laika uzskatītājs
 Name[nb]=TimeTracker
 Name[nds]=Tietlogbook
Index: kontact/plugins/kjots/kjots_plugin.desktop
===================================================================
--- kontact/plugins/kjots/kjots_plugin.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/kjots/kjots_plugin.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -62,6 +62,7 @@
 Name[ja]=メモ帳
 Name[km]=សៀវភៅ​ចំណាំ
 Name[ko]=공책
+Name[lt]=Užrašinės
 Name[lv]=Piezīmju grāmatiņas
 Name[nb]=Notisbøker
 Name[nds]=Notizböker
Index: kontact/plugins/kjots/kjots.setdlg
===================================================================
--- kontact/plugins/kjots/kjots.setdlg	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/kjots/kjots.setdlg	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -13,6 +13,7 @@
 Name[ja]=メモ帳
 Name[km]=សៀវភៅ​ចំណាំ
 Name[ko]=공책
+Name[lt]=Užrašinės
 Name[lv]=Piezīmju grāmatiņas
 Name[nb]=Notisbøker
 Name[nds]=Notizböker
@@ -46,6 +47,7 @@
 Comment[ja]=メモ帳コンポーネント
 Comment[km]=សមាសភាគ​សៀវភៅ​
 Comment[ko]=공책 구성 요소
+Comment[lt]=Užrašinių komponentas
 Comment[lv]=Piezīmju grāmatiņu komponente
 Comment[nb]=Notisbok-komponent
 Comment[nds]=Notizbook-Komponent
Index: kontact/plugins/korganizer/kcmapptsummary.desktop
===================================================================
--- kontact/plugins/korganizer/kcmapptsummary.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/korganizer/kcmapptsummary.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -28,6 +28,7 @@
 Name[kk]=Болашақ оқиғалар
 Name[km]=ព្រឹត្តិការណ៍​ដែល​នឹង​កើតឡើង
 Name[ko]=다가오는 약속
+Name[lt]=Artėjantys įvykiai
 Name[lv]=Gaidāmie notikumi
 Name[nb]=Kommende hendelser
 Name[nds]=Anstahn Begeefnissen
@@ -65,6 +66,7 @@
 Comment[kk]=Болашақ оқигалар тұжырымының баптау
 Comment[km]=ការ​រៀបចំ​សេចក្ដី​សង្ខេប​ព្រឹត្តិការណ៍​ដែល​នឹង​កើតឡើង
 Comment[ko]=다가오는 약속 요약 설정
+Comment[lt]=Artėjančių įvykių santraukos nustatymai
 Comment[lv]=Gaidāmo notikumu kopsavilkuma iestatījumi
 Comment[nb]=Sammendragsoppsett for kommende hendelser
 Comment[nds]=De Översicht för anstahn Begeefnissen instellen
Index: kontact/plugins/korganizer/kcmtodosummary.desktop
===================================================================
--- kontact/plugins/korganizer/kcmtodosummary.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/korganizer/kcmtodosummary.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -28,6 +28,7 @@
 Name[kk]=Кейінге қалдырылған жоспарлар
 Name[km]=ការងារ​ត្រូវធ្វើ​ដែល​មិនទាន់​សម្រេច
 Name[ko]=남아 있는 할 일
+Name[lt]=Neatlikti darbai
 Name[lv]=Darāmie darbi
 Name[nb]=Ventende gjøremål
 Name[nds]=Anstahn Opgaven
@@ -65,6 +66,7 @@
 Comment[kk]=Кейінге қалдырылған жоспарлар тұжырымының баптау
 Comment[km]=ការ​រៀបចំ​សេចក្ដីសង្ខេបការងារ​​ធ្វើ​ដែល​មិន​ទាន់សម្រេច
 Comment[ko]=남아 있는 할 일 요약 설정
+Comment[lt]=Neatliktų darbų santraukos nustatymai
 Comment[lv]=Darbu kopsavilkuma iestatījumi
 Comment[nb]=Oppsett av sammendraget av ventende gjøremål
 Comment[nds]=De Översicht för anstahn Opgaven instellen
Index: kontact/plugins/kmail/summarywidget.cpp
===================================================================
--- kontact/plugins/kmail/summarywidget.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/kmail/summarywidget.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -88,9 +88,13 @@
 {
   // check whether we need to update the message counts
   org::kde::kmail::kmail kmail( DBUS_KMAIL, "/KMail", QDBusConnection::sessionBus() );
-  const int timeOfLastMessageCountChange = kmail.timeOfLastMessageCountChange();
-  if ( timeOfLastMessageCountChange > mTimeOfLastMessageCountUpdate ) {
-    slotUnreadCountChanged();
+  if ( kmail.isValid() ) {
+    QDBusReply<int> timeOfLastMessageCountChange = kmail.timeOfLastMessageCountChange();
+    if ( timeOfLastMessageCountChange.isValid() ) {
+      if ( timeOfLastMessageCountChange > mTimeOfLastMessageCountUpdate ) {
+        slotUnreadCountChanged();
+      }
+    }
   }
 }
 
@@ -127,70 +131,87 @@
   int counter = 0;
   QStringList::ConstIterator it;
   org::kde::kmail::kmail kmail( DBUS_KMAIL, "/KMail", QDBusConnection::sessionBus() );
-  for ( it = folders.begin(); it != folders.end(); ++it ) {
-    if ( activeFolders.contains( *it ) ) {
-      QDBusReply<QString> ref = kmail.getFolder( *it );
-      if ( ref.isValid() && !ref.value().isEmpty() ) {
-        OrgKdeKmailFolderInterface folderInterface(
-          DBUS_KMAIL, "/Folder", QDBusConnection::sessionBus() );
-        QDBusReply<int> replyNumMsg = folderInterface.messages();
-        const int numMsg = replyNumMsg;
-        QDBusReply<int> replyUnreadNumMsg = folderInterface.unreadMessages();
-        const int numUnreadMsg=replyUnreadNumMsg;
+  if ( kmail.isValid() ) {
+    for ( it = folders.begin(); it != folders.end(); ++it ) {
+      if ( activeFolders.contains( *it ) ) {
+        QDBusReply<QString> ref = kmail.getFolder( *it );
+        if ( ref.isValid() && !ref.value().isEmpty() ) {
+          OrgKdeKmailFolderInterface folderInterface(
+            DBUS_KMAIL, "/Folder", QDBusConnection::sessionBus() );
+          if ( !folderInterface.isValid() )
+            continue;
 
-        if ( numUnreadMsg == 0 ) {
-          continue;
-        }
+          QDBusReply<int> replyNumMsg = folderInterface.messages();
+          if ( !replyNumMsg.isValid() )
+            continue;
 
-        // folder icon
-        QString name = folderInterface.unreadIconPath();
-        if ( name.isEmpty() ) {
-          name = defName;
-        }
-        label = new QLabel( this );
-        label->setPixmap( KIconLoader::global()->loadIcon( name, KIconLoader::Small ) );
-        label->setMaximumWidth( label->minimumSizeHint().width() );
-        label->setAlignment( Qt::AlignVCenter );
-        mLayout->addWidget( label, counter, 0 );
-        mLabels.append( label );
+          const int numMsg = replyNumMsg;
+          QDBusReply<int> replyUnreadNumMsg = folderInterface.unreadMessages();
+          if ( !replyUnreadNumMsg.isValid() )
+            continue;
 
-        // folder path
-        QString folderPath;
-        QDBusReply<QString> replyFolderPath;
-        if ( config.readEntry( "ShowFullPath", true ) ) {
-          replyFolderPath= folderInterface.displayPath();
-        } else {
-          replyFolderPath= folderInterface.displayName();
-        }
-        folderPath = replyFolderPath;
-        KUrlLabel *urlLabel = new KUrlLabel( *it, folderPath, this );
-        urlLabel->installEventFilter( this );
-        urlLabel->setAlignment( Qt::AlignLeft );
-        urlLabel->setWordWrap( true );
-        mLayout->addWidget( urlLabel, counter, 1 );
-        mLabels.append( urlLabel );
+          const int numUnreadMsg = replyUnreadNumMsg;
+          if ( numUnreadMsg == 0 ) {
+            continue;
+          }
 
-        connect( urlLabel, SIGNAL(leftClickedUrl(const QString&)),
-                 SLOT(selectFolder(const QString&)) );
+          // folder icon
+          QDBusReply<QString> dbusName = folderInterface.unreadIconPath();
+          QString name;
+          if ( dbusName.isValid() ) {
+            name = dbusName;
+            if ( name.isEmpty() )
+              name = defName;
+          }
+          else
+            name = defName;
+          label = new QLabel( this );
+          label->setPixmap( KIconLoader::global()->loadIcon( name, KIconLoader::Small ) );
+          label->setMaximumWidth( label->minimumSizeHint().width() );
+          label->setAlignment( Qt::AlignVCenter );
+          mLayout->addWidget( label, counter, 0 );
+          mLabels.append( label );
 
-        // unread of total
-        label = new QLabel( i18nc( "%1: number of unread messages "
-                                   "%2: total number of messages",
-                                   "%1 / %2", numUnreadMsg, numMsg ), this );
-        label->setAlignment( Qt::AlignLeft );
-        mLayout->addWidget( label, counter, 2 );
-        mLabels.append( label );
+          // folder path
+          QString folderPath;
+          QDBusReply<QString> replyFolderPath;
+          if ( config.readEntry( "ShowFullPath", true ) ) {
+            replyFolderPath= folderInterface.displayPath();
+          } else {
+            replyFolderPath= folderInterface.displayName();
+          }
+          if ( replyFolderPath.isValid() )
+            folderPath = replyFolderPath;
 
-        // tooltip
-        urlLabel->setToolTip( i18n( "<qt><b>%1</b>"
-                                    "<br/>Total: %2<br/>"
-                                    "Unread: %3</qt>",
-                                    folderPath,
-                                    numMsg,
-                                    numUnreadMsg ) );
-        //TODO: put the folder size in the tooltip
-        //so we need to add a folderSize() to the interface
-        counter++;
+          KUrlLabel *urlLabel = new KUrlLabel( *it, folderPath, this );
+          urlLabel->installEventFilter( this );
+          urlLabel->setAlignment( Qt::AlignLeft );
+          urlLabel->setWordWrap( true );
+          mLayout->addWidget( urlLabel, counter, 1 );
+          mLabels.append( urlLabel );
+
+          connect( urlLabel, SIGNAL(leftClickedUrl(const QString&)),
+                  SLOT(selectFolder(const QString&)) );
+
+          // unread of total
+          label = new QLabel( i18nc( "%1: number of unread messages "
+                                    "%2: total number of messages",
+                                    "%1 / %2", numUnreadMsg, numMsg ), this );
+          label->setAlignment( Qt::AlignLeft );
+          mLayout->addWidget( label, counter, 2 );
+          mLabels.append( label );
+
+          // tooltip
+          urlLabel->setToolTip( i18n( "<qt><b>%1</b>"
+                                      "<br/>Total: %2<br/>"
+                                      "Unread: %3</qt>",
+                                      folderPath,
+                                      numMsg,
+                                      numUnreadMsg ) );
+          //TODO: put the folder size in the tooltip
+          //so we need to add a folderSize() to the interface
+          counter++;
+        }
       }
     }
   }
Index: kontact/plugins/kmail/kcmkmailsummary.desktop
===================================================================
--- kontact/plugins/kmail/kcmkmailsummary.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/kmail/kcmkmailsummary.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -31,6 +31,7 @@
 Name[kk]=Жаңа хабарламалар
 Name[km]=សារ​ថ្មី
 Name[ko]=새 메시지
+Name[lt]=Nauji laiškai
 Name[lv]=Jaunas vēstules
 Name[nb]=Nye meldinger
 Name[nds]=Nieg Narichten
Index: kontact/plugins/summary/kcmkontactsummary.desktop
===================================================================
--- kontact/plugins/summary/kcmkontactsummary.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/summary/kcmkontactsummary.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -26,6 +26,7 @@
 Name[ja]=要約
 Name[km]=សេចក្ដីសង្ខេប
 Name[ko]=요약
+Name[lt]=Santraukos
 Name[lv]=Kopsavilkumi
 Name[nb]=Sammendrag
 Name[nds]=Tosamenfaten
@@ -60,6 +61,7 @@
 Comment[ja]=表示する要約を選択
 Comment[km]=ជម្រើស​សេចក្ដី​សង្ខេប
 Comment[ko]=요약 선택
+Comment[lt]=Santraukos pasirinkimas
 Comment[lv]=Kopsavilkuma izvēle
 Comment[nb]=Sammendragsutvalg
 Comment[nds]=Tosamenfaten utsöken
Index: kontact/plugins/newsticker/kcmkontactknt.desktop
===================================================================
--- kontact/plugins/newsticker/kcmkontactknt.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ kontact/plugins/newsticker/kcmkontactknt.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -30,6 +30,7 @@
 Name[kk]=Ақпарлар
 Name[km]=មតិ​ព័ត៌មាន
 Name[ko]=뉴스 피드
+Name[lt]=Naujienų kanalai
 Name[lv]=Ziņu barotnes
 Name[nb]=Nyhetskilder
 Name[nds]=Mellenströöm
Index: knotes/knotes_export.h
===================================================================
--- knotes/knotes_export.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ knotes/knotes_export.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -1,40 +0,0 @@
-/*  This file is part of the KDE project
-    Copyright (C) 2007 David Faure <faure@kde.org>
-
-    This library is free software; you can redistribute it and/or
-    modify it under the terms of the GNU Library General Public
-    License as published by the Free Software Foundation; either
-    version 2 of the License, or (at your option) any later version.
-
-    This library is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-    Library General Public License for more details.
-
-    You should have received a copy of the GNU Library General Public License
-    along with this library; see the file COPYING.LIB.  If not, write to
-    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
-    Boston, MA 02110-1301, USA.
-*/
-
-#ifndef KNOTES_EXPORT_H
-#define KNOTES_EXPORT_H
-
-/* needed for KDE_EXPORT and KDE_IMPORT macros */
-#include <kdemacros.h>
-
-#ifndef KNOTES_EXPORT
-# if defined(MAKE_KNOTES_LIB)
-   /* We are building this library */
-#  define KNOTES_EXPORT KDE_EXPORT
-# else
-   /* We are using this library */
-#  define KNOTES_EXPORT KDE_IMPORT
-# endif
-#endif
-
-# ifndef KNOTES_EXPORT_DEPRECATED
-#  define KNOTES_EXPORT_DEPRECATED KDE_DEPRECATED KNOTES_EXPORT
-# endif
-
-#endif
Index: knotes/knotesnetrecv.h
===================================================================
--- knotes/knotesnetrecv.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ knotes/knotesnetrecv.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -45,22 +45,22 @@
   public:
     KNotesNetworkReceiver( QTcpSocket * );
     ~KNotesNetworkReceiver();
-    
+
   signals:
     void sigNoteReceived( const QString &, const QString & );
-    
+
   private slots:
     void slotDataAvailable();
     void slotReceptionTimeout();
     void slotConnectionClosed();
-    void slotError( int err );
-    
+    void slotError( QAbstractSocket::SocketError );
+
   private:
     QTimer *m_timer;       // to avoid memory and connection floods
-    
+
     QByteArray *m_buffer;
     QTcpSocket *m_sock;
-    
+
     QString m_titleAddon;
 };
 
Index: knotes/resourcenotes.h
===================================================================
--- knotes/resourcenotes.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ knotes/resourcenotes.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -36,8 +36,6 @@
 #include <kcal/alarm.h>
 #include <kresources/resource.h>
 
-#include "knotes_export.h"
-
 class KNotesResourceManager;
 
 namespace KCal {
Index: knotes/knotesapp.h
===================================================================
--- knotes/knotesapp.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ knotes/knotesapp.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -57,80 +57,83 @@
   public:
     KNotesApp();
     ~KNotesApp();
-    
+
     void showNote( const QString &id ) const;
     void hideNote( const QString &id ) const;
-    
+
     void killNote( const QString &id );
     void killNote( const QString &id, bool force );
-    
+
     QString name( const QString &id ) const;
     QString text( const QString &id ) const;
-    
+
     void setName( const QString &id, const QString &newName );
     void setText( const QString &id, const QString &newText );
-    
+
     QMap<QString,QString> notes() const;
-    
+
     bool commitData( QSessionManager & );
-    
+
   public slots:
     QString newNote( const QString &name = QString(),
                      const QString &text = QString() );
     QString newNoteFromClipboard( const QString &name = QString() );
-    
+
     void hideAllNotes() const;
     void showAllNotes() const;
-    
+
   protected slots:
     void slotActivated( QSystemTrayIcon::ActivationReason );
     void slotShowNote();
     void slotWalkThroughNotes();
-    
+
     void slotOpenFindDialog();
     void slotFindNext();
-    
+
     void slotPreferences();
     void slotConfigureAccels();
-    
+
     void slotNoteKilled( KCal::Journal *journal );
-    
+
     void slotQuit();
-    
+
   private:
     void showNote( KNote *note ) const;
     void saveConfigs();
-    
+
   private slots:
     void acceptConnection();
     void saveNotes();
+    void saveNotes( const QString & uid );
     void updateNoteActions();
     void updateNetworkListener();
     void updateStyle();
-    
+
     void createNote( KCal::Journal *journal );
     void killNote( KCal::Journal *journal );
-    
+
   private:
     QMap<QString, KNote *> m_notes;
     QList<QAction *>       m_noteActions;
-    
+
     KNotesResourceManager  *m_manager;
     KNotesAlarm            *m_alarm;
     QTcpServer             *m_listener;
     DNSSD::PublicService   *m_publisher;
-    
+
     KFind           *m_find;
     QMap<QString, KNote *>::iterator *m_findPos;
-    
+
     KMenu           *m_noteMenu;
     KMenu           *m_contextMenu;
-    
+
     KXMLGUIFactory  *m_guiFactory;
     KXMLGUIBuilder  *m_guiBuilder;
     KSystemTrayIcon *m_tray;
-    
+    KAction         *m_findAction;
+
     QDomDocument    m_noteGUI;
+    QString m_noteUidModify;
 };
 
 #endif
Index: knotes/knote.cpp
===================================================================
--- knotes/knote.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ knotes/knote.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -31,7 +31,6 @@
 #include <QVBoxLayout>
 #include <QDesktopWidget>
 
-#include <k3colordrag.h>
 #include <kaction.h>
 #include <kactioncollection.h>
 #include <kapplication.h>
@@ -82,29 +81,28 @@
 using namespace KCal;
 
 
-KNote::KNote( QDomDocument buildDoc, Journal *j, QWidget *parent )
+KNote::KNote( const QDomDocument& buildDoc, Journal *j, QWidget *parent )
   : QFrame( parent, Qt::FramelessWindowHint ), m_label( 0 ), m_grip( 0 ),
     m_button( 0 ), m_tool( 0 ), m_editor( 0 ), m_config( 0 ), m_journal( j ),
-    m_find( 0 ), m_kwinConf( KSharedConfig::openConfig( "kwinrc" ) )
+    m_find( 0 ), m_kwinConf( KSharedConfig::openConfig( "kwinrc" ) ), m_blockEmitDataChanged( false )
 {
   setAcceptDrops( true );
   setAttribute( Qt::WA_DeleteOnClose );
   setDOMDocument( buildDoc );
-  setObjectName( m_journal->uid() );  
+  setObjectName( m_journal->uid() );
   setXMLFile( componentData().componentName() + "ui.rc", false, false );
-  
+
   // create the main layout
   m_noteLayout = new QVBoxLayout( this );
-  setLayout( m_noteLayout );
   m_noteLayout->setMargin( 0 );
-   
+
   // if there is no title yet, use the start date if valid
   // (KOrganizer's journals don't have titles but a valid start date)
   if ( m_journal->summary().isNull() && m_journal->dtStart().isValid() ) {
     QString s = KGlobal::locale()->formatDateTime( m_journal->dtStart() );
     m_journal->setSummary( s );
   }
-  
+
   createActions();
 
   buildGui();
@@ -117,11 +115,20 @@
   delete m_config;
 }
 
+void KNote::changeJournal(KCal::Journal *journal)
+{
+   m_journal = journal;
+   m_editor->setText( m_journal->description() );
+   m_label->setText( m_journal->summary() );
+   updateLabelAlignment();
 
+}
+
 // -------------------- public slots -------------------- //
 
 void KNote::slotKill( bool force )
 {
+  m_blockEmitDataChanged = true;
   if ( !force &&
        ( KMessageBox::warningContinueCancel( this,
          i18n( "<qt>Do you really want to delete note <b>%1</b>?</qt>",
@@ -130,27 +137,26 @@
          KGuiItem( i18n( "&Delete" ), "edit-delete" ),
          KStandardGuiItem::cancel(),
          "ConfirmDeleteNote" ) != KMessageBox::Continue ) ) {
-    return;
+     m_blockEmitDataChanged = false;
+     return;
   }
-  
   // delete the configuration first, then the corresponding file
   delete m_config;
   m_config = 0;
-  
+
   QString configFile = KGlobal::dirs()->saveLocation( "appdata", "notes/" );
   configFile += m_journal->uid();
-  
   if ( !KIO::NetAccess::del( KUrl( configFile ), this ) ) {
     kError( 5500 ) <<"Can't remove the note config:" << configFile;
   }
-  
+
   emit sigKillNote( m_journal );
 }
 
 
 // -------------------- public member functions -------------------- //
 
-void KNote::saveData()
+void KNote::saveData( bool update )
 {
   m_journal->setSummary( m_label->text() );
   m_journal->setDescription( m_editor->text() );
@@ -160,9 +166,11 @@
                                 m_config->bgColor().name() );
   m_journal->setCustomProperty( "KNotes", "RichText",
                                 m_config->richText() ? "true" : "false" );
-  
-  emit sigDataChanged();
+
+  if(update) {
+  emit sigDataChanged(m_journal->uid());
   m_editor->document()->setModified( false );
+  }
 }
 
 void KNote::saveConfig() const
@@ -175,7 +183,7 @@
     m_config->setHeight( 0 );
   }
   m_config->setPosition( pos() );
-  
+
 #ifdef Q_WS_X11
   NETWinInfo wm_client( QX11Info::display(), winId(),
                         QX11Info::appRootWindow(), NET::WMDesktop );
@@ -184,7 +192,7 @@
     m_config->setDesktop( wm_client.desktop() );
   }
 #endif
-  
+
   // actually store the config on disk
   m_config->writeConfig();
 }
@@ -208,7 +216,7 @@
 {
   m_label->setText( name );
   updateLabelAlignment();
-  
+
   if ( m_editor ) {    // not called from CTOR?
     saveData();
   }
@@ -218,25 +226,25 @@
                        NET::WMDesktop );
   note_win.setName( name.toUtf8() );
 #endif
-  
+
   emit sigNameChanged();
 }
 
 void KNote::setText( const QString& text )
 {
   m_editor->setText( text );
-  
+
   saveData();
 }
 
 void KNote::find( KFind* kfind )
 {
   m_find = kfind;
-  disconnect( m_find ); 
+  disconnect( m_find );
   connect( m_find, SIGNAL( highlight( const QString &, int, int ) ),
            this, SLOT( slotHighlight( const QString &, int, int ) ) );
   connect( m_find, SIGNAL( findNext() ), this, SLOT( slotFindNext() ) );
-  
+
   m_find->setData( m_editor->toPlainText() );
   slotFindNext();
 }
@@ -244,13 +252,13 @@
 void KNote::slotFindNext()
 {
   // TODO: honor FindBackwards
- 
+
   // Let KFind inspect the text fragment, and display a dialog if a match is
   // found
   KFind::Result res = m_find->find();
- 
+
   if ( res == KFind::NoMatch ) { // i.e. at end-pos
-   
+
     QTextCursor c = m_editor->textCursor(); //doesn't return by reference, so we use setTextCursor
     c.clearSelection();
     m_editor->setTextCursor( c );
@@ -258,7 +266,7 @@
     disconnect( m_find, 0, this, 0 );
     emit sigFindFinished();
   } else {
-	
+
     show();
 #ifdef Q_WS_X11
     KWindowSystem::setCurrentDesktop( KWindowSystem::windowInfo( winId(),
@@ -284,31 +292,33 @@
 
 void KNote::slotRename()
 {
+    m_blockEmitDataChanged = true;
   // pop up dialog to get the new name
   bool ok;
+  QString oldName = m_label->text();
   QString newName = KInputDialog::getText( QString::null,
     //krazy:exclude=nullstrassign for old broken gcc
     i18n( "Please enter the new name:" ), m_label->text(), &ok, this );
-  
-  if ( !ok ) { // handle cancel
+  m_blockEmitDataChanged = false;
+  if ( !ok || (oldName == newName) ) { // handle cancel
     return;
   }
-  
+
   setName( newName );
 }
 
 void KNote::slotUpdateReadOnly()
 {
   const bool readOnly = m_readOnly->isChecked();
-  
+
   m_editor->setReadOnly( readOnly );
   m_config->setReadOnly( readOnly );
-  
+
   // enable/disable actions accordingly
   actionCollection()->action( "configure_note" )->setEnabled( !readOnly );
   actionCollection()->action( "insert_date" )->setEnabled( !readOnly );
   actionCollection()->action( "delete_note" )->setEnabled( !readOnly );
-  
+
   actionCollection()->action( "edit_undo" )->setEnabled( !readOnly &&
                               m_editor->document()->isUndoAvailable() );
   actionCollection()->action( "edit_redo" )->setEnabled( !readOnly &&
@@ -317,7 +327,8 @@
                               m_editor->textCursor().hasSelection() );
   actionCollection()->action( "edit_paste" )->setEnabled( !readOnly );
   actionCollection()->action( "edit_clear" )->setEnabled( !readOnly );
-  
+
+  actionCollection()->action( "rename_note" )->setEnabled( !readOnly);
   updateFocus();
 }
 
@@ -331,11 +342,11 @@
     m_config->setDesktop( wm_client.desktop() );
   }
 #endif
-  
+
   m_editor->clearFocus();
   m_config->setHideNote( true );
   m_config->setPosition( pos() );
-  
+  m_config->writeConfig();
   // just hide the note so it's still available from the dock window
   hide();
 }
@@ -348,12 +359,14 @@
 
 void KNote::slotSetAlarm()
 {
+    m_blockEmitDataChanged = true;
   KNoteAlarmDlg dlg( name(), this );
   dlg.setIncidence( m_journal );
-  
+
   if ( dlg.exec() == QDialog::Accepted ) {
-    emit sigDataChanged();
+    emit sigDataChanged(noteId());
   }
+  m_blockEmitDataChanged = false;
 }
 
 void KNote::slotPreferences()
@@ -362,7 +375,7 @@
   if ( KNoteConfigDlg::showDialog( noteId() ) ) {
     return;
   }
-  
+
   // create a new preferences dialog...
   KNoteConfigDlg *dialog = new KNoteConfigDlg( m_config, name(), this, noteId() );
   connect( dialog, SIGNAL( settingsChanged( const QString & ) ) , this,
@@ -377,13 +390,13 @@
   // pop up dialog to get the IP
   KNoteHostDlg hostDlg( i18n( "Send \"%1\"", name() ), this );
   bool ok = ( hostDlg.exec() == QDialog::Accepted );
-  
+
   if ( !ok ) { // handle cancel
     return;
   }
   QString host = hostDlg.host();
   quint16 port = hostDlg.port();
-  
+
   if ( !port ) { // not specified, use default
     port = KNotesGlobalConfig::port();
   }
@@ -392,9 +405,9 @@
     KMessageBox::sorry( this, i18n( "The host cannot be empty." ) );
     return;
   }
-  
+
   // Send the note
-  
+
   KNotesNetworkSender *sender = new KNotesNetworkSender(
     KSocketFactory::connectToHost( "knotes", host, port ) );
   sender->setSenderId( KNotesGlobalConfig::senderID() );
@@ -404,9 +417,9 @@
 void KNote::slotMail()
 {
   // get the mail action command
-  QStringList cmd_list = KNotesGlobalConfig::mailAction().split( QChar(' '),
+  const QStringList cmd_list = KNotesGlobalConfig::mailAction().split( QChar(' '),
       QString::SkipEmptyParts );
-  
+
   KProcess mail;
   foreach ( const QString& cmd, cmd_list ) {
     if ( cmd == "%f" ) {
@@ -417,7 +430,7 @@
       mail << cmd;
     }
   }
-  
+
   if ( !mail.startDetached() ) {
     KMessageBox::sorry( this, i18n( "Unable to start the mail process." ) );
   }
@@ -440,35 +453,37 @@
 void KNote::slotSaveAs()
 {
   // TODO: where to put pdf file support? In the printer??!??!
-  
+  m_blockEmitDataChanged = true;
   QCheckBox *convert = 0;
-  
+
   if ( m_editor->acceptRichText() ) {
     convert = new QCheckBox( 0 );
     convert->setText( i18n( "Save note as plain text" ) );
   }
-  
+  m_blockEmitDataChanged = true;
   KUrl url;
   KFileDialog dlg( url, QString(), this, convert );
   dlg.setOperationMode( KFileDialog::Saving );
   dlg.setCaption( i18n( "Save As" ) );
   dlg.exec();
-  
+
   QString fileName = dlg.selectedFile();
   if ( fileName.isEmpty() ) {
+      m_blockEmitDataChanged = false;
     return;
   }
-  
+
   QFile file( fileName );
-  
+
   if ( file.exists() &&
        KMessageBox::warningContinueCancel( this,
           i18n( "<qt>A file named <b>%1</b> already exists.<br />"
                 "Are you sure you want to overwrite it?</qt>",
                 QFileInfo( file ).fileName() ) ) != KMessageBox::Continue ) {
+      m_blockEmitDataChanged = false;
     return;
   }
-  
+
   if ( file.open( QIODevice::WriteOnly ) ) {
     QTextStream stream( &file );
     if ( convert && !convert->isChecked() ) {
@@ -477,6 +492,7 @@
       stream << m_editor->toPlainText();
     }
   }
+  m_blockEmitDataChanged = false;
 }
 
 void KNote::slotPopupActionToDesktop( int id )
@@ -494,15 +510,15 @@
   m_editor->setTextFont( m_config->font() );
   m_editor->setTabStop( m_config->tabSize() );
   m_editor->setAutoIndentMode( m_config->autoIndent() );
-  
+
   // if called as a slot, save the text, we might have changed the
   // text format - otherwise the journal will not be updated
   if ( sender() ) {
     saveData();
   }
-  
+
   setColor( m_config->fgColor(), m_config->bgColor() );
-  
+
   updateLayout();
   slotUpdateShowInTaskbar();
 }
@@ -567,20 +583,20 @@
                        NET::DesktopNames );
   NETWinInfo wm_client( QX11Info::display(), winId(),
                         QX11Info::appRootWindow(), NET::WMDesktop );
-  
+
   QStringList desktops;
   desktops.append( i18n( "&All Desktops" ) );
   desktops.append( QString::null );           // Separator
                                               // krazy:exclude=nullstrassign
                                               // for old broken gcc
-  
+
   int count = wm_root.numberOfDesktops();
   for ( int n = 1; n <= count; n++ ) {
     desktops.append( QString( "&%1 %2" ).arg( n ).arg(
       QString::fromUtf8( wm_root.desktopName( n ) ) ) );
   }
   m_toDesktop->setItems( desktops );
-  
+
   if ( wm_client.desktop() == NETWinInfo::OnAllDesktops ) {
     m_toDesktop->setCurrentItem( 0 );
   } else {
@@ -595,13 +611,13 @@
 
 void KNote::buildGui()
 {
-  createNoteHeader();  
+  createNoteHeader();
   createNoteEditor();
-  
+
   KXMLGUIBuilder builder( this );
   KXMLGUIFactory factory( &builder, this );
   factory.addClient( this );
-  
+
   m_menu = dynamic_cast<KMenu*>( factory.container( "note_context", this ) );
   m_editor->setContextMenu( dynamic_cast<KMenu *>(
                               factory.container( "note_edit", this ) ) );
@@ -618,18 +634,18 @@
 
   action  = new KAction( KIcon( "document-new" ), i18n( "New" ),  this );
   actionCollection()->addAction( "new_note", action );
-  connect( action, SIGNAL( triggered( bool ) ), SIGNAL( sigRequestNewNote() ) );
+  connect( action, SIGNAL( triggered( bool ) ), SLOT( slotRequestNewNote() ) );
 
   action  = new KAction( KIcon( "edit-rename" ), i18n( "Rename..." ), this );
   actionCollection()->addAction( "rename_note", action );
   connect( action, SIGNAL( triggered( bool ) ), SLOT( slotRename() ) );
 
-  m_readOnly  = new KToggleAction( KIcon( "system-lock-screen" ),
+  m_readOnly  = new KToggleAction( KIcon( "object-locked" ),
                                    i18n( "Lock" ), this );
   actionCollection()->addAction( "lock_note", m_readOnly );
   connect( m_readOnly, SIGNAL( triggered( bool ) ),
           SLOT( slotUpdateReadOnly() ) );
-  m_readOnly->setCheckedState( KGuiItem( i18n( "Unlock" ), "unlock" ) );
+  m_readOnly->setCheckedState( KGuiItem( i18n( "Unlock" ), "object-unlocked" ) );
 
   action  = new KAction( KIcon( "window-close" ), i18n( "Hide" ), this );
   actionCollection()->addAction( "hide_note", action );
@@ -638,8 +654,8 @@
 
   action  = new KAction( KIcon( "edit-delete" ), i18n( "Delete" ), this );
   actionCollection()->addAction( "delete_note", action );
-  connect( action, SIGNAL( triggered( bool ) ), SLOT( slotKill() ) );
-  
+  connect( action, SIGNAL( triggered( bool ) ), SLOT( slotKill() ) ,Qt::QueuedConnection);
+
   action  = new KAction( KIcon( "knotes_date" ), i18n( "Insert Date" ), this );
   actionCollection()->addAction( "insert_date", action );
   connect( action, SIGNAL( triggered( bool ) ), SLOT( slotInsDate() ) );
@@ -648,7 +664,7 @@
                          this );
   actionCollection()->addAction( "set_alarm", action );
   connect( action, SIGNAL( triggered( bool ) ), SLOT( slotSetAlarm() ) );
-  
+
   action  = new KAction( KIcon( "network-wired" ), i18n( "Send..." ), this );
   actionCollection()->addAction( "send_note", action );
   connect( action, SIGNAL( triggered( bool ) ), SLOT( slotSend() ) );
@@ -667,20 +683,20 @@
   action  = new KAction( KIcon( "configure" ), i18n( "Preferences..." ), this );
   actionCollection()->addAction( "configure_note", action );
   connect( action, SIGNAL( triggered( bool ) ), SLOT( slotPreferences() ) );
-  
-  
+
+
   m_keepAbove  = new KToggleAction( KIcon( "go-up" ),
                                     i18n( "Keep Above Others" ), this );
   actionCollection()->addAction( "keep_above", m_keepAbove );
   connect( m_keepAbove, SIGNAL( triggered( bool ) ),
            SLOT( slotKeepAbove() ) );
-  
+
   m_keepBelow  = new KToggleAction( KIcon( "go-down" ),
                                     i18n( "Keep Below Others" ), this );
   actionCollection()->addAction( "keep_below", m_keepBelow );
   connect( m_keepBelow, SIGNAL( triggered( bool ) ),
            SLOT( slotKeepBelow() ) );
-  
+
 #ifdef Q_WS_X11
   m_toDesktop  = new KSelectAction( i18n( "To Desktop" ), this );
   actionCollection()->addAction( "to_desktop", m_toDesktop );
@@ -689,7 +705,7 @@
   connect( m_toDesktop->menu(), SIGNAL( aboutToShow() ),
            SLOT( slotUpdateDesktopActions() ) );
 #endif
-  
+
   // invisible action to walk through the notes to make this configurable
   action  = new KAction( i18n( "Walk Through Notes" ), this );
   actionCollection()->addAction( "walk_notes", action );
@@ -705,18 +721,18 @@
 {
   // load style configuration
   KConfigGroup styleGroup( m_kwinConf, "Style" );
-  
+
   QBoxLayout::Direction headerLayoutDirection = QBoxLayout::LeftToRight;
-  
+
   if ( styleGroup.readEntry( "CustomButtonPositions", false ) ) {
     if ( styleGroup.readEntry( "ButtonsOnLeft" ).contains( 'X' ) ) {
       headerLayoutDirection = QBoxLayout::RightToLeft;
     }
   }
-  
-  QBoxLayout *headerLayout = new QBoxLayout( headerLayoutDirection, this );
-  
-  
+
+  QBoxLayout *headerLayout = new QBoxLayout( headerLayoutDirection);
+
+
   // create header label
   m_label = new QLabel( this );
   headerLayout->addWidget( m_label );
@@ -730,9 +746,9 @@
                                         // connected at this stage yet
   m_button = new KNoteButton( "knotes_close", this );
   headerLayout->addWidget( m_button );
-  
+
   connect( m_button, SIGNAL( clicked() ), this, SLOT( slotClose() ) );
-  
+
   m_noteLayout->addItem( headerLayout );
 }
 
@@ -741,9 +757,17 @@
   m_editor = new KNoteEdit( actionCollection(), this );
   m_noteLayout->addWidget( m_editor );
   m_editor->installEventFilter( this ); // receive focus events for modified
-  setFocusProxy( m_editor );  
+  setFocusProxy( m_editor );
 }
 
+
+void KNote::slotRequestNewNote()
+{
+    //Be sure to save before to request a new note
+    saveData();
+    emit sigRequestNewNote();
+}
+
 void KNote::createNoteFooter()
 {
   if ( m_tool ) {
@@ -751,22 +775,22 @@
     m_tool->setFixedHeight( 24 );
     m_tool->setToolButtonStyle( Qt::ToolButtonIconOnly );
   }
-  
+
   // create size grip
-  QHBoxLayout *gripLayout = new QHBoxLayout( this );
+  QHBoxLayout *gripLayout = new QHBoxLayout;
   m_grip = new QSizeGrip( this );
   m_grip->setFixedSize( m_grip->sizeHint() );
-  
+
   if ( m_tool ) {
     gripLayout->addWidget( m_tool );
     gripLayout->setAlignment( m_tool, Qt::AlignBottom | Qt::AlignLeft );
     m_tool->hide();
   }
-  
+
   gripLayout->addWidget( m_grip );
   gripLayout->setAlignment( m_grip, Qt::AlignBottom | Qt::AlignRight );
   m_noteLayout->addItem( gripLayout );
-  
+
   // if there was just a way of making KComboBox adhere the toolbar height...
   if ( m_tool ) {
     foreach ( KComboBox *combo, m_tool->findChildren<KComboBox *>() ) {
@@ -783,17 +807,17 @@
   // the config file location
   QString configFile = KGlobal::dirs()->saveLocation( "appdata", "notes/" );
   configFile += m_journal->uid();
-  
+
   // no config file yet? -> use the default display config if available
   // we want to write to configFile, so use "false"
   bool newNote = !KIO::NetAccess::exists( KUrl( configFile ),
                                           KIO::NetAccess::DestinationSide, 0 );
-  
+
   m_config = new KNoteConfig( KSharedConfig::openConfig( configFile,
                                                          KConfig::NoGlobals ) );
   m_config->readConfig();
   m_config->setVersion( KNOTES_VERSION );
-  
+
   if ( newNote ) {
     // until kdelibs provides copying of KConfigSkeletons (KDE 3.4)
     KNotesGlobalConfig *globalConfig = KNotesGlobalConfig::self();
@@ -801,14 +825,14 @@
     m_config->setFgColor( globalConfig->fgColor() );
     m_config->setWidth( globalConfig->width() );
     m_config->setHeight( globalConfig->height() );
-    
+
     m_config->setFont( globalConfig->font() );
     m_config->setTitleFont( globalConfig->titleFont() );
     m_config->setAutoIndent( globalConfig->autoIndent() );
     m_config->setRichText( globalConfig->richText() );
     m_config->setTabSize( globalConfig->tabSize() );
     m_config->setReadOnly( globalConfig->readOnly() );
-    
+
     m_config->setDesktop( globalConfig->desktop() );
     m_config->setHideNote( globalConfig->hideNote() );
     m_config->setPosition( globalConfig->position() );
@@ -816,26 +840,25 @@
     m_config->setRememberDesktop( globalConfig->rememberDesktop() );
     m_config->setKeepAbove( globalConfig->keepAbove() );
     m_config->setKeepBelow( globalConfig->keepBelow() );
-    
+
     m_config->writeConfig();
   }
-  
+
   // set up the look&feel of the note
   setFrameStyle( Panel | Raised );
   setMinimumSize( 20, 20 );
   setBackgroundRole( QPalette::Base );
-  
+
   m_editor->setContentsMargins( 0, 0, 0, 0 );
   m_editor->setBackgroundRole( QPalette::Base );
   m_editor->setFrameStyle( NoFrame );
   m_editor->setText( m_journal->description() );
-  m_editor->document()->setModified( false );
-  
+
   // load the display configuration of the note
   uint width = m_config->width();
   uint height = m_config->height();
   resize( width, height );
-  
+
   // let KWin do the placement if the position is illegal--at least 10 pixels
   // of a note need to be visible
   const QPoint& position = m_config->position();
@@ -844,7 +867,7 @@
   if ( desk.intersects( QRect( position, QSize( width, height ) ) ) ) {
     move( position );           // do before calling show() to avoid flicker
   }
-  
+
   // config items in the journal have priority
   QString property = m_journal->customProperty( "KNotes", "FgColor" );
   if ( !property.isNull() ) {
@@ -853,7 +876,7 @@
     m_journal->setCustomProperty( "KNotes", "FgColor",
                                   m_config->fgColor().name() );
   }
-  
+
   property = m_journal->customProperty( "KNotes", "BgColor" );
   if ( !property.isNull() ) {
     m_config->setBgColor( QColor( property ) );
@@ -868,26 +891,26 @@
     m_journal->setCustomProperty( "KNotes", "RichText",
                                   m_config->richText() ? "true" : "false" );
   }
-  
+
   // read configuration settings...
   slotApplyConfig();
-  
+
   // if this is a new note put on current desktop - we can't use defaults
   // in KConfig XT since only _changes_ will be stored in the config file
   int desktop = m_config->desktop();
-  
+
 #ifdef Q_WS_X11
   if ( ( desktop < 0 && desktop != NETWinInfo::OnAllDesktops ) ||
        !m_config->rememberDesktop() )
     desktop = KWindowSystem::currentDesktop();
 #endif
-  
+
   // show the note if desired
   if ( desktop != 0 && !m_config->hideNote() ) {
     // to avoid flicker, call this before show()
     toDesktop( desktop );
     show();
-    
+
     // because KWin forgets about that for hidden windows
 #ifdef Q_WS_X11
     if ( desktop == NETWinInfo::OnAllDesktops ) {
@@ -895,10 +918,10 @@
     }
 #endif
   }
-  
+
   m_readOnly->setChecked( m_config->readOnly() );
   slotUpdateReadOnly();
-  
+
   if ( m_config->keepAbove() ) {
     m_keepAbove->setChecked( true );
   } else if ( m_config->keepBelow() ) {
@@ -908,7 +931,7 @@
     m_keepBelow->setChecked( false );
   }
   slotUpdateKeepAboveBelow();
-  
+
   // HACK: update the icon color - again after showing the note, to make kicker
   // aware of the new colors
   KIconEffect effect;
@@ -925,6 +948,7 @@
 #ifdef Q_WS_X11
   KWindowSystem::setIcons( winId(), icon, miniIcon );
 #endif
+  m_editor->document()->setModified( false );
 }
 
 void KNote::toDesktop( int desktop )
@@ -932,7 +956,7 @@
   if ( desktop == 0 ) {
     return;
   }
-  
+
 #ifdef Q_WS_X11
   if ( desktop == NETWinInfo::OnAllDesktops ) {
     KWindowSystem::setOnAllDesktops( winId(), true );
@@ -945,45 +969,45 @@
 void KNote::setColor( const QColor &fg, const QColor &bg )
 {
   QPalette p = palette();
-  
+
   // better: from light(150) to light(100) to light(75)
   // QLinearGradient g( width()/2, 0, width()/2, height() );
   // g.setColorAt( 0, bg );
   // g.setColorAt( 1, bg.dark(150) );
-  
+
   p.setColor( QPalette::Window,     bg );
   // p.setBrush( QPalette::Window,     g );
   p.setColor( QPalette::Base,       bg );
   // p.setBrush( QPalette::Base,       g );
-  
+
   p.setColor( QPalette::WindowText, fg );
   p.setColor( QPalette::Text,       fg );
-  
+
   p.setColor( QPalette::Button,     bg.dark( 116 ) );
   p.setColor( QPalette::ButtonText, fg );
-  
+
   //p.setColor( QPalette::Highlight,  bg );
   //p.setColor( QPalette::HighlightedText, fg );
-  
+
   // order: Light, Midlight, Button, Mid, Dark, Shadow
-  
+
   // the shadow
   p.setColor( QPalette::Light, bg.light( 180 ) );
   p.setColor( QPalette::Midlight, bg.light( 150 ) );
   p.setColor( QPalette::Mid, bg.light( 150 ) );
   p.setColor( QPalette::Dark, bg.dark( 108 ) );
   p.setColor( QPalette::Shadow, bg.dark( 116 ) );
-  
+
   setPalette( p );
-  
+
   // darker values for the active label
   p.setColor( QPalette::Active, QPalette::Base, bg.dark( 116 ) );
-  
+
   m_label->setPalette( p );
-  
+
   // set the text color
   m_editor->setTextColor( fg );
-  
+
   // update the icon color
   KIconEffect effect;
   QPixmap icon = effect.apply( qApp->windowIcon().pixmap(
@@ -1018,11 +1042,11 @@
 {
   if ( hasFocus() ) {
     m_button->show();
-    m_grip->show();
-    
+
     if ( !m_editor->isReadOnly() ) {
       if ( m_tool && m_tool->isHidden() && m_editor->acceptRichText() ) {
         m_tool->show();
+	m_grip->show();
         setGeometry( x(), y(), width(), height() + m_tool->height() );
       }
     } else if ( m_tool && !m_tool->isHidden() ) {
@@ -1033,7 +1057,7 @@
   } else {
     m_button->hide();
     m_grip->hide();
-    
+
     if ( m_tool && !m_tool->isHidden() ) {
       m_tool->hide();
       setGeometry( x(), y(), width(), height() - m_tool->height() );
@@ -1092,7 +1116,7 @@
   if ( m_config->readOnly() ) {
     return;
   }
-  
+
   const QMimeData *md = e->mimeData();
   if ( md->hasColor() ) {
        QColor bg =  qvariant_cast<QColor>( md->colorData() );
@@ -1119,26 +1143,27 @@
     dragEnterEvent( static_cast<QDragEnterEvent *>( ev ) );
     return true;
   }
-  
+
   if ( ev->type() == QEvent::Drop &&
        static_cast<QDropEvent *>( ev )->mimeData()->hasColor() ) {
     dropEvent( static_cast<QDropEvent *>( ev ) );
     return true;
   }
-  
+
   if ( o == m_label ) {
     QMouseEvent *e = ( QMouseEvent * )ev;
-    
+
     if ( ev->type() == QEvent::MouseButtonDblClick ) {
-      slotRename();
+       if(!m_editor->isReadOnly())
+          slotRename();
     }
-    
+
     if ( ev->type() == QEvent::MouseButtonPress &&
         ( e->button() == Qt::LeftButton || e->button() == Qt::MidButton ) ) {
 #ifdef Q_WS_X11
       e->button() == Qt::LeftButton ? KWindowSystem::raiseWindow( winId() )
                                     : KWindowSystem::lowerWindow( winId() );
-      
+
       XUngrabPointer( QX11Info::display(), QX11Info::appTime() );
       NETRootInfo wm_root( QX11Info::display(), NET::WMMoveResize );
       wm_root.moveResizeRequest( winId(), e->globalX(), e->globalY(),
@@ -1146,7 +1171,7 @@
 #endif
       return true;
     }
-    
+
     if ( ev->type() == QEvent::MouseButtonRelease ) {
 #ifdef Q_WS_X11
         NETRootInfo wm_root( QX11Info::display(), NET::WMMoveResize );
@@ -1155,10 +1180,10 @@
 #endif
         return false;
     }
-    
+
     return false;
   }
-  
+
   if ( o == m_editor ) {
     if ( ev->type() == QEvent::FocusOut ) {
           QFocusEvent *fe = static_cast<QFocusEvent *>( ev );
@@ -1166,16 +1191,18 @@
                fe->reason() != Qt::MouseFocusReason ) {
             updateFocus();
             if ( isModified() ) {
-              saveData();
+              saveConfig();
+              if ( !m_blockEmitDataChanged )
+                  saveData();
             }
           }
     } else if ( ev->type() == QEvent::FocusIn ) {
       updateFocus();
     }
-    
+
     return false;
   }
-  
+
   return false;
 }
 
Index: knotes/knoteslegacy.cpp
===================================================================
--- knotes/knoteslegacy.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ knotes/knoteslegacy.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -71,9 +71,9 @@
   bool converted = false;
   
   QDir noteDir( KGlobal::dirs()->saveLocation( "appdata", "notes/" ) );
-  QStringList notes = noteDir.entryList( QDir::Files, QDir::Name );
-  for ( QStringList::Iterator note = notes.begin(); note != notes.end();
-        note++ ) {
+  const QStringList notes = noteDir.entryList( QDir::Files, QDir::Name );
+  for ( QStringList::ConstIterator note = notes.constBegin(); note != notes.constEnd();
+        ++note ) {
     QString file = noteDir.absoluteFilePath( *note );
     KConfig *test = new KConfig( file, KConfig::SimpleConfig );
     KConfigGroup grp( test, "General" );
@@ -260,7 +260,7 @@
   grp.deleteEntry( "state" );
   
   // load the saved text and put it in the journal
-  QFile infile( noteDir.absoluteFilePath( "." + file + "_data" ) );
+  QFile infile( noteDir.absoluteFilePath( '.' + file + "_data" ) );
   if ( infile.open( QIODevice::ReadOnly ) ) {
     QTextStream input( &infile );
     input.setCodec( "UTF-8" );
Index: knotes/knotesnetrecv.cpp
===================================================================
--- knotes/knotesnetrecv.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ knotes/knotesnetrecv.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -58,18 +58,18 @@
   QString date =
     KGlobal::locale()->formatDateTime( QDateTime::currentDateTime(),
                                        KLocale::ShortDate, false );
-  
+
   // Add the remote IP or hostname and the date to the title, to help the
   // user guess who wrote it.
   m_titleAddon = QString( " [%1, %2]" )
                   .arg( m_sock->peerAddress().toString() )
                   .arg( date );
-  
+
   // Setup the communications
   connect( m_sock, SIGNAL( readyRead() ), SLOT( slotDataAvailable() ) );
   connect( m_sock, SIGNAL( disconnected() ), SLOT( slotConnectionClosed() ) );
-  connect( m_sock, SIGNAL( error( int ) ), SLOT( slotError( int ) ) );
-  
+  connect( m_sock, SIGNAL(error(QAbstractSocket::SocketError)), SLOT(slotError(QAbstractSocket::SocketError)));
+
   // Setup the timer
   m_timer = new QTimer( this );
   m_timer->setSingleShot( true );
@@ -87,22 +87,22 @@
 {
   char smallBuffer[SBSIZE];
   int smallBufferLen;
-  
+
   do {
     // Append to "big buffer" only if we have some space left.
     int curLen = m_buffer->count();
-    
+
     smallBufferLen = m_sock->read( smallBuffer, SBSIZE );
-    
+
     // Limit max transfer over buffer, to avoid overflow.
     smallBufferLen = qMin( smallBufferLen, MAXBUFFER - curLen );
-    
+
     if ( smallBufferLen > 0 ) {
       m_buffer->resize( curLen + smallBufferLen );
       memcpy( m_buffer->data() + curLen, smallBuffer, smallBufferLen );
     }
   } while ( smallBufferLen == SBSIZE );
-  
+
   // If we are overflowing, close connection.
   if ( m_buffer->count() == MAXBUFFER ) {
     m_sock->close();
@@ -120,24 +120,24 @@
 {
   if ( m_timer->isActive() ) {
     QString noteText = QString( *m_buffer ).trimmed();
-    
+
     // First line is the note title or, in case of ATnotes, the id
     int pos = noteText.indexOf( QRegExp( "[\r\n]" ) );
     QString noteTitle = noteText.left( pos ).trimmed() + m_titleAddon;
-    
+
     noteText = noteText.mid( pos ).trimmed();
-    
+
     if ( !noteText.isEmpty() ) {
         emit sigNoteReceived( noteTitle, noteText );
     }
   }
-  
+
   deleteLater();
 }
 
-void KNotesNetworkReceiver::slotError( int err )
+void KNotesNetworkReceiver::slotError( QAbstractSocket::SocketError error )
 {
-  kWarning( 5500 ) << err << m_sock->errorString();
+    kWarning( 5500 ) <<"error type :"<< ( int ) error <<" error string : "<<m_sock->errorString();
 }
 
 #include "knotesnetrecv.moc"
Index: knotes/knoteedit.h
===================================================================
--- knotes/knoteedit.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ knotes/knoteedit.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -51,7 +51,6 @@
     QString text() const;
     
     void setTextFont( const QFont &font );
-    void setTextColor( const QColor &color );
     void setTabStop( int tabs );
     void setAutoIndentMode( bool newmode );
     
@@ -80,7 +79,8 @@
     
     void textIncreaseIndent();
     void textDecreaseIndent();
-    
+    void setTextFontSize( int );
+
   protected:
     virtual void contextMenuEvent( QContextMenuEvent * );
     virtual void dragEnterEvent( QDragEnterEvent * );
Index: knotes/knotesapp.cpp
===================================================================
--- knotes/knotesapp.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ knotes/knotesapp.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -69,25 +69,25 @@
     {
       setCaption( i18n( "Configure Shortcuts" ) );
       setButtons( Default | Ok | Cancel );
-      
+
       m_keyChooser = new KShortcutsEditor( globals, this );
       setMainWidget( m_keyChooser );
       connect( this, SIGNAL( defaultClicked() ),
                m_keyChooser, SLOT( allDefault() ) );
     }
-    
+
     void insert( KActionCollection *actions )
     {
         m_keyChooser->addCollection( actions, i18n( "Note Actions" ) );
     }
-    
+
     void configure()
     {
         if ( exec() == Accepted ) {
             m_keyChooser->save();
         }
     }
-    
+
   private:
     KShortcutsEditor *m_keyChooser;
 };
@@ -108,18 +108,18 @@
 
   // create the dock widget...
   m_tray = new KSystemTrayIcon();
-  
+
   m_tray->setToolTip( i18n( "KNotes: Sticky notes for KDE" ) );
   m_tray->setIcon( KSystemTrayIcon::loadIcon( "knotes" ) );
   connect( m_tray, SIGNAL( activated( QSystemTrayIcon::ActivationReason ) ),
            SLOT( slotActivated( QSystemTrayIcon::ActivationReason ) ) );
-  
+
   // set the initial style
 #ifdef __GNUC__
 #warning FIXME
 #endif
   //    KNote::setStyle( KNotesGlobalConfig::style() );
-  
+
   // create the GUI...
   KAction *action  = new KAction( KIcon( "document-new" ),
                                   i18n( "New Note" ), this );
@@ -127,31 +127,31 @@
                              KAction::DefaultShortcut );
   actionCollection()->addAction( "new_note", action );
   connect( action, SIGNAL( triggered() ), SLOT( newNote() ) );
-  
+
   action  = new KAction( KIcon( "edit-paste" ),
                          i18n( "New Note From Clipboard" ), this );
   action->setGlobalShortcut( KShortcut( Qt::ALT + Qt::SHIFT + Qt::Key_C ),
                              KAction::DefaultShortcut );
   actionCollection()->addAction( "new_note_clipboard", action );
   connect( action, SIGNAL( triggered() ), SLOT( newNoteFromClipboard() ) );
-  
+
   action  = new KAction( KIcon( "knotes" ), i18n( "Show All Notes" ), this );
   action->setGlobalShortcut( KShortcut( Qt::ALT + Qt::SHIFT + Qt::Key_S ),
                              KAction::DefaultShortcut );
   actionCollection()->addAction( "show_all_notes", action );
   connect( action, SIGNAL( triggered() ), SLOT( showAllNotes() ) );
-  
+
   action  = new KAction( KIcon( "window-close" ),
                          i18n( "Hide All Notes" ), this );
   action->setGlobalShortcut( KShortcut( Qt::ALT + Qt::SHIFT + Qt::Key_H ),
                              KAction::DefaultShortcut );
   actionCollection()->addAction( "hide_all_notes", action );
   connect( action, SIGNAL( triggered() ), SLOT( hideAllNotes() ) );
-  
+
   new KHelpMenu( this, KGlobal::mainComponent().aboutData(), false,
                  actionCollection() );
-  
-  KStandardAction::find( this, SLOT( slotOpenFindDialog() ),
+
+  m_findAction = KStandardAction::find( this, SLOT( slotOpenFindDialog() ),
                          actionCollection() );
   KStandardAction::preferences( this, SLOT( slotPreferences() ),
                          actionCollection() );
@@ -160,13 +160,13 @@
   //FIXME: no shortcut removing!?
   KStandardAction::quit( this, SLOT( slotQuit() ),
                          actionCollection() )->setShortcut( 0 );
-  
+
   setXMLFile( componentData().componentName() + "appui.rc" );
-  
+
   m_guiBuilder = new KXMLGUIBuilder( this );
   m_guiFactory = new KXMLGUIFactory( m_guiBuilder, this );
   m_guiFactory->addClient( this );
-  
+
   m_contextMenu = static_cast<KMenu *>( m_guiFactory->container(
                                         "knotes_context",
                                         this ) );
@@ -179,26 +179,26 @@
   QStringList fileList =
       componentData().dirs()->findAllResources( "data", filter ) +
       componentData().dirs()->findAllResources( "data", xmlFileName );
-  
+
   QString doc;
   KXMLGUIClient::findMostRecentXMLFile( fileList, doc );
   m_noteGUI.setContent( doc );
-  
+
   KConfigGroup config( KGlobal::config(), "Global Keybindings" );
-  
+
   // clean up old config files
   KNotesLegacy::cleanUp();
-  
+
   // create the resource manager
   m_manager = new KNotesResourceManager();
   connect( m_manager, SIGNAL( sigRegisteredNote( KCal::Journal * ) ),
            this,      SLOT( createNote( KCal::Journal * ) ) );
   connect( m_manager, SIGNAL( sigDeregisteredNote( KCal::Journal * ) ),
            this,      SLOT( killNote( KCal::Journal * ) ) );
-  
+
   // read the notes
   m_manager->load();
-  
+
   // read the old config files, convert and add them
   KCal::CalendarLocal calendar( QString::fromLatin1( "UTC" ) );
   if ( KNotesLegacy::convert( &calendar ) ) {
@@ -207,20 +207,20 @@
     for ( it = notes.constBegin(); it != notes.constEnd(); ++it ) {
       m_manager->addNewNote( *it );
     }
-    
+
     m_manager->save();
   }
-  
+
   // set up the alarm reminder - do it after loading the notes because this
   // is used as a check if updateNoteActions has to be called for a new note
   m_alarm = new KNotesAlarm( m_manager, this );
-  
+
    updateNetworkListener();
-  
+
   if ( m_notes.size() == 0 && !kapp->isSessionRestored() ) {
       newNote();
   }
-  
+
   updateNoteActions();
   m_tray->show();
 }
@@ -228,14 +228,20 @@
 KNotesApp::~KNotesApp()
 {
   saveNotes();
-  
+
   blockSignals( true );
   qDeleteAll( m_notes );
   m_notes.clear();
   qDeleteAll( m_noteActions );
   m_noteActions.clear();
   blockSignals( false );
-  
+
+  delete m_listener;
+  m_listener=0;
+  delete m_publisher;
+  m_publisher=0;
+  delete m_findPos;
+  m_findPos = 0;
   //delete m_listener;
   delete m_manager;
   delete m_guiBuilder;
@@ -254,7 +260,7 @@
 {
   // create the new note
   KCal::Journal *journal = new KCal::Journal();
-  
+
   // new notes have the current date/time as title if none was given
   if ( !name.isEmpty() ) {
     journal->setSummary( name );
@@ -262,14 +268,14 @@
     journal->setSummary( KGlobal::locale()->formatDateTime(
                                                QDateTime::currentDateTime() ) );
   }
-  
+
   // the body of the note
   journal->setDescription( text );
-  
+
   m_manager->addNewNote( journal );
-  
+
   showNote( journal->uid() );
-  
+
   return journal->uid();
 }
 
@@ -282,7 +288,7 @@
 void KNotesApp::hideAllNotes() const
 {
   foreach ( KNote *note, m_notes ) {
-    note->hide();
+    note->slotClose();
   }
 }
 
@@ -291,9 +297,9 @@
   foreach ( KNote *note, m_notes ) {
     // workaround to BUG 149116
     note->hide();
-    
+
     note->show();
-    note->setFocus();
+    //note->setFocus();
   }
 }
 
@@ -336,11 +342,11 @@
 QMap<QString, QString> KNotesApp::notes() const
 {
   QMap<QString, QString> notes;
-  
+
   foreach ( KNote *note, m_notes ) {
     notes.insert( note->noteId(), note->name() );
   }
-  
+
   return notes;
 }
 
@@ -393,7 +399,7 @@
     case QSystemTrayIcon::Trigger:
       if ( m_notes.size() == 1 ) {
         showNote( *m_notes.begin() );
-      } else if ( m_notes.size() > 1 ) {
+      } else if ( m_notes.size() != 1 ) {
         m_noteMenu->popup( QCursor::pos () );
       }
       break;
@@ -437,20 +443,20 @@
   findDia.setHasSelection( false );
   findDia.setHasCursor( false );
   findDia.setSupportsBackwardsFind( false );
-  
-  if ( findDia.exec() != QDialog::Accepted ) {
+
+  if ( (findDia.exec() != QDialog::Accepted) || findDia.pattern().isEmpty() ) {
     return;
   }
-  
+
   delete m_findPos;
   m_findPos = new QMap<QString, KNote *>::iterator();
   *m_findPos = m_notes.begin();
-  
+
   // this could be in an own method if searching without a dialog
   // should be possible
   delete m_find;
   m_find = new KFind( findDia.pattern(), findDia.options(), this );
-  
+
   slotFindNext();
 }
 
@@ -488,25 +494,25 @@
 void KNotesApp::slotConfigureAccels()
 {
   KNotesKeyDialog keys( actionCollection(), this );
-  
+
   QMap<QString, KNote *>::const_iterator it = m_notes.constBegin();
-  
+
   if ( !m_notes.isEmpty() ) {
     keys.insert( ( *it )->actionCollection() );
   }
-  
+
   keys.configure();
-  
+
   // update GUI doc for new notes
   m_noteGUI.setContent(
     KXMLGUIFactory::readConfigFile( componentData().componentName() + "ui.rc",
                                     componentData() )
                       );
-  
+
   if ( m_notes.isEmpty() ) {
     return;
   }
-  
+
   foreach ( QAction *action, ( *it )->actionCollection()->actions() ) {
     it = m_notes.constBegin();
     for ( ++it; it != m_notes.constEnd(); ++it ) {
@@ -521,7 +527,7 @@
 */
       QAction *toChange =
         ( *it )->actionCollection()->action( action->objectName() );
-      
+
       if ( toChange ) {
         toChange->setShortcuts( action->shortcuts() );
       }
@@ -531,6 +537,7 @@
 
 void KNotesApp::slotNoteKilled( KCal::Journal *journal )
 {
+  m_noteUidModify.clear();
   m_manager->deleteNote( journal );
   saveNotes();
 }
@@ -539,10 +546,10 @@
 {
   foreach ( KNote *note, m_notes ) {
     if ( note->isModified() ) {
-      note->saveData();
+      note->saveData(false);
     }
   }
-  
+
   saveConfigs();
   kapp->quit();
 }
@@ -562,9 +569,18 @@
 
 void KNotesApp::createNote( KCal::Journal *journal )
 {
+  if( journal->uid() == m_noteUidModify)
+  {
+         KNote *note = m_notes.value( m_noteUidModify );
+         if ( note )
+                 note->changeJournal(journal);
+
+         return;
+  }
+  m_noteUidModify = journal->uid();
   KNote *newNote = new KNote( m_noteGUI, journal, 0 );
   m_notes.insert( newNote->noteId(), newNote );
-  
+
   connect( newNote, SIGNAL( sigRequestNewNote() ),
            SLOT( newNote() ) );
   connect( newNote, SIGNAL( sigShowNextNote() ),
@@ -573,13 +589,13 @@
            SLOT( slotNoteKilled( KCal::Journal * ) ) );
   connect( newNote, SIGNAL( sigNameChanged() ),
            SLOT( updateNoteActions() ) );
-  connect( newNote, SIGNAL( sigDataChanged() ),
-           SLOT( saveNotes() ) );
+  connect( newNote, SIGNAL( sigDataChanged(const QString &) ),
+           SLOT( saveNotes(const QString &) ) );
   connect( newNote, SIGNAL( sigColorChanged() ),
            SLOT( updateNoteActions() ) );
   connect( newNote, SIGNAL( sigFindFinished() ),
            SLOT( slotFindNext() ) );
-  
+
   // don't call this during startup for each and every loaded note
   if ( m_alarm ) {
     updateNoteActions();
@@ -588,6 +604,10 @@
 
 void KNotesApp::killNote( KCal::Journal *journal )
 {
+  if(m_noteUidModify == journal->uid())
+  {
+         return;
+  }
   // this kills the KNote object
   KNote *note = m_notes.take( journal->uid() );
   if ( note )
@@ -597,11 +617,17 @@
   }
 }
 
+void KNotesApp::saveNotes( const QString & uid )
+{
+  m_noteUidModify = uid;
+  saveNotes();
+}
+
 void KNotesApp::acceptConnection()
 {
   // Accept the connection and make KNotesNetworkReceiver do the job
   QTcpSocket *s = m_listener->nextPendingConnection();
-  
+
   if ( s ) {
     KNotesNetworkReceiver *recv = new KNotesNetworkReceiver( s );
     connect( recv,
@@ -644,18 +670,26 @@
                     1,
                     note->palette().color( note->backgroundRole() ),
                     false );
-    
+
     action->setIcon( icon );
     m_noteActions.append( action );
   }
-  
-	qSort( m_noteActions.begin(), m_noteActions.end(), qActionLessThan );
-  
+
   if ( m_noteActions.isEmpty() ) {
+      actionCollection()->action( "hide_all_notes" )->setEnabled( false );
+      actionCollection()->action( "show_all_notes" )->setEnabled( false );
+      m_findAction->setEnabled( false );
     KAction *action = new KAction( i18n( "No Notes" ), this );
     m_noteActions.append( action );
   }
-  
+  else
+  {
+      qSort( m_noteActions.begin(), m_noteActions.end(), qActionLessThan );
+      actionCollection()->action( "hide_all_notes" )->setEnabled( true );
+      actionCollection()->action( "show_all_notes" )->setEnabled( true );
+      m_findAction->setEnabled( true );
+  }
+
   plugActionList( "notes", m_noteActions );
 }
 
@@ -665,7 +699,7 @@
     m_listener=0;
     delete m_publisher;
     m_publisher=0;
-    
+
     if ( KNotesGlobalConfig::receiveNotes() ) {
         // create the socket and start listening for connections
         m_listener=KSocketFactory::listen( "knotes" , QHostAddress::Any,
@@ -683,7 +717,7 @@
 #warning FIXME!
 #endif
   //    KNote::setStyle( KNotesGlobalConfig::style() );
-  
+
   foreach ( KNote *note, m_notes ) {
     QApplication::postEvent( note, new QEvent( QEvent::LayoutRequest ) );
   }
Index: knotes/knotesalarm.cpp
===================================================================
--- knotes/knotesalarm.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ knotes/knotesalarm.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -48,9 +48,9 @@
 {
   setObjectName( name );
   // TODO: fix timezone stuff?
-  
+
   connect( &m_checkTimer, SIGNAL( timeout() ), SLOT( checkAlarms() ) );
-  
+
   // interval in seconds
   m_checkTimer.start( 1000 * KNotesGlobalConfig::self()->checkInterval() );
 }
@@ -61,19 +61,21 @@
   if ( !from.isValid() ) {
     from.setTime_t( 0 );
   }
-  
+
   KDateTime now = KDateTime::currentLocalDateTime();
   KNotesGlobalConfig::self()->setAlarmsLastChecked( now.dateTime() );
   QList<KCal::Alarm *> alarms = m_manager->alarms( KDateTime( from,
 KDateTime::LocalZone ), now );
-  
+  if ( alarms.isEmpty() )
+      return;
+
   QStringList notes;
   QList<KCal::Alarm *>::ConstIterator it;
   for ( it = alarms.constBegin(); it != alarms.constEnd(); ++it ) {
     KCal::Incidence *incidence = ( *it )->parent();
     notes += incidence->summary();
   }
-  
+
   if ( !notes.isEmpty() ) {
     KMessageBox::informationList( 0,
                                   i18n( "The following notes triggered "
Index: knotes/resourcemanager.cpp
===================================================================
--- knotes/resourcemanager.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ knotes/resourcemanager.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -122,8 +122,8 @@
   KRES::Manager<ResourceNotes>::ActiveIterator it;
   for ( it = m_manager->activeBegin(); it != m_manager->activeEnd(); ++it ) {
     KCal::Alarm::List list = ( *it )->alarms( from, to );
-    KCal::Alarm::List::Iterator it;
-    for ( it = list.begin(); it != list.end(); ++it ) {
+    KCal::Alarm::List::ConstIterator it;
+    for ( it = list.constBegin(); it != list.constEnd(); ++it ) {
       result.append( *it );
     }
   }
Index: knotes/knotes_manager.desktop
===================================================================
--- knotes/knotes_manager.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ knotes/knotes_manager.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -32,6 +32,7 @@
 Name[lv]=Piezīmes
 Name[mk]=Белешки
 Name[ms]=Nota
+Name[nb]=Notater
 Name[nds]=Notizen
 Name[ne]=टिपोट
 Name[nl]=Notities
Index: knotes/knote.h
===================================================================
--- knotes/knote.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ knotes/knote.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -53,10 +53,10 @@
 {
   Q_OBJECT
   public:
-    KNote( QDomDocument buildDoc, KCal::Journal *journal, QWidget *parent = 0 );
+    KNote( const QDomDocument& buildDoc, KCal::Journal *journal, QWidget *parent = 0 );
     ~KNote();
-
-    void saveData();
+    void changeJournal(KCal::Journal *);
+    void saveData(bool update = true);
     void saveConfig() const;
 
     QString noteId() const;
@@ -69,15 +69,16 @@
     void find( KFind* kfind );
 
     bool isModified() const;
+    void blockEmitDataChanged( bool _b ) { m_blockEmitDataChanged = _b;}
 
   public slots:
     void slotKill( bool force = false );
-
+    void slotClose();
   signals:
     void sigRequestNewNote();
     void sigShowNextNote();
     void sigNameChanged();
-    void sigDataChanged();
+    void sigDataChanged(const QString &);
     void sigColorChanged();
     void sigKillNote( KCal::Journal * );
 
@@ -97,7 +98,6 @@
   private slots:
     void slotRename();
     void slotUpdateReadOnly();
-    void slotClose();
 
     void slotSend();
     void slotMail();
@@ -121,6 +121,7 @@
     void slotKeepAbove();
     void slotKeepBelow();
 
+    void slotRequestNewNote();
   private:
     void buildGui();
     void createActions();
@@ -160,6 +161,7 @@
     KToggleAction *m_keepBelow;
 
     KSharedConfig::Ptr m_kwinConf;
+    bool m_blockEmitDataChanged;
 };
 
 #endif
Index: knotes/knoteedit.cpp
===================================================================
--- knotes/knoteedit.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ knotes/knoteedit.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -178,7 +178,7 @@
   pix.fill( Qt::black ); // just a dummy, gets updated before widget is shown
   m_textColor  = new KAction( i18n( "Text Color..." ), this );
   actions->addAction( "format_color", m_textColor );
-  ( ( QAction * )m_textColor )->setIcon( pix );
+  m_textColor->setIcon( pix );
   connect( m_textColor, SIGNAL( triggered( bool ) ), SLOT( slotTextColor() ) );
   
   m_textFont  = new KFontAction( i18n( "Text Font" ), this );
@@ -189,7 +189,7 @@
   m_textSize  = new KFontSizeAction( i18n( "Text Size" ), this );
   actions->addAction( "format_size", m_textSize );
   connect( m_textSize, SIGNAL( fontSizeChanged( int ) ),
-           this, SLOT( setFontWeight ( int ) ) );
+           this, SLOT( setTextFontSize( int ) ) );
   
   // QTextEdit connections
   connect( this, SIGNAL( currentCharFormatChanged( const QTextCharFormat & ) ),
@@ -230,16 +230,13 @@
 
 void KNoteEdit::setTextFont( const QFont &font )
 {
-  QTextCharFormat f;
-  f.setFont( font );
-  setTextFormat( f );
+  setCurrentFont( font );
 }
 
-void KNoteEdit::setTextColor( const QColor &color )
+
+void KNoteEdit::setTextFontSize( int size )
 {
-  QTextCharFormat f;
-  f.setForeground( QBrush( color ) );
-  setTextFormat( f );
+	  setFontPointSize( size );
 }
 
 void KNoteEdit::setTabStop( int tabs )
@@ -427,7 +424,9 @@
       }
       insertPlainText( ( *it ).prettyUrl() );
     }
-  } else { KTextEdit::dropEvent( e ); }
+  } else {
+      KTextEdit::dropEvent( e );
+  }
 }
 
 void KNoteEdit::keyPressEvent( QKeyEvent *e )
@@ -462,7 +461,7 @@
 {
   // font changes
   m_textFont->setFont( f.fontFamily() );
-  m_textSize->setFontSize( ( int ) f.fontPointSize() );
+  m_textSize->setFontSize( (f.fontPointSize()>0 ) ?  ( int ) f.fontPointSize() :10);
   
   m_textBold->setChecked( f.font().bold() );
   m_textItalic->setChecked( f.fontItalic() );
Index: akonadi/tray/akonaditray.desktop
===================================================================
--- akonadi/tray/akonaditray.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ akonadi/tray/akonaditray.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -23,6 +23,7 @@
 GenericName[fr]=Utilitaire miniature Akonadi
 GenericName[ga]=Uirlis Tráidire Akonadi
 GenericName[gl]=Utilidade de Bandexa de Akonadi
+GenericName[is]=Akonadi kerfisbakkatól
 GenericName[it]=Utilità del vassoio di sistema di Akonadi
 GenericName[ja]=Akonadi システムトレイユーティリティ
 GenericName[km]=ឧបករណ៍​ប្រើប្រាស់​ថាស​ប្រព័ន្ធ​របស់ Akonadi
Index: akonadi/resources/vcard/vcardresource.desktop
===================================================================
--- akonadi/resources/vcard/vcardresource.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ akonadi/resources/vcard/vcardresource.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -10,6 +10,7 @@
 Name[fr]=Fichier VCard
 Name[ga]=Comhad v-Chárta
 Name[gl]=Ficheiro de VCard
+Name[is]=VCard spjaldskrá
 Name[it]=File vCard
 Name[ja]=VCard ファイル
 Name[km]=ឯកសារ VCard
@@ -42,6 +43,7 @@
 Comment[fr]=Charge des données depuis un fichier au format VCard
 Comment[ga]=Breiseán a luchtaíonn sonraí ó chomhad v-Chárta
 Comment[gl]=Carrega datos desde un ficheiro VCard
+Comment[is]=Hleður inn gögnum úr VCard spjaldskrá
 Comment[it]=Caricare dati da un file vCard
 Comment[ja]=VCard ファイルからデータを読み込みます
 Comment[km]=ផ្ទុក​ទិន្នន័យ​ពី​ឯកសារ VCard
Index: akonadi/resources/localbookmarks/localbookmarksresource.desktop
===================================================================
--- akonadi/resources/localbookmarks/localbookmarksresource.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ akonadi/resources/localbookmarks/localbookmarksresource.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -14,6 +14,7 @@
 Name[km]=ចំណាំ​មូលដ្ឋាន
 Name[ko]=로컬 책갈피
 Name[lv]=Lokālās grāmatzīmes
+Name[nb]=Lokale bokmerker
 Name[nds]=Lokaalleestekens
 Name[nl]=Lokale bladwijzers
 Name[nn]=Lokalbokmerke
Index: akonadi/resources/vcarddir/vcarddirresource.desktop
===================================================================
--- akonadi/resources/vcarddir/vcarddirresource.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ akonadi/resources/vcarddir/vcarddirresource.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -10,6 +10,7 @@
 Name[fr]=Dossier VCard
 Name[ga]=Comhadlann v-Chárta
 Name[gl]=Directorio de VCard
+Name[is]=Mappa fyrir VCard spjaldskrár
 Name[it]=Cartella vCard
 Name[ja]=VCard ディレクトリ
 Name[km]=ថត VCard
@@ -43,6 +44,7 @@
 Comment[fr]=Charge des données depuis un dossier contenant des fichiers VCard
 Comment[ga]=Gníomhaire a luchtaíonn sonraí ó chomhadlann ina bhfuil v-Chártaí
 Comment[gl]=Carregar datos desde un cartafol con VCards 
+Comment[is]=Hleður inn gögnum úr möppu með VCard spjaldskrám
 Comment[it]=Caricare dati da una cartella con file vCard
 Comment[ja]=VCard のディレクトリからデータを読み込みます
 Comment[km]=ផ្ទុក​ទីន្នន័យ​ពី​ថត​ដែល​មាន VCards
Index: MAINTAINERS
===================================================================
--- MAINTAINERS	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ MAINTAINERS	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -7,13 +7,11 @@
                   Lutz Rogowski <lutz@klaralvdalens-datakonsult.se>
 kfile-plugins     ?
 kioslave          ?
-kitchensync       Tobias Koenig <tokoe@kde.org>
 kjots             Stephen Kelly <steveire@gmail.com>
 kleopatra         Marc Mutz <mutz@kde.org>
                   Steffen Hansen <hansen@kde.org>
 kmail             Thomas McGuire <mcguire@kde.org>
 kmailcvt          Danny Kukawka <danny.kukawka@web.de>
-kmobiletools      Marco Gulino <marco.gulino@gmail.com>
 knode             Volker Krause <vkrause@kde.org>
 knotes            Guillermo Antonio Amaral Bastidas <me@guillermoamaral.com>
 kode              Cornelius Schumacher <schumacher@kde.org>
@@ -22,7 +20,6 @@
 kontactinterfaces Allen Winter <winter@kde.org>
 korganizer        Reinhold Kainhofer <reinhold@kainhofer.com>
                   Cornelius Schumacher <schumacher@kde.org>
-korn              Mart Kelder <mart.mailing@hccnet.nl>
 kpilot            Jason 'vanRijn' Kasper <vR@movingparts.net>
                   Adriaan de Groot <groot@kde.org>
 kresources        ?
Index: korganizer/koeditorgeneralevent.h
===================================================================
--- korganizer/koeditorgeneralevent.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeditorgeneralevent.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -70,7 +70,7 @@
     */
     void readEvent( Event *event, bool tmpl = false );
     /** Write event settings to event object */
-    void writeEvent( Event * );
+    void fillEvent( Event * );
 
     /** Check if the input is valid. */
     bool validateInput();
Index: korganizer/koattendeeeditor.cpp
===================================================================
--- korganizer/koattendeeeditor.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koattendeeeditor.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -304,7 +304,7 @@
   }
 }
 
-void KOAttendeeEditor::writeIncidence( KCal::Incidence *incidence )
+void KOAttendeeEditor::fillIncidence( KCal::Incidence *incidence )
 {
   if ( mOrganizerCombo ) {
     // TODO: Don't take a string and split it up... Is there a better way?
Index: korganizer/history.cpp
===================================================================
--- korganizer/history.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/history.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -105,7 +105,7 @@
 
 void History::addEntry( Entry *entry )
 {
-  if ( mCurrentMultiEntry ) {
+  if ( mCurrentMultiEntry && mCurrentMultiEntry != entry ) {
     mCurrentMultiEntry->appendEntry( entry );
   } else {
     truncate();
Index: korganizer/koeditorgeneraltodo.cpp
===================================================================
--- korganizer/koeditorgeneraltodo.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeditorgeneraltodo.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -304,6 +304,7 @@
     mDueDateEdit->setDate( QDate::currentDate() );
     mDueTimeEdit->setTime( QTime::currentTime() );
     mDueCheck->setChecked( false );
+    mTimeZoneComboDue->setEnabled( false );
   }
 
   if ( todo->hasStartDate() ) {
@@ -319,6 +320,7 @@
     mStartDateEdit->setDate( QDate::currentDate() );
     mStartTimeEdit->setTime( QTime::currentTime() );
     mStartCheck->setChecked( false );
+    mTimeZoneComboStart->setEnabled( false );
   }
 
   mTimeButton->setChecked( !todo->allDay() );
@@ -335,9 +337,9 @@
   mStartDateModified = false;
 }
 
-void KOEditorGeneralTodo::writeTodo( Todo *todo )
+void KOEditorGeneralTodo::fillTodo( Todo *todo )
 {
-  KOEditorGeneral::writeIncidence( todo );
+  KOEditorGeneral::fillIncidence( todo );
 
   // temp. until something better happens.
   QString tmpStr;
Index: korganizer/koeditorgeneral.cpp
===================================================================
--- korganizer/koeditorgeneral.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeditorgeneral.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -327,6 +327,8 @@
 {
   KPIM::CategorySelectDialog *categoryDialog =
     new KPIM::CategorySelectDialog( KOPrefs::instance(), mCategoriesButton );
+  categoryDialog->setHelp( "categories-view", "korganizer" );
+  categoryDialog->setButtons( KDialog::Ok | KDialog::Cancel | KDialog::Help );
   KOGlobals::fitDialogToScreen( categoryDialog );
   categoryDialog->setSelected( mCategories );
 
@@ -493,7 +495,7 @@
   }
 }
 
-void KOEditorGeneral::writeIncidence( Incidence *incidence )
+void KOEditorGeneral::fillIncidence( Incidence *incidence )
 {
   incidence->setSummary( mSummaryEdit->text() );
   incidence->setLocation( mLocationEdit->text() );
@@ -532,7 +534,7 @@
       incidence->addAlarm( al );
     }
   }
-  mAttachments->writeIncidence( incidence );
+  mAttachments->fillIncidence( incidence );
 }
 
 void KOEditorGeneral::setSummary( const QString &text )
Index: korganizer/koeventeditor.cpp
===================================================================
--- korganizer/koeventeditor.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeventeditor.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -66,6 +66,16 @@
   }
 }
 
+bool KOEventEditor::incidenceModified() {
+  Event *newEvent = 0;
+
+  if ( mEvent ) {
+    newEvent = mEvent->clone();
+    fillEvent( newEvent );
+  }
+  return mEvent && !( *newEvent == *mEvent );
+}
+
 void KOEventEditor::init()
 {
   setupGeneral();
@@ -288,7 +298,7 @@
     Event *oldEvent = mEvent->clone();
     Event *event = mEvent->clone();
 
-    writeEvent( event );
+    fillEvent( event );
 
     if ( *event == *mEvent ) {
       // Don't do anything
@@ -301,7 +311,7 @@
       }
     } else {
       //IncidenceChanger::assignIncidence( mEvent, event );
-      writeEvent( mEvent );
+      fillEvent( mEvent );
       if ( mIsCounter ) {
         KOGroupware::instance()->sendCounterProposal( mCalendar, oldEvent, mEvent );
         // add dummy event at the position of the counter proposal
@@ -320,7 +330,7 @@
     mEvent = new Event;
     mEvent->setOrganizer( Person( KOPrefs::instance()->fullName(),
                           KOPrefs::instance()->email() ) );
-    writeEvent( mEvent );
+    fillEvent( mEvent );
     if ( !mChanger->addIncidence( mEvent, this ) ) {
       delete mEvent;
       mEvent = 0;
@@ -373,16 +383,16 @@
   }
 }
 
-void KOEventEditor::writeEvent( Event *event )
+void KOEventEditor::fillEvent( Event *event )
 {
-  mGeneral->writeEvent( event );
+  mGeneral->fillEvent( event );
   if ( mFreeBusy ) {
-    mFreeBusy->writeIncidence( event );
+    mFreeBusy->fillIncidence( event );
   }
 
   cancelRemovedAttendees( event );
 
-  mRecurrence->writeIncidence( event );
+  mRecurrence->fillIncidence( event );
 
   writeDesignerFields( event );
 }
@@ -429,7 +439,7 @@
 void KOEventEditor::slotSaveTemplate( const QString &templateName )
 {
   Event *event = new Event;
-  writeEvent( event );
+  fillEvent( event );
   saveAsTemplate( event, templateName );
 }
 
@@ -441,7 +451,7 @@
 void KOEventEditor::updateRecurrenceSummary()
 {
   Event *ev =  new Event();
-  writeEvent( ev );
+  fillEvent( ev );
   mGeneral->updateRecurrenceSummary( IncidenceFormatter::recurrenceString( ev ) );
   delete ev;
 }
Index: korganizer/koeditorfreebusy.cpp
===================================================================
--- korganizer/koeditorfreebusy.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeditorfreebusy.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -424,8 +424,15 @@
   clearAttendees();
 
   KDateTime::Spec timeSpec = KOPrefs::instance()->timeSpec();
+  QDateTime endDateTime = incidence->dtEnd().toTimeSpec( timeSpec ).dateTime();
+
+  // in kcal, all day events have an inclusive dtEnd()
+  if ( incidence->allDay() ) {
+    endDateTime = endDateTime.addDays( 1 );
+  }
+
   setDateTimes( incidence->dtStart().toTimeSpec( timeSpec ).dateTime(),
-                incidence->dtEnd().toTimeSpec( timeSpec ).dateTime() );
+                endDateTime );
   mIsOrganizer = KOPrefs::instance()->thatIsMe( incidence->organizer().email() );
   updateStatusSummary();
   clearSelection();
@@ -760,7 +767,7 @@
   dialog.exec();
 }
 
-void KOEditorFreeBusy::writeIncidence( Incidence *incidence )
+void KOEditorFreeBusy::fillIncidence( Incidence *incidence )
 {
   incidence->clearAttendees();
   QVector<FreeBusyItem*> toBeDeleted;
@@ -804,7 +811,7 @@
     }
   }
 
-  KOAttendeeEditor::writeIncidence( incidence );
+  KOAttendeeEditor::fillIncidence( incidence );
 
   // cleanup
   qDeleteAll( toBeDeleted );
Index: korganizer/koattendeeeditor.h
===================================================================
--- korganizer/koattendeeeditor.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koattendeeeditor.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -56,7 +56,7 @@
     virtual void insertAttendee( KCal::Attendee *attendee, bool fetchFB = true ) = 0;
 
     virtual void readIncidence( KCal::Incidence *incidence );
-    virtual void writeIncidence( KCal::Incidence *incidence );
+    virtual void fillIncidence( KCal::Incidence *incidence );
 
     /** return a clone of the incidence with attendees to be canceld*/
     void cancelAttendeeIncidence( KCal::Incidence *incidence );
Index: korganizer/dbuscalendar.desktop
===================================================================
--- korganizer/dbuscalendar.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/dbuscalendar.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -35,6 +35,7 @@
 Comment[kk]=D-BUS интерфейсті Ұйымдастырғыш
 Comment[km]=កម្មវិធី​រៀបចំ​ដែល​មាន​ចំណុច​ប្រទាក់ D-BUS
 Comment[ko]=D-BUS 인터페이스를 사용하는 오거나이저
+Comment[lt]=Planuoklis su D-Bus sąsaja
 Comment[lv]=Organizators ar D-BUS saskarni
 Comment[nb]=Organizer med D-BUS-grensesnitt
 Comment[nds]=En Daagpleger mit en D-Bus-Koppelsteed
Index: korganizer/koeditorgeneral.h
===================================================================
--- korganizer/koeditorgeneral.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeditorgeneral.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -88,7 +88,7 @@
     void readIncidence( Incidence *incidence );
 
     /** Write event settings to event object */
-    void writeIncidence( Incidence * );
+    void fillIncidence( Incidence * );
 
     /** Check if the input is valid. */
     bool validateInput();
Index: korganizer/koeventeditor.h
===================================================================
--- korganizer/koeventeditor.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeventeditor.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -95,7 +95,7 @@
     /**
       Write event settings to event object
     */
-    void writeEvent( Event * );
+    void fillEvent( Event * );
 
     QObject *typeAheadReceiver() const;
 
@@ -126,6 +126,7 @@
     int msgItemDelete();
     void loadTemplate( CalendarLocal & );
     QStringList &templates() const;
+    bool incidenceModified();
 
   private:
     Event *mEvent;
Index: korganizer/koeditorgeneralevent.cpp
===================================================================
--- korganizer/koeditorgeneralevent.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeditorgeneralevent.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -432,9 +432,9 @@
   readIncidence( event );
 }
 
-void KOEditorGeneralEvent::writeEvent( Event *event )
+void KOEditorGeneralEvent::fillEvent( Event *event )
 {
-  writeIncidence( event );
+  fillIncidence( event );
 
   QDate tmpDate;
   QTime tmpTime;
Index: korganizer/koeditorattachments.h
===================================================================
--- korganizer/koeditorattachments.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeditorattachments.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -104,7 +104,7 @@
     /** Read event object and setup widgets accordingly */
     void readIncidence( KCal::Incidence * );
     /** Write event settings to event object */
-    void writeIncidence( KCal::Incidence * );
+    void fillIncidence( KCal::Incidence * );
 
     bool hasAttachments();
 
Index: korganizer/korgac/alarmdialog.cpp
===================================================================
--- korganizer/korgac/alarmdialog.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/korgac/alarmdialog.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -413,8 +413,17 @@
       // FIXME: Check whether this should be done for all multiple alarms
       if ( alarm->type() == Alarm::Procedure ) {
         // FIXME: Add a message box asking whether the procedure should really be executed
-      kDebug() << "Starting program: '" << alarm->programFile() << "'";
-      QProcess::startDetached( alarm->programFile() );
+        kDebug() << "Starting program: '" << alarm->programFile() << "'";
+
+        QString program = alarm->programFile();
+
+        // if the program name contains spaces escape it
+        if ( program.contains( " " )   &&
+             !( program.startsWith( "\"" ) && program.endsWith( "\"" ) ) ) {
+          program = "\"" + program + "\"";
+        }
+
+        QProcess::startDetached( program + " " + alarm->programArguments() );
       } else if ( alarm->type() == Alarm::Audio ) {
         beeped = true;
         Phonon::MediaObject *player =
Index: korganizer/interfaces/calendar/calendarplugin.desktop
===================================================================
--- korganizer/interfaces/calendar/calendarplugin.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/interfaces/calendar/calendarplugin.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -14,8 +14,9 @@
 Name[ja]=カレンダープラグインインターフェース
 Name[km]=ប្រតិទិន​កម្មវិធី​ជំនួយ​ប្រតិទិន
 Name[ko]=달력 플러그인 인터페이스
+Name[lt]=Kalendoriaus priedo sąsaja
 Name[lv]=Kalendāra spraudņa saskarne
-Name[nb]=Calendar-grensesnitt for programtillegg
+Name[nb]=Grensesnitt til kalender-programtillegg
 Name[nds]=Kalennermoduul-Koppelsteed
 Name[nl]=Agendapluginuiterlijk
 Name[nn]=Grensesnitt til kalender-programtillegg
@@ -67,7 +68,7 @@
 Comment[lv]=Kalendāra spraudnis
 Comment[mk]=Приклучок за календар
 Comment[ms]=Plugin Kalendar
-Comment[nb]=Calendar-programtillegg
+Comment[nb]=Kalender-programtillegg
 Comment[nds]=Kalenner-Moduul
 Comment[ne]=क्यालेन्डर प्लगइन
 Comment[nl]=Agendaplugin
Index: korganizer/interfaces/calendar/calendardecoration.desktop
===================================================================
--- korganizer/interfaces/calendar/calendardecoration.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/interfaces/calendar/calendardecoration.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -14,8 +14,9 @@
 Name[ja]=カレンダー装飾インターフェース
 Name[km]=ចំណុច​ប្រទាក់​តុបតែង​ប្រតិទិន
 Name[ko]=달력 장식 인터페이스
+Name[lt]=Kalendoriaus dekoracijų sąsaja
 Name[lv]=Kalendāra dekorāciju saskarne
-Name[nb]=Calendar dekorasjonsgrensesnitt
+Name[nb]=Grensesnitt til kalenderpynt
 Name[nds]=Kalennerdekoratschoon-Koppelsteed
 Name[nl]=Agendadecoratie-uiterlijk
 Name[nn]=Grensesnitt til kalenderpynt
@@ -67,7 +68,7 @@
 Comment[lv]=Kalendāra dekorāciju spraudnis
 Comment[mk]=Приклучок за декорација на календар
 Comment[ms]=Plugin Hiasan Kalendar
-Comment[nb]=Calendar dekorasjonsprogramtillegg
+Comment[nb]=Programtillegg for kalenderpynt
 Comment[nds]=Dekoratschoon för den Kalenner
 Comment[ne]=क्यालेन्डर सजावट प्लगइन
 Comment[nl]=Agendadecoratieplugin
Index: korganizer/kotodoeditor.cpp
===================================================================
--- korganizer/kotodoeditor.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/kotodoeditor.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -62,6 +62,16 @@
   emit dialogClose( mTodo );
 }
 
+bool KOTodoEditor::incidenceModified() {
+  Todo *newTodo = 0;
+
+  if ( mTodo ) {
+    newTodo = mTodo->clone();
+    fillTodo( newTodo );
+  }
+  return mTodo && !( *newTodo == *mTodo );
+}
+
 void KOTodoEditor::init()
 {
   setupGeneral();
@@ -75,6 +85,8 @@
 
   connect( mGeneral, SIGNAL(openCategoryDialog()),
            SIGNAL(editCategories()) );
+  connect( this, SIGNAL(updateCategoryConfig()),
+           mGeneral, SIGNAL(updateCategoryConfig()) );
 
   connect( mDetails, SIGNAL(updateAttendeeSummary(int)),
            mGeneral, SLOT(updateAttendeeSummary(int)) );
@@ -220,13 +232,13 @@
     Todo *oldTodo = mTodo->clone();
     Todo *todo = mTodo->clone();
 
-    writeTodo( todo );
+    fillTodo( todo );
 
     if( *mTodo == *todo ) {
       // Don't do anything
     } else {
       //IncidenceChanger::assignIncidence( mTodo, todo );
-      writeTodo( mTodo );
+      fillTodo( mTodo );
       mChanger->changeIncidence( oldTodo, mTodo );
     }
     delete todo;
@@ -237,7 +249,7 @@
     mTodo = new Todo;
     mTodo->setOrganizer( Person( KOPrefs::instance()->fullName(), KOPrefs::instance()->email() ) );
 
-    writeTodo( mTodo );
+    fillTodo( mTodo );
 
     if ( !mChanger->addIncidence( mTodo, this ) ) {
       delete mTodo;
@@ -298,13 +310,13 @@
   readDesignerFields( todo );
 }
 
-void KOTodoEditor::writeTodo( Todo *todo )
+void KOTodoEditor::fillTodo( Todo *todo )
 {
   Incidence *oldIncidence = todo->clone();
 
-  mGeneral->writeTodo( todo );
-  mDetails->writeIncidence( todo );
-  mRecurrence->writeIncidence( todo );
+  mGeneral->fillTodo( todo );
+  mDetails->fillIncidence( todo );
+  mRecurrence->fillIncidence( todo );
 
   if ( *( oldIncidence->recurrence() ) != *( todo->recurrence() ) ) {
     todo->setDtDue( todo->dtDue(), true );
@@ -367,7 +379,7 @@
 void KOTodoEditor::slotSaveTemplate( const QString &templateName )
 {
   Todo *todo = new Todo;
-  writeTodo( todo );
+  fillTodo( todo );
   saveAsTemplate( todo, templateName );
 }
 
Index: korganizer/koeditorgeneraljournal.cpp
===================================================================
--- korganizer/koeditorgeneraljournal.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeditorgeneraljournal.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -176,7 +176,7 @@
   setCategories( journal->categories() );
 }
 
-void KOEditorGeneralJournal::writeJournal( Journal *journal )
+void KOEditorGeneralJournal::fillJournal( Journal *journal )
 {
   journal->setSummary( mSummaryEdit->text() );
   if ( mRichDescription->isChecked() ) {
Index: korganizer/koeditordetails.cpp
===================================================================
--- korganizer/koeditordetails.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeditordetails.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -281,7 +281,7 @@
   emit updateAttendeeSummary( mListView->childCount() );
 }
 
-void KOEditorDetails::writeIncidence( Incidence *incidence )
+void KOEditorDetails::fillIncidence( Incidence *incidence )
 {
   incidence->clearAttendees();
   QVector<Q3ListViewItem*> toBeDeleted;
@@ -326,7 +326,7 @@
     }
   }
 
-  KOAttendeeEditor::writeIncidence( incidence );
+  KOAttendeeEditor::fillIncidence( incidence );
 
   // cleanup
   qDeleteAll( toBeDeleted );
Index: korganizer/koeditorfreebusy.h
===================================================================
--- korganizer/koeditorfreebusy.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeditorfreebusy.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -60,7 +60,7 @@
     void clearAttendees();
 
     void readIncidence( KCal::Incidence *incidence );
-    void writeIncidence( KCal::Incidence *incidence );
+    void fillIncidence( KCal::Incidence *incidence );
 
     void triggerReload();
     void cancelReload();
Index: korganizer/kodaymatrix.cpp
===================================================================
--- korganizer/kodaymatrix.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/kodaymatrix.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -289,8 +289,10 @@
          !( recurType == Recurrence::rWeekly && !KOPrefs::instance()->mWeeklyRecur ) ) {
 
       DateTimeList timeDateList;
+      bool isRecurrent = event->recurs();
+      int eventDuration = event->dtStart().daysTo( event->dtEnd() );
 
-      if ( event->recurs() ) {
+      if ( isRecurrent ) {
         //Its a recurring event, find out in which days it occurs
         timeDateList = event->recurrence()->timesInInterval(
           *new KDateTime( mDays[0], mCalendar->timeSpec() ),
@@ -310,6 +312,13 @@
         QDate d = t->date();
         int j   = 0;
 
+        QDate occurrenceEnd;
+        if ( isRecurrent ) {
+          occurrenceEnd = d.addDays( eventDuration );
+        } else {
+          occurrenceEnd = event->dtEnd().date();
+        }
+
         do {
 
           mEvents.append( d );
@@ -317,7 +326,7 @@
           ++j;
           d = d.addDays( 1 );
 
-        } while ( d <= event->dtEnd().date() && j < NUMDAYS );
+        } while ( d <= occurrenceEnd && j < NUMDAYS );
       }
     }
   }
Index: korganizer/koeditorrecurrence.cpp
===================================================================
--- korganizer/koeditorrecurrence.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeditorrecurrence.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -1407,7 +1407,7 @@
   mExceptions->setDates( incidence->recurrence()->exDates() );
 }
 
-void KOEditorRecurrence::writeIncidence( Incidence *incidence )
+void KOEditorRecurrence::fillIncidence( Incidence *incidence )
 {
   if ( !mEnabledCheck->isChecked() || !isEnabled() ) {
     if ( incidence->recurs() ) {
Index: korganizer/kotodoeditor.h
===================================================================
--- korganizer/kotodoeditor.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/kotodoeditor.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -82,7 +82,7 @@
     void readTodo( Todo *todo, bool tmpl = false );
 
     /** Write To-do settings to todo object */
-    void writeTodo( Todo *todo );
+    void fillTodo( Todo *todo );
 
     /** Check if the input is valid. */
     bool validateInput();
@@ -108,6 +108,7 @@
     void setupGeneral();
     void setupRecurrence();
     int msgItemDelete();
+    bool incidenceModified();
 
   private:
     Todo *mTodo;
Index: korganizer/filtereditdialog.cpp
===================================================================
--- korganizer/filtereditdialog.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/filtereditdialog.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -292,6 +292,8 @@
 
   if ( !mCategorySelectDialog ) {
     mCategorySelectDialog = new KPIM::CategorySelectDialog( KOPrefs::instance(), this );
+    mCategorySelectDialog->setHelp( "categories-view", "korganizer" );
+    mCategorySelectDialog->setButtons( KDialog::Ok | KDialog::Cancel | KDialog::Help );
     connect( mCategorySelectDialog, SIGNAL(categoriesSelected(const QStringList&)),
              SLOT(updateCategorySelection(const QStringList&)) );
     connect( mCategorySelectDialog, SIGNAL(editCategories()),
Index: korganizer/views/monthview/monthgraphicsitems.cpp
===================================================================
--- korganizer/views/monthview/monthgraphicsitems.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/views/monthview/monthgraphicsitems.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -164,7 +164,10 @@
 
 QPainterPath MonthGraphicsItem::shape() const
 {
-  return widgetPath( true );
+  // The returned shape must be a closed path,
+  // otherwise MonthScene:itemAt( pos ) can have
+  // problems detecting the item
+  return widgetPath( false );
 }
 
 // TODO: remove this method.
Index: korganizer/views/todoview/kotodomodel.cpp
===================================================================
--- korganizer/views/todoview/kotodomodel.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/views/todoview/kotodomodel.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -800,8 +800,10 @@
     if ( role == Qt::EditRole ) {
       switch ( index.column() ) {
         case SummaryColumn:
-          todo->setSummary( value.toString() );
-          modified = KOGlobals::SUMMARY_MODIFIED;
+          if ( !value.toString().isEmpty() ) {
+            todo->setSummary( value.toString() );
+            modified = KOGlobals::SUMMARY_MODIFIED;
+          }
           break;
         case PriorityColumn:
           todo->setPriority( value.toInt() );
Index: korganizer/views/todoview/kotodoview.cpp
===================================================================
--- korganizer/views/todoview/kotodoview.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/views/todoview/kotodoview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -233,6 +233,8 @@
   }
   connect( mPercentageCompletedPopupMenu, SIGNAL(triggered(QAction *)),
            SLOT(setNewPercentage(QAction *)) );
+
+  setMinimumHeight( 50 );
 }
 
 KOTodoView::~KOTodoView()
Index: korganizer/views/whatsnextview/kowhatsnextview.cpp
===================================================================
--- korganizer/views/whatsnextview/kowhatsnextview.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/views/whatsnextview/kowhatsnextview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -104,10 +104,10 @@
 
   Event::List events;
   KDateTime::Spec timeSpec = KOPrefs::instance()->timeSpec();
-  for ( QDate date = mStartDate; date <= mEndDate; date = date.addDays( 1 ) ) {
-    events += calendar()->events( date, timeSpec, EventSortStartDate, SortDirectionAscending );
-  }
 
+  events = calendar()->events( mStartDate, mEndDate, timeSpec, false );
+  calendar()->sortEvents( &events, EventSortStartDate, SortDirectionAscending );
+
   if ( events.count() > 0 ) {
     mText += "<p></p>";
     kil.loadIcon( "view-calendar-day", KIconLoader::NoGroup, 22,
Index: korganizer/views/timespentview/kotimespentview.cpp
===================================================================
--- korganizer/views/timespentview/kotimespentview.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/views/timespentview/kotimespentview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -79,16 +79,62 @@
       QMap<QString, int> secondsSpent;
 
       int total = 0;
+
       foreach ( Event *e, mEventList ) {
+
+        KDateTime selectedStart( mTimeSpentView->mStartDate,
+                                 QTime( 0, 0 ),
+                                 e->dtStart().timeSpec() );
+
+        KDateTime selectedEnd( mTimeSpentView->mEndDate.addDays( 1 ),
+                               QTime( 0, 0 ),
+                               e->dtEnd().timeSpec() );
+
+        KDateTime start;
+        KDateTime end;
+
+        // duration of all occurrences added
+        int totalDuration = 0;
+
+        if ( e->recurs() ) {
+          int eventDuration = e->dtStart().secsTo( e->dtEnd() );
+
+          // timesInInterval only return events that have their start inside the interval
+          // so we resize the interval by -eventDuration
+          DateTimeList times = e->recurrence()->timesInInterval( selectedStart.addSecs( -eventDuration ), selectedEnd );
+
+          foreach ( KDateTime kdt, times ) {
+            // either the event's start or the event's end must be in the view's interval
+            if ( kdt >= selectedStart ||
+                 kdt.addSecs( eventDuration ) >= selectedStart ) {
+
+              start = kdt > selectedStart ? kdt : selectedStart;
+              end   = kdt.addSecs( eventDuration ) < selectedEnd ? kdt.addSecs( eventDuration ) : selectedEnd;
+              totalDuration += start.secsTo( end );
+            }
+          }
+
+        } else {
+          // The event's start can be before the view's start date or end after the view's end
+          start  = e->dtStart() > selectedStart ? e->dtStart() : selectedStart;
+          end    = e->dtEnd()   < selectedEnd   ? e->dtEnd()   : selectedEnd;
+
+          totalDuration += start.secsTo( end );
+        }
+
+        if ( totalDuration == 0 ) {
+          continue;
+        }
+
         if ( e->categories().count() ) {
           foreach ( const QString &s, e->categories() ) {
-            secondsSpent[ s ] += e->dtStart().secsTo( e->dtEnd() );
+            secondsSpent[ s ] += totalDuration;
           }
         } else {
-          secondsSpent[ i18n( "No category" ) ] += e->dtStart().secsTo( e->dtEnd() );
+          secondsSpent[ i18n( "No category" ) ] += totalDuration;
         }
 
-        total += e->dtStart().secsTo( e->dtEnd() );
+        total += totalDuration;
       }
 
       QMapIterator<QString, int> i( secondsSpent );
@@ -201,14 +247,9 @@
   }
   text+="</h2>\n";
   */
-  Event::List events;
+
   KDateTime::Spec timeSpec = KOPrefs::instance()->timeSpec();
-  for ( QDate date = mStartDate; date <= mEndDate; date = date.addDays( 1 ) ) {
-    events += calendar()->events( date, timeSpec,
-                                  EventSortStartDate, SortDirectionAscending );
-  }
-
-  mView->mEventList = events;
+  mView->mEventList = calendar()->events( mStartDate, mEndDate, timeSpec );
   mView->repaint();
 }
 
Index: korganizer/views/agendaview/koagendaview.cpp
===================================================================
--- korganizer/views/agendaview/koagendaview.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/views/agendaview/koagendaview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -1244,8 +1244,15 @@
     }
     if ( todo ) {
       QTime t = todo->dtDue().toTimeSpec( KOPrefs::instance()->timeSpec() ).time();
-      endY = mAgenda->timeToY( t ) - 1;
-      startY = mAgenda->timeToY( t.addSecs( -1800 ) );
+
+      int halfHour = 1800;
+      if ( t.addSecs( -halfHour ) < t ) {
+        startY = mAgenda->timeToY( t.addSecs( -halfHour ) );
+        endY   = mAgenda->timeToY( t ) - 1;
+      } else {
+        startY = 0;
+        endY   = mAgenda->timeToY( t.addSecs( halfHour ) ) - 1;
+      }
     }
     if ( endY < startY ) {
       endY = startY;
@@ -1471,7 +1478,7 @@
 void KOAgendaView::updateEventIndicatorTop( int newY )
 {
   for ( int i = 0; i < mMinY.size(); ++i ) {
-    mEventIndicatorTop->enableColumn( i, newY >= mMinY[i] );
+    mEventIndicatorTop->enableColumn( i, newY > mMinY[i] );
   }
   mEventIndicatorTop->update();
 }
@@ -1544,8 +1551,12 @@
   KConfigGroup group = config->group( "Views" );
 
   QList<int> sizes = group.readEntry( "Separator AgendaView", QList<int>() );
-  mSplitterAgenda->setSizes( sizes );
 
+  // the size depends on the number of plugins used
+  if ( sizes.count() >= 2 ) {
+    mSplitterAgenda->setSizes( sizes );
+  }
+
   updateConfig();
 }
 
Index: korganizer/views/agendaview/koagendaitem.cpp
===================================================================
--- korganizer/views/agendaview/koagendaitem.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/views/agendaview/koagendaitem.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -879,16 +879,7 @@
   QColor textColor = getTextColor( bgColor );
   p.setPen( textColor );
 
-  p.setFont( KOPrefs::instance()->agendaCalendarItemsFont() );
-  if ( mIncidence ) {
-    if ( mIncidence->type() == "Event" ) {
-      p.setFont( KOPrefs::instance()->agendaCalendarItemsEventsFont() );
-    }
-    if ( mIncidence->type() == "Todo" ) {
-      p.setFont( KOPrefs::instance()->agendaCalendarItemsToDosFont() );
-    }
-  }
-
+  p.setFont( KOPrefs::instance()->agendaViewFont() );
   QFontMetrics fm = p.fontMetrics();
 
   int singleLineHeight = fm.boundingRect( mLabelText ).height();
Index: korganizer/kojournaleditor.h
===================================================================
--- korganizer/kojournaleditor.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/kojournaleditor.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -97,7 +97,7 @@
     void readJournal( Journal *journal, bool tmpl = false );
 
     /** Write Journal settings to journal object */
-    void writeJournal( Journal * );
+    void fillJournal( Journal * );
 
     int msgItemDelete();
 
@@ -123,6 +123,7 @@
     void setupGeneral();
     void loadTemplate( CalendarLocal & );
     QStringList &templates() const;
+    bool incidenceModified();
 
   private:
     Journal *mJournal;
Index: korganizer/timelabels.cpp
===================================================================
--- korganizer/timelabels.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/timelabels.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -203,6 +203,14 @@
   //testline
   //p->drawLine(0,0,0,contentsHeight());
   while ( y < cy + ch + mCellHeight ) {
+    QPen pen;
+    if ( cell < 0 || cell >= 24 ) {
+      pen.setColor( QColor( 150, 150, 150 ) );
+    } else {
+      pen.setColor( palette().color( QPalette::WindowText ) );
+    }
+    p->setPen( pen );
+
     // hour, full line
     p->drawLine( cx, int( y ), cw + 2, int( y ) );
 
@@ -224,14 +232,6 @@
       }
     }
 
-    QPen pen;
-    if ( cell < 0 || cell >= 24 ) {
-      pen.setColor( QColor( 150, 150, 150 ) );
-    } else {
-      pen.setColor( QPalette::Text );
-    }
-    p->setPen( pen );
-
     // center and draw the time label
     int timeWidth = fm.width( hour );
     int offset = startW - timeWidth - tw2 -1 ;
Index: korganizer/koeditordetails.h
===================================================================
--- korganizer/koeditordetails.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeditordetails.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -95,7 +95,7 @@
     void readIncidence( Incidence * );
 
     /** Write settings to incidence */
-    void writeIncidence( Incidence * );
+    void fillIncidence( Incidence * );
 
     /** Check if the input is valid. */
     bool validateInput();
Index: korganizer/koeditorrecurrence.h
===================================================================
--- korganizer/koeditorrecurrence.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeditorrecurrence.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -314,7 +314,7 @@
     void readIncidence( Incidence * );
 
     /** Write event settings to event object */
-    void writeIncidence( Incidence * );
+    void fillIncidence( Incidence * );
 
     /** Check if the input is valid. */
     bool validateInput();
Index: korganizer/calendarview.cpp
===================================================================
--- korganizer/calendarview.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/calendarview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -145,8 +145,6 @@
   mDateNavigator->setObjectName( "CalendarView::DateNavigator" );
 
 //  mLeftSplitter->setResizeMode( mDateNavigator, QSplitter::Stretch );
-  mLeftSplitter->setCollapsible( mLeftSplitter->indexOf(mDateNavigator), true );
-
   mTodoList = new KOTodoView( CalendarNull::self(), mLeftSplitter );
   mTodoList->setObjectName( "todolist" );
 
@@ -1256,6 +1254,7 @@
   if ( alarms.isEmpty() ) {
     // Add an alarm if it didn't have one
     Alarm *alm = incidence->newAlarm();
+    alm->setType( Alarm::Display );
     alm->setEnabled( true );
   }
   mChanger->changeIncidence( oldincidence, incidence, KOGlobals::ALARM_MODIFIED );
@@ -2141,18 +2140,28 @@
           i18n( "KOrganizer Confirmation" ),
           KGuiItem( i18n( "Delete All" ) ) );
       } else {
-        km = KOMessageBox::fourBtnMsgBox(
-          this,
-          QMessageBox::Warning,
-          i18n( "The calendar item \"%1\" recurs over multiple dates. "
-                "Do you want to delete only the current one on %2, only all "
-                "future recurrences, or all its recurrences?",
-                incidence->summary(),
-                KGlobal::locale()->formatDate( itemDate ) ),
-          i18n( "KOrganizer Confirmation" ),
-          KGuiItem( i18n( "Delete C&urrent" ) ),
-          KGuiItem( i18n( "Delete &Future" ) ),
-          KGuiItem( i18n( "Delete &All" ) ) );
+        KDateTime itemDateTime( itemDate, KOPrefs::instance()->timeSpec() );
+        bool isFirst = !incidence->recurrence()->getPreviousDateTime( itemDateTime ).isValid();
+        bool isLast  = !incidence->recurrence()->getNextDateTime( itemDateTime ).isValid();
+        KGuiItem itemFuture( i18n( "Delete &Future" ) );
+        itemFuture.setEnabled( !isFirst && !isLast );
+
+        if ( !( isFirst && isLast ) ) {
+          km = KOMessageBox::fourBtnMsgBox(
+            this,
+            QMessageBox::Warning,
+            i18n( "The calendar item \"%1\" recurs over multiple dates. "
+                  "Do you want to delete only the current one on %2, only all "
+                  "future recurrences, or all its recurrences?",
+                  incidence->summary(),
+                  KGlobal::locale()->formatDate( itemDate ) ),
+            i18n( "KOrganizer Confirmation" ),
+            KGuiItem( i18n( "Delete C&urrent" ) ),
+            itemFuture,
+            KGuiItem( i18n( "Delete &All" ) ) );
+        } else {
+          km = msgItemDelete( incidence );
+        }
       }
     }
     switch( km ) {
Index: korganizer/koeditorgeneraltodo.h
===================================================================
--- korganizer/koeditorgeneraltodo.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeditorgeneraltodo.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -65,7 +65,7 @@
     void readTodo( Todo *todo, bool tmpl = false );
 
     /** Write todo settings to event object */
-    void writeTodo( Todo * );
+    void fillTodo( Todo * );
 
     /** Check if the input is valid. */
     bool validateInput();
Index: korganizer/kojournaleditor.cpp
===================================================================
--- korganizer/kojournaleditor.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/kojournaleditor.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -136,7 +136,7 @@
 
   if ( mJournal ) {
     Journal *oldJournal = mJournal->clone();
-    writeJournal( mJournal );
+    fillJournal( mJournal );
     mChanger->changeIncidence( oldJournal, mJournal );
     delete oldJournal;
   } else {
@@ -144,7 +144,7 @@
     mJournal->setOrganizer( Person( KOPrefs::instance()->fullName(),
                             KOPrefs::instance()->email() ) );
 
-    writeJournal( mJournal );
+    fillJournal( mJournal );
 
     if ( !mChanger->addIncidence( mJournal, this ) ) {
       delete mJournal;
@@ -176,6 +176,16 @@
   mGeneral->setTime( time );
 }
 
+bool KOJournalEditor::incidenceModified() {
+  Journal *newJournal = 0;
+
+  if ( mJournal ) {
+    newJournal = mJournal->clone();
+    fillJournal( newJournal );
+  }
+  return mJournal && !( *newJournal == *mJournal );
+}
+
 void KOJournalEditor::readJournal( Journal *journal, bool tmpl )
 {
   //TODO: just tmpl variable
@@ -189,10 +199,10 @@
   mDetails->readIncidence( journal );
 }
 
-void KOJournalEditor::writeJournal( Journal *journal )
+void KOJournalEditor::fillJournal( Journal *journal )
 {
-  mGeneral->writeJournal( journal );
-  mDetails->writeIncidence( journal );
+  mGeneral->fillJournal( journal );
+  mDetails->fillIncidence( journal );
 }
 
 bool KOJournalEditor::validateInput()
@@ -229,7 +239,7 @@
 void KOJournalEditor::slotSaveTemplate( const QString &templateName )
 {
   Journal *journal = new Journal;
-  writeJournal( journal );
+  fillJournal( journal );
   saveAsTemplate( journal, templateName );
 }
 
Index: korganizer/koeditorattachments.cpp
===================================================================
--- korganizer/koeditorattachments.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeditorattachments.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -775,7 +775,7 @@
   }
 }
 
-void KOEditorAttachments::writeIncidence( KCal::Incidence *i )
+void KOEditorAttachments::fillIncidence( KCal::Incidence *i )
 {
   i->clearAttachments();
 
Index: korganizer/koincidenceeditor.cpp
===================================================================
--- korganizer/koincidenceeditor.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koincidenceeditor.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -86,8 +86,13 @@
 {
 }
 
+bool KOIncidenceEditor::incidenceModified() {
+  return true;
+}
+
 void KOIncidenceEditor::slotButtonClicked( int button )
 {
+  bool dontQuit = false;
   switch( button ) {
   case KDialog::Ok:
   {
@@ -104,13 +109,16 @@
     processInput();
     break;
   case KDialog::Cancel:
-    if ( KMessageBox::questionYesNo(
-           this,
-           i18nc( "@info", "Do you really want to cancel?" ),
-           i18nc( "@title:window", "KOrganizer Confirmation" ) ) == KMessageBox::Yes ) {
-      processCancel();
-      KDialog::reject();
-    }
+    dontQuit = incidenceModified() &&
+               KMessageBox::questionYesNo(
+                 this,
+                 i18nc( "@info", "Do you really want to cancel?" ),
+                 i18nc( "@title:window", "KOrganizer Confirmation" ) ) == KMessageBox::No;
+
+    if ( !dontQuit ) {
+       processCancel();
+       KDialog::reject();
+     }
     break;
   default:
     KPageDialog::slotButtonClicked( button );
Index: korganizer/resourceview.cpp
===================================================================
--- korganizer/resourceview.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/resourceview.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -308,6 +308,8 @@
   connect( mDeleteButton, SIGNAL( clicked() ), SLOT( removeResource() ) );
   connect( mEditButton, SIGNAL( clicked() ), SLOT( editResource() ) );
 
+  setMinimumHeight( 50 );
+
   updateView();
 }
 
Index: korganizer/koeventpopupmenu.cpp
===================================================================
--- korganizer/koeventpopupmenu.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeventpopupmenu.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -103,6 +103,7 @@
     }
     for ( it = mRecurrenceItems.begin(); it != mRecurrenceItems.end(); ++it ) {
       (*it)->setVisible( mCurrentIncidence->recurs() );
+      (*it)->setEnabled( !mCurrentIncidence->isReadOnly() );
     }
     popup( QCursor::pos() );
   } else {
Index: korganizer/koeventviewer.cpp
===================================================================
--- korganizer/koeventviewer.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeventviewer.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -46,6 +46,7 @@
 {
   mIncidence = 0;
   setNotifyClick( true );
+  setMinimumHeight( 1 );
 }
 
 KOEventViewer::~KOEventViewer()
Index: korganizer/kcmconfigs/korganizer_configtime.desktop
===================================================================
--- korganizer/kcmconfigs/korganizer_configtime.desktop	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/kcmconfigs/korganizer_configtime.desktop	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -29,6 +29,7 @@
 Name[ja]=日付と時間
 Name[km]=កាលបរិច្ឆេទ និង​ពេលវេលា
 Name[ko]=시간과 날짜
+Name[lt]=Laikas ir data
 Name[lv]=Laiks un datums
 Name[nb]=Dato og klokkeslett
 Name[nds]=Tiet un Datum
Index: korganizer/incidencechanger.cpp
===================================================================
--- korganizer/incidencechanger.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/incidencechanger.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -314,21 +314,22 @@
     //        for group cheduling. Each implementation could then just do what
     //        it wants with the event. If no groupware is used,use the null
     //        pattern...
-    bool revert = KOPrefs::instance()->mUseGroupwareCommunication;
-    if ( revert &&
-        KOGroupware::instance()->sendICalMessage( 0,
-                                                  KCal::iTIPRequest,
-                                                  newinc, false, statusChanged ) ) {
+    bool success = true;
+    if ( KOPrefs::instance()->mUseGroupwareCommunication ) {
+      success = KOGroupware::instance()->sendICalMessage( 0,
+                                                          KCal::iTIPRequest,
+                                                          newinc, false, statusChanged );
+    }
+
+    if ( success ) {
       // Accept the event changes
       if ( action < 0 ) {
         emit incidenceChanged( oldinc, newinc );
       } else {
         emit incidenceChanged( oldinc, newinc, action );
       }
-      revert = false;
-    }
-
-    if ( revert ) {
+    } else {
+      // revert changes
       assignIncidence( newinc, oldinc );
       return false;
     }
Index: korganizer/koeditorgeneraljournal.h
===================================================================
--- korganizer/koeditorgeneraljournal.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeditorgeneraljournal.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -69,7 +69,7 @@
     /** Read journal object and setup widgets accordingly */
     void readJournal( Journal *, bool tmpl = false );
     /** Write journal settings to event object */
-    void writeJournal( Journal * );
+    void fillJournal( Journal * );
 
     /** Check if the input is valid. */
     bool validateInput();
Index: korganizer/koeditoralarms.cpp
===================================================================
--- korganizer/koeditoralarms.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koeditoralarms.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -199,6 +199,7 @@
   connect( this, SIGNAL(okClicked()), SLOT(slotOk()) );
   connect( this, SIGNAL(applyClicked()), SLOT(slotApply()) );
   init();
+  mWidget.mTypeEmailRadio->hide();
 }
 
 KOEditorAlarms::~KOEditorAlarms()
@@ -282,7 +283,7 @@
   mWidget.mRepeats->setChecked( alarm->repeatCount() > 0 );
   if ( alarm->repeatCount() > 0 ) {
     mWidget.mRepeatCount->setValue( alarm->repeatCount() );
-    mWidget.mRepeatInterval->setValue( alarm->snoozeTime().asSeconds() / 60 );
+    mWidget.mRepeatInterval->setValue( alarm->snoozeTime().asSeconds() / 60 ); // show as minutes
   }
   int id = 0;
 
@@ -355,7 +356,7 @@
   // Repeating
   if ( mWidget.mRepeats->isChecked() ) {
     alarm->setRepeatCount( mWidget.mRepeatCount->value() );
-    alarm->setSnoozeTime( mWidget.mRepeatInterval->value() );
+    alarm->setSnoozeTime( mWidget.mRepeatInterval->value() * 60 ); // convert back to seconds
   } else {
     alarm->setRepeatCount( 0 );
   }
Index: korganizer/koincidenceeditor.h
===================================================================
--- korganizer/koincidenceeditor.h	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koincidenceeditor.h	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -133,6 +133,11 @@
     void readDesignerFields( Incidence *i );
     void writeDesignerFields( Incidence *i );
 
+    /**
+      Returns true if the user made any alteration
+    */
+    virtual bool incidenceModified();
+
     // Returns the page widget. To remove the tab, just delete that one.
     QWidget *addDesignerTab( const QString &uifile );
 
Index: korganizer/koprefsdialog.cpp
===================================================================
--- korganizer/koprefsdialog.cpp	(.../tags/KDE/4.2.1/kdepim)	(wersja 942069)
+++ korganizer/koprefsdialog.cpp	(.../branches/KDE/4.2/kdepim)	(wersja 942069)
@@ -220,8 +220,14 @@
       QGridLayout *regionalLayout = new QGridLayout( regionalPage );
       regionalLayout->setSpacing( KDialog::spacingHint() );
 
+      QGroupBox *datetimeGroupBox =
+        new QGroupBox( i18nc( "@title:group", "General Time and Date" ), regionalPage );
+      regionalLayout->addWidget( datetimeGroupBox, 0, 0 );
+
+      QGridLayout *datetimeLayout = new QGridLayout( datetimeGroupBox );
+
       KHBox *timeZoneBox = new KHBox( regionalPage );
-      regionalLayout->addWidget( timeZoneBox, 0, 0, 1, 2 );
+      datetimeLayout->addWidget( timeZoneBox, 0, 0, 1, 2 );
 
       QLabel *timeZoneLabel = new QLabel( i18nc( "@label", "Time zone:" ), timeZoneBox );
       QString whatsThis = i18nc( "@info:whatsthis",
@@ -265,9 +271,20 @@
       mTimeZoneCombo->setCurrentIndex( nCurrentlySet );
       mTimeZoneCombo->setWhatsThis( whatsThis );
 
+      KPrefsWidTime *dayBegins =
+        addWidTime( KOPrefs::instance()->dayBeginsItem(), regionalPage );
+      datetimeLayout->addWidget( dayBegins->label(), 1, 0 );
+      datetimeLayout->addWidget( dayBegins->timeEdit(), 1, 1 );
+
+      QGroupBox *holidaysGroupBox =
+        new QGroupBox( i18nc( "@title:group", "Holidays" ), regionalPage );
+      regionalLayout->addWidget( holidaysGroupBox, 1, 0 );
+
+      QGridLayout *holidaysLayout = new QGridLayout( holidaysGroupBox );
+
       // holiday region selection
       KHBox *holidayRegBox = new KHBox( regionalPage );
-      regionalLayout->addWidget( holidayRegBox, 1, 0, 1, 2 );
+      holidaysLayout->addWidget( holidayRegBox, 1, 0, 1, 2 );
 
       QLabel *holidayLabel = new QLabel(
         i18nc( "@label", "Use holiday region:" ), holidayRegBox );
@@ -316,14 +333,9 @@
         }
       }
 
-      KPrefsWidTime *dayBegins =
-        addWidTime( KOPrefs::instance()->dayBeginsItem(), regionalPage );
-      regionalLayout->addWidget( dayBegins->label(), 2, 0 );
-      regionalLayout->addWidget( dayBegins->timeEdit(), 2, 1 );
-
       QGroupBox *workingHoursGroupBox =
         new QGroupBox( i18nc( "@title:group", "Working Hours" ), regionalPage );
-      regionalLayout->addWidget( workingHoursGroupBox, 3, 0, 1, 2 );
+      regionalLayout->addWidget( workingHoursGroupBox, 2, 0 );
 
       QBoxLayout *workingHoursLayout = new QVBoxLayout( workingHoursGroupBox );
 
@@ -385,16 +397,28 @@
       QGridLayout *defaultLayout = new QGridLayout( defaultPage );
       defaultLayout->setSpacing( KDialog::spacingHint() );
 
+      QGroupBox *timesGroupBox =
+        new QGroupBox( i18nc( "@title:group", "Appointments" ), defaultPage );
+      defaultLayout->addWidget( timesGroupBox, 0, 0 );
+
+      QGridLayout *timesLayout = new QGridLayout( timesGroupBox );
+
       KPrefsWidTime *defaultTime =
         addWidTime( KOPrefs::instance()->startTimeItem(), defaultPage );
-      defaultLayout->addWidget( defaultTime->label(), 0, 0 );
-      defaultLayout->addWidget( defaultTime->timeEdit(), 0, 1 );
+      timesLayout->addWidget( defaultTime->label(), 0, 0 );
+      timesLayout->addWidget( defaultTime->timeEdit(), 0, 1 );
 
       KPrefsWidDuration *defaultDuration =
         addWidDuration( KOPrefs::instance()->defaultDurationItem(), defaultPage );
-      defaultLayout->addWidget( defaultDuration->label(), 1, 0 );
-      defaultLayout->addWidget( defaultDuration->timeEdit(), 1, 1 );
+      timesLayout->addWidget( defaultDuration->label(), 1, 0 );
+      timesLayout->addWidget( defaultDuration->timeEdit(), 1, 1 );
 
+      QGroupBox *remindersGroupBox =
+        new QGroupBox( i18nc( "@title:group", "Reminders" ), defaultPage );
+      defaultLayout->addWidget( remindersGroupBox, 1, 0 );
+
+      QGridLayout *remindersLayout = new QGridLayout( remindersGroupBox );
+
       QStringList alarmList;
       alarmList << i18nc( "@item:inlistbox", "1 minute" )
                 << i18nc( "@item:inlistbox", "5 minutes" )
@@ -402,13 +426,13 @@
                 << i18nc( "@item:inlistbox", "15 minutes" )
                 << i18nc( "@item:inlistbox", "30 minutes" );
       QLabel *alarmLabel = new QLabel( i18nc( "@label", "Default reminder time:" ), defaultPage );
-      defaultLayout->addWidget( alarmLabel, 2, 0 );
+      remindersLayout->addWidget( alarmLabel, 0, 0 );
       alarmLabel->setWhatsThis( KOPrefs::instance()->alarmTimeItem()->whatsThis() );
       mAlarmTimeCombo = new KComboBox( defaultPage );
       mAlarmTimeCombo->setWhatsThis( KOPrefs::instance()->alarmTimeItem()->whatsThis() );
       connect( mAlarmTimeCombo, SIGNAL(activated(int)), SLOT(slotWidChanged()) );
       mAlarmTimeCombo->addItems( alarmList );
-      defaultLayout->addWidget( mAlarmTimeCombo, 2, 1 );
+      remindersLayout->addWidget( mAlarmTimeCombo, 0, 1 );
 
       defaultLayout->setRowStretch( 3, 1 );
       load();

Zmiany atrybutów dla: .
___________________________________________________________________
Dodane: svn:externals
   + 


